cscope 15 $HOME/sudiptac/shared_cache_bus_fix/m_cache -q 0000001368 0000519414
	@DAG_WCET.c

6 
	$d‘eùDœeùiÚ
Ğ
b¿nch
 *
bru
, 
block
 *
bv
 ) {

8 ifĞ
bru
->
bb
->
outgošg
[1] =ğ
bv
->
bbid
 )

9  
bru
->
jump_cÚd
;

11  
	`Ãg
Ğ
bru
->
jump_cÚd
 );

33 
	}
}

39 
	$»¡ÜeIncomšgCÚæiùs
() {

41 
i
, 
j
;

42 
´oûdu»
 *
p
;

43 
b¿nch
 *
br
;

45  
i
 = 0; i < 
num_´ocs
; i++ ) {

46 
p
 = 
´ocs
[
i
];

48  
j
 = 0; j < 
p
->
num_bb
; j++ ) {

49 
br
 = 
b¿nchli¡
[
i
][
j
];

50 ifĞ
br
 !ğ
NULL
 )

51 
br
->
num_aùive_šcfs
 = br->
num_šcfs
;

55 
	}
}

61 
	$š_£q_bef
Ğ
bbid
, 
rg‘
, *
bb_£q
, 
bb_Ën
 ) {

63 
i
;

65  
i
 = 
bb_Ën
 - 1; i >ğ0 && 
bb_£q
[i] !ğ
rg‘
; i-- )

66 ifĞ
bb_£q
[
i
] =ğ
bbid
 )

69 
	}
}

72 
	$efãùCªûÎed
Ğ
b¿nch
 *
br
, 
assign
 *
assg
, 
·th
 *
pv
, 
block
 **
bbli¡
, 
num_bb
 ) {

74 
i
, 
Ê
, 
id
;

76  
i
 = 0; i < 
num_bb
; i++ ) {

77 
id
 = 
bbli¡
[
i
]->
bbid
;

79 ifĞ
id
 =ğ
br
->
bb
->
bbid
 || 
	`š_£q_bef
Ğid, br->bb->bbid, 
pv
->
bb_£q
,…v->
bb_Ën
 )) {

81  
Ê
 = 0;†À< 
num_assign
[
br
->
bb
->
pid
][
id
];†n++ ) {

82 ifĞ
assg
 !ğ
NULL
 && 
assigÆi¡
[
br
->
bb
->
pid
][
id
][
Ê
] ==‡ssg )

84 ifĞ
	`¡r¡r
Ğ
br
->
d”i_Œ“
, 
assigÆi¡
[br->
bb
->
pid
][
id
][
Ê
]->d”i_Œ“ ) !ğ
NULL
 )

85  
id
;

90 
	}
}

93 
	$BBcÚæiùInP©h
Ğ
b¿nch
 *
bru
, 
dœeùiÚ
, 
block
 *
bv
, 
·th
 *
pv
, block **
bbli¡
, 
num_bb
 ) {

95 
cf
, 
id
;

96 
»s
;

97 
b¿nch
 *
br
;

100  
cf
 = 0; cà< 
bru
->
num_cÚæiùs
; cf++ ) {

101 
br
 = 
bru
->
cÚæiùs
[
cf
];

103 
id
 = 
	`fšdB¿nch
Ğ
br
, 
pv
->
b¿nch_eff
,…v->
b¿nch_Ën
 );

104 ifĞ
id
 == -1 )

107 
»s
 = 
pv
->
b¿nch_dœ
[
id
];

108 ifĞ
dœeùiÚ
 =ğ
bru
->
jump_cÚd
 && bru->
cÚæiùdœ_jump
[
cf
] =ğ
»s
 ||

109 
dœeùiÚ
 =ğ
	`Ãg
Ğ
bru
->
jump_cÚd
 ) && bru->
cÚæiùdœ_çÎ
[
cf
] =ğ
»s
 ) {

112 
id
 = 
	`efãùCªûÎed
Ğ
br
, 
NULL
, 
pv
, 
bbli¡
, 
num_bb
 );

114 ifĞ
id
 == -1 ) {

115 ifĞ
debug
 )

116 
	`´štf
Ğ"BB %d:%d~%d - %d(%d)\n", 
bru
->
bb
->
pid
, bru->bb->
bbid
, 
bv
->bbid, 
br
->bb->bbid, 
»s
 );

119 ifĞ
debug
 )

120 
	`´štf
Ğ"BB %d:%d~%d - %d(%dèÿnûl[%d]\n", 
bru
->
bb
->
pid
, bru->bb->
bbid
, 
bv
->bbid, 
br
->bb->bbid, 
»s
, 
id
 );

124 
	}
}

127 
	$BAcÚæiùInP©h
Ğ
block
 *
bu
, block *
bv
, 
·th
 *
pv
, block **
bbli¡
, 
num_bb
 ) {

129 
cf
, 
Ê
, 
id
;

130 
»s
;

131 
assign
 *
assg
;

132 
b¿nch
 *
br
;

134  
Ê
 = 0;†À< 
num_assign
[
bu
->
pid
][bu->
bbid
];†n++ ) {

135 
assg
 = 
assigÆi¡
[
bu
->
pid
][bu->
bbid
][
Ê
];

137  
cf
 = 0; cà< 
assg
->
num_cÚæiùs
; cf++ ) {

138 
br
 = 
assg
->
cÚæiùs
[
cf
];

140 
id
 = 
	`fšdB¿nch
Ğ
br
, 
pv
->
b¿nch_eff
,…v->
b¿nch_Ën
 );

141 ifĞ
id
 == -1 )

144 
»s
 = 
pv
->
b¿nch_dœ
[
id
];

145 ifĞ
assg
->
cÚæiùdœ
[
cf
] =ğ
»s
 ) {

148 
id
 = 
	`efãùCªûÎed
Ğ
br
, 
assg
, 
pv
, 
bbli¡
, 
num_bb
 );

150 ifĞ
id
 == -1 ) {

151 ifĞ
debug
 )

152 
	`´štf
Ğ"BA %d:%d - %d(%d)\n", 
bu
->
pid
, bu->
bbid
, 
br
->
bb
->bbid, 
»s
 );

155 ifĞ
debug
 )

156 
	`´štf
Ğ"BA %d:%d - %d(%dèÿnûl[%d]\n", 
bu
->
pid
, bu->
bbid
, 
br
->
bb
->bbid, 
»s
, 
id
 );

161 
	}
}

168 
	$assignsTo
Ğ
block
 *
bb
, *
addr
 ) {

170 
i
;

171  
i
 = 0; i < 
num_assign
[
bb
->
pid
][bb->
bbid
]; i++ )

172 ifĞ
	`¡r¡r
Ğ
addr
, 
assigÆi¡
[
bb
->
pid
][bb->
bbid
][
i
]->
d”i_Œ“
 ) !ğ
NULL
 )

175 
	}
}

182 
	$hasIncomšgCÚæiù
Ğ
b¿nch
 *
br
, 
dœ
, 
block
 **
bbli¡
, 
¡¬t
, 
num_bb
 ) {

184 
i
, 
j
, 
id
, 
brid
, 
pid
;

185 
b¿nch
 *
bc
;

186 
assign
 *
assg
;

188 ifĞ!
br
->
num_aùive_šcfs
 )

191 
pid
 = 
br
->
bb
->pid;

193  
i
 = 
¡¬t
; i < 
num_bb
; i++ ) {

194 
id
 = 
bbli¡
[
i
]->
bbid
;

196 ifĞ
br
->
š_cÚæiù
[
id
] ) {

199 
bc
 = 
b¿nchli¡
[
pid
][
id
];

200 ifĞ
bc
 !ğ
NULL
 ) {

201 
brid
 = 
	`fšdB¿nch
Ğ
br
, 
bc
->
cÚæiùs
, bc->
num_cÚæiùs
 );

202 ifĞ
brid
 !ğ-1 && ( 
bc
->
cÚæiùdœ_jump
[brid] =ğ
dœ
 || bc->
cÚæiùdœ_çÎ
[brid] == dir ))

207  
j
 = 0; j < 
num_assign
[
pid
][
id
]; j++ ) {

208 
assg
 = 
assigÆi¡
[
pid
][
id
][
j
];

209 
brid
 = 
	`fšdB¿nch
Ğ
br
, 
assg
->
cÚæiùs
,‡ssg->
num_cÚæiùs
 );

210 ifĞ
brid
 !ğ-1 && 
assg
->
cÚæiùdœ
[brid] =ğ
dœ
 )

216 
	}
}

223 
	$Œav”£
Ğ
pid
, 
block
 **
bbli¡
, 
num_bb
, *
š_deg»e
, 
ušt
 *
co¡
 ) {

225 
i
, 
j
, 
k
, 
id
, 
rid
, 
±
;

226 
dœeùiÚ
, 
ex‹nd
;

228 
·th
 *
pu
, *
pv
;

229 
block
 *
bu
, *
bv
;

230 
b¿nch
 *
bru
;

232  
i
 = 0; i < 
num_bb
; i++ ) {

233 
bu
 = 
bbli¡
[
i
];

234 
bru
 = 
b¿nchli¡
[
pid
][
bu
->
bbid
];

239 ifĞ!
bu
->
num_outgošg
 ) {

242 
pu
 = (
·th
*è
	`MALLOC
(…u, (path), "path" );

243 
pu
->
co¡
 = co¡[
bu
->
bbid
];

244 
pu
->
bb_Ën
 = 1;

245 
pu
->
bb_£q
 = (*è
	`MALLOC
(…u->bb_seq, (), "path bb_seq" );

246 
pu
->
bb_£q
[0] = 
bu
->
bbid
;

247 
pu
->
b¿nch_Ën
 = 0;

248 
pu
->
b¿nch_eff
 = 
NULL
;

249 
pu
->
b¿nch_dœ
 = 
NULL
;

251 
num_·ths
[
bu
->
bbid
]++;

252 
·thli¡
[
bu
->
bbid
] = (
·th
**)

253 
	`REALLOC
Ğ
·thli¡
[
bu
->
bbid
], 
num_·ths
[bu->bbid] * (
·th
*), "pathlistƒlm" );

254 
·thli¡
[
bu
->
bbid
][ 
num_·ths
[bu->bbid]-1 ] = 
pu
;

259  
j
 = 0; j < 
bu
->
num_outgošg
; j++ ) {

261 
id
 = 
	`g‘block
Ğ
bu
->
outgošg
[
j
], 
bbli¡
, 0, 
i
-1 );

262 ifĞ
id
 == -1 )

263 
	`´štf
Ğ"Block %d-%d‚Ù found.\n", 
pid
, 
bu
->
outgošg
[
j
] ), 
	`ex™
(1);

265 
bv
 = 
bbli¡
[
id
];

268  
±
 = 0;…ˆ< 
num_·ths
[
bv
->
bbid
];…t++ ) {

269 
pv
 = 
·thli¡
[
bv
->
bbid
][
±
];

272 ifĞ
bru
 !ğ
NULL
 ) {

274 
dœeùiÚ
 = 
	`d‘eùDœeùiÚ
Ğ
bru
, 
bv
 );

296 
pu
 = (
·th
*è
	`MALLOC
(…u, (path), "path" );

297 
pu
->
bb_Ën
 = 
pv
->bb_len + 1;

299 
pu
->
co¡
 = 
pv
->co¡ + co¡[
bu
->
bbid
];

302 ifĞ
»giÚmode
 ) {

304 ifĞ
bu
->
ÿÎpid
 != -1 )

305 
rid
 = 
´ocs
[
bu
->
ÿÎpid
]->
bbli¡
[…rocs[bu->ÿÎpid]->
num_bb
 - 1 ]->
»gid
;

307 ifĞ
bu
->
ÿÎpid
 =ğ-1 || 
rid
 == -1 ) {

308 ifĞ
bu
->
»gid
 !ğ-1 && 
bv
->regid != -1 && bu->regid != bv->regid ) {

309 
	`´štf
( "regionransition %d-%d(%d) --> %d-%d(%d) cost: %u\n",

310 
bu
->
pid
, bu->
bbid
, bu->
»gid
, 
bv
->pid, bv->bbid, bv->»gid, 
»giÚco¡
[bv->regid] );

311 
	`fæush
Ğ
¡dout
 );

312 
pu
->
co¡
 +ğ
»giÚco¡
[
bv
->
»gid
];

317 ifĞ
rid
 !ğ-1 && 
bv
->
»gid
 != -1 &&„id != bv->regid ) {

318 
	`´štf
( "regionransition %d-%d(%d)…rocedure„eturn %d(%d) --> %d-%d(%d) cost: %u\n",

319 
bu
->
pid
, bu->
bbid
, bu->
»gid
, bu->
ÿÎpid
, 
rid
,

320 
bv
->
pid
, bv->
bbid
, bv->
»gid
, 
»giÚco¡
[bv->»gid] ); 
	`fæush
Ğ
¡dout
 );

321 
pu
->
co¡
 +ğ
»giÚco¡
[
bv
->
»gid
];

327 
ex‹nd
 = 0;

328 ifĞ
bru
 !ğ
NULL
 && 
	`hasIncomšgCÚæiù
Ğbru, 
dœeùiÚ
, 
bbli¡
, 
i
+1, 
num_bb
 ))

329 
ex‹nd
 = 1;

331 
pu
->
b¿nch_Ën
 = 
pv
->branch_len;

332 ifĞ
ex‹nd
 )

333 
pu
->
b¿nch_Ën
++;

335 
pu
->
bb_£q
 = (*è
	`MALLOC
Ğpu->bb_£q,…u->
bb_Ën
 * (), "path bb_seq" );

336 
pu
->
b¿nch_eff
 = (
b¿nch
**)

337 
	`MALLOC
Ğ
pu
->
b¿nch_eff
,…u->
b¿nch_Ën
 * (
b¿nch
*), "path branch_eff" );

338 
pu
->
b¿nch_dœ
 = (*)

339 
	`MALLOC
Ğ
pu
->
b¿nch_dœ
,…u->
b¿nch_Ën
 * (), "path branch_dir" );

341 
	`cİySeq
Ğ
pu
, 
pv
 );

342 
pu
->
bb_£q
[…u->
bb_Ën
 - 1 ] = 
bu
->
bbid
;

344 ifĞ
ex‹nd
 )

345 
	`sÜ‹dIn£¹B¿nch
Ğ
pu
, 
bru
, 
dœeùiÚ
 );

347 
num_·ths
[
bu
->
bbid
]++;

348 
·thli¡
[
bu
->
bbid
] = (
·th
**)

349 
	`REALLOC
Ğ
·thli¡
[
bu
->
bbid
], 
num_·ths
[bu->bbid] * (
·th
*), "pathlistƒlm" );

350 
·thli¡
[
bu
->
bbid
][ 
num_·ths
[bu->bbid]-1 ] = 
pu
;

356 ifĞ
num_·ths
[
bu
->
bbid
] <= 0 )

357 
	`´štf
Ğ"\nNØãasibË…©h‡ˆ%d-%d!\n\n", 
pid
, 
bu
->
bbid
 ), 
	`ex™
(1);

367  
j
 = 0; j < 
´ocs
[
pid
]->
num_bb
; j++ ) {

368 
bru
 = 
b¿nchli¡
[
pid
][
j
];

369 ifĞ
bru
 !ğ
NULL
 && bru->
š_cÚæiù
[
bu
->
bbid
] )

370 
bru
->
num_aùive_šcfs
--;

374  
±
 = 0;…ˆ< 
num_·ths
[
bu
->
bbid
];…t++ ) {

375 
pu
 = 
·thli¡
[
bu
->
bbid
][
±
];

378 
k
 = 0;

379  
k
 < 
pu
->
b¿nch_Ën
 ) {

382 ifĞ!
pu
->
b¿nch_eff
[
k
]->
num_aùive_šcfs


383 || 
	`assignsTo
Ğ
bu
, 
pu
->
b¿nch_eff
[
k
]->
d”i_Œ“
 ))

384 
	`»moveB¿nch
Ğ
pu
, 
k
 );

386 
k
++;

392 ifĞ
num_·ths
[
bu
->
bbid
] > 1 ) {

395 
	`sÜtP©h
Ğ
·thli¡
[
bu
->
bbid
], 
num_·ths
[bu->bbid] );

397  
±
 = 0;…ˆ< 
num_·ths
[
bu
->
bbid
] - 1;…t++ ) {

398 
pu
 = 
·thli¡
[
bu
->
bbid
][
±
];

400  
k
 = 
±
 + 1; k < 
num_·ths
[
bu
->
bbid
]; k++ ) {

401 
pv
 = 
·thli¡
[
bu
->
bbid
][
k
];

405 ifĞ
	`sub£tCÚæiù
Ğ
pv
, 
pu
 )) {

406 
pu
->
bb_Ën
 = -1;

412 
id
 = -1;

413  
±
 = 0;…ˆ< 
num_·ths
[
bu
->
bbid
];…t++ ) {

414 
pu
 = 
·thli¡
[
bu
->
bbid
][
±
];

416 ifĞ
pu
->
bb_Ën
 == -1 ) {

418 
	`ä“P©h
Ğ
bu
->
bbid
, 
±
 );

419 ifĞ
id
 == -1 )

420 
id
 = 
±
;

423 ifĞ
id
 > -1 )

424 
·thli¡
[
bu
->
bbid
][
id
++] = 
pu
;

427 ifĞ
id
 > -1 )

428 
num_·ths
[
bu
->
bbid
] = 
id
;

432 ifĞ
num_·ths
[
bu
->
bbid
] > 
max_·ths
 )

433 
max_·ths
 = 
num_·ths
[
bu
->
bbid
];

436  
j
 = 0; j < 
bu
->
num_outgošg
; j++ )

437 
š_deg»e
[ 
bu
->
outgošg
[
j
] ]--;

440  
j
 = 0; j < 
num_bb
 - 1; j++ ) {

441 
id
 = 
bbli¡
[
j
]->
bbid
;

442 ifĞ
š_deg»e
[
id
] =ğ0 && 
·thF»ed
[id] == 0 ) {

443 
	`ä“P©hsInNode
Ğ
id
 );

444 
·thF»ed
[
id
] = 1;

448 ifĞ
debug
 == 2 ) {

449 
	`´štf
Ğ"P©h © %d-%d: %d\n", 
pid
, 
bu
->
bbid
, 
num_·ths
[bu->bbid] );

450 ifĞ
debug
 == 2 ) {

451  
±
 = 0;…ˆ< 
num_·ths
[
bu
->
bbid
];…t++ )

452 
	`´štP©h
Ğ
·thli¡
[
bu
->
bbid
][
±
] );

453 
	`´štf
( "\n" );

460 
	}
}

463 
·th
* 
	$fšd_WCETP©h
Ğ
pid
, 
block
 **
bbli¡
, 
num_bb
, *
š_deg»e
, 
ušt
 *
co¡
 ) {

465 
i
, 
id
, 
¡¬t
;

466 
num
;

467 
ušt
 
WCET
;

468 
·th
 *
p
;

470 
num
 = 
´ocs
[
pid
]->
num_bb
;

472 
·thF»ed
 = (*è
	`CALLOC
Ğ·thF»ed, 
num
, (), "pathFreed" );

473 
num_·ths
 = (*è
	`CALLOC
Ğnum_·ths, 
num
, (), "num_paths" );

474 
·thli¡
 = (
·th
***è
	`MALLOC
Ğ·thli¡, 
num
 * (path**), "pathlist" );

475  
i
 = 0; i < 
num
; i++ )

476 
·thli¡
[
i
] = 
NULL
;

478 
	`»¡ÜeIncomšgCÚæiùs
();

480 
max_·ths
 = 0;

483 
	`Œav”£
Ğ
pid
, 
bbli¡
, 
num_bb
, 
š_deg»e
, 
co¡
 );

486 
¡¬t
 = 
bbli¡
[
num_bb
 - 1]->
bbid
;

487 
id
 = -1;

488 
WCET
 = 0;

490  
i
 = 0; i < 
num_·ths
[
¡¬t
]; i++ ) {

491 ifĞ
·thli¡
[
¡¬t
][
i
]->
co¡
 > 
WCET
 ) {

492 
id
 = 
i
;

493 
WCET
 = 
·thli¡
[
¡¬t
][
i
]->
co¡
;

496 ifĞ
id
 == -1 )

497 
	`´štf
Ğ"E¼Ü:‚Øwûˆ·th s–eùed.\n" ), 
	`ex™
(1);

500 
p
 = (
·th
*è
	`MALLOC
(…, (path), "path" );

501 
p
->
co¡
 = 
·thli¡
[
¡¬t
][
id
]->cost;

502 
p
->
bb_Ën
 = 
·thli¡
[
¡¬t
][
id
]->bb_len;

504 
p
->
bb_£q
 = (*è
	`MALLOC
Ğp->bb_£q,…->
bb_Ën
 * (), "path bb_seq" );

505  
i
 = 0; i < 
·thli¡
[
¡¬t
][
id
]->
bb_Ën
; i++ )

506 
p
->
bb_£q
[
i
] = 
·thli¡
[
¡¬t
][
id
]->bb_seq[i];

509  
i
 = 0; i < 
num_bb
; i++ ) {

510 
id
 = 
bbli¡
[
i
]->
bbid
;

511 ifĞ
·thF»ed
[
id
] == 0 )

512 
	`ä“P©hsInNode
Ğ
id
 );

515 
	`ä“
Ğ
·thli¡
 );

516 
	`ä“
Ğ
num_·ths
 );

517 
	`ä“
Ğ
·thF»ed
 );

519  
p
;

520 
	}
}

	@analysis.c

1 
	$addF»q
Ğ
sk_t
 *
tc
, 
âid
, 
bbid
, 
äeq
 ) {

3 
i
;

4  
i
 = 0; i < 
tc
->
numMemBlocks
; i++ ) {

5 
mem_t
 *
mt
 = 
tc
->
memBlockLi¡
[
i
];

6 ifĞ
mt
->
âid
 =ğâid && mt->
bbid
 == bbid ) {

7 
mt
->
äeq
 += freq;

8  
i
;

11 
	`´štf
Ğ"W¬nšg: block %d-%d‚Ù found.\n", 
âid
, 
bbid
 );

13 
	}
}

16 
	$g‘NumF‘ch
Ğ
size
 ) {

18 
n
 = 
size
 / 
FETCH_SIZE
;

19 ifĞ
size
 % 
FETCH_SIZE
 == 0 )

20  
n
;

21  
n
+1;

22 
	}
}

25 
	$»adCo¡
() {

27 
FILE
 *
åŒ
;

28 *
f•©h
;

29 
i
, 
j
;

64 
i
 = 0; i < 
numCh¬ts
; i++)

66 
	`¥rštf
(
f•©h
, "š‹rã»/msc%d_wûtbût_%s", 
i
+1, 
times_™”©iÚ
);

67 
åŒ
 = 
	`İ’fe
Ğ
f•©h
, "r" );

69 
j
 = 0; j < 
msg
[
i
].
tİoLi¡L’
; j++)

70 
	`fsÿnf
(
åŒ
, "%Lu %Lu \n", &(
skLi¡
[
msg
[
i
].
tİoLi¡
[
j
]]->
ùimeHi
), &ÑaskLi¡[msg[i].tİoLi¡[j]]->
ùimeLo
));

72 
	`fşo£
Ğ
åŒ
 );

114 
	}
}

	@analysis.h

5 
	#PROC
 1

	)

6 
	#LOOP
 2

	)

9 
FILE
 *
	gpf
;

11 
uÎ
 *
	g’um_·ths_´oc
;

12 
uÎ
 *
	g’um_·ths_loİ
;

14 ****
	g’um_·thli¡
;

15 ***
	g’um_·thËn
;

17 
	gdo_šlše
 = 0;

	@analysisCache.c

5 
	~<¡dio.h
>

8 
ä“CacheS‘
(
ÿche_lše_way_t
 **
ÿche_£t
);

11 
´oûdu»
*

12 
cÚ¡ruùFunùiÚC®l
(
´oûdu»
 *
´o
, 
sk_t
 *
sk
);

15 
ÿche_¡©e
 *

16 
ÿlcuÏ‹FunùiÚC®l
(
pid
, 
ÿche_¡©e
 * 
befÜe
);

18 
block
*

19 
cİyBlock
(
block
 * 
bb
);

21 
loİ
*

22 
cİyLoİ
(
´oûdu»
 *
´oc
,…roûdu»* 
cİy_´oc
, 
loİ
* 
Í
);

24 
´oûdu»
*

25 
cİyFunùiÚ
(
´oûdu»
 *
´oc
);

28 
ä“AÎCacheS‹
();

31 
ä“AÎFunùiÚ
(
´oûdu»
 *
´oc
);

34 
ä“AÎLoİ
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
);

45 
ÿche_¡©e
*

46 
m­Loİ
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
);

48 
ÿche_¡©e
 *

49 
m­FunùiÚC®l
(
´oûdu»
 *
´oc
, 
ÿche_¡©e
 *
cs
);

53 
ÿlcuÏ‹CacheS‹
(
ÿche_lše_way_t
 **
mu¡
, cache_lše_way_ˆ**
may
, cache_lše_way_ˆ**
³rsi¡
, 
š¡r_addr
);

55 
ÿche_¡©e
 *

56 
cİyCacheS‹
(
ÿche_¡©e
 *
cs
);

58 
dump_ÿche_lše
(
ÿche_lše_way_t
 *
şw_a
);

64 
ä“CacheS‹
(
ÿche_¡©e
 *
cs
);

69 
ä“CacheS‹Loİ
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
);

72 
ä“CacheS‹FunùiÚ
(
´oûdu»
 *
´oc
);

77 
isInWay
(
’Œy
, *
’Œ›s
, 
num_’Œy
);

80 
isNev”InCache
(
addr
, 
ÿche_lše_way_t
**
may
);

83 
isInCache
(
addr
, 
ÿche_lše_way_t
**
mu¡
);

85 
ÿche_lše_way_t
 **

86 
uniÚCacheS‹
(
ÿche_lše_way_t
 ** 
şw_a
, cache_lše_way_ˆ**
şw_b
);

88 
ÿche_lše_way_t
 **

89 
š‹r£ùCacheS‹
(
ÿche_lše_way_t
 ** 
şw_a
, cache_lše_way_ˆ**
şw_b
);

91 
ÿche_lše_way_t
 **

92 
uniÚMaxCacheS‹
(
ÿche_lše_way_t
 ** 
şw_a
, cache_lše_way_ˆ**
şw_b
);

95 
	$logBa£2
(
n
)

97 
pow”
 = 0;

99 ià(
n
 <= 0 || (n & (n-1)) != 0)

101 
	`´štf
("log2() only works for…ositive…ower ofwo values\n");

104 
n
 >>= 1)

105 
pow”
++;

107  
pow”
;

108 
	}
}

114 
	$£t_ÿche_basic
(* 
cÚfigFe
)

117 
FILE
 *
åŒ
;

118 
ns
, 
Ç
, 
ls
, 
cmp
, 
i
;

119 
·th
[ 
MAX_LEN
 ];

121 
	`¥rštf
(
·th
, "ÿche_cÚfig/%s.cÚfig", 
cÚfigFe
);

122 
åŒ
 = 
	`fİ’
(
·th
, "r" );

123 
	`fsÿnf
Ğ
åŒ
, "%d %d %d %d", &
ns
, &
Ç
, &
ls
, &
cmp
);

125 
ÿche
.
ns
 =‚s;

126 
ÿche
.
Ç
 =‚a;

127 
ÿche
.
ls
 =†s;

128 
ÿche
.
cmp
 = cmp;

131 
ÿche
.
nsb
 = 
	`logBa£2
(ÿche.
ns
);

132 
ÿche
.
lsb
 = 
	`logBa£2
(ÿche.
ls
);

134 
ÿche
.
Áb
 = 
MAX_TAG_BITS
;

135 
ÿche
.
Á
 = 1 << cache.
Áb
;

137 
ÿche
.
t_sb
 = cache.
Áb
 + cache.
nsb
;

138 
ÿche
.
s_lb
 = cache.
nsb
 + cache.
lsb
;

139 
ÿche
.
Á_s
 = 1 << cache.
t_sb
;

141 
ÿche
.
l_msk
 = (1 << cache.
lsb
) - 1;

143 
ÿche
.
s_msk
 = 0;

144 
i
 = 1; i < 
ÿche
.
ns
; i <<= 1)

145 
ÿche
.
s_msk
 = cache.s_msk | 
i
;

146 
ÿche
.
s_msk
 = cache.s_msk << cache.
lsb
;

148 
ÿche
.
t_msk
 = 0;

149 
i
 = 1; i < 
ÿche
.
Á
; i <<= 1)

150 
ÿche
.
t_msk
 |ğ
i
;

151 
ÿche
.
t_msk
 = cache.t_msk << (ÿche.
lsb
 + cache.
nsb
);

153 
ÿche
.
t_s_msk
 = cache.
t_msk
 | cache.
s_msk
;

154 
	}
}

157 
	$dumpCacheCÚfig
()

159 
	`´štf
("Cache Configuration‡s follow:\n");

160 
	`´štf
("nubm” oà£t: %d\n", 
ÿche
.
ns
);

161 
	`´štf
("nubm” oàassocŸtiv™y: %d\n", 
ÿche
.
Ç
);

162 
	`´štf
("ÿchlšsize: %d\n", 
ÿche
.
ls
);

163 
	`´štf
("ÿchmis ³ÇÉy: %d\n", 
ÿche
.
cmp
);

164 
	`´štf
("nubm” oà£ˆb™: %d\n", 
ÿche
.
nsb
);

165 
	`´štf
("nubm” oàlšesizb™: %d\n", 
ÿche
.
lsb
);

166 
	`´štf
("£ˆmask: %u\n", 
ÿche
.
s_msk
);

167 
	`´štf
("g mask: %u\n", 
ÿche
.
t_msk
);

168 
	`´štf
("g + s‘ mask: %u\n", 
ÿche
.
t_s_msk
);

169 
	}
}

199 
block
*

200 
	$cİyBlock
(
block
 *
bb
)

202 
block
 * 
¤c
, *
cİy
;

203 
¤c
 = 
bb
;

204 
i
, 
j
;

206 
cİy
 = (
block
*è
	`CALLOC
(copy, 1, (block), "block");

208 
cİy
->
bbid
 = 
¤c
->bbid;

211 
cİy
->
pid
ğ
¤c
->pid;

212 
cİy
->
¡¬ddr
ğ
¤c
->startaddr;

214 
cİy
->
num_outgošg
 = 
¤c
->num_outgoing;

215 
cİy
->
num_outgošg_cİy
 = 
¤c
->num_outgoing_copy;

217 if(
cİy
->
num_outgošg
)

219 
cİy
->
outgošg
 = (*)
	`CALLOC
(cİy->outgošg, cİy->
num_outgošg
, (), "outgoing");

220 
i
 = 0; i < 
cİy
->
num_outgošg
; i++)

221 
cİy
->
outgošg
[
i
] = 
¤c
->outgoing[i];

223 
cİy
->
num_šcomšg
 = 
¤c
->num_incoming;

225 if(
cİy
->
num_šcomšg
)

227 
cİy
->
šcomšg
 = (*)
	`CALLOC
(cİy->šcomšg, cİy->
num_šcomšg
, (), "incoming");

228 
i
 = 0; i < 
cİy
->
num_šcomšg
; i++)

229 
cİy
->
šcomšg
[
i
] = 
¤c
->incoming[i];

231 
cİy
->
ÿÎpid
 = 
¤c
->callpid;

232 
cİy
->
size
 = 
¤c
->size;

240 
cİy
->
loİid
 = 
¤c
->loopid;

241 
cİy
->
is_loİh—d
 = 
¤c
->is_loophead;

242 
cİy
->
num_ÿche_ãtch
 = 
¤c
->num_cache_fetch;

246 
cİy
->
num_š¡r
 = 
¤c
->num_instr;

248 
cİy
->
š¡¾i¡
 = (
š¡r
 **)
	`CALLOC
(cİy->š¡¾i¡, cİy->
num_š¡r
, (instr *), "instruction†ist");

249 
i
 = 0; i < 
cİy
->
num_š¡r
; i++)

251 
cİy
->
š¡¾i¡
[
i
] = (
š¡r
*)
	`CALLOC
(copy->instrlist[i], 1, (instr), "instruction");

253 
j
 = 0; j < 
OP_LEN
; j++)

255 
cİy
->
š¡¾i¡
[
i
]->
addr
[
j
] = 
¤c
->instrlist[i]->addr[j];

256 
cİy
->
š¡¾i¡
[
i
]->
İ
[
j
] = 
¤c
->instrlist[i]->op[j];

257 
cİy
->
š¡¾i¡
[
i
]->
r1
[
j
] = 
¤c
->instrlist[i]->r1[j];

258 
cİy
->
š¡¾i¡
[
i
]->
r2
[
j
] = 
¤c
->instrlist[i]->r2[j];

259 
cİy
->
š¡¾i¡
[
i
]->
r3
[
j
] = 
¤c
->instrlist[i]->r3[j];

266  
cİy
;

267 
	}
}

270 
loİ
*

271 
	$cİyLoİ
(
´oûdu»
 *
´oc
,…roûdu»* 
cİy_´oc
, 
loİ
 *
Í
)

273 
loİ
 *
¤c
, *
cİy
;

274 
¤c
 = 
Í
;

275 
i
;

277 
cİy
 = (
loİ
 *)
	`CALLOC
(copy, 1, (loop), "loop");

278 
cİy
->
Íid
 = 
¤c
->lpid;

281 
cİy
->
pid
 = 
¤c
->pid;

282 
cİy
->
loİbound
 = 
¤c
->loopbound;

285 
i
 = 
¤c
->
loİh—d
->
bbid
;

287 
cİy
->
loİh—d
 = 
cİy_´oc
->
bbli¡
[
i
];

289 
i
 = 
¤c
->
loİsšk
->
bbid
;

291 
cİy
->
loİsšk
ğ
cİy_´oc
->
bbli¡
[
i
];

293 
i
 = 
¤c
->
loİex™
->
bbid
;

295 
cİy
->
loİex™
 = 
cİy_´oc
->
bbli¡
[
i
];

297 
cİy
->
Ëv–
 = 
¤c
->level;

298 
cİy
->
Ã¡
 = 
¤c
->nest;

299 
cİy
->
is_dowhe
ğ
¤c
->is_dowhile;

301 
cİy
->
num_tİo
 = 
¤c
->num_topo;

302 if(
cİy
->
num_tİo
)

304 
cİy
->
tİo
 = (
block
**)
	`CALLOC
(cİy->tİo, cİy->
num_tİo
, (block*), "topo");

305 
i
 = 0; i < 
cİy
->
num_tİo
; i++)

307 
cİy
->
tİo
[
i
] = 
cİy_´oc
->
bbli¡
[
¤c
->tİo[i]->
bbid
];

309 
cİy
->
num_co¡
 = 
¤c
->num_cost;

314  
cİy
;

315 
	}
}

318 
´oûdu»
*

319 
	$cİyFunùiÚ
(
´oûdu»
* 
´oc
)

321 
´oûdu»
 *
¤c
, *
cİy
;

322 
¤c
 = 
´oc
;

323 
i
;

325 
cİy
 = (
´oûdu»
*è
	`CALLOC
(copy, 1, (procedure), "procedure");

326 
cİy
->
pid
 = 
¤c
->pid;

330 
cİy
->
num_bb
 = 
¤c
->num_bb;

331 if(
cİy
->
num_bb
)

333 
cİy
->
bbli¡
 = (
block
**è
	`CALLOC
(cİy->bbli¡, cİy->
num_bb
, (block*), "block*");

334 
i
 = 0; i < 
cİy
->
num_bb
; i++)

335 
cİy
->
bbli¡
[
i
] = 
	`cİyBlock
(
¤c
->bblist[i]);

337 
cİy
->
num_loİs
 = 
¤c
->num_loops;

338 if(
cİy
->
num_loİs
)

340 
cİy
->
loİs
 = (
loİ
**)
	`CALLOC
(cİy->loİs, cİy->
num_loİs
, (loop*), "loops");

341 
i
 = 0; i < 
cİy
->
num_loİs
; i++)

342 
cİy
->
loİs
[
i
] = 
	`cİyLoİ
(
´oc
, cİy, 
¤c
->loops[i]);

345 
cİy
->
num_ÿÎs
 = 
¤c
->num_calls;

346 if(
cİy
->
num_ÿÎs
)

348 
cİy
->
ÿÎs
 = (*)
	`CALLOC
(cİy->ÿÎs, cİy->
num_ÿÎs
, (), "calls");

349 
i
 = 0; i < 
cİy
->
num_ÿÎs
; i++)

350 
cİy
->
ÿÎs
[
i
] = 
¤c
->calls[i];

353 
cİy
->
num_tİo
 = 
¤c
->num_topo;

354 if(
cİy
->
num_tİo
)

356 
cİy
->
tİo
 = (
block
**)
	`CALLOC
(cİy->tİo, cİy->
num_tİo
, (block*), "topo");

357 
i
 = 0; i < 
cİy
->
num_tİo
; i++)

359 
cİy
->
tİo
[
i
] = cİy->
bbli¡
[
¤c
->tİo[i]->
bbid
];

361 
cİy
->
wût
 = 
¤c
->wcet;

365  
cİy
;

366 
	}
}

369 
´oûdu»
*

370 
	$cÚ¡ruùFunùiÚC®l
(
´oûdu»
 *
´o
, 
sk_t
 *
sk
)

372 
´oûdu»
 *
p
 = 
	`cİyFunùiÚ
(
´o
);

374 
block
 * 
bb
;

375 
num_blk
 = 
p
->
num_bb
;

376 
i
, 
j
;

380 
j
 = 
	`šdexOfProc
(
p
->
pid
);

381 if(
j
 >= 0)

383 if(
sk
->
´oc_cg_±r
[
j
].
num_´oc
 == 0)

385 
sk
->
´oc_cg_±r
[
j
].
num_´oc
 = 1;

386 
sk
->
´oc_cg_±r
[
j
].
´oc
 = (
´oûdu»
**)
	`CALLOC
(task->proc_cg_ptr[j].proc, 1, (procedure*), "procedure*");

387 
sk
->
´oc_cg_±r
[
j
].
´oc
[0] = 
p
;

391 
sk
->
´oc_cg_±r
[
j
].
num_´oc
 ++;

392 
sk
->
´oc_cg_±r
[
j
].
´oc
 = (
´oûdu»
**è
	`REALLOC
Ñask->´oc_cg_±r[j].´oc,ask->´oc_cg_±r[j].
num_´oc
 * (procedure*), "procedure*");

393 
sk
->
´oc_cg_±r
[
j
].
´oc
[sk->´oc_cg_±r[j].
num_´oc
 -1] = 
p
;

400 
	`´štf
("\nprocedure does‚otƒxsit!exit\n");

401 
	`ex™
(1);

404 
i
 = 0 ; i < 
num_blk
; i++)

406 
bb
 = 
p
 ->
bbli¡
[
i
];

408 if(
bb
->
ÿÎpid
 != -1)

411 
bb
->
´oc_±r
 = 
	`cÚ¡ruùFunùiÚC®l
(
´ocs
[bb->
ÿÎpid
], 
sk
);

412 if(
´št
)

413 
	`´štf
("\nbb->´oc_±¸ğf%x fÜ bb[%d] c®lšg…roc[%d]\n", ()
bb
->
´oc_±r
, bb->
bbid
, bb->
ÿÎpid
);

432 if(
´št
è
	`´štf
("\ncopy over\n");

436  
p
;

437 
	}
}

444 
	$cÚ¡ruùAÎ
(
sk_t
 *
sk
)

446 
´oûdu»
 *
p
 = 
´ocs
[ 
maš_id
 ];

468 
maš_cİy
 = 
	`cÚ¡ruùFunùiÚC®l
Ğ
p
, 
sk
);

470 
	}
}

474 
	$ÿlcuÏ‹Mu¡
(
ÿche_lše_way_t
 **
mu¡
, 
š¡r_addr
)

476 
i
, 
j
, 
k
, *

;

477 
š¡r_addr
 = 
	`TAGSET
(instr_addr);

479 
i
 = 0; i < 
ÿche
.
Ç
; i++)

481 if(
	`isInWay
(
š¡r_addr
, 
mu¡
[
i
]->
’Œy
, mu¡[i]->
num_’Œy
))

483 if(
i
 != 0)

485 
mu¡
[0]->
num_’Œy
++;

486 if(
mu¡
[0]->
num_’Œy
 =ğ1èmu¡[0]->
’Œy
 = (*)
	`CALLOC
(must[0]->entry, must[0]->num_entry, (), "enties");

487 
mu¡
[0]->
’Œy
 = (*)
	`REALLOC
(mu¡[0]->’Œy, (mu¡[0]->
num_’Œy
) * (), "enties");

489 
mu¡
[0]->
’Œy
[(mu¡[0]->
num_’Œy
è-1] = 
š¡r_addr
;

492 
j
 = 0; j < 
mu¡
[
i
]->
num_’Œy
; j++)

494 if(
mu¡
[
i
]->
’Œy
[
j
] =ğ
š¡r_addr
)

496 if(
j
 !ğ
mu¡
[
i
]->
num_’Œy
 -1)

497 
mu¡
[
i
]->
’Œy
[
j
] = mu¡[i]->’Œy[mu¡[i]->
num_’Œy
 -1];

498 
mu¡
[
i
]->
num_’Œy
 --;

499 if(
mu¡
[
i
]->
num_’Œy
 =ğ0è
	`ä“
(mu¡[i]->
’Œy
);

500 
mu¡
[
i
]->
’Œy
 = (*)
	`REALLOC
(mu¡[i]->’Œy, mu¡[i]->
num_’Œy
 * (), "entry");

509 
ÿche_lše_way_t
 * 
tmp
 = 
mu¡
[
ÿche
.
Ç
 -1];

510 
ÿche_lše_way_t
 *
h—d
 = 
NULL
;

512 
i
 = 
ÿche
.
Ç
 - 1; i > 0 ; i--)

513 
mu¡
[
i
] = must[i -1];

515 
	`ä“
(
tmp
);

519 
h—d
 = (
ÿche_lše_way_t
 *)
	`CALLOC
(head, 1, (cache_line_way_t), "cache_line_way_t");

520 
h—d
->
’Œy
 = (*)
	`CALLOC
(head->entry, 1, (), "in head->entry");

521 
h—d
->
’Œy
[0] = 
š¡r_addr
;

522 
h—d
->
num_’Œy
 = 1;

523 
mu¡
[0] = 
h—d
;

524 
	}
}

528 
	$ÿlcuÏ‹May
(
ÿche_lše_way_t
 **
may
, 
š¡r_addr
)

530 
i
, 
j
, *

;

531 
š¡r_addr
 = 
	`TAGSET
(instr_addr);

533 
i
 = 0; i < 
ÿche
.
Ç
; i++)

535 if(
	`isInWay
(
š¡r_addr
, 
may
[
i
]->
’Œy
, may[i]->
num_’Œy
))

537 if(
i
 != 0)

539 
may
[0]->
num_’Œy
++;

540 if(
may
[0]->
num_’Œy
 == 1)

542 
may
[0]->
’Œy
 = (*)
	`CALLOC
(may[0]->’Œy, may[0]->
num_’Œy
, (), "enties");

546 
may
[0]->
’Œy
 = (*)
	`REALLOC
(may[0]->’Œy, (may[0]->
num_’Œy
) * (), "enties");

548 
may
[0]->
’Œy
[(may[0]->
num_’Œy
è-1] = 
š¡r_addr
;

551 
j
 = 0; j < 
may
[
i
]->
num_’Œy
; j++)

553 if(
may
[
i
]->
’Œy
[
j
] =ğ
š¡r_addr
)

555 if(
j
 !ğ
may
[
i
]->
num_’Œy
 -1èmay[i]->
’Œy
[j] = may[i]->entry[may[i]->num_entry -1];

556 
may
[
i
]->
num_’Œy
 --;

557 if(
may
[
i
]->
num_’Œy
 == 0)

559 
	`ä“
(
may
[
i
]->
’Œy
);

563 
may
[
i
]->
’Œy
 = (*)
	`REALLOC
(may[i]->’Œy, may[i]->
num_’Œy
 * (), "entry");

572 
ÿche_lše_way_t
 * 
tmp
 = 
may
[
ÿche
.
Ç
 -1];

573 
ÿche_lše_way_t
 *
h—d
 = 
NULL
;

575 
i
 = 
ÿche
.
Ç
 - 1; i > 0 ; i--)

576 
may
[
i
] = may [i -1];

577 
	`ä“
(
tmp
);

580 
h—d
 = (
ÿche_lše_way_t
 *)
	`CALLOC
(head, 1, (cache_line_way_t), "cache_line_way_t");

581 
h—d
->
’Œy
 = (*)
	`CALLOC
(head->entry, 1, (), "in head->entry");

582 
h—d
->
’Œy
[0] = 
š¡r_addr
;

583 
h—d
->
num_’Œy
 = 1;

584 
may
[0] = 
h—d
;

585 
	}
}

591 
	$ÿlcuÏ‹P”si¡
(
ÿche_lše_way_t
 **
³rsi¡
, 
š¡r_addr
)

593 
i
, 
j
, *

;

594 
š¡r_addr
 = 
	`TAGSET
(instr_addr);

596 
i
 = 0; i < 
ÿche
.
Ç
; i++)

598 if(
	`isInWay
(
š¡r_addr
, 
³rsi¡
[
i
]->
’Œy
,…”si¡[i]->
num_’Œy
))

600 if(
i
 != 0)

602 
³rsi¡
[0]->
num_’Œy
++;

603 if(
³rsi¡
[0]->
num_’Œy
 == 1)

605 
³rsi¡
[0]->
’Œy
 = (*)
	`CALLOC
Õ”si¡[0]->’Œy,…”si¡[0]->
num_’Œy
, (), "enties");

609 
³rsi¡
[0]->
’Œy
 = (*)
	`REALLOC
Õ”si¡[0]->’Œy, (³rsi¡[0]->
num_’Œy
) * (), "enties");

611 
³rsi¡
[0]->
’Œy
[Õ”si¡[0]->
num_’Œy
è-1] = 
š¡r_addr
;

614 
j
 = 0; j < 
³rsi¡
[
i
]->
num_’Œy
; j++)

616 if(
³rsi¡
[
i
]->
’Œy
[
j
] =ğ
š¡r_addr
)

618 if(
j
 !ğ
³rsi¡
[
i
]->
num_’Œy
 -1è³rsi¡[i]->
’Œy
[j] =…ersist[i]->entry[persist[i]->num_entry -1];

619 
³rsi¡
[
i
]->
num_’Œy
 --;

620 if(
³rsi¡
[
i
]->
num_’Œy
 == 0)

622 
	`ä“
(
³rsi¡
[
i
]->
’Œy
);

626 
³rsi¡
[
i
]->
’Œy
 = (*)
	`REALLOC
Õ”si¡[i]->’Œy,…”si¡[i]->
num_’Œy
 * (), "entry");

635 
ÿche_lše_way_t
 * 
tmp
 = 
³rsi¡
[
ÿche
.
Ç
 ];

636 
ÿche_lše_way_t
 *
h—d
 = 
NULL
;

638 
i
 = 
ÿche
.
Ç
; i > 0 ; i--)

639 
³rsi¡
[
i
] =…ersist [i -1];

640 
	`ä“
(
tmp
);

643 
h—d
 = (
ÿche_lše_way_t
 *)
	`CALLOC
(head, 1, (cache_line_way_t), "cache_line_way_t");

644 
h—d
->
’Œy
 = (*)
	`CALLOC
(head->entry, 1, (), "in head->entry");

645 
h—d
->
’Œy
[0] = 
š¡r_addr
;

646 
h—d
->
num_’Œy
 = 1;

647 
³rsi¡
[0] = 
h—d
;

648 
	}
}

653 
	$ÿlcuÏ‹CacheS‹
(
ÿche_lše_way_t
 **
mu¡
, cache_lše_way_ˆ**
may
, cache_lše_way_ˆ**
³rsi¡
, 
š¡r_addr
)

657 
	`ÿlcuÏ‹Mu¡
(
mu¡
, 
š¡r_addr
);

658 
	`ÿlcuÏ‹May
(
may
, 
š¡r_addr
);

659 
	`ÿlcuÏ‹P”si¡
(
³rsi¡
, 
š¡r_addr
);

662 
	}
}

666 
ÿche_¡©e
 *

667 
	$®locCacheS‹
()

669 
i
, 
j
, 
k
;

670 
ÿche_¡©e
 *
»suÉ
 = 
NULL
;

679 
»suÉ
 = (
ÿche_¡©e
*è
	`CALLOC
(result, 1, (cache_state), "cache_state");

691 
»suÉ
->
mu¡
 = 
NULL
;

692 
»suÉ
->
mu¡
 = (
ÿche_lše_way_t
***)
	`CALLOC
ÔesuÉ->mu¡, 
ÿche
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

694 
»suÉ
->
may
 = 
NULL
;

695 
»suÉ
->
may
 = (
ÿche_lše_way_t
***)
	`CALLOC
ÔesuÉ->may, 
ÿche
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

697 
»suÉ
->
³rsi¡
 = 
NULL
;

698 
»suÉ
->
³rsi¡
 = (
ÿche_lše_way_t
***)
	`CALLOC
ÔesuÉ->³rsi¡, 
ÿche
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

700 
j
 = 0; j < 
ÿche
.
ns
; j++)

703 
»suÉ
->
mu¡
[
j
]ğ(
ÿche_lše_way_t
**è
	`CALLOC
ÔesuÉ->mu¡[j], 
ÿche
.
Ç
, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

705 
»suÉ
->
may
[
j
]ğ(
ÿche_lše_way_t
**)
	`CALLOC
ÔesuÉ->may[j], 
ÿche
.
Ç
, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

707 
»suÉ
->
³rsi¡
[
j
]ğ(
ÿche_lše_way_t
**)
	`CALLOC
ÔesuÉ->³rsi¡[j], 
ÿche
.
Ç
 + 1, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

709  
k
 = 0; k < 
ÿche
.
Ç
; k++)

712 
»suÉ
->
mu¡
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(result->must[j][k], 1, (cache_line_way_t), "one cache_line_way_t");

713 
»suÉ
->
mu¡
[
j
][
k
]->
num_’Œy
 = 0;

714 
»suÉ
->
mu¡
[
j
][
k
]->
’Œy
 = 
NULL
;

716 
»suÉ
->
may
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(result->may[j][k], 1, (cache_line_way_t), "one cache_line_way_t");

717 
»suÉ
->
may
[
j
][
k
]->
num_’Œy
 = 0;

718 
»suÉ
->
may
[
j
][
k
]->
’Œy
 = 
NULL
;

720 
»suÉ
->
³rsi¡
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(result->persist[j][k], 1, (cache_line_way_t), "one cache_line_way_t");

721 
»suÉ
->
³rsi¡
[
j
][
k
]->
num_’Œy
 = 0;

722 
»suÉ
->
³rsi¡
[
j
][
k
]->
’Œy
 = 
NULL
;

725 
»suÉ
->
³rsi¡
[
j
][
ÿche
.
Ç
] = (
ÿche_lše_way_t
*)
	`CALLOC
(result->persist[j][cache.na], 1, (cache_line_way_t), "one cache_line_way_t");

726 
»suÉ
->
³rsi¡
[
j
][
ÿche
.
Ç
]->
num_’Œy
 = 0;

727 
»suÉ
->
³rsi¡
[
j
][
ÿche
.
Ç
]->
’Œy
 = 
NULL
;

732  
»suÉ
;

733 
	}
}

824 
ÿche_¡©e
 *

825 
	$fixPoštCacheS‹
(
ÿche_¡©e
 *
cs_±r
, 
loİ
 *
Í
)

828 
	}
}

833 
	$isInS‘_³rsi¡
(
addr
, 
ÿche_lše_way_t
 **
£t
)

835 
i
;

836 
i
 = 0; i < 
ÿche
.
Ç
 + 1; i++)

838 if(
	`isInWay
(
addr
, 
£t
[
i
]->
’Œy
, s‘[i]->
num_’Œy
) == 1)

839  
i
;

842 
	}
}

845 
	$isInS‘
(
addr
, 
ÿche_lše_way_t
 **
£t
)

847 
i
;

848 
i
 = 0; i < 
ÿche
.
Ç
; i++)

850 if(
	`isInWay
(
addr
, 
£t
[
i
]->
’Œy
, s‘[i]->
num_’Œy
) == 1)

851  
i
;

854 
	}
}

858 
	$isInCache
(
addr
, 
ÿche_lše_way_t
**
mu¡
)

861 
i
;

862 
addr
 = 
	`TAGSET
(addr);

864 
i
 = 0; i < 
ÿche
.
Ç
; i++)

865 if(
	`isInWay
(
addr
, 
mu¡
[
i
]->
’Œy
, mu¡[i]->
num_’Œy
))

868 
	}
}

871 
	$isNev”InCache
(
addr
, 
ÿche_lše_way_t
**
may
)

874 
i
;

875 
addr
 = 
	`TAGSET
(addr);

876 
i
 = 0; i < 
ÿche
.
Ç
; i++)

877 if(
	`isInWay
(
addr
, 
may
[
i
]->
’Œy
, may[i]->
num_’Œy
))

881 
	}
}

884 
ÿche_¡©e
 *

885 
	$cİyCacheS‹
(
ÿche_¡©e
 *
cs
)

887 
i
, 
j
, 
k
, 
num_’Œy
, 
tmp
;

888 
ÿche_¡©e
 *
cİy
 = 
NULL
;

892 
cİy
 = (
ÿche_¡©e
*)
	`CALLOC
(copy, 1, (cache_state), "cache_state");

893 
cİy
->
mu¡
 = 
NULL
;

894 
cİy
->
may
 = 
NULL
;

895 
cİy
->
³rsi¡
 = 
NULL
;

902 
cİy
->
mu¡
 =(
ÿche_lše_way_t
***)
	`CALLOC
(cİy->mu¡, 
ÿche
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

903 
cİy
->
may
 =(
ÿche_lše_way_t
***)
	`CALLOC
(cİy->may, 
ÿche
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

904 
cİy
->
³rsi¡
 =(
ÿche_lše_way_t
***)
	`CALLOC
(cİy->³rsi¡, 
ÿche
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

906 
j
 = 0; j < 
ÿche
.
ns
; j++)

908 
cİy
->
mu¡
[
j
] = (
ÿche_lše_way_t
**è
	`CALLOC
(cİy->mu¡[j], 
ÿche
.
Ç
, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

909 
cİy
->
may
[
j
] = (
ÿche_lše_way_t
**è
	`CALLOC
(cİy->may[j], 
ÿche
.
Ç
, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

910 
cİy
->
³rsi¡
[
j
] = (
ÿche_lše_way_t
**è
	`CALLOC
(cİy->³rsi¡[j], 
ÿche
.
Ç
 + 1, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

913  
k
 = 0; k < 
ÿche
.
Ç
; k++)

915 
cİy
->
mu¡
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(copy->must[j][k], 1, (cache_line_way_t), "one cache_line_way_t must");

916 
cİy
->
may
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(copy->may[j][k], 1, (cache_line_way_t), "one cache_line_way_t may");

917 
cİy
->
³rsi¡
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(copy->persist[j][k], 1, (cache_line_way_t), "one cache_line_way_t may");

919 
cİy
->
mu¡
[
j
][
k
]->
num_’Œy
 = 
cs
->must[j][k]->num_entry;

920 if(
cİy
->
mu¡
[
j
][
k
]->
num_’Œy
)

922 
cİy
->
mu¡
[
j
][
k
]->
’Œy
 = (*)
	`CALLOC
(cİy->mu¡[j][k]->’Œy, cİy->mu¡[j][k]->
num_’Œy
, (), "entries");

924 
num_’Œy
 = 0;‚um_’Œy < 
cİy
->
mu¡
[
j
][
k
]->num_entry;‚um_entry++)

925 
cİy
->
mu¡
[
j
][
k
]->
’Œy
[
num_’Œy
] = 
cs
->must[j][k]->entry[num_entry];

928 
cİy
->
may
[
j
][
k
]->
num_’Œy
 = 
cs
->may[j][k]->num_entry;

929 if(
cİy
->
may
[
j
][
k
]->
num_’Œy
)

931 
cİy
->
may
[
j
][
k
]->
’Œy
 = (*)
	`CALLOC
(cİy->may[j][k]->’Œy, cİy->may[j][k]->
num_’Œy
, (), "entries");

933 
num_’Œy
 = 0;‚um_’Œy < 
cİy
->
may
[
j
][
k
]->num_entry;‚um_entry++)

934 
cİy
->
may
[
j
][
k
]->
’Œy
[
num_’Œy
] = 
cs
->may[j][k]->entry[num_entry];

938 
cİy
->
³rsi¡
[
j
][
k
]->
num_’Œy
 = 
cs
->persist[j][k]->num_entry;

939 if(
cİy
->
³rsi¡
[
j
][
k
]->
num_’Œy
)

941 
cİy
->
³rsi¡
[
j
][
k
]->
’Œy
 = (*)
	`CALLOC
(cİy->³rsi¡[j][k]->’Œy, cİy->³rsi¡[j][k]->
num_’Œy
, (), "entries");

943 
num_’Œy
 = 0;‚um_’Œy < 
cİy
->
³rsi¡
[
j
][
k
]->num_entry;‚um_entry++)

944 
cİy
->
³rsi¡
[
j
][
k
]->
’Œy
[
num_’Œy
] = 
cs
->persist[j][k]->entry[num_entry];

950 
cİy
->
³rsi¡
[
j
][
ÿche
.
Ç
] = (
ÿche_lše_way_t
*)
	`CALLOC
(copy->persist[j][cache.na], 1, (cache_line_way_t), "one cache_line_way_t may");

951 
cİy
->
³rsi¡
[
j
][
ÿche
.
Ç
]->
num_’Œy
 = 
cs
->persist[j][cache.na]->num_entry;

952 if(
cİy
->
³rsi¡
[
j
][
ÿche
.
Ç
]->
num_’Œy
)

954 
cİy
->
³rsi¡
[
j
][
ÿche
.
Ç
]->
’Œy
 = (*)
	`CALLOC
(cİy->³rsi¡[j][ÿche.Ç]->’Œy, cİy->³rsi¡[j][ÿche.Ç]->
num_’Œy
, (), "entries");

956 
num_’Œy
 = 0;‚um_’Œy < 
cİy
->
³rsi¡
[
j
][
ÿche
.
Ç
]->num_entry;‚um_entry++)

957 
cİy
->
³rsi¡
[
j
][
ÿche
.
Ç
]->
’Œy
[
num_’Œy
] = 
cs
->persist[j][cache.na]->entry[num_entry];

961  
cİy
;

962 
	}
}

966 
ÿche_¡©e
 *

967 
	$m­Loİ
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
)

969 
i
, 
j
, 
k
, 
n
, 
£t_no
, 
út
, 
tmp
, 
addr
, 
addr_Ãxt
, 
cİ›s
, 
g
, 
g_Ãxt
;

970 
¡¬t_addr
, 
¡¬t_addr_ãtch
, 
Í_Ëv–
, 
šcomšg_Í_Ëv–
;

972 
´oûdu»
 *
p
 = 
´oc
;

973 
block
 *
bb
, *
šcomšg_bb
;

974 
ÿche_¡©e
 *
cs_±r
, *
cs_tmp
;

975 
ÿche_lše_way_t
 **
şw
;

982 
num_blk
 = 
Í
->
num_tİo
;

987 
CHMC
 *
cu¼’t_chmc
;

990 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

991 if(
loİ_Ëv–_¬r
[
i
] =ğ
INVALID
)

993 
Í_Ëv–
 = 
i
 -1;

998 
út
 = 0;

999 
k
 = 0; k <ğ
Í_Ëv–
; k++)

1000 if(
loİ_Ëv–_¬r
 [
k
] =ğ
NEXT_ITERATION
)

1001 
út
 +ğ(1<<(
Í_Ëv–
 - 
k
));

1003 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

1007 
bb
 = 
Í
 ->
tİo
[
i
];

1009 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

1011 
bb
->
num_š¡r
 = bb->
size
 / 
INSN_SIZE
;

1013 if(
´št
è
	`´štf
("d—Èw™h bb[ %d ] iÀ´oc[%d]\n", 
bb
->
bbid
, bb->
pid
);

1015 if(
bb
->
is_loİh—d
 && 
i
 !ğ
num_blk
 -1)

1019 if(
´št
è
	`´štf
("\Áhfœ¡imgØštØloİ %d", 
bb
->
loİid
);

1020 
loİ_Ëv–_¬r
[
Í_Ëv–
 + 1] = 
FIRST_ITERATION
;

1021 
	`m­Loİ
(
p
,…->
loİs
[
bb
->
loİid
]);

1025 if(
´št
è
	`´štf
("\Áh£cÚdimgØštØloİ %d", 
bb
->
loİid
);

1026 
loİ_Ëv–_¬r
[
Í_Ëv–
 + 1] = 
NEXT_ITERATION
;

1027 
	`m­Loİ
(
p
,…->
loİs
[
bb
->
loİid
]);

1029 
loİ_Ëv–_¬r
[
Í_Ëv–
 + 1] = 
INVALID
;

1031 if(
´št
è
	`dumpCacheS‹
(
cs_±r
);

1042 if(
bb
->
is_loİh—d
 == 0)

1044 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[0]];

1046 #ifdeà
_DEBUG


1047 
	`årštf
(
¡dout
, "Calculating bb cache state of bbid = %d of…roc = %d‡t X1\n",

1048 
bb
->
bbid
, bb->
pid
);

1053 
cs_±r
 = 
	`cİyCacheS‹
(
šcomšg_bb
->
bb_ÿche_¡©e
);

1055 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
NEXT_ITERATION
 && 
šcomšg_bb
->
is_loİh—d
 == 0)

1057 
šcomšg_bb
->
num_outgošg
--;

1058 if(
šcomšg_bb
->
num_outgošg
 < 1 && incomšg_bb->
num_ÿche_¡©e
 == 1)

1060 
šcomšg_bb
->
num_ÿche_¡©e
 = 0;

1067 if(
bb
->
num_šcomšg
 > 1)

1073 
j
 = 1; j < 
bb
->
num_šcomšg
; j++)

1075 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[
j
]];

1077 if(
šcomšg_bb
->
bb_ÿche_¡©e
 =ğ
NULL
) ;

1079 
k
 = 0; k < 
ÿche
.
ns
; k++)

1081 
şw
 = 
cs_±r
->
mu¡
[
k
];

1082 
cs_±r
->
mu¡
[
k
] = 
	`š‹r£ùCacheS‹
(cs_±r->mu¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e
->must[k]);

1084 
	`ä“CacheS‘
(
şw
);

1086 
şw
 = 
cs_±r
->
may
[
k
];

1087 
cs_±r
->
may
[
k
] = 
	`uniÚCacheS‹
(cs_±r->may[k], 
šcomšg_bb
->
bb_ÿche_¡©e
->may[k]);

1089 
	`ä“CacheS‘
(
şw
);

1091 
şw
 = 
cs_±r
->
³rsi¡
[
k
];

1092 
cs_±r
->
³rsi¡
[
k
] = 
	`uniÚMaxCacheS‹
(cs_±r->³rsi¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e
->persist[k]);

1094 
	`ä“CacheS‘
(
şw
);

1097 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
NEXT_ITERATION
 && 
šcomšg_bb
->
is_loİh—d
 == 0)

1099 
šcomšg_bb
->
num_outgošg
--;

1100 if(
šcomšg_bb
->
num_outgošg
 < 1 && incomšg_bb->
num_ÿche_¡©e
 == 1)

1102 
šcomšg_bb
->
num_ÿche_¡©e
 = 0;

1117 if(
bb
->
is_loİh—d
 && 
i
 =ğ
num_blk
 - 1)

1119 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
FIRST_ITERATION
)

1121 #ifdeà
_DEBUG


1122 
	`årštf
(
¡dout
, "Calculating bb cache state of bbid = %d of…roc %d‡t X2\n",

1123 
bb
->
bbid
, bb->
pid
);

1125 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[0]];

1129 
cs_±r
 = 
	`cİyCacheS‹
(
šcomšg_bb
->
bb_ÿche_¡©e
);

1131 if(
bb
->
num_šcomšg
 > 1)

1137 
j
 = 1; j < 
bb
->
num_šcomšg
; j++)

1139 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[
j
]];

1143 
k
 = 0; k < 
ÿche
.
ns
; k++)

1145 
şw
 = 
cs_±r
->
mu¡
[
k
];

1146 
cs_±r
->
mu¡
[
k
] = 
	`š‹r£ùCacheS‹
(cs_±r->mu¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e
->must[k]);

1148 
	`ä“CacheS‘
(
şw
);

1150 
şw
 = 
cs_±r
->
may
[
k
];

1151 
cs_±r
->
may
[
k
] = 
	`uniÚCacheS‹
(cs_±r->may[k], 
šcomšg_bb
->
bb_ÿche_¡©e
->may[k]);

1153 
	`ä“CacheS‘
(
şw
);

1155 
şw
 = 
cs_±r
->
³rsi¡
[
k
];

1156 
cs_±r
->
³rsi¡
[
k
] = 
	`uniÚMaxCacheS‹
(cs_±r->³rsi¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e
->persist[k]);

1158 
	`ä“CacheS‘
(
şw
);

1166 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
NEXT_ITERATION
)

1171 
cs_±r
 = 
	`cİyCacheS‹
(
p
->
bbli¡
[
Í
->
tİo
[0]->
bbid
]->
bb_ÿche_¡©e
);

1195 
	`´štf
("\nCFGƒrror!\n");

1196 
	`ex™
(1);

1207 if(
bb
->
num_ÿche_¡©e
 == 0)

1211 
bb
->
num_ÿche_¡©e
 = 1;

1214 if(
bb
->
num_chmc
 == 0)

1217 
cİ›s
 = 2<<(
Í_Ëv–
);

1219 
bb
->
num_chmc
 = 
cİ›s
;

1221 
bb
->
chmc
 = (
CHMC
**)
	`CALLOC
(bb->chmc, 
cİ›s
, (CHMC*), "CHMC");

1222 
tmp
 = 0;m°< 
cİ›s
;mp++)

1224 
bb
->
chmc
[
tmp
] = (
CHMC
*)
	`CALLOC
(bb->chmc[tmp], 1, (CHMC), "CHMC");

1230 
bb
->
bb_ÿche_¡©e
 = 
cs_±r
;

1232 #ifdeà
_DEBUG


1233 
	`årštf
(
¡dout
, "Calculating bb cache state of bbid = %d of…roc %d‡t X3\n",

1234 
bb
->
bbid
, bb->
pid
);

1237 
cu¼’t_chmc
 = 
bb
->
chmc
[
út
];

1242 
cu¼’t_chmc
->
h™
 = 0;

1243 
cu¼’t_chmc
->
miss
 = 0;

1244 
cu¼’t_chmc
->
unknow
 = 0;

1246 
cu¼’t_chmc
->
wco¡
= 0;

1247 
cu¼’t_chmc
->
bco¡
= 0;

1271 
cu¼’t_chmc
->
h™miss
 = 
bb
->
num_š¡r
;

1273 
cu¼’t_chmc
->
h™miss_addr
 = (*)
	`CALLOC
(cu¼’t_chmc->h™miss_addr, cu¼’t_chmc->
h™miss
, (),"hitmiss_addr");

1277 
addr
 = 
bb
->
¡¬ddr
;

1278 
n
 = 0;‚ < 
bb
->
num_š¡r
 ;‚++)

1282 
£t_no
 = 
	`SET
(
addr
);

1284 if(
	`isInCache
(
addr
, 
bb
->
bb_ÿche_¡©e
->
mu¡
[
£t_no
]))

1286 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
ALWAYS_HIT
;

1289 if(
cu¼’t_chmc
->
h™
 == 0)

1291 
cu¼’t_chmc
->
h™
++;

1292 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1293 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1297 
cu¼’t_chmc
->
h™
++;

1298 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1299 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1303 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1304 
g
 = 
	`SET
(
addr
);

1305 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1306 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1308 
n
++;

1309 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

1311 if(
cu¼’t_chmc
->
h™
 == 0)

1313 
cu¼’t_chmc
->
h™
++;

1314 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1315 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1319 
cu¼’t_chmc
->
h™
++;

1320 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1321 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1324 
addr
 = 
addr_Ãxt
;

1325 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1327 
g
 = 
	`SET
(
addr
);

1328 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1332 if(
	`isNev”InCache
(
addr
, 
bb
->
bb_ÿche_¡©e
->
may
[
£t_no
]))

1334 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
ALWAYS_MISS
;

1337 if(
cu¼’t_chmc
->
miss
 == 0)

1339 
cu¼’t_chmc
->
miss
++;

1340 
cu¼’t_chmc
->
miss_addr
 = (*)
	`CALLOC
(current_chmc->miss_addr, 1, (), "miss_addr");

1341 
cu¼’t_chmc
->
miss_addr
[cu¼’t_chmc->
miss
-1] = 
addr
;

1345 
cu¼’t_chmc
->
miss
++;

1346 
cu¼’t_chmc
->
miss_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->miss_addr, cu¼’t_chmc->
miss
 * (), "miss_addr");

1347 
cu¼’t_chmc
->
miss_addr
[cu¼’t_chmc->
miss
-1] = 
addr
;

1351 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1352 
g
 = 
	`SET
(
addr
);

1353 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1354 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1356 
n
++;

1357 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
ALWAYS_HIT
;

1359 if(
cu¼’t_chmc
->
h™
 == 0)

1361 
cu¼’t_chmc
->
h™
++;

1362 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1363 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1367 
cu¼’t_chmc
->
h™
++;

1368 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1369 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1372 
addr
 = 
addr_Ãxt
;

1373 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1375 
g
 = 
	`SET
(
addr
);

1376 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1381 if(
	`isInCache
(
addr
, 
bb
->
bb_ÿche_¡©e
->
³rsi¡
[
£t_no
]))

1383 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
FIRST_MISS
;

1384 
Í
->
num_fm
 ++;

1388 if(
cu¼’t_chmc
->
h™
 == 0)

1390 
cu¼’t_chmc
->
h™
++;

1391 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1392 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1396 
cu¼’t_chmc
->
h™
++;

1397 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1398 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1402 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1403 
g
 = 
	`SET
(
addr
);

1404 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1405 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1407 
n
++;

1408 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

1410 if(
cu¼’t_chmc
->
h™
 == 0)

1412 
cu¼’t_chmc
->
h™
++;

1413 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1414 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1418 
cu¼’t_chmc
->
h™
++;

1419 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1420 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1423 
addr
 = 
addr_Ãxt
;

1424 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1426 
g
 = 
	`SET
(
addr
);

1427 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1434 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
UNKNOW
;

1437 if(
cu¼’t_chmc
->
unknow
 == 0)

1439 
cu¼’t_chmc
->
unknow
++;

1440 
cu¼’t_chmc
->
unknow_addr
 = (*)
	`CALLOC
(current_chmc->unknow_addr, 1, (), "unknow_addr");

1441 
cu¼’t_chmc
->
unknow_addr
[cu¼’t_chmc->
unknow
-1] = 
addr
;

1445 
cu¼’t_chmc
->
unknow
++;

1446 
cu¼’t_chmc
->
unknow_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->unknow_addr, cu¼’t_chmc->
unknow
 * (), "unknow_addr");

1447 
cu¼’t_chmc
->
unknow_addr
[cu¼’t_chmc->
unknow
-1] = 
addr
;

1450 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1451 
g
 = 
	`SET
(
addr
);

1452 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1453 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1455 
n
++;

1456 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
ALWAYS_HIT
;

1458 if(
cu¼’t_chmc
->
h™
 == 0)

1460 
cu¼’t_chmc
->
h™
++;

1461 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1462 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1466 
cu¼’t_chmc
->
h™
++;

1467 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1468 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1471 
addr
 = 
addr_Ãxt
;

1472 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1474 
g
 = 
	`SET
(
addr
);

1475 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1479 
addr
 =‡dd¸+ 
INSN_SIZE
;

1486 if(
´št
)

1491 
	`´štf
("\nbb->sizğ%d, bb->¡¬dd¸ğ%d\n", 
bb
->
size
, bb->
¡¬ddr
);

1492 
	`´štf
("h™ = %d, missğ%d, unknow = %d\n", 
cu¼’t_chmc
->
h™
, cu¼’t_chmc->
miss
, cu¼’t_chmc->
unknow
);

1493 
	`´štf
("\nwco¡ = %d, bco¡ = %d\n", 
cu¼’t_chmc
->
wco¡
, cu¼’t_chmc->
bco¡
);

1513 if(
bb
->
ÿÎpid
 != -1)

1517 
addr
 = 
bb
->
¡¬ddr
;

1519 
j
 = 0; j < 
bb
->
num_š¡r
; j++)

1521 
£t_no
 = 
	`SET
(
addr
);

1523 
	`ÿlcuÏ‹CacheS‹
(
bb
->
bb_ÿche_¡©e
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e->
may
[£t_no], bb->bb_ÿche_¡©e->
³rsi¡
[£t_no], 
addr
);

1527 
addr
 =‡dd¸+ 
INSN_SIZE
;

1529 
cs_±r
 = 
bb
->
bb_ÿche_¡©e
;

1530 
bb
->
bb_ÿche_¡©e
 = 
	`cİyCacheS‹
(
	`m­FunùiÚC®l
(bb->
´oc_±r
, 
cs_±r
));

1531 
	`ä“CacheS‹
(
cs_±r
);

1532 
cs_±r
 = 
NULL
;

1538 if(
´št
è
	`dumpCacheS‹
(
cs_±r
);

1543 
addr
 = 
bb
->
¡¬ddr
;

1544 
j
 = 0; j < 
bb
->
num_š¡r
; j++)

1546 
£t_no
 = 
	`SET
(
addr
);

1548 
	`ÿlcuÏ‹CacheS‹
(
bb
->
bb_ÿche_¡©e
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e->
may
[£t_no], bb->bb_ÿche_¡©e->
³rsi¡
[£t_no], 
addr
);

1552 
addr
 =‡dd¸+ 
INSN_SIZE
;

1556 if(
´št
è
	`dumpCacheS‹
(
cs_±r
);

1585  
NULL
;

1586 
	}
}

1589 
ÿche_¡©e
 *

1590 
	$m­FunùiÚC®l
(
´oûdu»
 *
´oc
, 
ÿche_¡©e
 *
cs
)

1592 
i
, 
j
, 
k
, 
n
, 
£t_no
, 
šcomšg_út
, 
út
, 
addr
, 
addr_Ãxt
, 
cİ›s
, 
tmp
;

1593 
¡¬t_addr
, 
¡¬t_addr_ãtch
, 
g
, 
g_Ãxt
, 
Í_Ëv–
, 
šcomšg_Í_Ëv–
;

1597 
´oûdu»
 *
p
 = 
´oc
;

1598 
block
 *
bb
, *
šcomšg_bb
;

1599 
ÿche_¡©e
 *
cs_±r
;

1600 
ÿche_lše_way_t
 **
şw
;

1601 
CHMC
 *
cu¼’t_chmc
;

1605 
cs_±r
 = 
	`cİyCacheS‹
(
cs
);

1609 
num_blk
 = 
p
->
num_tİo
;

1612 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

1613 if(
loİ_Ëv–_¬r
[
i
] =ğ
INVALID
)

1615 
Í_Ëv–
 = 
i
 -1;

1620 
út
 = 0;

1631 
k
 = 0; k <ğ
Í_Ëv–
; k++)

1632 if(
loİ_Ëv–_¬r
 [
k
] =ğ
NEXT_ITERATION
)

1633 
út
 +ğ(1<<(
Í_Ëv–
 - 
k
));

1637 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

1640 
bb
 = 
p
 ->
tİo
[
i
];

1643 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

1645 
bb
->
num_š¡r
 = bb->
size
 / 
INSN_SIZE
;

1647 if(
´št
è
	`´štf
("\nThi i  bb %d iÀ´oø%d\n", 
bb
->
bbid
, 
´oc
->
pid
);

1648 if(
bb
->
ÿÎpid
!= -1)

1649 if(
´št
è
	`´štBlock
(
bb
);

1653 if(
´št
è
	`´štf
("\nbb->num_šcomšg = %d\n", 
bb
->
num_šcomšg
);

1659 if(
bb
->
is_loİh—d
)

1667 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
FIRST_ITERATION
;

1669 
p
->
loİs
[
bb
->
loİid
]->
num_fm
 = 0;

1671 if(
´št
è
	`´štf
("\nThe firstime go into†oop\n");

1672 
	`m­Loİ
(
p
,…->
loİs
[
bb
->
loİid
]);

1678 if(
´št
è
	`´štf
("\nThe secondime go into†oop\n");

1681 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
NEXT_ITERATION
;

1682 
	`m­Loİ
(
p
,…->
loİs
[
bb
->
loİid
]);

1687 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
INVALID
;

1695 if(
bb
->
num_šcomšg
 > 0)

1697 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[0]];

1699 #ifdeà
_DEBUG


1700 
	`årštf
(
¡dout
, "Calculating bb cache state of bbid = %d of…roc %d‡t X4\n",

1701 
bb
->
bbid
, bb->
pid
);

1707 
cs_±r
 = 
	`cİyCacheS‹
(
šcomšg_bb
->
bb_ÿche_¡©e
);

1710 
šcomšg_bb
->
num_outgošg
--;

1711 if(
šcomšg_bb
->
num_outgošg
 < 1 && incomšg_bb->
num_ÿche_¡©e
 == 1)

1713 
šcomšg_bb
->
num_ÿche_¡©e
 = 0;

1719 if(
bb
->
num_šcomšg
 > 1)

1721 if(
´št
è
	`´štf
("\ndo operations if morehan one incomingƒdge\n");

1726 
j
 = 1; j < 
bb
->
num_šcomšg
; j++)

1728 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[
j
]];

1730 if(
šcomšg_bb
->
bb_ÿche_¡©e
 =ğ
NULL
) ;

1732 
k
 = 0; k < 
ÿche
.
ns
; k++)

1734 
şw
 = 
cs_±r
->
mu¡
[
k
];

1735 
cs_±r
->
mu¡
[
k
] = 
	`š‹r£ùCacheS‹
(cs_±r->mu¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e
->must[k]);

1737 
	`ä“CacheS‘
(
şw
);

1739 
şw
 = 
cs_±r
->
may
[
k
];

1740 
cs_±r
->
may
[
k
] = 
	`uniÚCacheS‹
(cs_±r->may[k], 
šcomšg_bb
->
bb_ÿche_¡©e
->may[k]);

1742 
	`ä“CacheS‘
(
şw
);

1744 
şw
 = 
cs_±r
->
³rsi¡
[
k
];

1745 
cs_±r
->
³rsi¡
[
k
] = 
	`uniÚMaxCacheS‹
(cs_±r->³rsi¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e
->persist[k]);

1747 
	`ä“CacheS‘
(
şw
);

1751 
šcomšg_bb
->
num_outgošg
--;

1752 if(
šcomšg_bb
->
num_outgošg
 < 1 && incomšg_bb->
num_ÿche_¡©e
 == 1)

1754 
šcomšg_bb
->
num_ÿche_¡©e
 = 0;

1760 if(
´št
è
	`dumpCacheS‹
(
cs_±r
);

1768 if(
bb
->
num_ÿche_¡©e
 == 0)

1770 
bb
->
num_ÿche_¡©e
 = 1;

1773 if(
bb
->
num_chmc
 == 0)

1775 if(
Í_Ëv–
 == -1)

1776 
cİ›s
 = 1;

1778 
cİ›s
 = 2<<(
Í_Ëv–
);

1780 
bb
->
num_chmc
 = 
cİ›s
;

1782 
bb
->
chmc
 = (
CHMC
**)
	`CALLOC
(bb->chmc, 
cİ›s
, (CHMC*), "CHMC");

1783 
tmp
 = 0;m°< 
cİ›s
;mp++)

1785 
bb
->
chmc
[
tmp
] = (
CHMC
*)
	`CALLOC
(bb->chmc[tmp], 1, (CHMC), "CHMC");

1790 #ifdeà
_DEBUG


1791 
	`årštf
(
¡dout
, "Calculating bb cache state of bbid = %d of…roc %d‡t X5\n",

1792 
bb
->
bbid
, bb->
pid
);

1795 
bb
->
bb_ÿche_¡©e
 = 
cs_±r
;

1799 if(
´št
)

1801 if(
cs_±r
->
may
[0][0]->
num_’Œy
)

1803 
tmp
 = 
cs_±r
->
may
[0][0]->
’Œy
[0];

1804 
	`´štf
("\Ám°ğ%d\n", 
tmp
);

1808 
cu¼’t_chmc
 = 
bb
->
chmc
[
út
];

1810 
cu¼’t_chmc
->
h™
 = 0;

1811 
cu¼’t_chmc
->
miss
 = 0;

1812 
cu¼’t_chmc
->
unknow
 = 0;

1814 
cu¼’t_chmc
->
wco¡
= 0;

1815 
cu¼’t_chmc
->
bco¡
= 0;

1825 
cu¼’t_chmc
->
h™miss
 = 
bb
->
num_š¡r
;

1827 
cu¼’t_chmc
->
h™miss_addr
 = (*)
	`CALLOC
(cu¼’t_chmc->h™miss_addr, cu¼’t_chmc->
h™miss
, (),"hitmiss_addr");

1831 
addr
 = 
bb
->
¡¬ddr
;

1832 
n
 = 0;‚ < 
bb
->
num_š¡r
 ;‚++)

1836 
£t_no
 = 
	`SET
(
addr
);

1838 if(
	`isInCache
(
addr
, 
bb
->
bb_ÿche_¡©e
->
mu¡
[
£t_no
]))

1840 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
ALWAYS_HIT
;

1843 if(
cu¼’t_chmc
->
h™
 == 0)

1845 
cu¼’t_chmc
->
h™
++;

1846 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1847 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1851 
cu¼’t_chmc
->
h™
++;

1852 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1853 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1856 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1857 
g
 = 
	`SET
(
addr
);

1858 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1859 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1861 
n
++;

1862 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

1864 if(
cu¼’t_chmc
->
h™
 == 0)

1866 
cu¼’t_chmc
->
h™
++;

1867 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1868 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1872 
cu¼’t_chmc
->
h™
++;

1873 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1874 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1877 
addr
 = 
addr_Ãxt
;

1878 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1880 
g
 = 
	`SET
(
addr
);

1881 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1885 if(
	`isNev”InCache
(
addr
, 
bb
->
bb_ÿche_¡©e
->
may
[
£t_no
]))

1887 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
ALWAYS_MISS
;

1890 if(
cu¼’t_chmc
->
miss
 == 0)

1892 
cu¼’t_chmc
->
miss
++;

1893 
cu¼’t_chmc
->
miss_addr
 = (*)
	`CALLOC
(current_chmc->miss_addr, 1, (), "miss_addr");

1894 
cu¼’t_chmc
->
miss_addr
[cu¼’t_chmc->
miss
-1] = 
addr
;

1898 
cu¼’t_chmc
->
miss
++;

1899 
cu¼’t_chmc
->
miss_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->miss_addr, cu¼’t_chmc->
miss
 * (), "miss_addr");

1900 
cu¼’t_chmc
->
miss_addr
[cu¼’t_chmc->
miss
-1] = 
addr
;

1903 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1904 
g
 = 
	`SET
(
addr
);

1905 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1906 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1908 
n
++;

1909 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

1911 if(
cu¼’t_chmc
->
h™
 == 0)

1913 
cu¼’t_chmc
->
h™
++;

1914 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1915 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1919 
cu¼’t_chmc
->
h™
++;

1920 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1921 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1924 
addr
 = 
addr_Ãxt
;

1925 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1927 
g
 = 
	`SET
(
addr
);

1928 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1933 if(
	`isInCache
(
addr
, 
bb
->
bb_ÿche_¡©e
->
³rsi¡
[ 
£t_no
 ]))

1935 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
FIRST_MISS
;

1938 if(
cu¼’t_chmc
->
h™
 == 0)

1940 
cu¼’t_chmc
->
h™
++;

1941 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1942 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1946 
cu¼’t_chmc
->
h™
++;

1947 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1948 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1951 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1952 
g
 = 
	`SET
(
addr
);

1953 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1954 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1956 
n
++;

1958 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

1960 if(
cu¼’t_chmc
->
h™
 == 0)

1962 
cu¼’t_chmc
->
h™
++;

1963 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1964 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1968 
cu¼’t_chmc
->
h™
++;

1969 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1970 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1973 
addr
 = 
addr_Ãxt
;

1974 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1976 
g
 = 
	`SET
(
addr
);

1977 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

1985 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
UNKNOW
;

1988 if(
cu¼’t_chmc
->
unknow
 == 0)

1990 
cu¼’t_chmc
->
unknow
++;

1991 
cu¼’t_chmc
->
unknow_addr
 = (*)
	`CALLOC
(current_chmc->unknow_addr, 1, (), "unknow_addr");

1992 
cu¼’t_chmc
->
unknow_addr
[cu¼’t_chmc->
unknow
-1] = 
addr
;

1996 
cu¼’t_chmc
->
unknow
++;

1997 
cu¼’t_chmc
->
unknow_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->unknow_addr, cu¼’t_chmc->
unknow
 * (), "unknow_addr");

1998 
cu¼’t_chmc
->
unknow_addr
[cu¼’t_chmc->
unknow
-1] = 
addr
;

2001 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

2002 
g
 = 
	`SET
(
addr
);

2003 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

2004 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

2006 
n
++;

2008 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

2010 if(
cu¼’t_chmc
->
h™
 == 0)

2012 
cu¼’t_chmc
->
h™
++;

2013 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

2014 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

2018 
cu¼’t_chmc
->
h™
++;

2019 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

2020 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

2023 
addr
 = 
addr_Ãxt
;

2024 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

2026 
g
 = 
	`SET
(
addr
);

2027 
g_Ãxt
 = 
	`SET
(
addr_Ãxt
);

2031 
addr
 =‡dd¸+ 
INSN_SIZE
;

2040 if(
´št
){

2042 
k
 = 0; k < 
cu¼’t_chmc
->
h™miss
; k++)

2043 
	`´štf
("L1: %d ", 
cu¼’t_chmc
->
h™miss_addr
[
k
]);

2044 
	`´štf
("\nbb->sizğ%d, bb->¡¬dd¸ğ%d\n", 
bb
->
size
, bb->
¡¬ddr
);

2045 
	`´štf
("h™ = %d, missğ%d, unknow = %d\n", 
cu¼’t_chmc
->
h™
, cu¼’t_chmc->
miss
, cu¼’t_chmc->
unknow
);

2046 
	`´štf
("\nwco¡ = %d, bco¡ = %d\n", 
cu¼’t_chmc
->
wco¡
, cu¼’t_chmc->
bco¡
);

2069 if(
bb
->
ÿÎpid
 != -1)

2073 
addr
 = 
bb
->
¡¬ddr
;

2075 
j
 = 0; j < 
bb
->
num_š¡r
; j++)

2077 
£t_no
 = 
	`SET
(
addr
);

2081 
	`ÿlcuÏ‹CacheS‹
(
bb
->
bb_ÿche_¡©e
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e->
may
[£t_no], bb->bb_ÿche_¡©e->
³rsi¡
[£t_no], 
addr
);

2085 
addr
 =‡dd¸+ 
INSN_SIZE
;

2090 
cs_±r
 = 
bb
->
bb_ÿche_¡©e
;

2093 
bb
->
bb_ÿche_¡©e
 = 
	`cİyCacheS‹
(
	`m­FunùiÚC®l
(bb->
´oc_±r
, 
cs_±r
));

2095 
	`ä“CacheS‹
(
cs_±r
);

2096 
cs_±r
 = 
NULL
;

2103 if(
´št
è
	`dumpCacheS‹
(
cs_±r
);

2109 
addr
 = 
bb
->
¡¬ddr
;

2110 
j
 = 0; j < 
bb
->
num_š¡r
; j ++)

2112 
£t_no
 = 
	`SET
(
addr
);

2116 
	`ÿlcuÏ‹CacheS‹
(
bb
->
bb_ÿche_¡©e
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e->
may
[£t_no], bb->bb_ÿche_¡©e->
³rsi¡
[£t_no], 
addr
);

2120 
addr
 =‡dd¸+ 
INSN_SIZE
;

2127 if(
´št
è
	`dumpCacheS‹
(
cs_±r
);

2132 
i
 = 0; i < 
p
->
num_bb
; i ++)

2133 
p
->
bbli¡
[
i
]->
num_outgošg
 =…->bbli¡[i]->
num_outgošg_cİy
;

2135  
p
 ->
bbli¡
[…->
tİo
[0]->
bbid
]->
bb_ÿche_¡©e
;

2136 
	}
}

2141 
	$ÿcheAÇlysis
(){

2142 
i
;

2146 
loİ_Ëv–_¬r
 = 
NULL
;

2147 
loİ_Ëv–_¬r
 = (*)
	`CALLOC
Öoİ_Ëv–_¬r, 
MAX_NEST_LOOP
, (), "loop_level_arr");

2149 
š¡r_³r_block
 = 
ÿche
.
ls
 / 
INSN_SIZE
;

2151 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

2152 
loİ_Ëv–_¬r
[
i
] = 
INVALID
;

2155 
ÿche_¡©e
 *
¡¬t_CS
;

2156 
block
 *
¡¬t_bb
;

2158 
¡¬t_CS
 = 
	`®locCacheS‹
();

2161 
¡¬t_CS
 = 
	`m­FunùiÚC®l
(
maš_cİy
, start_CS);

2166 
	}
}

2174 
	$isInWay
(
’Œy
, *
’Œ›s
, 
num_’Œy
)

2176 
i
;

2177 
i
 = 0; i < 
num_’Œy
; i++)

2178 if(
’Œy
 =ğ
’Œ›s
[
i
])

2182 
	}
}

2186 
ÿche_lše_way_t
 **

2187 
	$uniÚCacheS‹
(
ÿche_lše_way_t
 **
şw_a
, cache_lše_way_ˆ**
şw_b
)

2189 
i
, 
j
, 
k
, 
age
, 
šdex
, 
’Œy_a
, 
’Œy_b
, 
t
, 
n
, 
num_hi¡Üy
 = 0;

2190 *
hi¡Üy_’Œ›s
 = 
NULL
;

2192 
ÿche_lše_way_t
 **
»suÉ
 = (ÿche_lše_way_ˆ**è
	`CALLOC
ÔesuÉ, 
ÿche
.
Ç
, (cache_line_way_t*), "cache_line_way_t **");

2194 
i
 = 0; i < 
ÿche
.
Ç
; i++)

2196 
»suÉ
[
i
] = (
ÿche_lše_way_t
 *)
	`CALLOC
(result[i], 1, (cache_line_way_t), "cache_line_way_t *");

2197 
»suÉ
[
i
]->
num_’Œy
 = 0;

2198 
»suÉ
[
i
]->
’Œy
 = 
NULL
;

2202 
i
 = 0; i < 
ÿche
.
Ç
; i++)

2206 
j
 = 0 ; j < 
şw_a
[
i
]->
num_’Œy
; j++)

2208 
’Œy_a
 = 
şw_a
[
i
]->
’Œy
[
j
];

2210 
age
 = 
	`isInS‘
(
’Œy_a
, 
şw_b
);

2211 if(
age
 =ğ-1è
šdex
 = 
i
;

2212 if(
age
 < 
i
è
šdex
 =‡ge;

2215 
šdex
 = 
i
;

2218 
»suÉ
[
šdex
]->
num_’Œy
++;

2219 if(
»suÉ
[
šdex
]->
num_’Œy
 == 1)

2221 
»suÉ
[
šdex
]->
’Œy
 = (*)
	`CALLOC
ÔesuÉ[šdex]->’Œy,„esuÉ[šdex]->
num_’Œy
, (), "cache†ine way");

2225 
»suÉ
[
šdex
]->
’Œy
 = (*)
	`REALLOC
ÔesuÉ[šdex]->’Œy,„esuÉ[šdex]->
num_’Œy
 * (), "cache†ine way");

2227 
»suÉ
[
šdex
]->
’Œy
[»suÉ[šdex]->
num_’Œy
 - 1] = 
’Œy_a
;

2234 
j
 = 0; j < 
şw_b
[
i
]->
num_’Œy
; j++)

2236 
’Œy_b
 = 
şw_b
[
i
]->
’Œy
[
j
];

2237 if(
	`isInS‘
(
’Œy_b
, 
şw_a
) != -1)

2241 
»suÉ
[
i
]->
num_’Œy
 ++;

2242 if(
»suÉ
[
i
]->
num_’Œy
 == 1)

2244 
»suÉ
[
i
]->
’Œy
 = (*)
	`CALLOC
ÔesuÉ[i]->’Œy,„esuÉ[i]->
num_’Œy
, (), "cache†ine way");

2248 
»suÉ
[
i
]->
’Œy
 = (*)
	`REALLOC
ÔesuÉ[i]->’Œy,„esuÉ[i]->
num_’Œy
*(), "cache†ine way");

2250 
»suÉ
[
i
]->
’Œy
[»suÉ[i]->
num_’Œy
 - 1] = 
’Œy_b
;

2256  
»suÉ
;

2258 
	}
}

2264 
ÿche_lše_way_t
 **

2265 
	$uniÚMaxCacheS‹
(
ÿche_lše_way_t
 **
şw_a
, cache_lše_way_ˆ**
şw_b
)

2267 
i
, 
j
, 
k
, 
age
, 
šdex
, 
’Œy_a
, 
’Œy_b
, 
t
, 
n
, 
num_hi¡Üy
 = 0;

2268 *
hi¡Üy_’Œ›s
 = 
NULL
;

2270 
ÿche_lše_way_t
 **
»suÉ
 = (ÿche_lše_way_ˆ**è
	`CALLOC
ÔesuÉ, 
ÿche
.
Ç
 + 1, (cache_line_way_t*), "cache_line_way_t **");

2272 
i
 = 0; i < 
ÿche
.
Ç
 + 1; i++)

2274 
»suÉ
[
i
] = (
ÿche_lše_way_t
 *)
	`CALLOC
(result[i], 1, (cache_line_way_t), "cache_line_way_t *");

2275 
»suÉ
[
i
]->
num_’Œy
 = 0;

2276 
»suÉ
[
i
]->
’Œy
 = 
NULL
;

2280 
i
 = 
ÿche
.
Ç
; i >= 0; i--)

2284 
j
 = 0 ; j < 
şw_a
[
i
]->
num_’Œy
; j++)

2286 
’Œy_a
 = 
şw_a
[
i
]->
’Œy
[
j
];

2292 
age
 = 
	`isInS‘_³rsi¡
(
’Œy_a
, 
şw_b
);

2294 if(
age
 =ğ-1è
šdex
 = 
i
;

2297 if(
age
 > 
i
è
šdex
 =‡ge;

2300 
šdex
 = 
i
;

2303 
»suÉ
[
šdex
]->
num_’Œy
++;

2304 if(
»suÉ
[
šdex
]->
num_’Œy
 == 1)

2306 
»suÉ
[
šdex
]->
’Œy
 = (*)
	`CALLOC
ÔesuÉ[šdex]->’Œy,„esuÉ[šdex]->
num_’Œy
, (), "cache†ine way");

2310 
»suÉ
[
šdex
]->
’Œy
 = (*)
	`REALLOC
ÔesuÉ[šdex]->’Œy,„esuÉ[šdex]->
num_’Œy
 * (), "cache†ine way");

2312 
»suÉ
[
šdex
]->
’Œy
[»suÉ[šdex]->
num_’Œy
 - 1] = 
’Œy_a
;

2319 
j
 = 0; j < 
şw_b
[
i
]->
num_’Œy
; j++)

2321 
’Œy_b
 = 
şw_b
[
i
]->
’Œy
[
j
];

2322 if(
	`isInS‘_³rsi¡
(
’Œy_b
, 
şw_a
) != -1)

2328 
»suÉ
[
i
]->
num_’Œy
 ++;

2329 if(
»suÉ
[
i
]->
num_’Œy
 == 1)

2331 
»suÉ
[
i
]->
’Œy
 = (*)
	`CALLOC
ÔesuÉ[i]->’Œy,„esuÉ[i]->
num_’Œy
, (), "cache†ine way");

2335 
»suÉ
[
i
]->
’Œy
 = (*)
	`REALLOC
ÔesuÉ[i]->’Œy,„esuÉ[i]->
num_’Œy
*(), "cache†ine way");

2337 
»suÉ
[
i
]->
’Œy
[»suÉ[i]->
num_’Œy
 - 1] = 
’Œy_b
;

2343  
»suÉ
;

2345 
	}
}

2350 
	$ä“CacheS‘
(
ÿche_lše_way_t
 **
ÿche_£t
)

2352 
i
;

2353 
i
 = 0; i < 
ÿche
.
Ç
; i++)

2355 if(
ÿche_£t
[
i
]->
num_’Œy
)

2356 
	`ä“
(
ÿche_£t
[
i
]->
’Œy
);

2357 
	`ä“
(
ÿche_£t
[
i
]);

2360 
	`ä“
(
ÿche_£t
);

2362 
	}
}

2366 
	$ä“CacheS‹
(
ÿche_¡©e
 *
cs
)

2368 
i
, 
j
, 
k
;

2370 
i
 = 0; i < 
ÿche
.
ns
; i++ )

2372 
j
 = 0; j < 
ÿche
.
Ç
; j++)

2374 if(
cs
->
mu¡
[
i
][
j
]->
num_’Œy
)

2375 
	`ä“
(
cs
->
mu¡
[
i
][
j
]->
’Œy
);

2377 if(
cs
->
may
[
i
][
j
]->
num_’Œy
)

2378 
	`ä“
(
cs
->
may
[
i
][
j
]->
’Œy
);

2380 if(
cs
->
³rsi¡
[
i
][
j
]->
num_’Œy
)

2381 
	`ä“
(
cs
->
³rsi¡
[
i
][
j
]->
’Œy
);

2383 
	`ä“
(
cs
->
mu¡
[
i
][
j
]);

2384 
	`ä“
(
cs
->
may
[
i
][
j
]);

2385 
	`ä“
(
cs
->
³rsi¡
[
i
][
j
]);

2389 if(
cs
->
³rsi¡
[
i
][
ÿche
.
Ç
]->
num_’Œy
)

2390 
	`ä“
(
cs
->
³rsi¡
[
i
][
ÿche
.
Ç
]->
’Œy
);

2392 
	`ä“
(
cs
->
³rsi¡
[
i
][
ÿche
.
Ç
]);

2395 
i
 = 0; i < 
ÿche
.
ns
; i++ )

2397 
	`ä“
(
cs
->
mu¡
[
i
]);

2398 
	`ä“
(
cs
->
may
[
i
]);

2399 
	`ä“
(
cs
->
³rsi¡
[
i
]);

2401 
	`ä“
(
cs
->
mu¡
);

2402 
	`ä“
(
cs
->
may
);

2403 
	`ä“
(
cs
->
³rsi¡
);

2405 
	`ä“
(
cs
);

2406 
cs
 = 
NULL
;

2407 
	}
}

2410 
	$ä“CacheS‹FunùiÚ
(
´oûdu»
 * 
´oc
)

2412 
´oûdu»
 *
p
 = 
´oc
;

2413 
block
 *
bb
;

2414 
i
;

2416 
num_blk
 = 
p
->
num_tİo
;

2420 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

2423 
bb
 = 
p
 ->
tİo
[
i
];

2425 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

2427 
bb
->
num_ÿche_¡©e
 = 0;

2428 if(
bb
->
bb_ÿche_¡©e
!ğ
NULL
)

2430 
	`ä“CacheS‹
(
bb
->
bb_ÿche_¡©e
);

2431 
bb
->
bb_ÿche_¡©e
 = 
NULL
;

2436 
	}
}

2439 
	$ä“CacheS‹Loİ
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
)

2441 
´oûdu»
 *
p
 = 
´oc
;

2442 
loİ
 *
loİ_±r
 = 
Í
;

2443 
block
 *
bb
;

2444 
i
;

2446 
num_blk
 = 
loİ_±r
->
num_tİo
;

2448 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

2450 
bb
 = 
loİ_±r
->
tİo
[
i
];

2452 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

2454 if(
bb
->
is_loİh—d
 && 
i
 =ğ
num_blk
 -1) ;

2456 
bb
->
num_ÿche_¡©e
 = 0;

2457 if(
bb
->
bb_ÿche_¡©e
 !ğ
NULL
)

2459 
	`ä“CacheS‹
(
bb
->
bb_ÿche_¡©e
);

2460 
bb
->
bb_ÿche_¡©e
 = 
NULL
;

2463 
	}
}

2467 
	$ä“AÎFunùiÚ
(
´oûdu»
 *
´oc
)

2469 
´oûdu»
 *
p
 = 
´oc
;

2470 
block
 *
bb
;

2471 
i
, 
k
;

2472 
num_blk
 = 
p
->
num_tİo
;

2474 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

2476 
bb
 = 
p
 ->
tİo
[
i
];

2477 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

2479 if(
bb
->
is_loİh—d
è
	`ä“AÎLoİ
(
p
,…->
loİs
[bb->
loİid
]);

2480 if(
bb
->
ÿÎpid
 != -1)

2482 
bb
->
num_ÿche_¡©e
 = 0;

2483 if(
bb
->
bb_ÿche_¡©e
 !ğ
NULL
)

2485 
	`ä“CacheS‹
(
bb
->
bb_ÿche_¡©e
);

2486 
bb
->
bb_ÿche_¡©e
 = 
NULL
;

2488 
	`ä“AÎFunùiÚ
(
bb
->
´oc_±r
);

2492 
bb
->
num_ÿche_¡©e
 = 0;

2493 if(
bb
->
bb_ÿche_¡©e
 !ğ
NULL
)

2495 
	`ä“
(
bb
->
bb_ÿche_¡©e
);

2496 
bb
->
bb_ÿche_¡©e
 = 
NULL
;

2501 
	}
}

2504 
	$ä“AÎLoİ
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
)

2506 
´oûdu»
 *
p
 = 
´oc
;

2507 
loİ
 *
Í_±r
 = 
Í
;

2508 
block
 *
bb
;

2509 
i
, 
k
;

2511 
num_blk
 = 
Í_±r
->
num_tİo
;

2513 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

2515 
bb
 = 
Í_±r
 ->
tİo
[
i
];

2516 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

2518 if(
bb
->
is_loİh—d
 && 
i
!ğ
num_blk
 -1è
	`ä“AÎLoİ
(
p
,…->
loİs
[bb->
loİid
]);

2519 if(
bb
->
ÿÎpid
 != -1)

2521 
bb
->
num_ÿche_¡©e
 = 0;

2522 if(
bb
->
bb_ÿche_¡©e
 !ğ
NULL
)

2524 
	`ä“CacheS‹
(
bb
->
bb_ÿche_¡©e
);

2525 
bb
->
bb_ÿche_¡©e
 = 
NULL
;

2527 
	`ä“AÎFunùiÚ
(
bb
->
´oc_±r
);

2531 
bb
->
num_ÿche_¡©e
 = 0;

2532 if(
bb
->
bb_ÿche_¡©e
 !ğ
NULL
)

2534 
	`ä“CacheS‹
(
bb
->
bb_ÿche_¡©e
);

2535 
bb
->
bb_ÿche_¡©e
 = 
NULL
;

2540 
	}
}

2543 
	$ä“AÎCacheS‹
()

2545 
	`ä“AÎFunùiÚ
(
maš_cİy
);

2546 
	}
}

2550 
ÿche_lše_way_t
 **

2551 
	$š‹r£ùCacheS‹
(
ÿche_lše_way_t
 **
şw_a
, cache_lše_way_ˆ**
şw_b
)

2553 
i
, 
j
, 
k
, 
age
, 
šdex
, 
’Œy_a
, 
’Œy_b
, 
num_hi¡Üy
 = 0;

2554 *
hi¡Üy_’Œ›s
 = 
NULL
;

2556 
ÿche_lše_way_t
 **
»suÉ
 = (ÿche_lše_way_ˆ**è
	`CALLOC
ÔesuÉ, 
ÿche
.
Ç
, (cache_line_way_t*), "cache_line_way_t **");

2558 
i
 = 0; i < 
ÿche
.
Ç
; i++)

2560 
»suÉ
[
i
] = (
ÿche_lše_way_t
 *)
	`CALLOC
(result[i], 1, (cache_line_way_t), "cache_line_way_t *");

2561 
»suÉ
[
i
]->
num_’Œy
 = 0;

2562 
»suÉ
[
i
]->
’Œy
 = 
NULL
;

2567 
i
 = 
ÿche
.
Ç
 - 1; i >= 0; i--)

2569 
j
 = 0; j < 
şw_b
[
i
]->
num_’Œy
; j++)

2571 
’Œy_b
 = 
şw_b
[
i
]->
’Œy
[
j
];

2572 
age
 = 
	`isInS‘
(
’Œy_b
, 
şw_a
);

2575 if(
age
 == -1)

2579 if(
age
 > 
i
è
šdex
 =‡ge;

2580 
šdex
 = 
i
;

2582 
»suÉ
[
šdex
]->
num_’Œy
 ++;

2583 if(
»suÉ
[
šdex
]->
num_’Œy
 == 1)

2585 
»suÉ
[
šdex
]->
’Œy
 = (*è
	`CALLOC
ÔesuÉ[šdex]->’Œy ,„esuÉ[šdex]->
num_’Œy
, (), "cache†ine way");

2589 
»suÉ
[
šdex
]->
’Œy
 = (*è
	`REALLOC
ÔesuÉ[šdex]->’Œy ,„esuÉ[šdex]->
num_’Œy
*(), "cache†ine way");

2591 
»suÉ
[
šdex
]->
’Œy
[»suÉ[šdex]->
num_’Œy
 - 1] = 
’Œy_b
;

2596  
»suÉ
;

2597 
	}
}

2600 
	$dump_ÿche_lše
(
ÿche_lše_way_t
 *
şw_a
)

2602 
i
, 
j
;

2605 if(
şw_a
->
num_’Œy
 == 0)

2607 
	`´štf
("NULL\n");

2610 
j
 = 0; j < 
şw_a
->
num_’Œy
; j++)

2611 
	`´štf
(" %d ", 
şw_a
->
’Œy
[
j
]);

2613 
	`´štf
("\n");

2615 
	}
}

2618 
	$‹¡_cs_İ
()

2620 
ÿche_lše_way_t
 **
şw_a
, **
şw_b
;

2621 
ÿche_lše_way_t
** 
‹mp
;

2624 
şw_a
 = (
ÿche_lše_way_t
**è
	`CALLOC
(clw_a , 1, (cache_line_way_t), "a");

2625 
şw_a
[0] = (
ÿche_lše_way_t
*è
	`CALLOC
(clw_a , 2, (cache_line_way_t), "a");

2627 
şw_a
[0][0].
num_’Œy
 = 3;

2628 
şw_a
[0][1].
num_’Œy
 = 3;

2629 
şw_a
[0][0].
’Œy
 = (*è
	`CALLOC
(şw_a[0][0].’Œy, clw_a[0][0].
num_’Œy
, (), "entries for‡");

2630 
şw_a
[0][1].
’Œy
 = (*è
	`CALLOC
(şw_a[0][1].’Œy, clw_a[0][1].
num_’Œy
, (), "entries for‡");

2632 
şw_a
[0][0] .
’Œy
[0] = 1;

2633 
şw_a
[0][0] .
’Œy
[1] = 2;

2634 
şw_a
[0][0] .
’Œy
[2] = 5;

2635 
şw_a
[0][1] .
’Œy
[0] = 2;

2636 
şw_a
[0][1] .
’Œy
[1] = 3;

2637 
şw_a
[0][1] .
’Œy
[2] = 4;

2639 
şw_b
 = (
ÿche_lše_way_t
**è
	`CALLOC
(clw_b , 1, (cache_line_way_t), "b");

2640 
şw_b
[0] = (
ÿche_lše_way_t
*è
	`CALLOC
(clw_b , 3, (cache_line_way_t), "b");

2642 
şw_b
[0][0].
num_’Œy
 = 3;

2643 
şw_b
[0][1].
num_’Œy
 = 3;

2644 
şw_b
[0][0].
’Œy
 = (*è
	`CALLOC
(şw_b[0][0].’Œy, clw_b[0][0].
num_’Œy
, (), "entries for b");

2645 
şw_b
[0][1].
’Œy
 = (*è
	`CALLOC
(şw_b[0][1].’Œy, clw_b[0][1].
num_’Œy
, (), "entries for b");

2647 
şw_b
[0][0] .
’Œy
[0] = 3;

2648 
şw_b
[0][0] .
’Œy
[1] = 2;

2649 
şw_b
[0][0] .
’Œy
[1] = 5;

2650 
şw_b
[0][1] .
’Œy
[0] = 4;

2651 
şw_b
[0][1] .
’Œy
[1] = 3;

2652 
şw_b
[0][1] .
’Œy
[2] = 2;

2653 
	`dump_ÿche_lše
(
şw_a
[0]);

2654 
	`´štf
("\n");

2655 
	`dump_ÿche_lše
(
şw_b
[0]);

2656 
	`´štf
("\n");

2657 
	`´štf
("Result for union: \n");

2658 
‹mp
 = 
	`uniÚCacheS‹
(
şw_a
, 
şw_b
);

2659 
	`dump_ÿche_lše
(
‹mp
[0]);

2660 
	`´štf
("\n");

2661 
	`´štf
("Result for intersect: \n");

2662 
‹mp
 = 
	`š‹r£ùCacheS‹
(
şw_a
, 
şw_b
);

2663 
	`dump_ÿche_lše
(
‹mp
[0]);

2664 
	`´štf
("\n");

2666 
	}
}

	@analysisCacheL2.c

5 
	~<¡dio.h
>

6 
	~<as£¹.h
>

9 
ÿche_¡©e
 *

10 
m­Loİ_L2
(
´oûdu»
 *
´o
, 
loİ
 *
Í
);

12 
ÿche_¡©e
 *

13 
m­FunùiÚC®l_L2
(
´oûdu»
 *
´oc
, 
ÿche_¡©e
 *
cs
);

16 
»£tH™Miss_L2
(
MSC
 *
msc
);

19 
»£tFunùiÚ_L2
(
´oûdu»
 *
´oc
);

22 
»£tLoİ_L2
(
´oûdu»
 *
´oc
, 
loİ
* 
Í
);

25 
ÿlcuÏ‹CacheS‹_L2
(
ÿche_lše_way_t
 **
mu¡
, cache_lše_way_ˆ**
may
, cache_lše_way_ˆ**
³rsi¡
, 
š¡r_addr
);

27 
ÿche_¡©e
 *

28 
cİyCacheS‹_L2
(
ÿche_¡©e
 *
cs
);

42 
ä“AÎ_L2
();

45 
ä“AÎFunùiÚ_L2
(
´oûdu»
 *
´oc
);

48 
ä“AÎLoİ_L2
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
);

53 
isNev”InCacheL2
(
addr
, 
ÿche_lše_way_t
**
may
);

56 
isInCache_L2
(
addr
, 
ÿche_lše_way_t
**
mu¡
);

58 
ÿche_lše_way_t
 **

59 
uniÚCacheS‹_L2
(
ÿche_lše_way_t
 ** 
şw_a
, cache_lše_way_ˆ**
şw_b
);

82 
	$£t_ÿche_basic_L2
(* 
cÚfigFe
)

85 
FILE
 *
åŒ
;

86 
ns
, 
Ç
, 
ls
, 
cmp
, 
i
;

87 
·th
[ 
MAX_LEN
 ];

89 
	`¥rštf
(
·th
, "ÿche_cÚfig/%s.cÚfig", 
cÚfigFe
);

90 
åŒ
 = 
	`fİ’
(
·th
, "r" );

91 
	`fsÿnf
Ğ
åŒ
, "%d %d %d %d", &
ns
, &
Ç
, &
ls
, &
cmp
);

93 
ÿche_L2
.
ns
 =‚s;

94 
ÿche_L2
.
Ç
 =‚a;

95 
ÿche_L2
.
ls
 =†s;

96 
ÿche_L2
.
cmp
 = cmp;

99 
ÿche_L2
.
nsb
 = 
	`logBa£2
(ÿche_L2.
ns
);

100 
ÿche_L2
.
lsb
 = 
	`logBa£2
(ÿche_L2.
ls
);

102 
ÿche_L2
.
Áb
 = 
MAX_TAG_BITS
;

103 
ÿche_L2
.
Á
 = 1 << cache_L2.
Áb
;

105 
ÿche_L2
.
t_sb
 = cache_L2.
Áb
 + cache_L2.
nsb
;

106 
ÿche_L2
.
s_lb
 = cache_L2.
nsb
 + cache_L2.
lsb
;

107 
ÿche_L2
.
Á_s
 = 1 << cache_L2.
t_sb
;

109 
ÿche_L2
.
l_msk
 = (1 << cache_L2.
lsb
) - 1;

111 
ÿche_L2
.
s_msk
 = 0;

112 
i
 = 1; i < 
ÿche_L2
.
ns
; i <<= 1)

113 
ÿche_L2
.
s_msk
 = cache_L2.s_msk | 
i
;

114 
ÿche_L2
.
s_msk
 = cache_L2.s_msk << cache_L2.
lsb
;

116 
ÿche_L2
.
t_msk
 = 0;

117 
i
 = 1; i < 
ÿche_L2
.
Á
; i <<= 1)

118 
ÿche_L2
.
t_msk
 |ğ
i
;

119 
ÿche_L2
.
t_msk
 = cache_L2.t_msk << (ÿche_L2.
lsb
 + cache_L2.
nsb
);

121 
ÿche_L2
.
t_s_msk
 = cache_L2.
t_msk
 | cache_L2.
s_msk
;

122 
	}
}

125 
	$dumpCacheCÚfig_L2
()

127 
	`´štf
("Cache Configuration‡s follow:\n");

128 
	`´štf
("nubm” oà£t: %d\n", 
ÿche_L2
.
ns
);

129 
	`´štf
("nubm” oàassocŸtiv™y: %d\n", 
ÿche_L2
.
Ç
);

130 
	`´štf
("ÿchlšsize: %d\n", 
ÿche_L2
.
ls
);

131 
	`´štf
("ÿchmis ³ÇÉy: %d\n", 
ÿche_L2
.
cmp
);

132 
	`´štf
("nubm” oà£ˆb™: %d\n", 
ÿche_L2
.
nsb
);

133 
	`´štf
("nubm” oàlšesizb™: %d\n", 
ÿche_L2
.
lsb
);

134 
	`´štf
("£ˆmask: %u\n", 
ÿche_L2
.
s_msk
);

135 
	`´štf
("g mask: %u\n", 
ÿche_L2
.
t_msk
);

136 
	`´štf
("g + s‘ mask: %u\n", 
ÿche_L2
.
t_s_msk
);

137 
	}
}

141 
	$ÿlcuÏ‹Mu¡_L2
(
ÿche_lše_way_t
 **
mu¡
, 
š¡r_addr
)

143 
i
, 
j
, *

;

144 
š¡r_addr
 = 
	`TAGSET_L2
(instr_addr);

146 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

148 if(
	`isInWay
(
š¡r_addr
, 
mu¡
[
i
]->
’Œy
, mu¡[i]->
num_’Œy
))

150 if(
i
 != 0)

152 
mu¡
[0]->
num_’Œy
++;

153 if(
mu¡
[0]->
num_’Œy
 == 1)

155 
mu¡
[0]->
’Œy
 = (*)
	`CALLOC
(must[0]->entry, 1, (), "entry");

159 
mu¡
[0]->
’Œy
 = (*)
	`REALLOC
(mu¡[0]->’Œy, (mu¡[0]->
num_’Œy
) * (), "enties");

161 
mu¡
[0]->
’Œy
[(mu¡[0]->
num_’Œy
è-1] = 
š¡r_addr
;

164 
j
 = 0; j < 
mu¡
[
i
]->
num_’Œy
; j++)

166 if(
mu¡
[
i
]->
’Œy
[
j
] =ğ
š¡r_addr
)

168 if(
j
 !ğ
mu¡
[
i
]->
num_’Œy
 -1)

169 
mu¡
[
i
]->
’Œy
[
j
] = mu¡[i]->’Œy[mu¡[i]->
num_’Œy
 -1];

170 
mu¡
[
i
]->
num_’Œy
 --;

171 if(
mu¡
[
i
]->
num_’Œy
 == 0)

173 
	`ä“
(
mu¡
[
i
]->
’Œy
);

177 
mu¡
[
i
]->
’Œy
 = (*)
	`REALLOC
(mu¡[i]->’Œy, mu¡[i]->
num_’Œy
 * (), "entry");

186 
ÿche_lše_way_t
 * 
tmp
 = 
mu¡
[
ÿche_L2
.
Ç
 -1];

187 
ÿche_lše_way_t
 *
h—d
 = 
NULL
;

189 
i
 = 
ÿche_L2
.
Ç
 - 1; i > 0 ; i--)

190 
mu¡
[
i
] = must[i -1];

192 
	`ä“
(
tmp
);

196 
h—d
 = (
ÿche_lše_way_t
 *)
	`CALLOC
(head, 1, (cache_line_way_t), "cache_line_way_t");

197 
h—d
->
’Œy
 = (*)
	`CALLOC
(head->entry, 1, (), "in head->entry");

198 
h—d
->
’Œy
[0] = 
š¡r_addr
;

199 
h—d
->
num_’Œy
 = 1;

200 
mu¡
[0] = 
h—d
;

201 
	}
}

205 
	$ÿlcuÏ‹May_L2
(
ÿche_lše_way_t
 **
may
, 
š¡r_addr
)

207 
i
, 
j
, *

;

208 
š¡r_addr
 = 
	`TAGSET_L2
(instr_addr);

210 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

212 if(
	`isInWay
(
š¡r_addr
, 
may
[
i
]->
’Œy
, may[i]->
num_’Œy
))

214 if(
i
 != 0)

216 
may
[0]->
num_’Œy
++;

217 if(
may
[0]->
num_’Œy
 == 1)

219 
may
[0]->
’Œy
 = (*)
	`CALLOC
(may[0]->’Œy, may[0]->
num_’Œy
, (), "enties");

223 
may
[0]->
’Œy
 = (*)
	`REALLOC
(may[0]->’Œy, (may[0]->
num_’Œy
) * (), "enties");

225 
may
[0]->
’Œy
[(may[0]->
num_’Œy
è-1] = 
š¡r_addr
;

228 
j
 = 0; j < 
may
[
i
]->
num_’Œy
; j++)

230 if(
may
[
i
]->
’Œy
[
j
] =ğ
š¡r_addr
)

232 if(
j
 !ğ
may
[
i
]->
num_’Œy
 -1)

233 
may
[
i
]->
’Œy
[
j
] = may[i]->’Œy[may[i]->
num_’Œy
 -1];

234 
may
[
i
]->
num_’Œy
 --;

235 if(
may
[
i
]->
num_’Œy
 == 0)

237 
	`ä“
(
may
[
i
]->
’Œy
);

241 
may
[
i
]->
’Œy
 = (*)
	`REALLOC
(may[i]->’Œy, may[i]->
num_’Œy
 * (), "entry");

250 
ÿche_lše_way_t
 * 
tmp
 = 
may
[
ÿche_L2
.
Ç
 -1];

251 
ÿche_lše_way_t
 *
h—d
 = 
NULL
;

253 
i
 = 
ÿche_L2
.
Ç
 - 1; i > 0 ; i--)

254 
may
[
i
] = may [i -1];

255 
	`ä“
(
tmp
);

257 
h—d
 = (
ÿche_lše_way_t
 *)
	`CALLOC
(head, 1, (cache_line_way_t), "cache_line_way_t");

258 
h—d
->
’Œy
 = (*)
	`CALLOC
(head->entry, 1, (), "in head->entry");

259 
h—d
->
’Œy
[0] = 
š¡r_addr
;

260 
h—d
->
num_’Œy
 = 1;

261 
may
[0] = 
h—d
;

262 
	}
}

268 
	$ÿlcuÏ‹P”si¡_L2
(
ÿche_lše_way_t
 **
³rsi¡
, 
š¡r_addr
)

270 
i
, 
j
, *

;

271 
š¡r_addr
 = 
	`TAGSET_L2
(instr_addr);

275 
i
 = 0; i < 
ÿche_L2
.
Ç
 + 1; i++)

277 if(
	`isInWay
(
š¡r_addr
, 
³rsi¡
[
i
]->
’Œy
,…”si¡[i]->
num_’Œy
))

279 if(
i
 != 0)

281 
³rsi¡
[0]->
num_’Œy
++;

282 if(
³rsi¡
[0]->
num_’Œy
 == 1)

284 
³rsi¡
[0]->
’Œy
 = (*)
	`CALLOC
Õ”si¡[0]->’Œy,…”si¡[0]->
num_’Œy
, (), "enties");

288 
³rsi¡
[0]->
’Œy
 = (*)
	`REALLOC
Õ”si¡[0]->’Œy, (³rsi¡[0]->
num_’Œy
) * (), "enties");

290 
³rsi¡
[0]->
’Œy
[Õ”si¡[0]->
num_’Œy
è-1] = 
š¡r_addr
;

293 
j
 = 0; j < 
³rsi¡
[
i
]->
num_’Œy
; j++)

295 if(
³rsi¡
[
i
]->
’Œy
[
j
] =ğ
š¡r_addr
)

297 if(
j
 !ğ
³rsi¡
[
i
]->
num_’Œy
 -1)

298 
³rsi¡
[
i
]->
’Œy
[
j
] =…”si¡[i]->’Œy[³rsi¡[i]->
num_’Œy
 -1];

299 
³rsi¡
[
i
]->
num_’Œy
 --;

300 if(
³rsi¡
[
i
]->
num_’Œy
 == 0)

302 
	`ä“
(
³rsi¡
[
i
]->
’Œy
);

306 
³rsi¡
[
i
]->
’Œy
 = (*)
	`REALLOC
Õ”si¡[i]->’Œy,…”si¡[i]->
num_’Œy
 * (), "entry");

317 
ÿche_lše_way_t
 * 
tmp
 = 
³rsi¡
[
ÿche_L2
.
Ç
];

318 
ÿche_lše_way_t
 *
h—d
 = 
NULL
;

320 
i
 = 
ÿche_L2
.
Ç
; i > 0 ; i--)

321 
³rsi¡
[
i
] =…ersist [i -1];

322 
	`ä“
(
tmp
);

324 
h—d
 = (
ÿche_lše_way_t
 *)
	`CALLOC
(head, 1, (cache_line_way_t), "cache_line_way_t");

325 
h—d
->
’Œy
 = (*)
	`CALLOC
(head->entry, 1, (), "in head->entry");

326 
h—d
->
’Œy
[0] = 
š¡r_addr
;

327 
h—d
->
num_’Œy
 = 1;

328 
³rsi¡
[0] = 
h—d
;

329 
	}
}

333 
	$ÿlcuÏ‹CacheS‹_L2
(
ÿche_lše_way_t
 **
mu¡
, cache_lše_way_ˆ**
may
, cache_lše_way_ˆ**
³rsi¡
, 
š¡r_addr
)

337 
	`ÿlcuÏ‹Mu¡_L2
(
mu¡
, 
š¡r_addr
);

338 
	`ÿlcuÏ‹May_L2
(
may
, 
š¡r_addr
);

339 
	`ÿlcuÏ‹P”si¡_L2
(
³rsi¡
, 
š¡r_addr
);

341 
	}
}

346 
	$isInS‘_L2_³rsi¡
(
addr
, 
ÿche_lše_way_t
 **
£t
)

348 
i
;

349 
i
 = 0; i < 
ÿche_L2
.
Ç
 + 1; i++)

351 if(
	`isInWay
(
addr
, 
£t
[
i
]->
’Œy
, s‘[i]->
num_’Œy
) == 1)

352  
i
;

355 
	}
}

358 
	$isInS‘_L2
(
addr
, 
ÿche_lše_way_t
 **
£t
)

360 
i
;

361 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

363 if(
	`isInWay
(
addr
, 
£t
[
i
]->
’Œy
, s‘[i]->
num_’Œy
) == 1)

364  
i
;

367 
	}
}

370 
ÿche_lše_way_t
 **

371 
	$š‹r£ùCacheS‹_L2
(
ÿche_lše_way_t
 **
şw_a
, cache_lše_way_ˆ**
şw_b
)

373 
i
, 
j
, 
k
, 
age
, 
šdex
, 
’Œy_a
, 
’Œy_b
, 
num_hi¡Üy
 = 0;

374 *
hi¡Üy_’Œ›s
 = 
NULL
;

376 
ÿche_lše_way_t
 **
»suÉ
 = (ÿche_lše_way_ˆ**è
	`CALLOC
ÔesuÉ, 
ÿche_L2
.
Ç
, (cache_line_way_t*), "cache_line_way_t **");

378 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

380 
»suÉ
[
i
] = (
ÿche_lše_way_t
 *)
	`CALLOC
(result[i], 1, (cache_line_way_t), "cache_line_way_t *");

381 
»suÉ
[
i
]->
num_’Œy
 = 0;

382 
»suÉ
[
i
]->
’Œy
 = 
NULL
;

387 
i
 = 
ÿche_L2
.
Ç
 - 1; i >= 0; i--)

389 
j
 = 0; j < 
şw_b
[
i
]->
num_’Œy
; j++)

391 
’Œy_b
 = 
şw_b
[
i
]->
’Œy
[
j
];

392 
age
 = 
	`isInS‘_L2
(
’Œy_b
, 
şw_a
);

395 if(
age
 == -1)

399 if(
age
 > 
i
è
šdex
 =‡ge;

400 
šdex
 = 
i
;

402 
»suÉ
[
šdex
]->
num_’Œy
 ++;

403 if(
»suÉ
[
šdex
]->
num_’Œy
 == 1)

405 
»suÉ
[
šdex
]->
’Œy
 = (*è
	`CALLOC
ÔesuÉ[šdex]->’Œy ,„esuÉ[šdex]->
num_’Œy
, (), "cache†ine way");

409 
»suÉ
[
šdex
]->
’Œy
 = (*è
	`REALLOC
ÔesuÉ[šdex]->’Œy ,„esuÉ[šdex]->
num_’Œy
*(), "cache†ine way");

411 
»suÉ
[
šdex
]->
’Œy
[»suÉ[šdex]->
num_’Œy
 - 1] = 
’Œy_b
;

416  
»suÉ
;

417 
	}
}

421 
ÿche_lše_way_t
 **

422 
	$uniÚCacheS‹_L2
(
ÿche_lše_way_t
 **
şw_a
, cache_lše_way_ˆ**
şw_b
)

424 
i
, 
j
, 
k
, 
age
, 
šdex
, 
’Œy_a
, 
’Œy_b
, 
t
, 
n
, 
num_hi¡Üy
 = 0;

425 *
hi¡Üy_’Œ›s
 = 
NULL
;

427 
ÿche_lše_way_t
 **
»suÉ
 = (ÿche_lše_way_ˆ**è
	`CALLOC
ÔesuÉ, 
ÿche_L2
.
Ç
, (cache_line_way_t*), "cache_line_way_t **");

429 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

431 
»suÉ
[
i
] = (
ÿche_lše_way_t
 *)
	`CALLOC
(result[i], 1, (cache_line_way_t), "cache_line_way_t *");

432 
»suÉ
[
i
]->
num_’Œy
 = 0;

433 
»suÉ
[
i
]->
’Œy
 = 
NULL
;

437 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

441 
j
 = 0 ; j < 
şw_a
[
i
]->
num_’Œy
; j++)

443 
’Œy_a
 = 
şw_a
[
i
]->
’Œy
[
j
];

445 
age
 = 
	`isInS‘_L2
(
’Œy_a
, 
şw_b
);

446 if(
age
 =ğ-1è
šdex
 = 
i
;

447 if(
age
 < 
i
è
šdex
 =‡ge;

450 
šdex
 = 
i
;

453 
»suÉ
[
šdex
]->
num_’Œy
++;

454 if(
»suÉ
[
šdex
]->
num_’Œy
 == 1)

456 
»suÉ
[
šdex
]->
’Œy
 = (*)
	`CALLOC
ÔesuÉ[šdex]->’Œy,„esuÉ[šdex]->
num_’Œy
, (), "cache†ine way");

460 
»suÉ
[
šdex
]->
’Œy
 = (*)
	`REALLOC
ÔesuÉ[šdex]->’Œy,„esuÉ[šdex]->
num_’Œy
 * (), "cache†ine way");

462 
»suÉ
[
šdex
]->
’Œy
[»suÉ[šdex]->
num_’Œy
 - 1] = 
’Œy_a
;

469 
j
 = 0; j < 
şw_b
[
i
]->
num_’Œy
; j++)

471 
’Œy_b
 = 
şw_b
[
i
]->
’Œy
[
j
];

472 if(
	`isInS‘_L2
(
’Œy_b
, 
şw_a
) != -1)

476 
»suÉ
[
i
]->
num_’Œy
 ++;

477 if(
»suÉ
[
i
]->
num_’Œy
 == 1)

479 
»suÉ
[
i
]->
’Œy
 = (*)
	`CALLOC
ÔesuÉ[i]->’Œy,„esuÉ[i]->
num_’Œy
, (), "cache†ine way");

483 
»suÉ
[
i
]->
’Œy
 = (*)
	`REALLOC
ÔesuÉ[i]->’Œy,„esuÉ[i]->
num_’Œy
*(), "cache†ine way");

485 
»suÉ
[
i
]->
’Œy
[»suÉ[i]->
num_’Œy
 - 1] = 
’Œy_b
;

491  
»suÉ
;

493 
	}
}

499 
ÿche_lše_way_t
 **

500 
	$uniÚMaxCacheS‹_L2
(
ÿche_lše_way_t
 **
şw_a
, cache_lše_way_ˆ**
şw_b
)

502 
i
, 
j
, 
k
, 
age
, 
šdex
, 
’Œy_a
, 
’Œy_b
, 
t
, 
n
, 
num_hi¡Üy
 = 0;

503 *
hi¡Üy_’Œ›s
 = 
NULL
;

505 
ÿche_lše_way_t
 **
»suÉ
 = (ÿche_lše_way_ˆ**è
	`CALLOC
ÔesuÉ, 
ÿche_L2
.
Ç
 + 1, (cache_line_way_t*), "cache_line_way_t **");

507 
i
 = 0; i < 
ÿche_L2
.
Ç
 + 1; i++)

509 
»suÉ
[
i
] = (
ÿche_lše_way_t
 *)
	`CALLOC
(result[i], 1, (cache_line_way_t), "cache_line_way_t *");

510 
»suÉ
[
i
]->
num_’Œy
 = 0;

511 
»suÉ
[
i
]->
’Œy
 = 
NULL
;

515 
i
 = 
ÿche_L2
.
Ç
; i >= 0; i--)

519 
j
 = 0 ; j < 
şw_a
[
i
]->
num_’Œy
; j++)

521 
’Œy_a
 = 
şw_a
[
i
]->
’Œy
[
j
];

525 
age
 = 
	`isInS‘_L2_³rsi¡
(
’Œy_a
, 
şw_b
);

527 if(
age
 =ğ-1è
šdex
 = 
i
;

530 if(
age
 > 
i
è
šdex
 =‡ge;

534 
šdex
 = 
i
;

537 
»suÉ
[
šdex
]->
num_’Œy
++;

538 if(
»suÉ
[
šdex
]->
num_’Œy
 == 1)

540 
»suÉ
[
šdex
]->
’Œy
 = (*)
	`CALLOC
ÔesuÉ[šdex]->’Œy,„esuÉ[šdex]->
num_’Œy
, (), "cache†ine way");

544 
»suÉ
[
šdex
]->
’Œy
 = (*)
	`REALLOC
ÔesuÉ[šdex]->’Œy,„esuÉ[šdex]->
num_’Œy
 * (), "cache†ine way");

546 
»suÉ
[
šdex
]->
’Œy
[»suÉ[šdex]->
num_’Œy
 - 1] = 
’Œy_a
;

553 
j
 = 0; j < 
şw_b
[
i
]->
num_’Œy
; j++)

555 
’Œy_b
 = 
şw_b
[
i
]->
’Œy
[
j
];

556 if(
	`isInS‘_L2_³rsi¡
(
’Œy_b
, 
şw_a
) != -1)

562 
»suÉ
[
i
]->
num_’Œy
 ++;

563 if(
»suÉ
[
i
]->
num_’Œy
 == 1)

565 
»suÉ
[
i
]->
’Œy
 = (*)
	`CALLOC
ÔesuÉ[i]->’Œy,„esuÉ[i]->
num_’Œy
, (), "cache†ine way");

569 
»suÉ
[
i
]->
’Œy
 = (*)
	`REALLOC
ÔesuÉ[i]->’Œy,„esuÉ[i]->
num_’Œy
*(), "cache†ine way");

571 
»suÉ
[
i
]->
’Œy
[»suÉ[i]->
num_’Œy
 - 1] = 
’Œy_b
;

577  
»suÉ
;

579 
	}
}

583 
ÿche_¡©e
 *

584 
	$®locCacheS‹_L2
()

586 
i
, 
j
, 
k
;

587 
ÿche_¡©e
 *
»suÉ
 = 
NULL
;

590 
»suÉ
 = (
ÿche_¡©e
 *)
	`CALLOC
(result, 1, (cache_state), "cache_state_t");

597 
»suÉ
->
mu¡
 = 
NULL
;

598 
»suÉ
->
mu¡
 = (
ÿche_lše_way_t
***)
	`CALLOC
ÔesuÉ->mu¡, 
ÿche_L2
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

600 
»suÉ
->
may
 = 
NULL
;

601 
»suÉ
->
may
 = (
ÿche_lše_way_t
***)
	`CALLOC
ÔesuÉ->may, 
ÿche_L2
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

603 
»suÉ
->
³rsi¡
ğ
NULL
;

604 
»suÉ
->
³rsi¡
 = (
ÿche_lše_way_t
***)
	`CALLOC
ÔesuÉ->³rsi¡, 
ÿche_L2
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

606 
j
 = 0; j < 
ÿche_L2
.
ns
; j++)

609 
»suÉ
->
mu¡
[
j
]ğ(
ÿche_lše_way_t
**è
	`CALLOC
ÔesuÉ->mu¡[j], 
ÿche_L2
.
Ç
, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

611 
»suÉ
->
may
[
j
]ğ(
ÿche_lše_way_t
**)
	`CALLOC
ÔesuÉ->may[j], 
ÿche_L2
.
Ç
, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

613 
»suÉ
->
³rsi¡
[
j
]ğ(
ÿche_lše_way_t
**)
	`CALLOC
ÔesuÉ->³rsi¡[j], 
ÿche_L2
.
Ç
 + 1, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

615  
k
 = 0; k < 
ÿche_L2
.
Ç
; k++)

618 
»suÉ
->
mu¡
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(result->must[j][k], 1, (cache_line_way_t), "one cache_line_way_t");

619 
»suÉ
->
mu¡
[
j
][
k
]->
num_’Œy
 = 0;

620 
»suÉ
->
mu¡
[
j
][
k
]->
’Œy
 = 
NULL
;

622 
»suÉ
->
may
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(result->may[j][k], 1, (cache_line_way_t), "one cache_line_way_t");

623 
»suÉ
->
may
[
j
][
k
]->
num_’Œy
 = 0;

624 
»suÉ
->
may
[
j
][
k
]->
’Œy
 = 
NULL
;

626 
»suÉ
->
³rsi¡
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(result->persist[j][k], 1, (cache_line_way_t), "one cache_line_way_t");

627 
»suÉ
->
³rsi¡
[
j
][
k
]->
num_’Œy
 = 0;

628 
»suÉ
->
³rsi¡
[
j
][
k
]->
’Œy
 = 
NULL
;

630 
»suÉ
->
³rsi¡
[
j
][
ÿche_L2
.
Ç
] = (
ÿche_lše_way_t
*)
	`CALLOC
(result->persist[j][cache_L2.na], 1, (cache_line_way_t), "one cache_line_way_t");

631 
»suÉ
->
³rsi¡
[
j
][
ÿche_L2
.
Ç
]->
num_’Œy
 = 0;

632 
»suÉ
->
³rsi¡
[
j
][
ÿche_L2
.
Ç
]->
’Œy
 = 
NULL
;

638  
»suÉ
;

639 
	}
}

647 
	$ä“CacheS‹_L2
(
ÿche_¡©e
 *
cs
)

649 
i
, 
j
;

651 
i
 = 0; i < 
ÿche_L2
.
ns
; i++ )

653 
j
 = 0; j < 
ÿche_L2
.
Ç
; j++)

655 if(
cs
->
mu¡
[
i
][
j
]->
num_’Œy
)

656 
	`ä“
(
cs
->
mu¡
[
i
][
j
]->
’Œy
);

658 if(
cs
->
may
[
i
][
j
]->
num_’Œy
)

659 
	`ä“
(
cs
->
may
[
i
][
j
]->
’Œy
);

661 if(
cs
->
³rsi¡
[
i
][
j
]->
num_’Œy
)

662 
	`ä“
(
cs
->
³rsi¡
[
i
][
j
]->
’Œy
);

664 
	`ä“
(
cs
->
mu¡
[
i
][
j
]);

665 
	`ä“
(
cs
->
may
[
i
][
j
]);

666 
	`ä“
(
cs
->
³rsi¡
[
i
][
j
]);

669 if(
cs
->
³rsi¡
[
i
][
ÿche_L2
.
Ç
]->
num_’Œy
)

670 
	`ä“
(
cs
->
³rsi¡
[
i
][
ÿche_L2
.
Ç
]->
’Œy
);

671 
	`ä“
(
cs
->
³rsi¡
[
i
][
ÿche_L2
.
Ç
]);

675 
i
 = 0; i < 
ÿche_L2
.
ns
; i++ )

677 
	`ä“
(
cs
->
mu¡
[
i
]);

678 
	`ä“
(
cs
->
may
[
i
]);

679 
	`ä“
(
cs
->
³rsi¡
[
i
]);

682 
	`ä“
(
cs
->
mu¡
);

683 
	`ä“
(
cs
->
may
);

684 
	`ä“
(
cs
->
³rsi¡
);

685 
	`ä“
(
cs
);

686 
cs
 = 
NULL
;

687 
	}
}

690 
	$ä“CacheS‹FunùiÚ_L2
(
´oûdu»
 * 
´oc
)

692 
´oûdu»
 *
p
 = 
´oc
;

693 
block
 *
bb
;

694 
i
;

696 
num_blk
 = 
p
->
num_tİo
;

700 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

703 
bb
 = 
p
 ->
tİo
[
i
];

705 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

707 
bb
->
num_ÿche_¡©e_L2
= 0;

708 if(
bb
->
bb_ÿche_¡©e_L2
!ğ
NULL
)

710 
	`ä“CacheS‹_L2
(
bb
->
bb_ÿche_¡©e_L2
);

711 
bb
->
bb_ÿche_¡©e_L2
 = 
NULL
;

716 
	}
}

721 
	$ä“CacheS‹Loİ_L2
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
)

723 
´oûdu»
 *
p
 = 
´oc
;

724 
loİ
 *
loİ_±r
 = 
Í
;

725 
block
 *
bb
;

726 
i
;

728 
num_blk
 = 
loİ_±r
->
num_tİo
;

730 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

732 
bb
 = 
loİ_±r
->
tİo
[
i
];

734 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

736 if(
bb
->
is_loİh—d
 && 
i
 =ğ
num_blk
 -1) ;

738 
bb
->
num_ÿche_¡©e_L2
 = 0;

739 if(
bb
->
bb_ÿche_¡©e_L2
!ğ
NULL
)

741 
	`ä“CacheS‹_L2
(
bb
->
bb_ÿche_¡©e_L2
);

742 
bb
->
bb_ÿche_¡©e_L2
 = 
NULL
;

745 
	}
}

750 
	$ä“AÎFunùiÚ_L2
(
´oûdu»
 *
´oc
)

752 
´oûdu»
 *
p
 = 
´oc
;

753 
block
 *
bb
;

754 
i
, 
k
;

755 
num_blk
 = 
p
->
num_tİo
;

757 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

759 
bb
 = 
p
 ->
tİo
[
i
];

760 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

762 if(
bb
->
is_loİh—d
è
	`ä“AÎLoİ_L2
(
p
,…->
loİs
[bb->
loİid
]);

763 if(
bb
->
ÿÎpid
 != -1)

765 
bb
->
num_ÿche_¡©e_L2
 = 0;

766 if(
bb
->
bb_ÿche_¡©e_L2
 !ğ
NULL
)

768 
	`ä“
(
bb
->
bb_ÿche_¡©e_L2
);

769 
bb
->
bb_ÿche_¡©e_L2
 = 
NULL
;

771 
	`ä“AÎFunùiÚ_L2
(
bb
->
´oc_±r
);

775 
bb
->
num_ÿche_¡©e_L2
 = 0;

776 if(
bb
->
bb_ÿche_¡©e_L2
 !ğ
NULL
)

778 
	`ä“
(
bb
->
bb_ÿche_¡©e_L2
);

779 
bb
->
bb_ÿche_¡©e_L2
 = 
NULL
;

784 
	}
}

787 
	$ä“AÎLoİ_L2
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
)

789 
´oûdu»
 *
p
 = 
´oc
;

790 
loİ
 *
Í_±r
 = 
Í
;

791 
block
 *
bb
;

792 
i
, 
k
;

794 
num_blk
 = 
Í_±r
->
num_tİo
;

796 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

798 
bb
 = 
Í_±r
 ->
tİo
[
i
];

799 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

801 if(
bb
->
is_loİh—d
 && 
i
!ğ
num_blk
 -1è
	`ä“AÎLoİ_L2
(
p
,…->
loİs
[bb->
loİid
]);

802 if(
bb
->
ÿÎpid
 != -1)

804 
bb
->
num_ÿche_¡©e_L2
 = 0;

805 if(
bb
->
bb_ÿche_¡©e_L2
 !ğ
NULL
)

807 
	`ä“
(
bb
->
bb_ÿche_¡©e_L2
);

808 
bb
->
bb_ÿche_¡©e_L2
 = 
NULL
;

810 
	`ä“AÎFunùiÚ_L2
(
bb
->
´oc_±r
);

814 
bb
->
num_ÿche_¡©e_L2
 = 0;

815 if(
bb
->
bb_ÿche_¡©e_L2
 !ğ
NULL
)

817 
	`ä“
(
bb
->
bb_ÿche_¡©e_L2
);

818 
bb
->
bb_ÿche_¡©e_L2
 = 
NULL
;

823 
	}
}

826 
	$ä“AÎ_L2
()

828 
	`ä“AÎFunùiÚ_L2
(
maš_cİy
);

829 
	}
}

832 
ÿche_¡©e
*

833 
	$fixPoštCacheS‹_L2
(
ÿche_¡©e
 *
cs_±r
, 
loİ
 *
Í
)

836 
	}
}

844 
	$isInCache_L2
(
addr
, 
ÿche_lše_way_t
**
mu¡
)

847 
i
;

848 
addr
 = 
	`TAGSET_L2
(addr);

850 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

851 if(
	`isInWay
(
addr
, 
mu¡
[
i
]->
’Œy
, mu¡[i]->
num_’Œy
))

852  
i
;

854 
	}
}

858 
ÿche_lše_way_t
 **

859 
	$cİyCacheS‘_³rsi¡
(
ÿche_lše_way_t
 **
ÿche_£t
)

861 
i
, 
j
;

862 
ÿche_lše_way_t
 **
¤c
 = 
ÿche_£t
, **
cİy
;

863 
cİy
 = (
ÿche_lše_way_t
**è
	`CALLOC
(cİy, 
ÿche_L2
.
Ç
 + 1, (cache_line_way_t*), "cache_line_way_t*");

864 
i
 = 0; i < 
ÿche_L2
.
Ç
 + 1; i++)

866 
cİy
[
i
] = (
ÿche_lše_way_t
*è
	`CALLOC
(copy, 1, (cache_line_way_t), "cache_line_way_t");

868 
cİy
[
i
]->
num_’Œy
 = 
¤c
[i]->num_entry;

869 if(
cİy
[
i
]->
num_’Œy
)

871 
cİy
[
i
]->
’Œy
 = (*è
	`CALLOC
(cİy[i]->’Œy, cİy[i]->
num_’Œy
, (), "cache_line_way_t");

872 
j
 = 0; j < 
cİy
[
i
]->
num_’Œy
; j++)

873 
cİy
[
i
]->
’Œy
[
j
] = 
¤c
[i]->entry[j];

876  
cİy
;

877 
	}
}

879 
ÿche_lše_way_t
 **

880 
	$cİyCacheS‘
(
ÿche_lše_way_t
 **
ÿche_£t
)

882 
i
, 
j
;

883 
ÿche_lše_way_t
 **
¤c
 = 
ÿche_£t
, **
cİy
;

884 
cİy
 = (
ÿche_lše_way_t
**è
	`CALLOC
(cİy, 
ÿche_L2
.
Ç
, (cache_line_way_t*), "cache_line_way_t*");

885 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

887 
cİy
[
i
] = (
ÿche_lše_way_t
*è
	`CALLOC
(copy, 1, (cache_line_way_t), "cache_line_way_t");

889 
cİy
[
i
]->
num_’Œy
 = 
¤c
[i]->num_entry;

890 if(
cİy
[
i
]->
num_’Œy
)

892 
cİy
[
i
]->
’Œy
 = (*è
	`CALLOC
(cİy[i]->’Œy, cİy[i]->
num_’Œy
, (), "cache_line_way_t");

893 
j
 = 0; j < 
cİy
[
i
]->
num_’Œy
; j++)

894 
cİy
[
i
]->
’Œy
[
j
] = 
¤c
[i]->entry[j];

897  
cİy
;

898 
	}
}

902 
	$ä“CacheS‘_L2
(
ÿche_lše_way_t
 **
ÿche_£t
)

904 
i
, 
j
;

905 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

907 if(
ÿche_£t
[
i
]->
num_’Œy
)

908 
	`ä“
(
ÿche_£t
[
i
]->
’Œy
);

909 
	`ä“
(
ÿche_£t
[
i
]);

912 
	`ä“
(
ÿche_£t
);

914 
	}
}

917 
	$isNev”InCache_L2
(
addr
, 
ÿche_lše_way_t
**
may
)

920 
i
;

921 
addr
 = 
	`TAGSET_L2
(addr);

923 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

924 if(
	`isInWay
(
addr
, 
may
[
i
]->
’Œy
, may[i]->
num_’Œy
))

928 
	}
}

932 
ÿche_¡©e
 *

933 
	$m­Loİ_L2
(
´oûdu»
 *
´o
, 
loİ
 *
Í
)

935 
i
, 
j
, 
k
, 
n
, 
£t_no
, 
šcomšg_út
, 
út
, 
tmp
, 
addr
, 
addr_Ãxt
, 
cİ›s
, 
age
;

936 
¡¬t_addr
, 
¡¬t_addr_ãtch
, 
Í_Ëv–
, 
šcomšg_Í_Ëv–
, 
g
, 
g_Ãxt
;

938 
´oûdu»
 *
p
 = 
´o
;

940 
block
 *
bb
, *
šcomšg_bb
;

941 
ÿche_¡©e
 *
cs_±r
, *
cs_tmp
;

942 
ÿche_lše_way_t
 **
ÿche_£t_mu¡
, **
ÿche_£t_may
, **
ÿche_£t_³rsi¡
, **
şw
;

944 
num_blk
 = 
Í
->
num_tİo
;

948 
CHMC
 *
cu¼’t_chmc
;

950 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

951 if(
loİ_Ëv–_¬r
[
i
] =ğ
INVALID
)

953 
Í_Ëv–
 = 
i
 -1;

957 
út
 = 0;

958 
k
 = 0; k <ğ
Í_Ëv–
; k++)

959 if(
loİ_Ëv–_¬r
 [
k
] =ğ
NEXT_ITERATION
)

960 
út
 +ğ(1<<(
Í_Ëv–
 - 
k
));

963 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

966 
bb
 = 
Í
 ->
tİo
[
i
];

968 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

970 
bb
->
num_š¡r
 = bb->
size
 / 
INSN_SIZE
;

972 if(
bb
->
is_loİh—d
 && 
i
 !ğ
num_blk
 -1)

975 
loİ_Ëv–_¬r
[
Í_Ëv–
 + 1] = 
FIRST_ITERATION
;

976 
p
->
loİs
[
bb
->
loİid
]->
num_fm_L2
 = 0;

978 
	`m­Loİ_L2
(
p
,…->
loİs
[
bb
->
loİid
]);

982 
loİ_Ëv–_¬r
[
Í_Ëv–
 + 1] = 
NEXT_ITERATION
;

984 
	`m­Loİ_L2
(
p
,…->
loİs
[
bb
->
loİid
]);

988 
loİ_Ëv–_¬r
[
Í_Ëv–
 + 1] = 
INVALID
;

996 if(
bb
->
is_loİh—d
 == 0)

998 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[0]];

1000 if(!
šcomšg_bb
->
bb_ÿche_¡©e_L2
)

1003 
cs_±r
 = 
	`cİyCacheS‹_L2
(
šcomšg_bb
->
bb_ÿche_¡©e_L2
);

1005 if(
bb
->
num_šcomšg
 > 1)

1011 
j
 = 1; j < 
bb
->
num_šcomšg
; j++)

1013 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[
j
]];

1015 if(
šcomšg_bb
->
bb_ÿche_¡©e_L2
 =ğ
NULL
) ;

1017 
k
 = 0; k < 
ÿche_L2
.
ns
; k++)

1019 
şw
 = 
cs_±r
->
mu¡
[
k
];

1020 
cs_±r
->
mu¡
[
k
] = 
	`š‹r£ùCacheS‹_L2
(cs_±r->mu¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e_L2
->must[k]);

1022 
	`ä“CacheS‘_L2
(
şw
);

1024 
şw
 = 
cs_±r
->
may
[
k
];

1025 
cs_±r
->
may
[
k
] = 
	`uniÚCacheS‹_L2
(cs_±r->may[k], 
šcomšg_bb
->
bb_ÿche_¡©e_L2
->may[k]);

1027 
	`ä“CacheS‘_L2
(
şw
);

1029 
şw
 = 
cs_±r
->
³rsi¡
[
k
];

1030 
cs_±r
->
³rsi¡
[
k
] = 
	`uniÚMaxCacheS‹_L2
(cs_±r->³rsi¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e_L2
->persist[k]);

1032 
	`ä“CacheS‘_L2
(
şw
);

1044 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
FIRST_ITERATION
)

1046 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[0]];

1049 if(!
šcomšg_bb
->
bb_ÿche_¡©e_L2
)

1052 
cs_±r
 = 
	`cİyCacheS‹_L2
(
šcomšg_bb
->
bb_ÿche_¡©e_L2
);

1054 if(
bb
->
num_šcomšg
 > 1)

1060 
j
 = 1; j < 
bb
->
num_šcomšg
; j++)

1062 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[
j
]];

1064 if(
šcomšg_bb
->
bb_ÿche_¡©e_L2
 =ğ
NULL
) ;

1067 
k
 = 0; k < 
ÿche_L2
.
ns
; k++)

1069 
şw
 = 
cs_±r
->
mu¡
[
k
];

1070 
cs_±r
->
mu¡
[
k
] = 
	`š‹r£ùCacheS‹_L2
(cs_±r->mu¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e_L2
->must[k]);

1072 
	`ä“CacheS‘_L2
(
şw
);

1074 
şw
 = 
cs_±r
->
may
[
k
];

1075 
cs_±r
->
may
[
k
] = 
	`uniÚCacheS‹_L2
(cs_±r->may[k], 
šcomšg_bb
->
bb_ÿche_¡©e_L2
->may[k]);

1077 
	`ä“CacheS‘_L2
(
şw
);

1079 
şw
 = 
cs_±r
->
³rsi¡
[
k
];

1080 
cs_±r
->
³rsi¡
[
k
] = 
	`uniÚMaxCacheS‹_L2
(cs_±r->³rsi¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e_L2
->persist[k]);

1082 
	`ä“CacheS‘_L2
(
şw
);

1090 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
NEXT_ITERATION
)

1092 if(! (
p
->
bbli¡
[
Í
->
tİo
[0]->
bbid
]->
bb_ÿche_¡©e_L2
))

1095 
cs_±r
 = 
	`cİyCacheS‹_L2
(
p
->
bbli¡
[
Í
->
tİo
[0]->
bbid
]->
bb_ÿche_¡©e_L2
);

1104 
	`´štf
("\nCFGƒrror!\n");

1105 
	`ex™
(1);

1109 if(
bb
->
num_ÿche_¡©e_L2
 == 0)

1113 
bb
->
num_ÿche_¡©e_L2
 = 1;

1116 if(
bb
->
num_chmc_L2
 == 0)

1118 
cİ›s
 = 2<<(
Í_Ëv–
);

1120 
bb
->
num_chmc_L2
 = 
cİ›s
;

1122 
bb
->
chmc_L2
 = (
CHMC
**)
	`CALLOC
(bb->chmc_L2, 
cİ›s
, (CHMC*), "CHMC");

1124 
tmp
 = 0;m°< 
cİ›s
;mp++)

1126 
bb
->
chmc_L2
[
tmp
] = (
CHMC
*)
	`CALLOC
(bb->chmc_L2[tmp], 1, (CHMC), "CHMC");

1131 
bb
->
bb_ÿche_¡©e_L2
 = 
cs_±r
;

1133 
cu¼’t_chmc
 = 
bb
->
chmc_L2
[
út
];

1135 
cu¼’t_chmc
->
h™
 = 0;

1136 
cu¼’t_chmc
->
h™_cİy
 = 0;

1138 
cu¼’t_chmc
->
miss
 = 0;

1140 
cu¼’t_chmc
->
unknow
 = 0;

1141 
cu¼’t_chmc
->
unknow_cİy
 = 0;

1143 
cu¼’t_chmc
->
wco¡
 = 0;

1144 
cu¼’t_chmc
->
bco¡
 = 0;

1145 
cu¼’t_chmc
->
wco¡_cİy
 = 0;

1146 
cu¼’t_chmc
->
bco¡_cİy
 = 0;

1164 
cu¼’t_chmc
->
h™miss
 = 
bb
->
num_š¡r
;

1166 
cu¼’t_chmc
->
h™miss_addr
 = (*)
	`CALLOC
(cu¼’t_chmc->h™miss_addr, cu¼’t_chmc->
h™miss
, (),"hitmiss_addr");

1168 
addr
 = 
bb
->
¡¬ddr
;

1170 
n
 = 0;‚ < 
bb
->
num_š¡r
 ;‚++)

1172 
£t_no
 = 
	`SET_L2
(
addr
);

1174 if(
	`isInWay
(
addr
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

1176 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
HIT_UPPER
;

1177 
addr
 =‡dd¸+ 
INSN_SIZE
;

1181 if(
maš_cİy
->
h™_ÿche_£t_L2
[
£t_no
] !ğ
USED
)

1183 
numCÚæiùTask
[
£t_no
]++;

1184 
numCÚæiùMSC
[
£t_no
]++;

1186 
maš_cİy
->
h™_ÿche_£t_L2
[
£t_no
] = 
USED
;

1189 
maš_cİy
->
h™_addr
[
£t_no
].
num_’Œy
++;

1190 if(
maš_cİy
->
h™_addr
[
£t_no
].
num_’Œy
 == 1)

1192 
maš_cİy
->
h™_addr
[
£t_no
].
’Œy
 = (*)
	`CALLOC
(main_copy->hit_addr[set_no].entry, 1, (), "entry");

1193 
maš_cİy
->
h™_addr
[
£t_no
].
’Œy
[0] = 
	`TAGSET_L2
(
addr
);

1197 
maš_cİy
->
h™_addr
[
£t_no
].
’Œy
 = (*)
	`REALLOC
(maš_cİy->h™_addr[£t_no].’Œy, maš_cİy->h™_addr[£t_no].
num_’Œy
 * (), "entry");

1198 
maš_cİy
->
h™_addr
[
£t_no
].
’Œy
[maš_cİy->h™_addr[£t_no].
num_’Œy
 -1] = 
	`TAGSET_L2
(
addr
);

1202 
age
 = 
	`isInCache_L2
(
addr
, 
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
]);

1203 if(
age
 != -1)

1205 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
ALWAYS_HIT
;

1207 
maš_cİy
->
h™_ÿche_£t_L2
[
£t_no
] = 
USED
;

1209 if(
cu¼’t_chmc
->
h™
 == 0)

1211 
cu¼’t_chmc
->
h™
++;

1212 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1214 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

1215 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

1217 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1218 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1219 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

1224 
cu¼’t_chmc
->
h™
++;

1226 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1227 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

1228 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "age");

1230 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1231 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1232 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

1236 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1237 
g
 = 
	`SET_L2
(
addr
);

1238 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

1239 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1241 
n
++;

1242 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

1243 if(!
	`isInWay
(
addr_Ãxt
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

1245 if(
cu¼’t_chmc
->
h™
 == 0)

1247 
cu¼’t_chmc
->
h™
++;

1248 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1250 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

1251 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

1253 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1254 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1255 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

1260 
cu¼’t_chmc
->
h™
++;

1262 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1263 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

1264 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "age");

1266 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1267 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1268 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

1273 
addr_Ãxt
 +ğ
INSN_SIZE
;

1274 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

1282 if(
	`isNev”InCache_L2
(
addr
, 
bb
->
bb_ÿche_¡©e_L2
->
may
[
£t_no
]))

1284 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
ALWAYS_MISS
;

1286 
maš_cİy
->
h™_ÿche_£t_L2
[
£t_no
] = 
USED
;

1288 if(
cu¼’t_chmc
->
miss
 == 0)

1290 
cu¼’t_chmc
->
miss
++;

1292 
cu¼’t_chmc
->
miss_addr
 = (*)
	`CALLOC
(current_chmc->miss_addr, 1, (), "miss_addr");

1293 
cu¼’t_chmc
->
miss_addr
[cu¼’t_chmc->
miss
-1] = 
addr
;

1297 
cu¼’t_chmc
->
miss
++;

1299 
cu¼’t_chmc
->
miss_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->miss_addr, cu¼’t_chmc->
miss
 * (), "miss_addr");

1300 
cu¼’t_chmc
->
miss_addr
[cu¼’t_chmc->
miss
-1] = 
addr
;

1303 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1304 
g
 = 
	`SET_L2
(
addr
);

1305 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

1306 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1308 
n
++;

1309 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

1311 if(!
	`isInWay
(
addr_Ãxt
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

1313 if(
cu¼’t_chmc
->
h™
 == 0)

1315 
cu¼’t_chmc
->
h™
++;

1316 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1318 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

1319 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

1321 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1322 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1323 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 - 1;

1328 
cu¼’t_chmc
->
h™
++;

1330 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1331 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

1332 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "age");

1334 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1335 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1336 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 - 1;

1341 
addr_Ãxt
 +ğ
INSN_SIZE
;

1342 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

1350 if(
	`isInCache_L2
(
addr
, 
bb
->
bb_ÿche_¡©e_L2
->
³rsi¡
[
£t_no
]) != -1)

1352 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
FIRST_MISS
;

1353 
Í
->
num_fm_L2
 ++;

1355 
maš_cİy
->
h™_ÿche_£t_L2
[
£t_no
] = 
USED
;

1357 if(
cu¼’t_chmc
->
h™
 == 0)

1359 
cu¼’t_chmc
->
h™
++;

1360 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1362 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

1363 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

1365 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1366 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1367 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

1372 
cu¼’t_chmc
->
h™
++;

1374 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1375 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

1376 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "age");

1378 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

1379 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1380 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

1384 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1385 
g
 = 
	`SET_L2
(
addr
);

1386 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

1387 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1389 
n
++;

1391 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

1393 if(!
	`isInWay
(
addr_Ãxt
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

1395 if(
cu¼’t_chmc
->
h™
 == 0)

1397 
cu¼’t_chmc
->
h™
++;

1398 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1400 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

1401 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

1403 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1404 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1405 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

1410 
cu¼’t_chmc
->
h™
++;

1412 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1413 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

1414 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "age");

1416 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1417 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1418 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

1423 
addr_Ãxt
 +ğ
INSN_SIZE
;

1424 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

1432 
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] = 
UNKNOW
;

1434 
maš_cİy
->
h™_ÿche_£t_L2
[
£t_no
] = 
USED
;

1436 if(
cu¼’t_chmc
->
unknow
 == 0)

1438 
cu¼’t_chmc
->
unknow
++;

1439 
cu¼’t_chmc
->
unknow_addr
 = (*)
	`CALLOC
(current_chmc->unknow_addr, 1, (), "unknow_addr");

1440 
cu¼’t_chmc
->
unknow_addr
[cu¼’t_chmc->
unknow
-1] = 
addr
;

1444 
cu¼’t_chmc
->
unknow
++;

1445 
cu¼’t_chmc
->
unknow_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->unknow_addr, cu¼’t_chmc->
unknow
 * (), "unknow_addr");

1446 
cu¼’t_chmc
->
unknow_addr
[cu¼’t_chmc->
unknow
-1] = 
addr
;

1449 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

1450 
g
 = 
	`SET_L2
(
addr
);

1451 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

1452 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

1454 
n
++;

1455 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

1457 if(!
	`isInWay
(
addr_Ãxt
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

1459 if(
cu¼’t_chmc
->
h™
 == 0)

1461 
cu¼’t_chmc
->
h™
++;

1462 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

1464 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

1465 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

1467 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1468 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1469 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 - 1;

1474 
cu¼’t_chmc
->
h™
++;

1476 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

1477 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

1478 
cu¼’t_chmc
->
age
ğ(*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "age");

1480 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

1481 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

1482 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 - 1;

1487 
addr_Ãxt
 +ğ
INSN_SIZE
;

1488 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

1495 
addr
 = 
addr_Ãxt
;

1499 
n
 = 0;‚ < 
bb
->
num_š¡r
;‚++)

1502 if(
bb
->
chmc
[
út
]->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_HIT
)

1504 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT
;

1505 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

1509 if(
bb
->
chmc
[
út
]->
h™miss_addr
[ 
n
 ] =ğ
FIRST_MISS
)

1511 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
FIRST_ITERATION
)

1513 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_HIT
)

1515 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT_L2
;

1516 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

1519 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_MISS
 ||cu¼’t_chmc->h™miss_addr[‚ ] =ğ
FIRST_MISS
 )

1521 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

1522 
cu¼’t_chmc
->
bco¡
 +ğ
IC_MISS_L2
;

1527 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

1528 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

1532 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
NEXT_ITERATION
)

1534 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT
;

1535 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

1541 if(
bb
->
chmc
[
út
]->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_MISS
)

1543 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_HIT
)

1545 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT_L2
;

1546 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

1549 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
FIRST_MISS
)

1551 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
FIRST_ITERATION
)

1553 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

1554 
cu¼’t_chmc
->
bco¡
 +ğ
IC_MISS_L2
;

1556 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
NEXT_ITERATION
)

1558 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT_L2
;

1559 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

1563 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_MISS
)

1565 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

1566 
cu¼’t_chmc
->
bco¡
 +ğ
IC_MISS_L2
;

1571 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

1572 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

1578 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_HIT
)

1580 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT_L2
;

1581 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

1584 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
FIRST_MISS
)

1586 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
FIRST_ITERATION
)

1588 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

1589 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

1591 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
NEXT_ITERATION
)

1593 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT
;

1594 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

1598 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_MISS
)

1600 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

1601 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

1606 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

1607 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

1615 
cu¼’t_chmc
->
h™_cİy
 = cu¼’t_chmc->
h™
;

1616 
cu¼’t_chmc
->
unknow_cİy
 = cu¼’t_chmc->
unknow
;

1618 
cu¼’t_chmc
->
wco¡_cİy
 = cu¼’t_chmc->
wco¡
;

1619 
cu¼’t_chmc
->
bco¡_cİy
 = cu¼’t_chmc->
bco¡
;

1641 if(
´št
)

1646 
	`´štf
("úˆğ%d, bb->sizğ%d, bb->¡¬dd¸ğ%d\n", 
út
, 
bb
->
size
, bb->
¡¬ddr
);

1648 
	`´štf
("L1:\Âum oàãtch = %d, h™ = %d, missğ%d, unknow = %d\n", 
bb
->
chmc
[
út
]->
h™miss
, bb->chmc[út]->
h™
, bb->chmc[út]->
miss
, bb->chmc[út]->
unknow
);

1649 
	`´štf
("L2:\Âum oàãtch = %d, h™ = %d, missğ%d, unknow = %d\n", 
cu¼’t_chmc
->
h™miss
, cu¼’t_chmc->
h™
, cu¼’t_chmc->
miss
, cu¼’t_chmc->
unknow
);

1651 
	`´štf
("\nwco¡ = %d, bco¡ = %d\n", 
cu¼’t_chmc
->
wco¡
, cu¼’t_chmc->
bco¡
);

1654 if(
´št
)

1655 
	`´štf
("%c", 
tmp
);

1659 if(
bb
->
ÿÎpid
 != -1)

1661 
addr
 = 
bb
->
¡¬ddr
;

1663 
j
 = 0; j < 
bb
->
num_š¡r
; j++)

1665 
£t_no
 = 
	`SET_L2
(
addr
);

1667 if(
	`isInWay
(
addr
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

1669 if(
	`isInWay
(
addr
, 
cu¼’t_chmc
->
unknow_addr
, cu¼’t_chmc->
unknow
))

1671 
ÿche_£t_mu¡
 = 
	`cİyCacheS‘
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
]);

1672 
ÿche_£t_may
 = 
	`cİyCacheS‘
(
bb
->
bb_ÿche_¡©e_L2
->
may
[
£t_no
]);

1673 
ÿche_£t_³rsi¡
 = 
	`cİyCacheS‘_³rsi¡
(
bb
->
bb_ÿche_¡©e_L2
->
³rsi¡
[
£t_no
]);

1675 
	`ÿlcuÏ‹CacheS‹_L2
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e_L2->
may
[£t_no], bb->bb_ÿche_¡©e_L2->
³rsi¡
[£t_no], 
addr
);

1680 
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
] = 
	`š‹r£ùCacheS‹_L2
(
ÿche_£t_mu¡
, bb->bb_cache_state_L2->must[set_no]);

1681 
bb
->
bb_ÿche_¡©e_L2
->
may
[
£t_no
] = 
	`uniÚCacheS‹_L2
(
ÿche_£t_may
, bb->bb_cache_state_L2->may[set_no]);

1682 
bb
->
bb_ÿche_¡©e_L2
->
³rsi¡
[
£t_no
] = 
	`uniÚMaxCacheS‹_L2
(
ÿche_£t_³rsi¡
, bb->bb_cache_state_L2->persist[set_no]);

1686 
	`ä“CacheS‘
(
ÿche_£t_mu¡
);

1687 
	`ä“CacheS‘
(
ÿche_£t_may
);

1688 
	`ä“CacheS‘
(
ÿche_£t_³rsi¡
);

1692 
	`ÿlcuÏ‹CacheS‹_L2
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e_L2->
may
[£t_no], bb->bb_ÿche_¡©e_L2->
³rsi¡
[£t_no], 
addr
);

1694 
addr
 =‡dd¸+ 
INSN_SIZE
;

1698 
cs_±r
 = 
bb
->
bb_ÿche_¡©e_L2
;

1700 
bb
->
bb_ÿche_¡©e_L2
 = 
	`cİyCacheS‹_L2
(
	`m­FunùiÚC®l_L2
(bb->
´oc_±r
, 
cs_±r
));

1702 
	`ä“CacheS‹_L2
(
cs_±r
);

1710 
addr
 = 
bb
->
¡¬ddr
;

1712 
j
 = 0; j < 
bb
->
num_š¡r
; j ++)

1714 
£t_no
 = 
	`SET_L2
(
addr
);

1716 if(
	`isInWay
(
addr
, 
cu¼’t_chmc
->
h™_addr
, cu¼’t_chmc->
h™
))

1718 if(
	`isInWay
(
addr
, 
cu¼’t_chmc
->
unknow_addr
, cu¼’t_chmc->
unknow
))

1720 
ÿche_£t_mu¡
 = 
	`cİyCacheS‘
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
]);

1721 
ÿche_£t_may
 = 
	`cİyCacheS‘
(
bb
->
bb_ÿche_¡©e_L2
->
may
[
£t_no
]);

1722 
ÿche_£t_³rsi¡
 = 
	`cİyCacheS‘_³rsi¡
(
bb
->
bb_ÿche_¡©e_L2
->
³rsi¡
[
£t_no
]);

1724 
	`ÿlcuÏ‹CacheS‹_L2
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e_L2->
may
[£t_no], bb->bb_ÿche_¡©e_L2->
³rsi¡
[£t_no], 
addr
);

1729 
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
] = 
	`š‹r£ùCacheS‹_L2
(
ÿche_£t_mu¡
, bb->bb_cache_state_L2->must[set_no]);

1730 
bb
->
bb_ÿche_¡©e_L2
->
may
[
£t_no
] = 
	`uniÚCacheS‹_L2
(
ÿche_£t_may
, bb->bb_cache_state_L2->may[set_no]);

1731 
bb
->
bb_ÿche_¡©e_L2
->
³rsi¡
[
£t_no
] = 
	`uniÚMaxCacheS‹_L2
(
ÿche_£t_³rsi¡
, bb->bb_cache_state_L2->persist[set_no]);

1734 
	`ä“CacheS‘
(
ÿche_£t_mu¡
);

1735 
	`ä“CacheS‘
(
ÿche_£t_may
);

1736 
	`ä“CacheS‘
(
ÿche_£t_³rsi¡
);

1741 
	`ÿlcuÏ‹CacheS‹_L2
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e_L2->
may
[£t_no], bb->bb_ÿche_¡©e_L2->
³rsi¡
[£t_no], 
addr
);

1743 
addr
 =‡dd¸+ 
INSN_SIZE
;

1753  
p
->
bbli¡
[
Í
 ->
tİo
[0]->
bbid
]->
bb_ÿche_¡©e_L2
;

1754 
	}
}

1758 
ÿche_¡©e
 *

1759 
	$cİyCacheS‹_L2
(
ÿche_¡©e
 *
cs
)

1761 
i
, 
j
, 
k
, 
num_’Œy
, 
tmp
;

1762 
ÿche_¡©e
 *
cİy
 = 
NULL
;

1766 
cİy
 = (
ÿche_¡©e
*)
	`CALLOC
(copy, 1, (cache_state), "cache_state");

1767 
cİy
->
mu¡
 = 
NULL
;

1768 
cİy
->
may
 = 
NULL
;

1769 
cİy
->
³rsi¡
 = 
NULL
;

1777 
cİy
->
mu¡
 = (
ÿche_lše_way_t
***)
	`CALLOC
(cİy->mu¡, 
ÿche_L2
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

1779 
cİy
->
may
 = (
ÿche_lše_way_t
***)
	`CALLOC
(cİy->may, 
ÿche_L2
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

1781 
cİy
->
³rsi¡
 = (
ÿche_lše_way_t
***)
	`CALLOC
(cİy->³rsi¡, 
ÿche_L2
.
ns
, (cache_line_way_t**), "NO set cache_line_way_t");

1783 
j
 = 0; j < 
ÿche_L2
.
ns
; j++)

1785 
cİy
->
mu¡
[
j
] = (
ÿche_lše_way_t
**è
	`CALLOC
(cİy->mu¡[j], 
ÿche_L2
.
Ç
, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

1787 
cİy
->
may
[
j
] = (
ÿche_lše_way_t
**)
	`CALLOC
(cİy->may[j], 
ÿche_L2
.
Ç
, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

1789 
cİy
->
³rsi¡
[
j
] = (
ÿche_lše_way_t
**)
	`CALLOC
(cİy->³rsi¡[j], 
ÿche_L2
.
Ç
 + 1, (cache_line_way_t*), "NO‡ssoc cache_line_way_t");

1791  
k
 = 0; k < 
ÿche_L2
.
Ç
; k++)

1793 
cİy
->
mu¡
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(copy->must[j][k], 1, (cache_line_way_t), "one cache_line_way_t");

1794 
cİy
->
may
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(copy->may[j][k], 1, (cache_line_way_t), "one cache_line_way_t");

1795 
cİy
->
³rsi¡
[
j
][
k
] = (
ÿche_lše_way_t
*)
	`CALLOC
(copy->persist[j][k], 1, (cache_line_way_t), "one cache_line_way_t");

1797 
cİy
->
mu¡
[
j
][
k
]->
num_’Œy
 = 
cs
->must[j][k]->num_entry;

1798 if(
cİy
->
mu¡
[
j
][
k
]->
num_’Œy
)

1800 
cİy
->
mu¡
[
j
][
k
]->
’Œy
 = (*)
	`CALLOC
(cİy->mu¡[j][k]->’Œy, cİy->mu¡[j][k]->
num_’Œy
, (), "entries");

1802 
num_’Œy
 = 0;‚um_’Œy < 
cİy
->
mu¡
[
j
][
k
]->num_entry;‚um_entry++)

1803 
cİy
->
mu¡
[
j
][
k
]->
’Œy
[
num_’Œy
] = 
cs
->must[j][k]->entry[num_entry];

1806 
cİy
->
may
[
j
][
k
]->
num_’Œy
 = 
cs
->may[j][k]->num_entry;

1807 if(
cİy
->
may
[
j
][
k
]->
num_’Œy
)

1809 
cİy
->
may
[
j
][
k
]->
’Œy
 = (*)
	`CALLOC
(cİy->may[j][k]->’Œy, cİy->may[j][k]->
num_’Œy
, (), "entries");

1811 
num_’Œy
 = 0;‚um_’Œy < 
cİy
->
may
[
j
][
k
]->num_entry;‚um_entry++)

1812 
cİy
->
may
[
j
][
k
]->
’Œy
[
num_’Œy
] = 
cs
->may[j][k]->entry[num_entry];

1815 
cİy
->
³rsi¡
[
j
][
k
]->
num_’Œy
 = 
cs
->persist[j][k]->num_entry;

1816 if(
cİy
->
³rsi¡
[
j
][
k
]->
num_’Œy
)

1818 
cİy
->
³rsi¡
[
j
][
k
]->
’Œy
 = (*)
	`CALLOC
(cİy->³rsi¡[j][k]->’Œy, cİy->³rsi¡[j][k]->
num_’Œy
, (), "entries");

1820 
num_’Œy
 = 0;‚um_’Œy < 
cİy
->
³rsi¡
[
j
][
k
]->num_entry;‚um_entry++)

1821 
cİy
->
³rsi¡
[
j
][
k
]->
’Œy
[
num_’Œy
] = 
cs
->persist[j][k]->entry[num_entry];

1827 
cİy
->
³rsi¡
[
j
][
ÿche_L2
.
Ç
] = (
ÿche_lše_way_t
*)
	`CALLOC
(copy->persist[j][cache_L2.na], 1, (cache_line_way_t), "one cache_line_way_t may");

1828 
cİy
->
³rsi¡
[
j
][
ÿche_L2
.
Ç
]->
num_’Œy
 = 
cs
->persist[j][cache_L2.na]->num_entry;

1829 if(
cİy
->
³rsi¡
[
j
][
ÿche_L2
.
Ç
]->
num_’Œy
)

1831 
cİy
->
³rsi¡
[
j
][
ÿche_L2
.
Ç
]->
’Œy
 = (*)
	`CALLOC
(cİy->³rsi¡[j][ÿche_L2.Ç]->’Œy, cİy->³rsi¡[j][ÿche_L2.Ç]->
num_’Œy
, (), "entries");

1833 
num_’Œy
 = 0;‚um_’Œy < 
cİy
->
³rsi¡
[
j
][
ÿche_L2
.
Ç
]->num_entry;‚um_entry++)

1834 
cİy
->
³rsi¡
[
j
][
ÿche_L2
.
Ç
]->
’Œy
[
num_’Œy
] = 
cs
->persist[j][cache_L2.na]->entry[num_entry];

1839  
cİy
;

1840 
	}
}

1846 
ÿche_¡©e
 *

1847 
	$m­FunùiÚC®l_L2
(
´oûdu»
 *
´oc
, 
ÿche_¡©e
 *
cs
)

1849 
i
, 
j
, 
k
, 
n
, 
£t_no
, 
šcomšg_út
, 
út
, 
addr
, 
addr_Ãxt
, 
cİ›s
, 
tmp
, 
g
, 
g_Ãxt
;

1850 
¡¬t_addr
, 
¡¬t_addr_ãtch
, 
Í_Ëv–
, 
šcomšg_Í_Ëv–
, 
age
;

1854 
´oûdu»
 *
p
 = 
´oc
;

1855 
block
 *
bb
, *
šcomšg_bb
;

1856 
ÿche_¡©e
 *
cs_±r
;

1857 
ÿche_lše_way_t
 **
ÿche_£t_mu¡
, **
ÿche_£t_may
, **
şw
;

1858 
CHMC
 *
cu¼’t_chmc
;

1862 
cs_±r
 = 
	`cİyCacheS‹_L2
(
cs
);

1864 
num_blk
 = 
p
->
num_tİo
;

1867 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

1868 if(
loİ_Ëv–_¬r
[
i
] =ğ
INVALID
)

1870 
Í_Ëv–
 = 
i
 -1;

1874 
út
 = 0;

1876 
k
 = 0; k <ğ
Í_Ëv–
; k++)

1877 if(
loİ_Ëv–_¬r
 [
k
] =ğ
NEXT_ITERATION
)

1878 
út
 +ğ(1<<(
Í_Ëv–
 - 
k
));

1880 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

1882 
bb
 = 
p
 ->
tİo
[
i
];

1884 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

1886 
bb
->
num_š¡r
 = bb->
size
 / 
INSN_SIZE
;

1888 if(
bb
->
is_loİh—d
)

1891 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
FIRST_ITERATION
;

1892 
p
->
loİs
[
bb
->
loİid
]->
num_fm_L2
 = 0;

1894 
	`m­Loİ_L2
(
p
,…->
loİs
[
bb
->
loİid
]);

1897 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
NEXT_ITERATION
;

1899 
	`m­Loİ_L2
(
p
,…->
loİs
[
bb
->
loİid
]);

1903 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
INVALID
;

1910 if(
bb
->
num_šcomšg
 > 0)

1912 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[0]];

1915 if(!
šcomšg_bb
->
bb_ÿche_¡©e_L2
) ;

1917 
cs_±r
 = 
	`cİyCacheS‹_L2
(
šcomšg_bb
->
bb_ÿche_¡©e_L2
);

1920 
šcomšg_bb
->
num_outgošg
--;

1921 if(
šcomšg_bb
->
num_outgošg
 < 1 && incomšg_bb->
num_ÿche_¡©e_L2
 == 1)

1923 
šcomšg_bb
->
num_ÿche_¡©e_L2
 = 0;

1929 if(
bb
->
num_šcomšg
 > 1)

1931 if(
´št
è
	`´štf
("\ndo operations if morehan one incomingƒdge\n");

1936 
j
 = 1; j < 
bb
->
num_šcomšg
; j++)

1938 
šcomšg_bb
 = 
p
->
bbli¡
[
bb
->
šcomšg
[
j
]];

1940 if(
šcomšg_bb
->
bb_ÿche_¡©e_L2
 =ğ
NULL
) ;

1942 
k
 = 0; k < 
ÿche_L2
.
ns
; k++)

1944 
şw
 = 
cs_±r
->
mu¡
[
k
];

1945 
cs_±r
->
mu¡
[
k
] = 
	`š‹r£ùCacheS‹_L2
(cs_±r->mu¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e_L2
->must[k]);

1947 
	`ä“CacheS‘_L2
(
şw
);

1949 
şw
 = 
cs_±r
->
may
[
k
];

1950 
cs_±r
->
may
[
k
] = 
	`uniÚCacheS‹_L2
(cs_±r->may[k], 
šcomšg_bb
->
bb_ÿche_¡©e_L2
->may[k]);

1952 
	`ä“CacheS‘_L2
(
şw
);

1954 
şw
 = 
cs_±r
->
³rsi¡
[
k
];

1955 
cs_±r
->
³rsi¡
[
k
] = 
	`uniÚMaxCacheS‹_L2
(cs_±r->³rsi¡[k], 
šcomšg_bb
->
bb_ÿche_¡©e_L2
->persist[k]);

1957 
	`ä“CacheS‘_L2
(
şw
);

1961 
šcomšg_bb
->
num_outgošg
--;

1962 if(
šcomšg_bb
->
num_outgošg
 < 1 && incomšg_bb->
num_ÿche_¡©e_L2
 == 1)

1964 
šcomšg_bb
->
num_ÿche_¡©e_L2
 = 0;

1970 if(
´št
è
	`dumpCacheS‹_L2
(
cs_±r
);

1978 if(
bb
->
num_ÿche_¡©e_L2
== 0)

1982 
bb
->
num_ÿche_¡©e_L2
 = 1;

1985 if(
bb
->
num_chmc_L2
 == 0)

1987 if(
Í_Ëv–
 == -1)

1988 
cİ›s
 = 1;

1990 
cİ›s
 = 2<<(
Í_Ëv–
);

1992 
bb
->
num_chmc_L2
 = 
cİ›s
;

1994 
bb
->
chmc_L2
 = (
CHMC
**)
	`CALLOC
(bb->chmc_L2, 
cİ›s
, (CHMC*), "CHMC");

1996 
tmp
 = 0;m°< 
cİ›s
;mp++)

1998 
bb
->
chmc_L2
[
tmp
] = (
CHMC
*)
	`CALLOC
(bb->chmc_L2[tmp], 1, (CHMC), "CHMC");

2004 
bb
->
bb_ÿche_¡©e_L2
 = 
cs_±r
;

2006 
cu¼’t_chmc
 = 
bb
->
chmc_L2
[
út
];

2008 
cu¼’t_chmc
->
h™
 = 0;

2009 
cu¼’t_chmc
->
h™_cİy
 = 0;

2011 
cu¼’t_chmc
->
miss
 = 0;

2013 
cu¼’t_chmc
->
unknow
 = 0;

2014 
cu¼’t_chmc
->
unknow_cİy
 = 0;

2016 
cu¼’t_chmc
->
wco¡
 = 0;

2017 
cu¼’t_chmc
->
bco¡
 = 0;

2018 
cu¼’t_chmc
->
wco¡_cİy
 = 0;

2019 
cu¼’t_chmc
->
bco¡_cİy
 = 0;

2039 
cu¼’t_chmc
->
h™miss
 = 
bb
->
num_š¡r
;

2041 
cu¼’t_chmc
->
h™miss_addr
 = (*)
	`CALLOC
(cu¼’t_chmc->h™miss_addr, cu¼’t_chmc->
h™miss
, (),"hitmiss_addr");

2043 
addr
 = 
bb
->
¡¬ddr
;

2048 
n
 = 0;‚ < 
bb
->
num_š¡r
;‚++)

2052 
£t_no
 = 
	`SET_L2
(
addr
);

2055 if(
	`isInWay
(
addr
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

2058 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
HIT_UPPER
;

2059 
addr
 =‡dd¸+ 
INSN_SIZE
;

2063 if(
maš_cİy
->
h™_ÿche_£t_L2
[
£t_no
] !ğ
USED
)

2065 
numCÚæiùTask
[
£t_no
]++;

2066 
numCÚæiùMSC
[
£t_no
]++;

2068 
maš_cİy
->
h™_ÿche_£t_L2
[
£t_no
] = 
USED
;

2071 
maš_cİy
->
h™_addr
[
£t_no
].
num_’Œy
++;

2072 if(
maš_cİy
->
h™_addr
[
£t_no
].
num_’Œy
 == 1)

2074 
maš_cİy
->
h™_addr
[
£t_no
].
’Œy
 = (*)
	`CALLOC
(main_copy->hit_addr[set_no].entry, 1, (), "entry");

2075 
maš_cİy
->
h™_addr
[
£t_no
].
’Œy
[0] = 
	`TAGSET_L2
(
addr
);

2079 
maš_cİy
->
h™_addr
[
£t_no
].
’Œy
 = (*)
	`REALLOC
(maš_cİy->h™_addr[£t_no].’Œy, maš_cİy->h™_addr[£t_no].
num_’Œy
 * (), "entry");

2080 
maš_cİy
->
h™_addr
[
£t_no
].
’Œy
[maš_cİy->h™_addr[£t_no].
num_’Œy
 -1] = 
	`TAGSET_L2
(
addr
);

2083 
age
 = 
	`isInCache_L2
(
addr
, 
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
]);

2084 if(
age
 !=-1)

2086 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

2089 if(
cu¼’t_chmc
->
h™
 == 0)

2091 
cu¼’t_chmc
->
h™
++;

2092 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

2094 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

2096 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

2098 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

2099 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2100 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

2104 
cu¼’t_chmc
->
h™
++;

2106 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

2107 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

2108 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

2110 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

2111 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2112 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

2118 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

2119 
g
 = 
	`SET_L2
(
addr
);

2120 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

2121 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

2123 
n
++;

2124 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

2126 if(!
	`isInWay
(
addr_Ãxt
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

2128 if(
cu¼’t_chmc
->
h™
 == 0)

2130 
cu¼’t_chmc
->
h™
++;

2131 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

2133 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

2135 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

2137 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

2138 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2139 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 -1;

2144 
cu¼’t_chmc
->
h™
++;

2146 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

2147 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

2148 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "age");

2150 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

2151 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2152 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 -1;

2157 
addr_Ãxt
 +ğ
INSN_SIZE
;

2158 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

2164 if(
	`isNev”InCache_L2
(
addr
, 
bb
->
bb_ÿche_¡©e_L2
->
may
[
£t_no
]))

2166 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_MISS
;

2168 if(
cu¼’t_chmc
->
miss
 == 0)

2170 
cu¼’t_chmc
->
miss
++;

2172 
cu¼’t_chmc
->
miss_addr
 = (*)
	`CALLOC
(current_chmc->miss_addr, 1, (), "miss_addr");

2173 
cu¼’t_chmc
->
miss_addr
[cu¼’t_chmc->
miss
-1] = 
addr
;

2177 
cu¼’t_chmc
->
miss
++;

2179 
cu¼’t_chmc
->
miss_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->miss_addr, cu¼’t_chmc->
miss
 * (), "miss_addr");

2180 
cu¼’t_chmc
->
miss_addr
[cu¼’t_chmc->
miss
-1] = 
addr
;

2184 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

2185 
g
 = 
	`SET_L2
(
addr
);

2186 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

2187 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

2189 
n
++;

2190 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

2192 if(!
	`isInWay
(
addr_Ãxt
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

2194 if(
cu¼’t_chmc
->
h™
 == 0)

2196 
cu¼’t_chmc
->
h™
++;

2197 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

2199 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

2201 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

2203 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

2204 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2205 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 -1;

2210 
cu¼’t_chmc
->
h™
++;

2212 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

2213 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

2214 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "age");

2216 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

2217 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2218 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 -1;

2223 
addr_Ãxt
 +ğ
INSN_SIZE
;

2224 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

2232 if(
	`isInCache_L2
(
addr
, 
bb
->
bb_ÿche_¡©e_L2
->
³rsi¡
[
£t_no
])!= -1)

2234 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
FIRST_MISS
;

2236 if(
cu¼’t_chmc
->
h™
 == 0)

2238 
cu¼’t_chmc
->
h™
++;

2239 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

2241 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

2243 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

2245 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

2246 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2247 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

2251 
cu¼’t_chmc
->
h™
++;

2253 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

2254 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

2255 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

2257 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr
;

2258 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2259 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] =‡ge;

2265 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

2266 
g
 = 
	`SET_L2
(
addr
);

2267 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

2268 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

2270 
n
++;

2271 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

2273 if(!
	`isInWay
(
addr_Ãxt
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

2275 if(
cu¼’t_chmc
->
h™
 == 0)

2277 
cu¼’t_chmc
->
h™
++;

2278 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

2280 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

2282 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

2284 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

2285 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2286 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 -1;

2291 
cu¼’t_chmc
->
h™
++;

2293 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

2294 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

2295 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "age");

2297 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

2298 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2299 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 -1;

2304 
addr_Ãxt
 +ğ
INSN_SIZE
;

2305 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

2313 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
UNKNOW
;

2315 if(
cu¼’t_chmc
->
unknow
 == 0)

2317 
cu¼’t_chmc
->
unknow
++;

2318 
cu¼’t_chmc
->
unknow_addr
 = (*)
	`CALLOC
(current_chmc->unknow_addr, 1, (), "unknow_addr");

2319 
cu¼’t_chmc
->
unknow_addr
[cu¼’t_chmc->
unknow
-1] = 
addr
;

2323 
cu¼’t_chmc
->
unknow
++;

2324 
cu¼’t_chmc
->
unknow_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->unknow_addr, cu¼’t_chmc->
unknow
 * (), "unknow_addr");

2325 
cu¼’t_chmc
->
unknow_addr
[cu¼’t_chmc->
unknow
-1] = 
addr
;

2328 
addr_Ãxt
 = 
addr
 + 
INSN_SIZE
;

2329 
g
 = 
	`SET_L2
(
addr
);

2330 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

2331 
g
 =ğ
g_Ãxt
 && 
n
 < 
bb
->
num_š¡r
 - 1)

2333 
n
++;

2334 
cu¼’t_chmc
->
h™miss_addr
[
n
] = 
ALWAYS_HIT
;

2335 if(!
	`isInWay
(
addr_Ãxt
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

2337 if(
cu¼’t_chmc
->
h™
 == 0)

2339 
cu¼’t_chmc
->
h™
++;

2340 
cu¼’t_chmc
->
h™_addr
 = (*)
	`CALLOC
(current_chmc->hit_addr, 1, (), "hit_addr");

2342 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`CALLOC
(current_chmc->hit_change_miss, 1, (), "hit_change_miss");

2343 
cu¼’t_chmc
->
age
 = (*)
	`CALLOC
(current_chmc->age, 1, (), "age");

2345 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

2346 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2347 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 -1;

2352 
cu¼’t_chmc
->
h™
++;

2354 
cu¼’t_chmc
->
h™_addr
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_addr, cu¼’t_chmc->
h™
 * (), "hit_addr");

2355 
cu¼’t_chmc
->
h™_chªge_miss
 = (*)
	`REALLOC
(cu¼’t_chmc->h™_chªge_miss, cu¼’t_chmc->
h™
 * (), "hit_change_miss");

2356 
cu¼’t_chmc
->
age
 = (*)
	`REALLOC
(cu¼’t_chmc->age, cu¼’t_chmc->
h™
 * (), "age");

2358 
cu¼’t_chmc
->
h™_addr
[cu¼’t_chmc->
h™
-1] = 
addr_Ãxt
;

2359 
cu¼’t_chmc
->
h™_chªge_miss
[cu¼’t_chmc->
h™
-1] = 
HIT
;

2360 
cu¼’t_chmc
->
age
[cu¼’t_chmc->
h™
-1] = 
ÿche_L2
.
Ç
 -1;

2365 
addr_Ãxt
 +ğ
INSN_SIZE
;

2366 
g_Ãxt
 = 
	`SET_L2
(
addr_Ãxt
);

2374 
addr
 = 
addr_Ãxt
;

2380 
	`as£¹
((
bb
->
chmc
[
út
]->
miss
 + bb->chmc[út]->
unknow
è=ğ(
cu¼’t_chmc
->
h™
 + current_chmc->miss + current_chmc->unknow));

2382 
n
 = 0;‚ < 
bb
->
num_š¡r
;‚++)

2385 if(
bb
->
chmc
[
út
]->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_HIT
)

2387 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT
;

2388 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

2392 if(
bb
->
chmc
[
út
]->
h™miss_addr
[ 
n
 ] =ğ
FIRST_MISS
)

2394 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
FIRST_ITERATION
)

2396 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_HIT
)

2398 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT_L2
;

2399 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

2402 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_MISS
 ||cu¼’t_chmc->h™miss_addr[‚ ] =ğ
FIRST_MISS
 )

2404 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

2405 
cu¼’t_chmc
->
bco¡
 +ğ
IC_MISS_L2
;

2410 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

2411 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

2415 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
NEXT_ITERATION
)

2417 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT
;

2418 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

2424 if(
bb
->
chmc
[
út
]->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_MISS
)

2426 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_HIT
)

2428 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT_L2
;

2429 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

2432 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
FIRST_MISS
)

2434 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
FIRST_ITERATION
)

2436 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

2437 
cu¼’t_chmc
->
bco¡
 +ğ
IC_MISS_L2
;

2439 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
NEXT_ITERATION
)

2441 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT_L2
;

2442 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

2446 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_MISS
)

2448 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

2449 
cu¼’t_chmc
->
bco¡
 +ğ
IC_MISS_L2
;

2454 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

2455 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

2461 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_HIT
)

2463 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT_L2
;

2464 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

2467 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
FIRST_MISS
)

2469 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
FIRST_ITERATION
)

2471 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

2472 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

2474 if(
loİ_Ëv–_¬r
[
Í_Ëv–
] =ğ
NEXT_ITERATION
)

2476 
cu¼’t_chmc
->
wco¡
 +ğ
IC_HIT
;

2477 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT_L2
;

2481 if(
cu¼’t_chmc
->
h™miss_addr
[ 
n
 ] =ğ
ALWAYS_MISS
)

2483 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

2484 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

2489 
cu¼’t_chmc
->
wco¡
 +ğ
IC_MISS_L2
;

2490 
cu¼’t_chmc
->
bco¡
 +ğ
IC_HIT
;

2498 
cu¼’t_chmc
->
h™_cİy
 = cu¼’t_chmc->
h™
;

2499 
cu¼’t_chmc
->
unknow_cİy
 = cu¼’t_chmc->
unknow
;

2501 
cu¼’t_chmc
->
wco¡_cİy
 = cu¼’t_chmc->
wco¡
;

2502 
cu¼’t_chmc
->
bco¡_cİy
 = cu¼’t_chmc->
bco¡
;

2522 if(
´št
)

2527 
	`´štf
("úˆğ%d, bb->sizğ%d, bb->¡¬dd¸ğ%d\n", 
út
, 
bb
->
size
, bb->
¡¬ddr
);

2529 
	`´štf
("L1:\Âum oàãtch = %d, h™ = %d, missğ%d, unknow = %d\n", 
bb
->
chmc
[
út
]->
h™miss
, bb->chmc[út]->
h™
, bb->chmc[út]->
miss
, bb->chmc[út]->
unknow
);

2530 
	`´štf
("L2:\Âum oàãtch = %d, h™ = %d, missğ%d, unknow = %d\n", 
cu¼’t_chmc
->
h™miss
, cu¼’t_chmc->
h™
, cu¼’t_chmc->
miss
, cu¼’t_chmc->
unknow
);

2532 
	`´štf
("\nwco¡ = %d, bco¡ = %d\n", 
cu¼’t_chmc
->
wco¡
, cu¼’t_chmc->
bco¡
);

2534 if(
´št
)

2535 
	`´štf
("%c\n", 
tmp
);

2538 if(
bb
->
ÿÎpid
 != -1)

2540 
addr
 = 
bb
->
¡¬ddr
;

2542 
j
 = 0; j < 
bb
->
num_š¡r
; j ++)

2545 
£t_no
 = 
	`SET_L2
(
addr
);

2547 if(
	`isInWay
(
addr
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

2551 if(
	`isInWay
(
addr
, 
cu¼’t_chmc
->
unknow_addr
, cu¼’t_chmc->
unknow
))

2553 
ÿche_£t_mu¡
 = 
	`cİyCacheS‘
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
]);

2554 
ÿche_£t_may
 = 
	`cİyCacheS‘
(
bb
->
bb_ÿche_¡©e_L2
->
may
[
£t_no
]);

2556 
	`ÿlcuÏ‹CacheS‹_L2
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e_L2->
may
[£t_no], bb->bb_ÿche_¡©e_L2->
³rsi¡
[£t_no], 
addr
);

2561 
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
] = 
	`š‹r£ùCacheS‹_L2
(
ÿche_£t_mu¡
, bb->bb_cache_state_L2->must[set_no]);

2562 
bb
->
bb_ÿche_¡©e_L2
->
may
[
£t_no
] = 
	`uniÚCacheS‹_L2
(
ÿche_£t_may
, bb->bb_cache_state_L2->may[set_no]);

2565 
	`ä“CacheS‘
(
ÿche_£t_mu¡
);

2566 
	`ä“CacheS‘
(
ÿche_£t_may
);

2570 
	`ÿlcuÏ‹CacheS‹_L2
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e_L2->
may
[£t_no], bb->bb_ÿche_¡©e_L2->
³rsi¡
[£t_no], 
addr
);

2573 
addr
 =‡dd¸+ 
INSN_SIZE
;

2577 
cs_±r
 = 
bb
->
bb_ÿche_¡©e_L2
;

2578 
bb
->
bb_ÿche_¡©e_L2
 = 
	`cİyCacheS‹_L2
(
	`m­FunùiÚC®l_L2
(bb->
´oc_±r
, 
cs_±r
));

2580 
	`ä“CacheS‹_L2
(
cs_±r
);

2581 
cs_±r
 = 
NULL
;

2587 
addr
 = 
bb
->
¡¬ddr
;

2589 
j
 = 0; j < 
bb
->
num_š¡r
; j ++)

2591 
£t_no
 = 
	`SET_L2
(
addr
);

2594 if(
	`isInWay
(
addr
, 
bb
->
chmc
[
út
]->
h™_addr
, bb->chmc[út]->
h™
))

2599 if(
	`isInWay
(
addr
, 
cu¼’t_chmc
->
unknow_addr
, cu¼’t_chmc->
unknow
))

2601 
ÿche_£t_mu¡
 = 
	`cİyCacheS‘
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
]);

2602 
ÿche_£t_may
 = 
	`cİyCacheS‘
(
bb
->
bb_ÿche_¡©e_L2
->
may
[
£t_no
]);

2604 
	`ÿlcuÏ‹CacheS‹_L2
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e_L2->
may
[£t_no], bb->bb_ÿche_¡©e_L2->
³rsi¡
[£t_no], 
addr
);

2609 
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
] = 
	`š‹r£ùCacheS‹_L2
(
ÿche_£t_mu¡
, bb->bb_cache_state_L2->must[set_no]);

2610 
bb
->
bb_ÿche_¡©e_L2
->
may
[
£t_no
] = 
	`uniÚCacheS‹_L2
(
ÿche_£t_may
, bb->bb_cache_state_L2->may[set_no]);

2613 
	`ä“CacheS‘
(
ÿche_£t_mu¡
);

2614 
	`ä“CacheS‘
(
ÿche_£t_may
);

2619 
	`ÿlcuÏ‹CacheS‹_L2
(
bb
->
bb_ÿche_¡©e_L2
->
mu¡
[
£t_no
], bb->bb_ÿche_¡©e_L2->
may
[£t_no], bb->bb_ÿche_¡©e_L2->
³rsi¡
[£t_no], 
addr
);

2621 
addr
 =‡dd¸+
INSN_SIZE
;

2631 
i
 = 0; i < 
p
->
num_bb
; i ++)

2632 
p
->
bbli¡
[
i
]->
num_outgošg
 =…->bbli¡[i]->
num_outgošg_cİy
;

2634  
p
 ->
bbli¡
[…->
tİo
[0]->
bbid
]->
bb_ÿche_¡©e_L2
;

2635 
	}
}

2639 
	$»£tFunùiÚ_L2
(
´oûdu»
 * 
´oc
)

2641 
i
, 
j
, 
út
, 
Í_Ëv–
, 
num_blk
, 
cİ›s
;

2643 
´oûdu»
 *
p
 = 
´oc
;

2644 
block
 *
bb
;

2646 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

2647 if(
loİ_Ëv–_¬r
[
i
] =ğ
INVALID
)

2649 
Í_Ëv–
 = 
i
 -1;

2653 
út
 = 0;

2654 
i
 = 0; i <ğ
Í_Ëv–
; i++)

2655 if(
loİ_Ëv–_¬r
 [
i
] =ğ
NEXT_ITERATION
)

2656 
út
 +ğ(1<<(
Í_Ëv–
 - 
i
));

2659 
num_blk
 = 
p
->
num_tİo
;

2661 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

2664 
bb
 = 
p
 ->
tİo
[
i
];

2667 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

2669 if(
bb
->
is_loİh—d
)

2672 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
FIRST_ITERATION
;

2673 
	`»£tLoİ_L2
(
p
,…->
loİs
[
bb
->
loİid
]);

2675 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
NEXT_ITERATION
;

2676 
	`»£tLoİ_L2
(
p
,…->
loİs
[
bb
->
loİid
]);

2678 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
INVALID
;

2684 
bb
->
chmc_L2
[
út
]->
h™
 = bb->chmc_L2[út]->
h™_cİy
;

2685 
bb
->
chmc_L2
[
út
]->
unknow
 = bb->chmc_L2[út]->
unknow_cİy
;

2687 
bb
->
chmc_L2
[
út
]->
wco¡
 = bb->chmc_L2[út]->
wco¡_cİy
;

2688 
bb
->
chmc_L2
[
út
]->
bco¡
 = bb->chmc_L2[út]->
bco¡_cİy
;

2690 
j
 = 0; j < 
bb
->
chmc_L2
[
út
]->
h™
; j ++)

2691 
bb
->
chmc_L2
[
út
]->
h™_chªge_miss
[
j
] = 
HIT
;

2695 if(
bb
->
ÿÎpid
 != -1)

2697 
	`»£tFunùiÚ_L2
(
bb
->
´oc_±r
);

2702 
	}
}

2705 
	$»£tLoİ_L2
(
´oûdu»
 * 
´oc
, 
loİ
 * 
Í
)

2708 
i
, 
j
, 
út
, 
Í_Ëv–
, 
num_blk
, 
cİ›s
, 
tmp
;

2710 
´oûdu»
 *
p
 = 
´oc
;

2711 
block
 *
bb
;

2712 
loİ
 *
Í_±r
 = 
Í
;

2714 
num_blk
 = 
Í_±r
->
num_tİo
;

2719 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

2720 if(
loİ_Ëv–_¬r
[
i
] =ğ
INVALID
)

2722 
Í_Ëv–
 = 
i
 -1;

2726 
út
 = 0;

2727 
i
 = 0; i <ğ
Í_Ëv–
; i++)

2728 if(
loİ_Ëv–_¬r
 [
i
] =ğ
NEXT_ITERATION
)

2729 
út
 +ğ(1<<(
Í_Ëv–
 - 
i
));

2731 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

2734 
bb
 = 
Í_±r
->
tİo
[
i
];

2737 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

2739 if(
bb
->
is_loİh—d
 && 
i
!ğ
num_blk
 -1)

2742 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
FIRST_ITERATION
;

2744 
	`»£tLoİ_L2
(
p
,…->
loİs
[
bb
->
loİid
]);

2746 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
NEXT_ITERATION
;

2747 
	`»£tLoİ_L2
(
p
,…->
loİs
[
bb
->
loİid
]);

2749 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
INVALID
;

2756 
bb
->
chmc_L2
[
út
]->
h™
 = bb->chmc_L2[út]->
h™_cİy
;

2757 
bb
->
chmc_L2
[
út
]->
unknow
 = bb->chmc_L2[út]->
unknow_cİy
;

2759 
bb
->
chmc_L2
[
út
]->
wco¡
 = bb->chmc_L2[út]->
wco¡_cİy
;

2760 
bb
->
chmc_L2
[
út
]->
bco¡
 = bb->chmc_L2[út]->
bco¡_cİy
;

2762 
j
 = 0; j < 
bb
->
chmc_L2
[
út
]->
h™
; j ++)

2763 
bb
->
chmc_L2
[
út
]->
h™_chªge_miss
[
j
] = 
HIT
;

2765 if(
bb
->
ÿÎpid
 != -1)

2767 
	`»£tFunùiÚ_L2
(
bb
->
´oc_±r
);

2773 
	}
}

2779 
	$»£tH™Miss_L2
(
MSC
 *
msc
)

2781 
i
;

2784 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

2785 
loİ_Ëv–_¬r
[
i
] = 
INVALID
;

2786 
i
 = 0; i < 
msc
->
num_sk
; i++)

2788 
	`»£tFunùiÚ_L2
(
msc
->
skLi¡
[
i
].
maš_cİy
);

2790 
	}
}

2796 
	$ÿcheAÇlysis_L2
()

2798 
i
;

2800 
š¡r_³r_block_L2
 = 
ÿche_L2
.
ls
 / 
INSN_SIZE
;

2802 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

2803 
loİ_Ëv–_¬r
[
i
] = 
INVALID
;

2806 
ÿche_¡©e
 *
¡¬t
;

2808 
¡¬t
 = 
	`®locCacheS‹_L2
();

2810 
maš_cİy
->
h™_ÿche_£t_L2
 = (*)
	`CALLOC
(maš_cİy->h™_ÿche_£t_L2, 
ÿche_L2
.
ns
, (), "hit_cache_set_L2");

2811 
maš_cİy
->
h™_addr
 = (
ÿche_lše_way_t
*)
	`CALLOC
(maš_cİy->h™_addr, 
ÿche_L2
.
ns
, (cache_line_way_t), "cache_line_way_t");

2812 
i
 = 0; i < 
ÿche_L2
.
ns
; i++)

2813 
maš_cİy
->
h™_ÿche_£t_L2
[
i
] = 
NOT_USED
;

2816 
¡¬t
 = 
	`m­FunùiÚC®l_L2
(
maš_cİy
, start);

2825 
	}
}

	@analysisDAG.c

5 
	~<¡dio.h
>

33 
	$ª®y£DAGFunùiÚ
(
´oûdu»
 *
´oc
, 
šdex
)

36 
uÎ
 *
wût_¬r
 = 
NULL
;

43 
i
, 
id
;

44 
â
[100];

45 
max
;

46 
block
 *
bb
;

47 
äeq
;

49 
´oûdu»
 *
p
;

50 
loİ
 *
Í
, *
Ín
;

52 *
w·th
;

55 
block
 **
tİo
;

56 
num_tİo
;

60 
p
 = 
´oc
;

61 
tİo
 = 
p
->topo;

62 
num_tİo
 = 
p
->num_topo;

69 
wût_¬r
 = (
uÎ
*è
	`CALLOC
Ğwût_¬r, 
p
->
num_bb
, (ull), "wcet_arr" );

72  
i
 = 0; i < 
num_tİo
; i++ ) {

73 
bb
 = 
tİo
[
i
];

74 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

79 ifĞ
bb
->
¡¬ddr
 == -1 )

83 ifĞ
bb
->
is_loİh—d
)

85 
Ín
 = 
p
->
loİs
[ 
bb
->
loİid
 ];

87 
wût_¬r
[ 
bb
->
bbid
 ] = 
Ín
->
wût
[
šdex
 * 2] +†pn->wcet[index * 2 + 1];

90 
wût_¬r
[ 
bb
->
bbid
 ] +ğwût_¬r[ 
Ín
->
loİex™
->bbid ];

93 
	`´štf
("wût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r
[bb->bbid]);

100 
wût_¬r
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[
šdex
]->
wco¡
;

104 
	`´štf
("wût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r
[bb->bbid]);

108  
bb
->
num_outgošg
 ) {

114 
wût_¬r
[ 
bb
->
bbid
 ] +ğwût_¬r[ bb->
outgošg
[0] ];

117 
	`´štf
("wût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r
[bb->bbid]);

122 if(
bb
->
loİid
 !ğ
p
->
bbli¡
[bb->
outgošg
[0]]->loopid)

123 
max
 = 1;

124 if(
bb
->
loİid
 !ğ
p
->
bbli¡
[bb->
outgošg
[1]]->loopid)

125 
max
 = 0;

129 ifĞ
wût_¬r
[ 
bb
->
outgošg
[0] ] >= wcet_arr[ bb->outgoing[1] ] )

130 
max
 = 0;

132 
max
 = 1;

134 
wût_¬r
[ 
bb
->
bbid
 ] +ğwût_¬r[ bb->
outgošg
[
max
] ];

137 
	`´štf
("wût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r
[bb->bbid]);

145 
	`´štf
Ğ"Inv®id‚umb” oàoutgošgƒdge © %d-%d\n", 
bb
->
pid
, bb->
bbid
 );

146 
	`ex™
(1);

151 ifĞ
bb
->
ÿÎpid
 != -1 ) {

153 
wût_¬r
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
wût
[
šdex
];

155 
	`´štf
Ğ"bb %d-%d…roûdu» c®È%d wût: %Lu\n", 
bb
->
pid
, bb->
bbid
,

156 
bb
->
ÿÎpid
, 
p
->
wût
[
šdex
] ); 
	`fæush
Ğ
¡dout
 );

160 
	`´štf
("wût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r
[bb->bbid]);

237 
p
->
wût
[
šdex
] = 
wût_¬r
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

241 
	`´štf
("p->wût[%d] = %Lu\n",
šdex
, 
p
->
wût
[index]);

265 
	`ä“
Ğ
wût_¬r
 );

269 
	}
}

273 
	$ª®y£DAGLoİ
(
´oûdu»
 *
´oc
, 
loİ
 *
lİ
, 
šdex
 )

275 
uÎ
 *
wût_¬r_1
 = 
NULL
;

276 
uÎ
 *
wût_¬r_2
 = 
NULL
;

283 
i
, 
id
;

285 
max1
, 
max2
;

286 
block
 *
bb
;

289 
´oûdu»
 *
p
;

290 
loİ
 *
Í
, *
Ín
;

295 
block
 **
tİo
;

296 
num_tİo
;

300 
Í
 = 
lİ
;

301 
p
 = 
´oc
;

302 
tİo
 = 
Í
->topo;

303 
num_tİo
 = 
Í
->num_topo;

310 
wût_¬r_1
 = (
uÎ
*è
	`CALLOC
Ğwût_¬r_1, 
p
->
num_bb
, (ull), "wcet_arr_1");

311 
wût_¬r_2
 = (
uÎ
*è
	`CALLOC
Ğwût_¬r_2, 
p
->
num_bb
, (ull), "wcet_arr_2");

315  
i
 = 0; i < 
num_tİo
; i++ )

317 
bb
 = 
tİo
[
i
];

318 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

323 ifĞ
bb
->
¡¬ddr
 == -1 )

327 ifĞ
bb
->
is_loİh—d
 && (bb->
loİid
 !ğ
Í
->
Íid
))

329 
Ín
 = 
p
->
loİs
[ 
bb
->
loİid
 ];

331 
wût_¬r_1
[ 
bb
->
bbid
 ] = 
Ín
->
wût
[
šdex
 * 2];

332 
wût_¬r_2
[ 
bb
->
bbid
 ] = 
Ín
->
wût
[
šdex
 * 2 + 1] * (
Í
->
loİbound
 -1);

336 
wût_¬r_2
[ 
bb
->
bbid
 ] +ğwût_¬r_2[ 
Ín
->
loİex™
->bbid ];

340 
	`´štf
("wût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_1
[bb->bbid]);

341 
	`´štf
("wût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_2
[bb->bbid]);

351 
wût_¬r_1
[ 
bb
->
bbid
 ] +ğbb->
chmc_L2
[
šdex
 * 2]->
wco¡
;

352 
wût_¬r_2
[ 
bb
->
bbid
 ] +ğbb->
chmc_L2
[
šdex
 * 2 + 1]->
wco¡
 * (
Í
->
loİbound
 -1);

357 
	`´štf
("wût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_1
[bb->bbid]);

358 
	`´štf
("wût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_2
[bb->bbid]);

362  
bb
->
num_outgošg
 ) {

368 
wût_¬r_1
[ 
bb
->
bbid
 ] +ğwût_¬r_1[ bb->
outgošg
[0] ];

369 
wût_¬r_2
[ 
bb
->
bbid
 ] +ğwût_¬r_2[ bb->
outgošg
[0] ];

372 
	`´štf
("wût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_1
[bb->bbid]);

373 
	`´štf
("wût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_2
[bb->bbid]);

381 if(
bb
->
loİid
 > 
p
->
bbli¡
[bb->
outgošg
[0]]->loopid)

383 
max1
 = 1;

384 
max2
 = 1;

386 if(
bb
->
loİid
 > 
p
->
bbli¡
[bb->
outgošg
[1]]->loopid)

388 
max1
 = 0;

389 
max2
 = 0;

394 ifĞ
wût_¬r_1
[ 
bb
->
outgošg
[0] ] >= wcet_arr_1[ bb->outgoing[1] ] )

395 
max1
 = 0;

397 
max1
 = 1;

399 ifĞ
wût_¬r_2
[ 
bb
->
outgošg
[0] ] >= wcet_arr_2[ bb->outgoing[1] ] )

400 
max2
 = 0;

402 
max2
 = 1;

404 
wût_¬r_1
[ 
bb
->
bbid
 ] +ğwût_¬r_1[ bb->
outgošg
[
max1
] ];

405 
wût_¬r_2
[ 
bb
->
bbid
 ] +ğwût_¬r_2[ bb->
outgošg
[
max2
] ];

408 
	`´štf
("wût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_1
[bb->bbid]);

409 
	`´štf
("wût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_2
[bb->bbid]);

415 
	`´štf
Ğ"Inv®id‚umb” oàoutgošgƒdge © %d-%d\n", 
bb
->
pid
, bb->
bbid
 );

416 
	`ex™
(1);

421 ifĞ
bb
->
ÿÎpid
 != -1 ) {

423 
wût_¬r_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
wût
[
šdex
 * 2];

424 
wût_¬r_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
wût
[
šdex
 * 2 + 1] * (
Í
->
loİbound
 -1);

426 
	`´štf
Ğ"bb %d-%d…roûdu» c®È%d wût: 1 %Lu 2 %Lu\n", 
bb
->
pid
, bb->
bbid
,

427 
bb
->
ÿÎpid
, 
p
->
wût
[
šdex
 * 2],…->wût[šdex * 2 + 1]); 
	`fæush
Ğ
¡dout
 );

430 
	`´štf
("wût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_1
[bb->bbid]);

431 
	`´štf
("wût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_2
[bb->bbid]);

507 
Í
->
wût
[
šdex
] = 
wût_¬r_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

508 
Í
->
wût
[
šdex
 + 1] = 
wût_¬r_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

510 ifĞ!
Í
->
is_dowhe
 )

513 
Í
->
wût
[
šdex
] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc_L2
[šdex * 2 + 1]->
wco¡
;

514 ifĞ
Í
->
loİh—d
->
ÿÎpid
 != -1 )

515 
Í
->
wût
[
šdex
] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->wcet[index];

520 
	`´štf
("Í->wût[%d] = %Lu\n", 
šdex
, 
Í
->
wût
[index]);

521 
	`´štf
("Í->wût[%d] = %Lu\n", 
šdex
+1, 
Í
->
wût
[index + 1]);

541 
	`ä“
Ğ
wût_¬r_1
 );

542 
	`ä“
Ğ
wût_¬r_2
 );

545 
	}
}

554 
	$ª®y£Proc
Ğ
´oûdu»
 *
p
 ) {

556 
i
, 
j
;

557 
loİ
 *
Í
;

560  
i
 = 
p
->
num_loİs
 - 1; i >= 0; i-- ) {

561 
Í
 = 
p
->
loİs
[
i
];

565 
j
 = 0; j < (1<<
Í
->
Ëv–
); j++)

566 
	`ª®y£DAGLoİ
(
p
, 
Í
, 
j
*2);

574 
j
 = 0; j < 
p
->
num_co¡
; j++)

575 
	`ª®y£DAGFunùiÚ
Ğ
p
, 
j
);

577 
	}
}

588 
	$ª®ysis_dag
(
MSC
 *
msc
) {

590 
i
, 
j
, 
k
;

591 
t
;

593 
	`cyşe_time
(0);

595 
k
 = 0; k < 
msc
->
num_sk
; k++)

598  
i
 = 0; i < 
msc
->
skLi¡
[
k
].
num_´oc
; i++ )

599 
j
 = 0; j < 
msc
->
skLi¡
[
k
].
´oc_cg_±r
[
i
].
num_´oc
; j++)

601 
	`ª®y£Proc
(
msc
->
skLi¡
[
k
].
´oc_cg_±r
[
i
].
´oc
[
j
]);

605 
msc
->
skLi¡
[
k
].
wût
 = msc->skLi¡[k].
maš_cİy
->wcet[0];

608 
	`´štf
("msc->skLi¡[%d].wûˆğ%Lu\n", 
k
, 
msc
->
skLi¡
[k].
wût
);

613 
t
 = 
	`cyşe_time
(1);

614 
	`´štf
Ğ"\nTimk’ (ª®ysis): %àms\n", 
t
/
CYCLES_PER_MSEC
 ); 
	`fæush
Ğ
¡dout
 );

617 
	}
}

	@analysisDAG_BCET.c

5 
	~<¡dio.h
>

33 
	$ª®y£DAGFunùiÚ_BCET
(
´oûdu»
 *
´oc
, 
šdex
)

36 
uÎ
 *
bût_¬r
 = 
NULL
;

38 
uÎ
 *
h™_¬r
 = 
NULL
;

39 
uÎ
 *
miss_¬r
 = 
NULL
;

40 
uÎ
 *
unknow_¬r
 = 
NULL
;

42 
uÎ
 *
h™_¬r_L2
 = 
NULL
;

43 
uÎ
 *
miss_¬r_L2
 = 
NULL
;

44 
uÎ
 *
unknow_¬r_L2
 = 
NULL
;

52 
i
, 
id
;

54 
mš
;

55 
block
 *
bb
;

58 
´oûdu»
 *
p
;

59 
loİ
 *
Í
, *
Ín
;

64 
block
 **
tİo
;

65 
num_tİo
;

69 
p
 = 
´oc
;

70 
tİo
 = 
p
->topo;

71 
num_tİo
 = 
p
->num_topo;

78 
bût_¬r
 = (
uÎ
*è
	`CALLOC
Ğbût_¬r, 
p
->
num_bb
, (ull), "bcet_arr" );

80 
h™_¬r
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r, 
p
->
num_bb
, (ull), "hit_arr" );

81 
miss_¬r
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r, 
p
->
num_bb
, (ull), "miss_arr" );

82 
unknow_¬r
 = (
uÎ
*è
	`CALLOC
Ğunknow_¬r, 
p
->
num_bb
, (ull), "unknow_arr" );

84 
h™_¬r_L2
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r_L2, 
p
->
num_bb
, (ull), "hit_arr_L2" );

85 
miss_¬r_L2
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r_L2, 
p
->
num_bb
, (ull), "miss_arr_L2" );

86 
unknow_¬r_L2
 = (
uÎ
*è
	`CALLOC
Ğunknow_¬r_L2, 
p
->
num_bb
, (ull), "unknow_arr_L2" );

91  
i
 = 0; i < 
num_tİo
; i++ ) {

92 
bb
 = 
tİo
[
i
];

93 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

98 ifĞ
bb
->
¡¬ddr
 == -1 )

102 ifĞ
bb
->
is_loİh—d
)

104 
Ín
 = 
p
->
loİs
[ 
bb
->
loİid
 ];

121 
bût_¬r
[ 
bb
->
bbid
 ] +ğbût_¬r[ 
Ín
->
loİex™
->bbid ] + bb->
chmc_L2
[ 
šdex
 ]->
bco¡
;

123 
h™_¬r
[ 
bb
->
bbid
 ] +ğh™_¬r[ 
Ín
->
loİex™
->bbid ] + bb->
chmc
[ 
šdex
 ]->
h™
;

124 
miss_¬r
[ 
bb
->
bbid
 ] +ğmiss_¬r[ 
Ín
->
loİex™
->bbid ] + bb->
chmc
[ 
šdex
 ]->
miss
;

125 
unknow_¬r
[ 
bb
->
bbid
 ] +ğunknow_¬r[ 
Ín
->
loİex™
->bbid ] + bb->
chmc
[ 
šdex
 ]->
unknow
;

127 
h™_¬r_L2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2[ 
Ín
->
loİex™
->bbid ] + bb->
chmc_L2
[ 
šdex
 ]->
h™
;

128 
miss_¬r_L2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2[ 
Ín
->
loİex™
->bbid ] + bb->
chmc_L2
[ 
šdex
 ]->
miss
;

129 
unknow_¬r_L2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2[ 
Ín
->
loİex™
->bbid ] + bb->
chmc_L2
[ 
šdex
 ]->
unknow
;

134 if(
´št
)

136 
	`´štf
("bût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r
[bb->bbid]);

138 
	`´štf
("loİ[%d]:\Æp->wûˆğ%Lu, %Lu\n", 
Ín
->
Íid
,†²->
wût
[ 
šdex
 * 2 ],†pn->wcet[ index * 2 +1 ]);

140 
	`´štf
("h™_wûˆğ%Lu, %Lu\n", 
Ín
->
h™_wût
[ 
šdex
 * 2 ],†pn->hit_wcet[ index * 2 + 1 ]);

141 
	`´štf
("miss_wûˆğ%Lu, %Lu\n", 
Ín
->
miss_wût
[ 
šdex
 * 2 ],†pn->miss_wcet[ index * 2 + 1 ]);

142 
	`´štf
("unknow_wûˆğ%Lu, %Lu\n", 
Ín
->
unknow_wût
[ 
šdex
 * 2 ],†pn->unknow_wcet[ index * 2 + 1 ]);

144 
	`´štf
("h™_wût_L2 = %Lu, %Lu\n", 
Ín
->
h™_wût_L2
[ 
šdex
 * 2 ],†pn->hit_wcet_L2[ index * 2 + 1 ]);

145 
	`´štf
("miss_wût_L2 = %Lu, %Lu\n", 
Ín
->
miss_wût_L2
[ 
šdex
 * 2 ],†pn->miss_wcet_L2[ index * 2 + 1 ]);

146 
	`´štf
("unknow_wût_L2 = %Lu, %Lu\n", 
Ín
->
unknow_wût_L2
[ 
šdex
 * 2 ],†pn->unknow_wcet_L2[ index * 2 + 1 ]);

154 
bût_¬r
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[
šdex
]->
bco¡
;

156 
h™_¬r
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
h™
;

157 
miss_¬r
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
miss
;

158 
unknow_¬r
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
unknow
;

160 
h™_¬r_L2
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
h™
;

161 
miss_¬r_L2
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
miss
;

162 
unknow_¬r_L2
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
unknow
;

166 if(
´št
)

168 
	`´štf
("bût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r
[bb->bbid]);

174  
bb
->
num_outgošg
 ) {

180 
bût_¬r
[ 
bb
->
bbid
 ] +ğbût_¬r[ bb->
outgošg
[0] ];

182 
h™_¬r
[ 
bb
->
bbid
 ] +ğh™_¬r[ bb->
outgošg
[0] ];

183 
miss_¬r
[ 
bb
->
bbid
 ] +ğmiss_¬r[ bb->
outgošg
[0] ];

184 
unknow_¬r
[ 
bb
->
bbid
 ] +ğunknow_¬r[ bb->
outgošg
[0] ];

186 
h™_¬r_L2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2[ bb->
outgošg
[0] ];

187 
miss_¬r_L2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2[ bb->
outgošg
[0] ];

188 
unknow_¬r_L2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2[ bb->
outgošg
[0] ];

190 if(
´št
)

192 
	`´štf
("bût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r
[bb->bbid]);

194 
	`´štf
("h™_¬r[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r
[ bb->bbid ]);

195 
	`´štf
("miss_¬r[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r
[ bb->bbid ]);

196 
	`´štf
("unknow_¬r[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r
[ bb->bbid ]);

197 
	`´štf
("h™_¬r_L2[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2
[ bb->bbid ]);

198 
	`´štf
("miss_¬r_L2[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r_L2
[ bb->bbid ]);

199 
	`´štf
("unknow_¬r_L2[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2
[ bb->bbid ]);

214 ifĞ
bût_¬r
[ 
bb
->
outgošg
[0] ] >= bcet_arr[ bb->outgoing[1] ] )

215 
mš
 = 1;

217 
mš
 = 0;

219 
bût_¬r
[ 
bb
->
bbid
 ] +ğbût_¬r[ bb->
outgošg
[
mš
] ];

221 
h™_¬r
[ 
bb
->
bbid
 ] +ğh™_¬r[ bb->
outgošg
[
mš
] ];

222 
miss_¬r
[ 
bb
->
bbid
 ] +ğmiss_¬r[ bb->
outgošg
[
mš
] ];

223 
unknow_¬r
[ 
bb
->
bbid
 ] +ğunknow_¬r[ bb->
outgošg
[
mš
] ];

225 
h™_¬r_L2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2[ bb->
outgošg
[
mš
] ];

226 
miss_¬r_L2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2[ bb->
outgošg
[
mš
] ];

227 
unknow_¬r_L2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2[ bb->
outgošg
[
mš
] ];

230 if(
´št
)

232 
	`´štf
("bût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r
[bb->bbid]);

234 
	`´štf
("h™_¬r[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r
[ bb->bbid ]);

235 
	`´štf
("miss_¬r[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r
[ bb->bbid ]);

236 
	`´štf
("unknow_¬r[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r
[ bb->bbid ]);

237 
	`´štf
("h™_¬r_L2[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2
[ bb->bbid ]);

238 
	`´štf
("miss_¬r_L2[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r_L2
[ bb->bbid ]);

239 
	`´štf
("unknow_¬r_L2[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2
[ bb->bbid ]);

247 
	`´štf
Ğ"Inv®id‚umb” oàoutgošgƒdge © %d-%d\n", 
bb
->
pid
, bb->
bbid
 );

248 
	`ex™
(1);

253 ifĞ
bb
->
ÿÎpid
 != -1 ) {

255 
bût_¬r
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
bût
[
šdex
];

257 
h™_¬r
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_bût
[ 
šdex
 ];

258 
miss_¬r
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_bût
[ 
šdex
 ];

259 
unknow_¬r
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_bût
[ 
šdex
 ];

261 
h™_¬r_L2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_bût_L2
[ 
šdex
 ];

262 
miss_¬r_L2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_bût_L2
[ 
šdex
 ];

263 
unknow_¬r_L2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_bût_L2
[ 
šdex
 ];

266 if(
´št
)

267 
	`´štf
Ğ"bb %d-%d…roûdu» c®È%d bût: %Lu\n", 
bb
->
pid
, bb->
bbid
, bb->
ÿÎpid
, bb->
´oc_±r
->
bût
[
šdex
] ); 
	`fæush
Ğ
¡dout
 );

269 if(
´št
)

271 
	`´štf
("bût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r
[bb->bbid]);

273 
	`´štf
("h™_¬r[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r
[ bb->bbid ]);

274 
	`´štf
("miss_¬r[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r
[ bb->bbid ]);

275 
	`´štf
("unknow_¬r[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r
[ bb->bbid ]);

276 
	`´štf
("h™_¬r_L2[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2
[ bb->bbid ]);

277 
	`´štf
("miss_¬r_L2[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r_L2
[ bb->bbid ]);

278 
	`´štf
("unknow_¬r_L2[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2
[ bb->bbid ]);

356 
p
->
bût
[
šdex
] = 
bût_¬r
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

359 
p
->
h™_bût
[
šdex
] = 
h™_¬r
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

360 
p
->
miss_bût
[
šdex
] = 
miss_¬r
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

361 
p
->
unknow_bût
[
šdex
] = 
unknow_¬r
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

363 
p
->
h™_bût_L2
[
šdex
] = 
h™_¬r_L2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

364 
p
->
miss_bût_L2
[
šdex
] = 
miss_¬r_L2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

365 
p
->
unknow_bût_L2
[
šdex
] = 
unknow_¬r_L2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

369 if(
´št
)

371 
	`´štf
("p->bût[%d] = %Lu\n",
šdex
, 
p
->
bût
[index]);

373 
	`´štf
Ğ"p-> h™[ %d ]%Lu\n", 
šdex
, 
p
->
h™_bût
[ index ]);

374 
	`´štf
Ğ"p-> miss[ %d ]%Lu\n", 
šdex
, 
p
->
miss_bût
[ index ]);

375 
	`´štf
Ğ"p-> unknow[ %d ]%Lu\n", 
šdex
, 
p
->
unknow_bût
[ index ]);

377 
	`´štf
Ğ"p-> h™_L2[ %d ]%Lu\n", 
šdex
, 
p
->
h™_bût_L2
[ index ]);

378 
	`´štf
Ğ"p-> miss_L2[ %d ]%Lu\n", 
šdex
, 
p
->
miss_bût_L2
[ index ]);

379 
	`´štf
Ğ"p-> unknow_L2[ %d ]%Lu\n", 
šdex
, 
p
->
unknow_bût_L2
[ index ]);

404 
	`ä“
Ğ
bût_¬r
 );

408 
	}
}

412 
	$ª®y£DAGLoİ_BCET
(
´oûdu»
 *
´oc
, 
loİ
 *
lİ
, 
šdex
 )

414 
uÎ
 *
bût_¬r_1
 = 
NULL
;

415 
uÎ
 *
bût_¬r_2
 = 
NULL
;

417 
uÎ
 *
h™_¬r_1
 = 
NULL
;

418 
uÎ
 *
miss_¬r_1
 = 
NULL
;

419 
uÎ
 *
unknow_¬r_1
 = 
NULL
;

421 
uÎ
 *
h™_¬r_L2_1
 = 
NULL
;

422 
uÎ
 *
miss_¬r_L2_1
 = 
NULL
;

423 
uÎ
 *
unknow_¬r_L2_1
 = 
NULL
;

425 
uÎ
 *
h™_¬r_2
 = 
NULL
;

426 
uÎ
 *
miss_¬r_2
 = 
NULL
;

427 
uÎ
 *
unknow_¬r_2
 = 
NULL
;

429 
uÎ
 *
h™_¬r_L2_2
 = 
NULL
;

430 
uÎ
 *
miss_¬r_L2_2
 = 
NULL
;

431 
uÎ
 *
unknow_¬r_L2_2
 = 
NULL
;

441 
i
, 
id
;

443 
mš1
, 
mš2
;

444 
block
 *
bb
;

447 
´oûdu»
 *
p
;

448 
loİ
 *
Í
, *
Ín
;

453 
block
 **
tİo
;

454 
num_tİo
;

458 
Í
 = 
lİ
;

459 
p
 = 
´oc
;

460 
tİo
 = 
Í
->topo;

461 
num_tİo
 = 
Í
->num_topo;

470 
bût_¬r_1
 = (
uÎ
*è
	`CALLOC
Ğbût_¬r_1, 
p
->
num_bb
, (ull), "bcet_arr_1");

471 
bût_¬r_2
 = (
uÎ
*è
	`CALLOC
Ğbût_¬r_2, 
p
->
num_bb
, (ull), "bcet_arr_2");

473 
h™_¬r_1
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r_1, 
p
->
num_bb
, (ull), "hit_arr_1");

474 
miss_¬r_1
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r_1, 
p
->
num_bb
, (ull), "miss_arr_1");

475 
unknow_¬r_1
 = (
uÎ
*è
	`CALLOC
(unknow_¬r_1, 
p
->
num_bb
, (ull), "unknow_arr_1");

477 
h™_¬r_L2_1
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r_L2_1, 
p
->
num_bb
, (ull), "hit_arr_L2_1");

478 
miss_¬r_L2_1
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r_L2_1, 
p
->
num_bb
, (ull), "miss_arr_L2_1");

479 
unknow_¬r_L2_1
 = (
uÎ
*è
	`CALLOC
(unknow_¬r_L2_1, 
p
->
num_bb
, (ull), "unknow_arr_L2_1");

482 
h™_¬r_2
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r_2, 
p
->
num_bb
, (ull), "hit_arr_2");

483 
miss_¬r_2
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r_2, 
p
->
num_bb
, (ull), "miss_arr_2");

484 
unknow_¬r_2
 = (
uÎ
*è
	`CALLOC
(unknow_¬r_2, 
p
->
num_bb
, (ull), "unknow_arr_2");

486 
h™_¬r_L2_2
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r_L2_2, 
p
->
num_bb
, (ull), "hit_arr_L2_2");

487 
miss_¬r_L2_2
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r_L2_2, 
p
->
num_bb
, (ull), "miss_arr_L2_2");

488 
unknow_¬r_L2_2
 = (
uÎ
*è
	`CALLOC
(unknow_¬r_L2_2, 
p
->
num_bb
, (ull), "unknow_arr_L2_2");

495  
i
 = 0; i < 
num_tİo
; i++ )

497 
bb
 = 
tİo
[
i
];

498 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

503 ifĞ
bb
->
¡¬ddr
 == -1 )

507 ifĞ
bb
->
is_loİh—d
 && (bb->
loİid
 !ğ
Í
->
Íid
))

509 
Ín
 = 
p
->
loİs
[ 
bb
->
loİid
 ];

511 
bût_¬r_1
[ 
bb
->
bbid
 ] = 
Ín
->
bût
[
šdex
];

512 
bût_¬r_2
[ 
bb
->
bbid
 ] = 
Ín
->
bût
[
šdex
 + 1] * (
Í
->
loİbound
 -1);

514 
h™_¬r_1
[ 
bb
->
bbid
 ] = 
Ín
->
h™_bût
[ 
šdex
 ];

515 
miss_¬r_1
[ 
bb
->
bbid
 ] = 
Ín
->
miss_bût
[ 
šdex
 ];

516 
unknow_¬r_1
[ 
bb
->
bbid
 ] = 
Ín
->
unknow_bût
[ 
šdex
 ];

518 
h™_¬r_L2_1
[ 
bb
->
bbid
 ] = 
Ín
->
h™_bût_L2
[ 
šdex
 ];

519 
miss_¬r_L2_1
[ 
bb
->
bbid
 ] = 
Ín
->
miss_bût_L2
[ 
šdex
 ];

520 
unknow_¬r_L2_1
[ 
bb
->
bbid
 ] = 
Ín
->
unknow_bût_L2
[ 
šdex
 ];

524 
h™_¬r_2
[ 
bb
->
bbid
 ] = 
Ín
->
h™_bût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

525 
miss_¬r_2
[ 
bb
->
bbid
 ] = 
Ín
->
miss_bût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

526 
unknow_¬r_2
[ 
bb
->
bbid
 ] = 
Ín
->
unknow_bût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

528 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] = 
Ín
->
h™_bût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

529 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] = 
Ín
->
miss_bût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

530 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] = 
Ín
->
unknow_bût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

537 
bût_¬r_2
[ 
bb
->
bbid
 ] +ğbût_¬r_2[ 
Ín
->
loİex™
->bbid ];

539 
h™_¬r_2
[ 
bb
->
bbid
 ] +ğh™_¬r_2[ 
Ín
->
loİex™
->bbid ];

540 
miss_¬r_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_2[ 
Ín
->
loİex™
->bbid ];

541 
unknow_¬r_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_2[ 
Ín
->
loİex™
->bbid ];

543 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2_2[ 
Ín
->
loİex™
->bbid ];

544 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2_2[ 
Ín
->
loİex™
->bbid ];

545 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2_2[ 
Ín
->
loİex™
->bbid ];

548 if(
´št
)

550 
	`´štf
("bût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r_1
[bb->bbid]);

551 
	`´štf
("bût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r_2
[bb->bbid]);

553 
	`´štf
("h™_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_1
[bb->bbid]);

554 
	`´štf
("miss_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_1
[bb->bbid]);

555 
	`´štf
("unknow_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_1
[bb->bbid]);

557 
	`´štf
("h™_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_1
[bb->bbid]);

558 
	`´štf
("miss_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_1
[bb->bbid]);

559 
	`´štf
("unknow_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_1
[bb->bbid]);

562 
	`´štf
("h™_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_2
[bb->bbid]);

563 
	`´štf
("miss_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_2
[bb->bbid]);

564 
	`´štf
("unknow_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_2
[bb->bbid]);

566 
	`´štf
("h™_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_2
[bb->bbid]);

567 
	`´štf
("miss_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_2
[bb->bbid]);

568 
	`´štf
("unknow_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_2
[bb->bbid]);

580 
bût_¬r_1
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[
šdex
]->
bco¡
;

581 
bût_¬r_2
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[
šdex
 + 1]->
bco¡
 * (
Í
->
loİbound
 -1);

584 
h™_¬r_1
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
h™
;

585 
miss_¬r_1
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
miss
;

586 
unknow_¬r_1
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
unknow
;

589 
h™_¬r_L2_1
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
h™
;

590 
miss_¬r_L2_1
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
miss
;

591 
unknow_¬r_L2_1
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
unknow
;

595 
h™_¬r_2
[ 
bb
->
bbid
 ] = ( bb->
chmc
[
šdex
 + 1]->
h™
 ) * (
Í
->
loİbound
 -1);

596 
miss_¬r_2
[ 
bb
->
bbid
 ] = ( bb->
chmc
[
šdex
 + 1]->
miss
 ) * (
Í
->
loİbound
 -1);

597 
unknow_¬r_2
[ 
bb
->
bbid
 ] = ( bb->
chmc
[
šdex
 + 1]->
unknow
 ) * (
Í
->
loİbound
 -1);

600 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] = ( bb->
chmc_L2
[
šdex
 + 1]->
h™
 ) * (
Í
->
loİbound
 -1);

601 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] = ( bb->
chmc_L2
[
šdex
 + 1]->
miss
 ) * (
Í
->
loİbound
 -1);

602 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] = ( bb->
chmc_L2
[
šdex
 + 1]->
unknow
 ) * (
Í
->
loİbound
 -1);

607 if(
´št
)

609 
	`´štf
("bût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r_1
[bb->bbid]);

610 
	`´štf
("bût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r_2
[bb->bbid]);

612 
	`´štf
("h™_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_1
[bb->bbid]);

613 
	`´štf
("miss_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_1
[bb->bbid]);

614 
	`´štf
("unknow_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_1
[bb->bbid]);

616 
	`´štf
("h™_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_1
[bb->bbid]);

617 
	`´štf
("miss_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_1
[bb->bbid]);

618 
	`´štf
("unknow_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_1
[bb->bbid]);

621 
	`´štf
("h™_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_2
[bb->bbid]);

622 
	`´štf
("miss_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_2
[bb->bbid]);

623 
	`´štf
("unknow_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_2
[bb->bbid]);

625 
	`´štf
("h™_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_2
[bb->bbid]);

626 
	`´štf
("miss_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_2
[bb->bbid]);

627 
	`´štf
("unknow_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_2
[bb->bbid]);

631  
bb
->
num_outgošg
 ) {

637 
bût_¬r_1
[ 
bb
->
bbid
 ] +ğbût_¬r_1[ bb->
outgošg
[0] ];

638 
bût_¬r_2
[ 
bb
->
bbid
 ] +ğbût_¬r_2[ bb->
outgošg
[0] ];

640 
h™_¬r_1
[ 
bb
->
bbid
 ] +ğh™_¬r_1[ bb->
outgošg
[0] ];

641 
miss_¬r_1
[ 
bb
->
bbid
 ] +ğmiss_¬r_1[ bb->
outgošg
[0] ];

642 
unknow_¬r_1
[ 
bb
->
bbid
 ] +ğunknow_¬r_1[ bb->
outgošg
[0] ];

644 
h™_¬r_L2_1
[ 
bb
->
bbid
 ] +ğh™_¬r_L2_1[ bb->
outgošg
[0] ];

645 
miss_¬r_L2_1
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2_1[ bb->
outgošg
[0] ];

646 
unknow_¬r_L2_1
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2_1[ bb->
outgošg
[0] ];

649 
h™_¬r_2
[ 
bb
->
bbid
 ] +ğh™_¬r_2[ bb->
outgošg
[0] ];

650 
miss_¬r_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_2[ bb->
outgošg
[0] ];

651 
unknow_¬r_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_2[ bb->
outgošg
[0] ];

653 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2_2[ bb->
outgošg
[0] ];

654 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2_2[ bb->
outgošg
[0] ];

655 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2_2[ bb->
outgošg
[0] ];

657 if(
´št
)

659 
	`´štf
("bût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r_1
[bb->bbid]);

660 
	`´štf
("bût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r_2
[bb->bbid]);

662 
	`´štf
("h™_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_1
[bb->bbid]);

663 
	`´štf
("miss_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_1
[bb->bbid]);

664 
	`´štf
("unknow_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_1
[bb->bbid]);

666 
	`´štf
("h™_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_1
[bb->bbid]);

667 
	`´štf
("miss_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_1
[bb->bbid]);

668 
	`´štf
("unknow_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_1
[bb->bbid]);

671 
	`´štf
("h™_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_2
[bb->bbid]);

672 
	`´štf
("miss_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_2
[bb->bbid]);

673 
	`´štf
("unknow_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_2
[bb->bbid]);

675 
	`´štf
("h™_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_2
[bb->bbid]);

676 
	`´štf
("miss_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_2
[bb->bbid]);

677 
	`´štf
("unknow_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_2
[bb->bbid]);

686 if(
bb
->
loİid
 > 
p
->
bbli¡
[bb->
outgošg
[0]]->loopid)

688 
mš1
 = 1;

689 
mš2
 = 1;

691 if(
bb
->
loİid
 > 
p
->
bbli¡
[bb->
outgošg
[1]]->loopid)

693 
mš1
 = 0;

694 
mš2
 = 0;

699 ifĞ
bût_¬r_1
[ 
bb
->
outgošg
[0] ] >= bcet_arr_1[ bb->outgoing[1] ] )

700 
mš1
 = 1;

702 
mš1
 = 0;

704 ifĞ
bût_¬r_2
[ 
bb
->
outgošg
[0] ] >= bcet_arr_2[ bb->outgoing[1] ] )

705 
mš2
 = 1;

707 
mš2
 = 0;

710 
bût_¬r_1
[ 
bb
->
bbid
 ] +ğbût_¬r_1[ bb->
outgošg
[
mš1
] ];

711 
bût_¬r_2
[ 
bb
->
bbid
 ] +ğbût_¬r_2[ bb->
outgošg
[
mš2
] ];

714 
h™_¬r_1
[ 
bb
->
bbid
 ] +ğh™_¬r_1[ bb->
outgošg
[
mš1
] ];

715 
miss_¬r_1
[ 
bb
->
bbid
 ] +ğmiss_¬r_1[ bb->
outgošg
[
mš1
] ];

716 
unknow_¬r_1
[ 
bb
->
bbid
 ] +ğunknow_¬r_1[ bb->
outgošg
[
mš1
] ];

718 
h™_¬r_L2_1
[ 
bb
->
bbid
 ] +ğh™_¬r_L2_1[ bb->
outgošg
[
mš1
] ];

719 
miss_¬r_L2_1
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2_1[ bb->
outgošg
[
mš1
] ];

720 
unknow_¬r_L2_1
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2_1[ bb->
outgošg
[
mš1
] ];

723 
h™_¬r_2
[ 
bb
->
bbid
 ] +ğh™_¬r_2[ bb->
outgošg
[
mš2
] ];

724 
miss_¬r_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_2[ bb->
outgošg
[
mš2
] ];

725 
unknow_¬r_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_2[ bb->
outgošg
[
mš2
] ];

727 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2_2[ bb->
outgošg
[
mš2
] ];

728 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2_2[ bb->
outgošg
[
mš2
] ];

729 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2_2[ bb->
outgošg
[
mš2
] ];

732 if(
´št
)

734 
	`´štf
("bût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r_1
[bb->bbid]);

735 
	`´štf
("bût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r_2
[bb->bbid]);

737 
	`´štf
("h™_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_1
[bb->bbid]);

738 
	`´štf
("miss_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_1
[bb->bbid]);

739 
	`´štf
("unknow_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_1
[bb->bbid]);

741 
	`´štf
("h™_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_1
[bb->bbid]);

742 
	`´štf
("miss_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_1
[bb->bbid]);

743 
	`´štf
("unknow_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_1
[bb->bbid]);

746 
	`´štf
("h™_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_2
[bb->bbid]);

747 
	`´štf
("miss_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_2
[bb->bbid]);

748 
	`´štf
("unknow_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_2
[bb->bbid]);

750 
	`´štf
("h™_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_2
[bb->bbid]);

751 
	`´štf
("miss_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_2
[bb->bbid]);

752 
	`´štf
("unknow_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_2
[bb->bbid]);

759 
	`´štf
Ğ"Inv®id‚umb” oàoutgošgƒdge © %d-%d\n", 
bb
->
pid
, bb->
bbid
 );

760 
	`ex™
(1);

765 ifĞ
bb
->
ÿÎpid
 != -1 ) {

767 
bût_¬r_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
bût
[
šdex
 ];

768 
bût_¬r_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
bût
[
šdex
 + 1] * (
Í
->
loİbound
 -1);

771 
h™_¬r_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_bût
[ 
šdex
 ];

772 
miss_¬r_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_bût
[ 
šdex
 ];

773 
unknow_¬r_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_bût
[ 
šdex
 ];

775 
h™_¬r_L2_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_bût_L2
[ 
šdex
 ];

776 
miss_¬r_L2_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_bût_L2
[ 
šdex
 ];

777 
unknow_¬r_L2_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_bût_L2
[ 
šdex
 ];

780 
h™_¬r_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_bût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

781 
miss_¬r_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_bût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

782 
unknow_¬r_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_bût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

784 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_bût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

785 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_bût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

786 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_bût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

788 if(
´št
)

789 
	`´štf
Ğ"bb %d-%d…roûdu» c®È%d bût: 1 %Lu 2 %Lu\n", 
bb
->
pid
, bb->
bbid
, bb->
ÿÎpid
, bb->
´oc_±r
->
bût
[
šdex
 * 2], bb->´oc_±r->bût[šdex * 2 + 1]); 
	`fæush
Ğ
¡dout
 );

790 if(
´št
)

792 
	`´štf
("bût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r_1
[bb->bbid]);

793 
	`´štf
("bût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
bût_¬r_2
[bb->bbid]);

795 
	`´štf
("h™_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_1
[bb->bbid]);

796 
	`´štf
("miss_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_1
[bb->bbid]);

797 
	`´štf
("unknow_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_1
[bb->bbid]);

799 
	`´štf
("h™_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_1
[bb->bbid]);

800 
	`´štf
("miss_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_1
[bb->bbid]);

801 
	`´štf
("unknow_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_1
[bb->bbid]);

804 
	`´štf
("h™_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_2
[bb->bbid]);

805 
	`´štf
("miss_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_2
[bb->bbid]);

806 
	`´štf
("unknow_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_2
[bb->bbid]);

808 
	`´štf
("h™_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_2
[bb->bbid]);

809 
	`´štf
("miss_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_2
[bb->bbid]);

810 
	`´štf
("unknow_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_2
[bb->bbid]);

887 
Í
->
bût
[
šdex
] = 
bût_¬r_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

888 
Í
->
bût
[
šdex
 + 1] = 
bût_¬r_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

891 
Í
->
h™_bût
[ 
šdex
 ] = 
h™_¬r_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

892 
Í
->
miss_bût
[ 
šdex
 ] = 
miss_¬r_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

893 
Í
->
unknow_bût
[ 
šdex
 ] = 
unknow_¬r_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

896 
Í
->
h™_bût_L2
[ 
šdex
 ] = 
h™_¬r_L2_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

897 
Í
->
miss_bût_L2
[ 
šdex
 ] = 
miss_¬r_L2_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

898 
Í
->
unknow_bût_L2
[ 
šdex
 ] = 
unknow_¬r_L2_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

902 
Í
->
h™_bût
[ 
šdex
 + 1 ] = 
h™_¬r_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

903 
Í
->
miss_bût
[ 
šdex
 + 1 ] = 
miss_¬r_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

904 
Í
->
unknow_bût
[ 
šdex
 + 1 ] = 
unknow_¬r_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

907 
Í
->
h™_bût_L2
[ 
šdex
 + 1 ] = 
h™_¬r_L2_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

908 
Í
->
miss_bût_L2
[ 
šdex
 + 1 ] = 
miss_¬r_L2_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

909 
Í
->
unknow_bût_L2
[ 
šdex
 + 1 ] = 
unknow_¬r_L2_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

915 ifĞ!
Í
->
is_dowhe
 )

918 
Í
->
bût
[
šdex
 +1] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc_L2
[šdex + 1]->
bco¡
;

921 
Í
->
h™_bût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc
[šdex + 1]->
h™
;

922 
Í
->
miss_bût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc
[šdex + 1]->
miss
;

923 
Í
->
unknow_bût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc
[šdex + 1]->
unknow
;

926 
Í
->
h™_bût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc_L2
[šdex + 1]->
h™
;

927 
Í
->
miss_bût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc_L2
[šdex + 1]->
miss
;

928 
Í
->
unknow_bût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc_L2
[šdex + 1]->
unknow
;

932 ifĞ
Í
->
loİh—d
->
ÿÎpid
 != -1 )

934 
Í
->
bût
[
šdex
 + 1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->bcet[index + 1];

937 
Í
->
h™_bût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->hit_bcet[index + 1];

938 
Í
->
miss_bût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->miss_bcet[index + 1];

939 
Í
->
unknow_bût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->unknow_bcet[index + 1];

941 
Í
->
h™_bût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->hit_bcet_L2[index + 1];

942 
Í
->
miss_bût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->miss_bcet_L2[index + 1];

943 
Í
->
unknow_bût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->unknow_bcet_L2[index + 1];

948 if(
´št
)

950 
	`´štf
("Í->bût[%d] = %Lu\n", 
šdex
, 
Í
->
bût
[index]);

951 
	`´štf
("Í->bût[%d] = %Lu\n", 
šdex
 + 1, 
Í
->
bût
[index + 1]);

953 
	`´štf
("Í->h™_bûˆğ%Lu, %Lu\n", 
Í
->
h™_bût
[ 
šdex
 ],†p->hit_bcet[ index + 1 ]);

954 
	`´štf
("Í->miss_bûˆğ%Lu, %Lu\n", 
Í
->
miss_bût
[ 
šdex
 ],†p->miss_bcet[ index + 1 ]);

955 
	`´štf
("Í->unknow_bûˆğ%Lu, %Lu\n", 
Í
->
unknow_bût
[ 
šdex
 ],†p->unknow_bcet[ index + 1 ]);

957 
	`´štf
("Í->h™_bût_L2 = %Lu, %Lu\n", 
Í
->
h™_bût_L2
[ 
šdex
 ],†p->hit_bcet_L2[ index + 1 ]);

958 
	`´štf
("Í->miss_bût_L2 = %Lu, %Lu\n", 
Í
->
miss_bût_L2
[ 
šdex
 ],†p->miss_bcet_L2[ index + 1 ]);

959 
	`´štf
("Í->unknow_bût_L2 = %Lu, %Lu\n", 
Í
->
unknow_bût_L2
[ 
šdex
 ],†p->unknow_bcet_L2[ index + 1 ]);

980 
	`ä“
Ğ
bût_¬r_1
 );

981 
	`ä“
Ğ
bût_¬r_2
 );

984 
	}
}

993 
	$ª®y£Proc_BCET
Ğ
´oûdu»
 *
p
 ) {

995 
i
, 
j
;

996 
loİ
 *
Í
;

999  
i
 = 
p
->
num_loİs
 - 1; i >= 0; i-- ) {

1000 
Í
 = 
p
->
loİs
[
i
];

1004 
j
 = 0; j < (1<<
Í
->
Ëv–
); j++)

1005 
	`ª®y£DAGLoİ_BCET
(
p
, 
Í
, 
j
*2);

1013 
j
 = 0; j < 
p
->
num_co¡
; j++)

1014 
	`ª®y£DAGFunùiÚ_BCET
Ğ
p
, 
j
);

1016 
	}
}

1027 
	$ª®ysis_dag_BCET
(
MSC
 *
msc
) {

1029 
i
, 
j
, 
k
;

1030 
t
;

1034 
k
 = 0; k < 
msc
->
num_sk
; k++)

1037  
i
 = 0; i < 
msc
->
skLi¡
[
k
].
num_´oc
; i++ )

1039 
j
 = 0; j < 
msc
->
skLi¡
[
k
].
´oc_cg_±r
[
i
].
num_´oc
; j++)

1041 
	`ª®y£Proc_BCET
(
msc
->
skLi¡
[
k
].
´oc_cg_±r
[
i
].
´oc
[
j
]);

1045 
msc
->
skLi¡
[
k
].
bût
 = msc->skLi¡[k].
maš_cİy
->bcet[0];

1048 
msc
->
skLi¡
[
k
].
h™_bût
 = msc->skLi¡[k].
maš_cİy
->hit_bcet[0];

1049 
msc
->
skLi¡
[
k
].
miss_bût
 = msc->skLi¡[k].
maš_cİy
->miss_bcet[0];

1050 
msc
->
skLi¡
[
k
].
unknow_bût
 = msc->skLi¡[k].
maš_cİy
->unknow_bcet[0];

1052 
msc
->
skLi¡
[
k
].
h™_bût_L2
 = msc->skLi¡[k].
maš_cİy
->hit_bcet_L2[0];

1053 
msc
->
skLi¡
[
k
].
miss_bût_L2
 = msc->skLi¡[k].
maš_cİy
->miss_bcet_L2[0];

1054 
msc
->
skLi¡
[
k
].
unknow_bût_L2
 = msc->skLi¡[k].
maš_cİy
->unknow_bcet_L2[0];

1057 if(
´št
)

1059 
	`´štf
("msc->skLi¡[%d].bûˆğ%Lu\n", 
k
, 
msc
->
skLi¡
[k].
bût
);

1068 
	}
}

	@analysisDAG_WCET.c

5 
	~<¡dio.h
>

6 
	~<as£¹.h
>

8 
compu‹WCET_block
(
block
* 
bb
, 
´oûdu»
* 
´oc
, 
loİ
* 
cur_Í
);

9 
compu‹BCET_block
(
block
* 
bb
, 
´oûdu»
* 
´oc
, 
loİ
* 
cur_Í
);

10 
compu‹WCET_´oc
(
´oûdu»
* 
´oc
, 
uÎ
 
¡¬t_time
);

11 
compu‹BCET_´oc
(
´oûdu»
* 
´oc
, 
uÎ
 
¡¬t_time
);

12 
sched_p
 
g‘ScheduË
();

13 
£tScheduË
(* 
schedFe
);

14 
£gm’t_p
 
fšd_£gm’t
(£gm’t_p* 
h—d_£g
, 
n£gs
, 
uÎ
 
¡¬t_time
);

15 
´”r
(* 
msg
);

42 
	$ª®y£DAGFunùiÚ_WCET
(
´oûdu»
 *
´oc
, 
šdex
)

45 
uÎ
 *
wût_¬r
 = 
NULL
;

47 
uÎ
 *
h™_¬r
 = 
NULL
;

48 
uÎ
 *
miss_¬r
 = 
NULL
;

49 
uÎ
 *
unknow_¬r
 = 
NULL
;

51 
uÎ
 *
h™_¬r_L2
 = 
NULL
;

52 
uÎ
 *
miss_¬r_L2
 = 
NULL
;

53 
uÎ
 *
unknow_¬r_L2
 = 
NULL
;

61 
i
, 
id
;

62 
â
[100];

63 
max
;

64 
block
 *
bb
;

65 
äeq
;

67 
´oûdu»
 *
p
;

68 
loİ
 *
Í
, *
Ín
;

70 *
w·th
;

73 
block
 **
tİo
;

74 
num_tİo
;

78 
p
 = 
´oc
;

79 
tİo
 = 
p
->topo;

80 
num_tİo
 = 
p
->num_topo;

87 
wût_¬r
 = (
uÎ
*è
	`CALLOC
Ğwût_¬r, 
p
->
num_bb
, (ull), "wcet_arr" );

89 
h™_¬r
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r, 
p
->
num_bb
, (ull), "hit_arr" );

90 
miss_¬r
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r, 
p
->
num_bb
, (ull), "miss_arr" );

91 
unknow_¬r
 = (
uÎ
*è
	`CALLOC
Ğunknow_¬r, 
p
->
num_bb
, (ull), "unknow_arr" );

93 
h™_¬r_L2
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r_L2, 
p
->
num_bb
, (ull), "hit_arr_L2" );

94 
miss_¬r_L2
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r_L2, 
p
->
num_bb
, (ull), "miss_arr_L2" );

95 
unknow_¬r_L2
 = (
uÎ
*è
	`CALLOC
Ğunknow_¬r_L2, 
p
->
num_bb
, (ull), "unknow_arr_L2" );

101  
i
 = 0; i < 
num_tİo
; i++ ) {

102 
bb
 = 
tİo
[
i
];

103 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

108 ifĞ
bb
->
¡¬ddr
 == -1 )

112 ifĞ
bb
->
is_loİh—d
)

114 
Ín
 = 
p
->
loİs
[ 
bb
->
loİid
 ];

116 
wût_¬r
[ 
bb
->
bbid
 ] = 
Ín
->
wût
[
šdex
 * 2] +†pn->wcet[index * 2 + 1];

118 
h™_¬r
[ 
bb
->
bbid
 ] = 
Ín
->
h™_wût
[
šdex
 * 2] +†pn->hit_wcet[index * 2 + 1];

119 
miss_¬r
[ 
bb
->
bbid
 ] = 
Ín
->
miss_wût
[
šdex
 * 2] +†pn->miss_wcet[index * 2 + 1];

120 
unknow_¬r
[ 
bb
->
bbid
 ] = 
Ín
->
unknow_wût
[
šdex
 * 2] +†pn->unknow_wcet[index * 2 + 1];

122 
h™_¬r_L2
[ 
bb
->
bbid
 ] = 
Ín
->
h™_wût_L2
[
šdex
 * 2] +†pn->hit_wcet_L2[index * 2 + 1];

123 
miss_¬r_L2
[ 
bb
->
bbid
 ] = 
Ín
->
miss_wût_L2
[
šdex
 * 2] +†pn->miss_wcet_L2[index * 2 + 1];

124 
unknow_¬r_L2
[ 
bb
->
bbid
 ] = 
Ín
->
unknow_wût_L2
[
šdex
 * 2] +†pn->unknow_wcet_L2[index * 2 + 1];

127 
wût_¬r
[ 
bb
->
bbid
 ] +ğwût_¬r[ 
Ín
->
loİex™
->bbid ];

129 
h™_¬r
[ 
bb
->
bbid
 ] +ğh™_¬r[ 
Ín
->
loİex™
->bbid ];

130 
miss_¬r
[ 
bb
->
bbid
 ] +ğmiss_¬r[ 
Ín
->
loİex™
->bbid ];

131 
unknow_¬r
[ 
bb
->
bbid
 ] +ğunknow_¬r[ 
Ín
->
loİex™
->bbid ];

133 
h™_¬r_L2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2[ 
Ín
->
loİex™
->bbid ];

134 
miss_¬r_L2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2[ 
Ín
->
loİex™
->bbid ];

135 
unknow_¬r_L2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2[ 
Ín
->
loİex™
->bbid ];

138 if(
´št
)

140 
	`´štf
("wût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r
[bb->bbid]);

142 
	`´štf
("loİ[%d]:\Æp->wûˆğ%Lu, %Lu\n", 
Ín
->
Íid
,†²->
wût
[ 
šdex
 * 2 ],†pn->wcet[ index * 2 +1 ]);

144 
	`´štf
("h™_wûˆğ%Lu, %Lu\n", 
Ín
->
h™_wût
[ 
šdex
 * 2 ],†pn->hit_wcet[ index * 2 + 1 ]);

145 
	`´štf
("miss_wûˆğ%Lu, %Lu\n", 
Ín
->
miss_wût
[ 
šdex
 * 2 ],†pn->miss_wcet[ index * 2 + 1 ]);

146 
	`´štf
("unknow_wûˆğ%Lu, %Lu\n", 
Ín
->
unknow_wût
[ 
šdex
 * 2 ],†pn->unknow_wcet[ index * 2 + 1 ]);

148 
	`´štf
("h™_wût_L2 = %Lu, %Lu\n", 
Ín
->
h™_wût_L2
[ 
šdex
 * 2 ],†pn->hit_wcet_L2[ index * 2 + 1 ]);

149 
	`´štf
("miss_wût_L2 = %Lu, %Lu\n", 
Ín
->
miss_wût_L2
[ 
šdex
 * 2 ],†pn->miss_wcet_L2[ index * 2 + 1 ]);

150 
	`´štf
("unknow_wût_L2 = %Lu, %Lu\n", 
Ín
->
unknow_wût_L2
[ 
šdex
 * 2 ],†pn->unknow_wcet_L2[ index * 2 + 1 ]);

158 
wût_¬r
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
wco¡
;

160 
h™_¬r
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
h™
;

161 
miss_¬r
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
miss
;

162 
unknow_¬r
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
unknow
;

164 
h™_¬r_L2
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
h™
;

165 
miss_¬r_L2
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
miss
;

166 
unknow_¬r_L2
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
unknow
;

169 if(
´št
)

171 
	`´štf
("wût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r
[bb->bbid]);

173 
	`´štf
("bb->chmc[%d]->h™ = %d\n", 
šdex
, 
bb
->
chmc
[ index ]->
h™
);

174 
	`´štf
("bb->chmc[%d]->mis ğ%d\n", 
šdex
, 
bb
->
chmc
[ index ]->
miss
);

175 
	`´štf
("bb->chmc[%d]->unknow = %d\n", 
šdex
, 
bb
->
chmc
[ index ]->
unknow
);

176 
	`´štf
("bb->chmc_L2[%d]->h™ = %d\n", 
šdex
, 
bb
->
chmc_L2
[ index ]->
h™
);

177 
	`´štf
("bb->chmc_L2[%d]->mis ğ%d\n", 
šdex
, 
bb
->
chmc_L2
[ index ]->
miss
);

178 
	`´štf
("bb->chmc_L2[%d]->unknow = %d\n", 
šdex
, 
bb
->
chmc_L2
[ index ]->
unknow
);

183  
bb
->
num_outgošg
 ) {

189 
wût_¬r
[ 
bb
->
bbid
 ] +ğwût_¬r[ bb->
outgošg
[0] ];

191 
h™_¬r
[ 
bb
->
bbid
 ] +ğh™_¬r[ bb->
outgošg
[0] ];

192 
miss_¬r
[ 
bb
->
bbid
 ] +ğmiss_¬r[ bb->
outgošg
[0] ];

193 
unknow_¬r
[ 
bb
->
bbid
 ] +ğunknow_¬r[ bb->
outgošg
[0] ];

195 
h™_¬r_L2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2[ bb->
outgošg
[0] ];

196 
miss_¬r_L2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2[ bb->
outgošg
[0] ];

197 
unknow_¬r_L2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2[ bb->
outgošg
[0] ];

200 if(
´št
)

202 
	`´štf
("wût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r
[bb->bbid]);

204 
	`´štf
("h™_¬r[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r
[ bb->bbid ]);

205 
	`´štf
("miss_¬r[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r
[ bb->bbid ]);

206 
	`´štf
("unknow_¬r[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r
[ bb->bbid ]);

207 
	`´štf
("h™_¬r_L2[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2
[ bb->bbid ]);

208 
	`´štf
("miss_¬r_L2[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r_L2
[ bb->bbid ]);

209 
	`´štf
("unknow_¬r_L2[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2
[ bb->bbid ]);

225 ifĞ
wût_¬r
[ 
bb
->
outgošg
[0] ] >= wcet_arr[ bb->outgoing[1] ] )

226 
max
 = 0;

228 
max
 = 1;

230 
wût_¬r
[ 
bb
->
bbid
 ] +ğwût_¬r[ bb->
outgošg
[
max
] ];

232 
h™_¬r
[ 
bb
->
bbid
 ] +ğh™_¬r[ bb->
outgošg
[
max
] ];

233 
miss_¬r
[ 
bb
->
bbid
 ] +ğmiss_¬r[ bb->
outgošg
[
max
] ];

234 
unknow_¬r
[ 
bb
->
bbid
 ] +ğunknow_¬r[ bb->
outgošg
[
max
] ];

236 
h™_¬r_L2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2[ bb->
outgošg
[
max
] ];

237 
miss_¬r_L2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2[ bb->
outgošg
[
max
] ];

238 
unknow_¬r_L2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2[ bb->
outgošg
[
max
] ];

241 if(
´št
)

243 
	`´štf
("wût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r
[bb->bbid]);

245 
	`´štf
("h™_¬r[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r
[ bb->bbid ]);

246 
	`´štf
("miss_¬r[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r
[ bb->bbid ]);

247 
	`´štf
("unknow_¬r[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r
[ bb->bbid ]);

248 
	`´štf
("h™_¬r_L2[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2
[ bb->bbid ]);

249 
	`´štf
("miss_¬r_L2[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r_L2
[ bb->bbid ]);

250 
	`´štf
("unknow_¬r_L2[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2
[ bb->bbid ]);

259 
	`´štf
Ğ"Inv®id‚umb” oàoutgošgƒdge © %d-%d\n", 
bb
->
pid
, bb->
bbid
 );

260 
	`ex™
(1);

265 ifĞ
bb
->
ÿÎpid
 != -1 ) {

267 
wût_¬r
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
wût
[ 
šdex
 ];

269 
h™_¬r
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_wût
[ 
šdex
 ];

270 
miss_¬r
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_wût
[ 
šdex
 ];

271 
unknow_¬r
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_wût
[ 
šdex
 ];

273 
h™_¬r_L2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_wût_L2
[ 
šdex
 ];

274 
miss_¬r_L2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_wût_L2
[ 
šdex
 ];

275 
unknow_¬r_L2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_wût_L2
[ 
šdex
 ];

277 if(
´št
)

278 
	`´štf
Ğ"bb %d-%d…roûdu» c®È%d wût: %Lu\n", 
bb
->
pid
, bb->
bbid
, bb->
ÿÎpid
, bb->
´oc_±r
->
wût
[
šdex
] ); 
	`fæush
Ğ
¡dout
 );

280 if(
´št
)

282 
	`´štf
("wût_¬r[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r
[bb->bbid]);

284 
	`´štf
Ğ"p-> h™_L2[ %d ]%Lu\n", 
šdex
, 
bb
->
´oc_±r
->
h™_wût_L2
[ index ]);

285 
	`´štf
Ğ"p-> miss_L2[ %d ]%Lu\n", 
šdex
, 
bb
->
´oc_±r
->
miss_wût_L2
[ index ]);

286 
	`´štf
Ğ"p-> unknow_L2[ %d ]%Lu\n", 
šdex
, 
bb
->
´oc_±r
->
unknow_wût_L2
[ index ]);

288 
	`´štf
("h™_¬r[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r
[ bb->bbid ]);

289 
	`´štf
("miss_¬r[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r
[ bb->bbid ]);

290 
	`´štf
("unknow_¬r[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r
[ bb->bbid ]);

291 
	`´štf
("h™_¬r_L2[%d]->h™ = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2
[ bb->bbid ]);

292 
	`´štf
("miss_¬r_L2[%d]->mis ğ%Lu\n", 
bb
->
bbid
, 
miss_¬r_L2
[ bb->bbid ]);

293 
	`´štf
("unknow_¬r_L2[%d]->unknow = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2
[ bb->bbid ]);

371 
p
->
wût
[
šdex
] = 
wût_¬r
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

373 
p
->
h™_wût
[
šdex
] = 
h™_¬r
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

374 
p
->
miss_wût
[
šdex
] = 
miss_¬r
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

375 
p
->
unknow_wût
[
šdex
] = 
unknow_¬r
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

377 
p
->
h™_wût_L2
[
šdex
] = 
h™_¬r_L2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

378 
p
->
miss_wût_L2
[
šdex
] = 
miss_¬r_L2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

379 
p
->
unknow_wût_L2
[
šdex
] = 
unknow_¬r_L2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

382 if(
´št
)

384 
	`´štf
("p->wût[%d] = %Lu\n", 
šdex
, 
p
->
wût
[index]);

386 
	`´štf
Ğ"p-> h™[ %d ]%Lu\n", 
šdex
, 
p
->
h™_wût
[ index ]);

387 
	`´štf
Ğ"p-> miss[ %d ]%Lu\n", 
šdex
, 
p
->
miss_wût
[ index ]);

388 
	`´štf
Ğ"p-> unknow[ %d ]%Lu\n", 
šdex
, 
p
->
unknow_wût
[ index ]);

390 
	`´štf
Ğ"p-> h™_L2[ %d ]%Lu\n", 
šdex
, 
p
->
h™_wût_L2
[ index ]);

391 
	`´štf
Ğ"p-> miss_L2[ %d ]%Lu\n", 
šdex
, 
p
->
miss_wût_L2
[ index ]);

392 
	`´štf
Ğ"p-> unknow_L2[ %d ]%Lu\n", 
šdex
, 
p
->
unknow_wût_L2
[ index ]);

416 
	`ä“
Ğ
wût_¬r
 );

420 
	}
}

424 
	$ª®y£DAGLoİ_WCET
(
´oûdu»
 *
´oc
, 
loİ
 *
lİ
, 
šdex
 )

426 
uÎ
 *
wût_¬r_1
 = 
NULL
;

427 
uÎ
 *
wût_¬r_2
 = 
NULL
;

430 
uÎ
 *
h™_¬r_1
 = 
NULL
;

431 
uÎ
 *
miss_¬r_1
 = 
NULL
;

432 
uÎ
 *
unknow_¬r_1
 = 
NULL
;

434 
uÎ
 *
h™_¬r_L2_1
 = 
NULL
;

435 
uÎ
 *
miss_¬r_L2_1
 = 
NULL
;

436 
uÎ
 *
unknow_¬r_L2_1
 = 
NULL
;

438 
uÎ
 *
h™_¬r_2
 = 
NULL
;

439 
uÎ
 *
miss_¬r_2
 = 
NULL
;

440 
uÎ
 *
unknow_¬r_2
 = 
NULL
;

442 
uÎ
 *
h™_¬r_L2_2
 = 
NULL
;

443 
uÎ
 *
miss_¬r_L2_2
 = 
NULL
;

444 
uÎ
 *
unknow_¬r_L2_2
 = 
NULL
;

452 
i
, 
id
;

454 
max1
, 
max2
;

455 
block
 *
bb
;

458 
´oûdu»
 *
p
;

459 
loİ
 *
Í
, *
Ín
;

464 
block
 **
tİo
;

465 
num_tİo
;

469 
Í
 = 
lİ
;

470 
p
 = 
´oc
;

471 
tİo
 = 
Í
->topo;

472 
num_tİo
 = 
Í
->num_topo;

479 
wût_¬r_1
 = (
uÎ
*è
	`CALLOC
Ğwût_¬r_1, 
p
->
num_bb
, (ull), "wcet_arr_1");

480 
wût_¬r_2
 = (
uÎ
*è
	`CALLOC
Ğwût_¬r_2, 
p
->
num_bb
, (ull), "wcet_arr_2");

482 
h™_¬r_1
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r_1, 
p
->
num_bb
, (ull), "hit_arr_1");

483 
miss_¬r_1
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r_1, 
p
->
num_bb
, (ull), "miss_arr_1");

484 
unknow_¬r_1
 = (
uÎ
*è
	`CALLOC
(unknow_¬r_1, 
p
->
num_bb
, (ull), "unknow_arr_1");

486 
h™_¬r_L2_1
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r_L2_1, 
p
->
num_bb
, (ull), "hit_arr_L2_1");

487 
miss_¬r_L2_1
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r_L2_1, 
p
->
num_bb
, (ull), "miss_arr_L2_1");

488 
unknow_¬r_L2_1
 = (
uÎ
*è
	`CALLOC
(unknow_¬r_L2_1, 
p
->
num_bb
, (ull), "unknow_arr_L2_1");

491 
h™_¬r_2
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r_2, 
p
->
num_bb
, (ull), "hit_arr_2");

492 
miss_¬r_2
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r_2, 
p
->
num_bb
, (ull), "miss_arr_2");

493 
unknow_¬r_2
 = (
uÎ
*è
	`CALLOC
(unknow_¬r_2, 
p
->
num_bb
, (ull), "unknow_arr_2");

495 
h™_¬r_L2_2
 = (
uÎ
*è
	`CALLOC
Ğh™_¬r_L2_2, 
p
->
num_bb
, (ull), "hit_arr_L2_2");

496 
miss_¬r_L2_2
 = (
uÎ
*è
	`CALLOC
Ğmiss_¬r_L2_2, 
p
->
num_bb
, (ull), "miss_arr_L2_2");

497 
unknow_¬r_L2_2
 = (
uÎ
*è
	`CALLOC
(unknow_¬r_L2_2, 
p
->
num_bb
, (ull), "unknow_arr_L2_2");

502  
i
 = 0; i < 
num_tİo
; i++ )

504 
bb
 = 
tİo
[
i
];

505 
bb
 = 
p
->
bbli¡
[bb->
bbid
];

510 ifĞ
bb
->
¡¬ddr
 == -1 )

514 ifĞ
bb
->
is_loİh—d
 && (bb->
loİid
 !ğ
Í
->
Íid
))

516 
Ín
 = 
p
->
loİs
[ 
bb
->
loİid
 ];

518 
wût_¬r_1
[ 
bb
->
bbid
 ] = 
Ín
->
wût
[ 
šdex
 ];

519 
wût_¬r_2
[ 
bb
->
bbid
 ] = 
Ín
->
wût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

521 
h™_¬r_1
[ 
bb
->
bbid
 ] = 
Ín
->
h™_wût
[ 
šdex
 ];

522 
miss_¬r_1
[ 
bb
->
bbid
 ] = 
Ín
->
miss_wût
[ 
šdex
 ];

523 
unknow_¬r_1
[ 
bb
->
bbid
 ] = 
Ín
->
unknow_wût
[ 
šdex
 ];

525 
h™_¬r_L2_1
[ 
bb
->
bbid
 ] = 
Ín
->
h™_wût_L2
[ 
šdex
 ];

526 
miss_¬r_L2_1
[ 
bb
->
bbid
 ] = 
Ín
->
miss_wût_L2
[ 
šdex
 ];

527 
unknow_¬r_L2_1
[ 
bb
->
bbid
 ] = 
Ín
->
unknow_wût_L2
[ 
šdex
 ];

531 
h™_¬r_2
[ 
bb
->
bbid
 ] = 
Ín
->
h™_wût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

532 
miss_¬r_2
[ 
bb
->
bbid
 ] = 
Ín
->
miss_wût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

533 
unknow_¬r_2
[ 
bb
->
bbid
 ] = 
Ín
->
unknow_wût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

535 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] = 
Ín
->
h™_wût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

536 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] = 
Ín
->
miss_wût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

537 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] = 
Ín
->
unknow_wût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

543 
wût_¬r_2
[ 
bb
->
bbid
 ] +ğwût_¬r_2[ 
Ín
->
loİex™
->bbid ];

545 
h™_¬r_2
[ 
bb
->
bbid
 ] +ğh™_¬r_2[ 
Ín
->
loİex™
->bbid ];

546 
miss_¬r_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_2[ 
Ín
->
loİex™
->bbid ];

547 
unknow_¬r_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_2[ 
Ín
->
loİex™
->bbid ];

549 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2_2[ 
Ín
->
loİex™
->bbid ];

550 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2_2[ 
Ín
->
loİex™
->bbid ];

551 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2_2[ 
Ín
->
loİex™
->bbid ];

555 if(
´št
)

557 
	`´štf
("wût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_1
[bb->bbid]);

558 
	`´štf
("wût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_2
[bb->bbid]);

570 
wût_¬r_1
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[
šdex
]->
wco¡
;

571 
wût_¬r_2
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[
šdex
 + 1]->
wco¡
 * (
Í
->
loİbound
 -1);

574 
h™_¬r_1
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
h™
;

575 
miss_¬r_1
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
miss
;

576 
unknow_¬r_1
[ 
bb
->
bbid
 ] = bb->
chmc
[ 
šdex
 ]->
unknow
;

579 
h™_¬r_L2_1
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
h™
;

580 
miss_¬r_L2_1
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
miss
;

581 
unknow_¬r_L2_1
[ 
bb
->
bbid
 ] = bb->
chmc_L2
[ 
šdex
 ]->
unknow
;

585 
h™_¬r_2
[ 
bb
->
bbid
 ] = ( bb->
chmc
[
šdex
 + 1]->
h™
 ) * (
Í
->
loİbound
 -1);

586 
miss_¬r_2
[ 
bb
->
bbid
 ] = ( bb->
chmc
[
šdex
 + 1]->
miss
 ) * (
Í
->
loİbound
 -1);

587 
unknow_¬r_2
[ 
bb
->
bbid
 ] = ( bb->
chmc
[
šdex
 + 1]->
unknow
 ) * (
Í
->
loİbound
 -1);

590 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] = ( bb->
chmc_L2
[
šdex
 + 1]->
h™
 ) * (
Í
->
loİbound
 -1);

591 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] = ( bb->
chmc_L2
[
šdex
 + 1]->
miss
 ) * (
Í
->
loİbound
 -1);

592 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] = ( bb->
chmc_L2
[
šdex
 + 1]->
unknow
 ) * (
Í
->
loİbound
 -1);

597 if(
´št
)

599 
	`´štf
("wût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_1
[bb->bbid]);

600 
	`´štf
("wût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_2
[bb->bbid]);

602 
	`´štf
("h™_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_1
[bb->bbid]);

603 
	`´štf
("miss_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_1
[bb->bbid]);

604 
	`´štf
("unknow_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_1
[bb->bbid]);

606 
	`´štf
("h™_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_1
[bb->bbid]);

607 
	`´štf
("miss_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_1
[bb->bbid]);

608 
	`´štf
("unknow_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_1
[bb->bbid]);

611 
	`´štf
("h™_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_2
[bb->bbid]);

612 
	`´štf
("miss_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_2
[bb->bbid]);

613 
	`´štf
("unknow_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_2
[bb->bbid]);

615 
	`´štf
("h™_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_2
[bb->bbid]);

616 
	`´štf
("miss_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_2
[bb->bbid]);

617 
	`´štf
("unknow_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_2
[bb->bbid]);

621  
bb
->
num_outgošg
 ) {

627 
wût_¬r_1
[ 
bb
->
bbid
 ] +ğwût_¬r_1[ bb->
outgošg
[0] ];

628 
wût_¬r_2
[ 
bb
->
bbid
 ] +ğwût_¬r_2[ bb->
outgošg
[0] ];

630 
h™_¬r_1
[ 
bb
->
bbid
 ] +ğh™_¬r_1[ bb->
outgošg
[0] ];

631 
miss_¬r_1
[ 
bb
->
bbid
 ] +ğmiss_¬r_1[ bb->
outgošg
[0] ];

632 
unknow_¬r_1
[ 
bb
->
bbid
 ] +ğunknow_¬r_1[ bb->
outgošg
[0] ];

634 
h™_¬r_L2_1
[ 
bb
->
bbid
 ] +ğh™_¬r_L2_1[ bb->
outgošg
[0] ];

635 
miss_¬r_L2_1
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2_1[ bb->
outgošg
[0] ];

636 
unknow_¬r_L2_1
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2_1[ bb->
outgošg
[0] ];

639 
h™_¬r_2
[ 
bb
->
bbid
 ] +ğh™_¬r_2[ bb->
outgošg
[0] ];

640 
miss_¬r_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_2[ bb->
outgošg
[0] ];

641 
unknow_¬r_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_2[ bb->
outgošg
[0] ];

643 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2_2[ bb->
outgošg
[0] ];

644 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2_2[ bb->
outgošg
[0] ];

645 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2_2[ bb->
outgošg
[0] ];

648 if(
´št
)

650 
	`´štf
("wût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_1
[bb->bbid]);

651 
	`´štf
("wût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_2
[bb->bbid]);

653 
	`´štf
("h™_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_1
[bb->bbid]);

654 
	`´štf
("miss_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_1
[bb->bbid]);

655 
	`´štf
("unknow_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_1
[bb->bbid]);

657 
	`´štf
("h™_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_1
[bb->bbid]);

658 
	`´štf
("miss_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_1
[bb->bbid]);

659 
	`´štf
("unknow_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_1
[bb->bbid]);

662 
	`´štf
("h™_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_2
[bb->bbid]);

663 
	`´štf
("miss_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_2
[bb->bbid]);

664 
	`´štf
("unknow_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_2
[bb->bbid]);

666 
	`´štf
("h™_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_2
[bb->bbid]);

667 
	`´štf
("miss_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_2
[bb->bbid]);

668 
	`´štf
("unknow_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_2
[bb->bbid]);

678 if(
bb
->
loİid
 > 
p
->
bbli¡
[bb->
outgošg
[0]]->loopid)

680 
max1
 = 1;

681 
max2
 = 1;

683 if(
bb
->
loİid
 > 
p
->
bbli¡
[bb->
outgošg
[1]]->loopid)

685 
max1
 = 0;

686 
max2
 = 0;

691 ifĞ
wût_¬r_1
[ 
bb
->
outgošg
[0] ] >= wcet_arr_1[ bb->outgoing[1] ] )

692 
max1
 = 0;

694 
max1
 = 1;

696 ifĞ
wût_¬r_2
[ 
bb
->
outgošg
[0] ] >= wcet_arr_2[ bb->outgoing[1] ] )

697 
max2
 = 0;

699 
max2
 = 1;

701 
wût_¬r_1
[ 
bb
->
bbid
 ] +ğwût_¬r_1[ bb->
outgošg
[
max1
] ];

702 
wût_¬r_2
[ 
bb
->
bbid
 ] +ğwût_¬r_2[ bb->
outgošg
[
max2
] ];

705 
h™_¬r_1
[ 
bb
->
bbid
 ] +ğh™_¬r_1[ bb->
outgošg
[
max1
] ];

706 
miss_¬r_1
[ 
bb
->
bbid
 ] +ğmiss_¬r_1[ bb->
outgošg
[
max1
] ];

707 
unknow_¬r_1
[ 
bb
->
bbid
 ] +ğunknow_¬r_1[ bb->
outgošg
[
max1
] ];

709 
h™_¬r_L2_1
[ 
bb
->
bbid
 ] +ğh™_¬r_L2_1[ bb->
outgošg
[
max1
] ];

710 
miss_¬r_L2_1
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2_1[ bb->
outgošg
[
max1
] ];

711 
unknow_¬r_L2_1
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2_1[ bb->
outgošg
[
max1
] ];

714 
h™_¬r_2
[ 
bb
->
bbid
 ] +ğh™_¬r_2[ bb->
outgošg
[
max2
] ];

715 
miss_¬r_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_2[ bb->
outgošg
[
max2
] ];

716 
unknow_¬r_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_2[ bb->
outgošg
[
max2
] ];

718 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] +ğh™_¬r_L2_2[ bb->
outgošg
[
max2
] ];

719 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] +ğmiss_¬r_L2_2[ bb->
outgošg
[
max2
] ];

720 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] +ğunknow_¬r_L2_2[ bb->
outgošg
[
max2
] ];

722 if(
´št
)

724 
	`´štf
("wût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_1
[bb->bbid]);

725 
	`´štf
("wût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_2
[bb->bbid]);

727 
	`´štf
("h™_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_1
[bb->bbid]);

728 
	`´štf
("miss_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_1
[bb->bbid]);

729 
	`´štf
("unknow_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_1
[bb->bbid]);

731 
	`´štf
("h™_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_1
[bb->bbid]);

732 
	`´štf
("miss_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_1
[bb->bbid]);

733 
	`´štf
("unknow_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_1
[bb->bbid]);

736 
	`´štf
("h™_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_2
[bb->bbid]);

737 
	`´štf
("miss_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_2
[bb->bbid]);

738 
	`´štf
("unknow_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_2
[bb->bbid]);

740 
	`´štf
("h™_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_2
[bb->bbid]);

741 
	`´štf
("miss_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_2
[bb->bbid]);

742 
	`´štf
("unknow_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_2
[bb->bbid]);

751 
	`´štf
Ğ"Inv®id‚umb” oàoutgošgƒdge © %d-%d\n", 
bb
->
pid
, bb->
bbid
 );

752 
	`ex™
(1);

757 ifĞ
bb
->
ÿÎpid
 != -1 ) {

759 
wût_¬r_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
wût
[ 
šdex
 ];

760 
wût_¬r_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
wût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

763 
h™_¬r_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_wût
[ 
šdex
 ];

764 
miss_¬r_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_wût
[ 
šdex
 ];

765 
unknow_¬r_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_wût
[ 
šdex
 ];

767 
h™_¬r_L2_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_wût_L2
[ 
šdex
 ];

768 
miss_¬r_L2_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_wût_L2
[ 
šdex
 ];

769 
unknow_¬r_L2_1
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_wût_L2
[ 
šdex
 ];

772 
h™_¬r_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_wût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

773 
miss_¬r_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_wût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

774 
unknow_¬r_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_wût
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

776 
h™_¬r_L2_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
h™_wût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

777 
miss_¬r_L2_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
miss_wût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

778 
unknow_¬r_L2_2
[ 
bb
->
bbid
 ] +ğbb->
´oc_±r
->
unknow_wût_L2
[ 
šdex
 + 1 ] * (
Í
->
loİbound
 -1);

781 if(
´št
)

782 
	`´štf
Ğ"bb %d-%d…roûdu» c®È%d wût: 1 %Lu 2 %Lu\n", 
bb
->
pid
, bb->
bbid
, bb->
ÿÎpid
, bb->
´oc_±r
->
wût
[
šdex
 * 2], bb->´oc_±r->wût[šdex * 2 + 1]); 
	`fæush
Ğ
¡dout
 );

783 if(
´št
)

785 
	`´štf
("wût_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_1
[bb->bbid]);

786 
	`´štf
("wût_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
wût_¬r_2
[bb->bbid]);

788 
	`´štf
("h™_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_1
[bb->bbid]);

789 
	`´štf
("miss_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_1
[bb->bbid]);

790 
	`´štf
("unknow_¬r_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_1
[bb->bbid]);

792 
	`´štf
("h™_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_1
[bb->bbid]);

793 
	`´štf
("miss_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_1
[bb->bbid]);

794 
	`´štf
("unknow_¬r_L2_1[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_1
[bb->bbid]);

797 
	`´štf
("h™_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_2
[bb->bbid]);

798 
	`´štf
("miss_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_2
[bb->bbid]);

799 
	`´štf
("unknow_¬r_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_2
[bb->bbid]);

801 
	`´štf
("h™_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
h™_¬r_L2_2
[bb->bbid]);

802 
	`´štf
("miss_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
miss_¬r_L2_2
[bb->bbid]);

803 
	`´štf
("unknow_¬r_L2_2[%d] = %Lu\n", 
bb
->
bbid
, 
unknow_¬r_L2_2
[bb->bbid]);

880 
Í
->
wût
[ 
šdex
 ] = 
wût_¬r_1
[ 
tİo
[ 
num_tİo
-1 ]->
bbid
 ] +†p->
num_fm_L2
 * 
IC_MISS_L2
 +†p->
num_fm
 * 
IC_MISS
;

881 
Í
->
wût
[ 
šdex
 + 1 ] = 
wût_¬r_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

884 
Í
->
h™_wût
[ 
šdex
 ] = 
h™_¬r_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

885 
Í
->
miss_wût
[ 
šdex
 ] = 
miss_¬r_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

886 
Í
->
unknow_wût
[ 
šdex
 ] = 
unknow_¬r_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

889 
Í
->
h™_wût_L2
[ 
šdex
 ] = 
h™_¬r_L2_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

890 
Í
->
miss_wût_L2
[ 
šdex
 ] = 
miss_¬r_L2_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

891 
Í
->
unknow_wût_L2
[ 
šdex
 ] = 
unknow_¬r_L2_1
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

895 
Í
->
h™_wût
[ 
šdex
 + 1 ] = 
h™_¬r_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

896 
Í
->
miss_wût
[ 
šdex
 + 1 ] = 
miss_¬r_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

897 
Í
->
unknow_wût
[ 
šdex
 + 1 ] = 
unknow_¬r_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

900 
Í
->
h™_wût_L2
[ 
šdex
 + 1 ] = 
h™_¬r_L2_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

901 
Í
->
miss_wût_L2
[ 
šdex
 + 1 ] = 
miss_¬r_L2_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

902 
Í
->
unknow_wût_L2
[ 
šdex
 + 1 ] = 
unknow_¬r_L2_2
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

904 if(
´št
)

906 
	`´štf
("†p->wûˆğ%Lu, %Lu\n", 
Í
->
wût
[
šdex
],†p->wcet[ index + 1 ]);

908 
	`´štf
("†p->h™_wûˆğ%Lu, %Lu\n", 
Í
->
h™_wût
[
šdex
],†p->hit_wcet[ index + 1 ]);

909 
	`´štf
("†p->miss_wûˆğ%Lu, %Lu\n", 
Í
->
miss_wût
[
šdex
],†p->miss_wcet[ index + 1 ]);

910 
	`´štf
("†p->unknow_wûˆğ%Lu, %Lu\n", 
Í
->
unknow_wût
[
šdex
],†p->unknow_wcet[ index + 1 ]);

912 
	`´štf
("†p->h™_wût_L2 = %Lu, %Lu\n", 
Í
->
h™_wût_L2
[
šdex
],†p->hit_wcet_L2[ index + 1 ]);

913 
	`´štf
("†p->miss_wût_L2 = %Lu, %Lu\n", 
Í
->
miss_wût_L2
[
šdex
],†p->miss_wcet_L2[ index + 1 ]);

914 
	`´štf
("†p->unknow_wût_L2 = %Lu, %Lu\n", 
Í
->
unknow_wût_L2
[
šdex
],†p->unknow_wcet_L2[ index + 1 ]);

919 ifĞ!
Í
->
is_dowhe
 )

922 
Í
->
wût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc_L2
[šdex + 1]->
wco¡
;

925 
Í
->
h™_wût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc
[šdex + 1]->
h™
;

926 
Í
->
miss_wût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc
[šdex + 1]->
miss
;

927 
Í
->
unknow_wût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc
[šdex + 1]->
unknow
;

930 
Í
->
h™_wût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc_L2
[šdex + 1]->
h™
;

931 
Í
->
miss_wût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc_L2
[šdex + 1]->
miss
;

932 
Í
->
unknow_wût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
chmc_L2
[šdex + 1]->
unknow
;

935 ifĞ
Í
->
loİh—d
->
ÿÎpid
 != -1 )

937 
Í
->
wût
[ 
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->wcet[index + 1];

940 
Í
->
h™_wût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->hit_wcet[index + 1];

941 
Í
->
miss_wût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->miss_wcet[index + 1];

942 
Í
->
unknow_wût
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->unknow_wcet[index + 1];

944 
Í
->
h™_wût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->hit_wcet_L2[index + 1];

945 
Í
->
miss_wût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->miss_wcet_L2[index + 1];

946 
Í
->
unknow_wût_L2
[
šdex
 +1 ] +ğ
p
->
bbli¡
[Í->
loİh—d
->
bbid
]->
´oc_±r
->unknow_wcet_L2[index + 1];

951 if(
´št
)

953 
	`´štf
("Í->wût[%d] = %Lu\n", 
šdex
, 
Í
->
wût
[index]);

954 
	`´štf
("Í->wût[%d] = %Lu\n", 
šdex
+1, 
Í
->
wût
[index + 1]);

956 
	`´štf
("Í->h™_wûˆğ%Lu, %Lu\n", 
Í
->
h™_wût
[ 
šdex
 ],†p->hit_wcet[ index + 1 ]);

957 
	`´štf
("Í->miss_wûˆğ%Lu, %Lu\n", 
Í
->
miss_wût
[ 
šdex
 ],†p->miss_wcet[ index + 1 ]);

958 
	`´štf
("Í->unknow_wûˆğ%Lu, %Lu\n", 
Í
->
unknow_wût
[ 
šdex
 ],†p->unknow_wcet[ index + 1 ]);

960 
	`´štf
("Í->h™_wût_L2 = %Lu, %Lu\n", 
Í
->
h™_wût_L2
[ 
šdex
 ],†p->hit_wcet_L2[ index + 1 ]);

961 
	`´štf
("Í->miss_wût_L2 = %Lu, %Lu\n", 
Í
->
miss_wût_L2
[ 
šdex
 ],†p->miss_wcet_L2[ index + 1 ]);

962 
	`´štf
("Í->unknow_wût_L2 = %Lu, %Lu\n", 
Í
->
unknow_wût_L2
[ 
šdex
 ],†p->unknow_wcet_L2[ index + 1 ]);

983 
	`ä“
Ğ
wût_¬r_1
 );

984 
	`ä“
Ğ
wût_¬r_2
 );

987 
	}
}

997 
	$ª®y£Proc_WCET
Ğ
´oûdu»
 *
p
 ) {

999 
i
, 
j
;

1000 
loİ
 *
Í
;

1003  
i
 = 
p
->
num_loİs
 - 1; i >= 0; i-- ) {

1004 
Í
 = 
p
->
loİs
[
i
];

1008 
j
 = 0; j < (1<<
Í
->
Ëv–
); j++)

1009 
	`ª®y£DAGLoİ_WCET
(
p
, 
Í
, 
j
*2);

1017 
j
 = 0; j < 
p
->
num_co¡
; j++)

1018 
	`ª®y£DAGFunùiÚ_WCET
Ğ
p
, 
j
);

1020 
	}
}

1031 
	$ª®ysis_dag_WCET
(
MSC
 *
msc
) {

1032 
i
, 
j
, 
k
;

1033 
t
;

1037 
k
 = 0; k < 
msc
->
num_sk
; k++)

1040  
i
 = 0; i < 
msc
->
skLi¡
[
k
].
num_´oc
; i++ )

1041 
j
 = 0; j < 
msc
->
skLi¡
[
k
].
´oc_cg_±r
[
i
].
num_´oc
; j++)

1043 
	`ª®y£Proc_WCET
(
msc
->
skLi¡
[
k
].
´oc_cg_±r
[
i
].
´oc
[
j
]);

1048 
msc
->
skLi¡
[
k
].
wût
 = msc->skLi¡[k].
maš_cİy
->wcet[0];

1050 
msc
->
skLi¡
[
k
].
h™_wût
 = msc->skLi¡[k].
maš_cİy
->hit_wcet[0];

1051 
msc
->
skLi¡
[
k
].
miss_wût
 = msc->skLi¡[k].
maš_cİy
->miss_wcet[0];

1052 
msc
->
skLi¡
[
k
].
unknow_wût
 = msc->skLi¡[k].
maš_cİy
->unknow_wcet[0];

1054 
msc
->
skLi¡
[
k
].
h™_wût_L2
 = msc->skLi¡[k].
maš_cİy
->hit_wcet_L2[0];

1055 
msc
->
skLi¡
[
k
].
miss_wût_L2
 = msc->skLi¡[k].
maš_cİy
->miss_wcet_L2[0];

1056 
msc
->
skLi¡
[
k
].
unknow_wût_L2
 = msc->skLi¡[k].
maš_cİy
->unknow_wcet_L2[0];

1059 if(
´št
)

1061 
	`´štf
("msc->skLi¡[%d].wûˆğ%Lu\n", 
k
, 
msc
->
skLi¡
[k].
wût
);

1070 
	}
}

1088 
ušt
 
	$g‘_hex
(* 
hex_¡ršg
)

1090 
Ën
,
i
;

1091 
dig
;

1092 
ušt
 
v®ue
 = 0;

1094 
Ën
 = 
	`¡¾’
(
hex_¡ršg
);

1096 #ifdeà
_NDEBUG


1097 
	`årštf
(
¡dout
, "hex sŒšg = %s\n", 
hex_¡ršg
);

1100 
i
 = 0; i < 
Ën
; i++)

1102 
dig
 = 
hex_¡ršg
[
Ën
-
i
-1];

1104 
dig
)

1107 
v®ue
 +ğ10 * 
	`pow
(16,
i
);

1110 
v®ue
 +ğ11 * 
	`pow
(16,
i
);

1113 
v®ue
 +ğ12 * 
	`pow
(16,
i
);

1116 
v®ue
 +ğ13 * 
	`pow
(16,
i
);

1119 
v®ue
 +ğ14 * 
	`pow
(16,
i
);

1122 
v®ue
 +ğ15 * 
	`pow
(16,
i
);

1125 
v®ue
 +ğ(
dig
 - 48è* 
	`pow
(16,
i
);

1129 #ifdeà
_NDEBUG


1130 
	`årštf
(
¡dout
, "hex v®uğ%x\n", 
v®ue
);

1133  
v®ue
;

1134 
	}
}

1136 #ifdeà
_PRINT


1137 
	$dump_´og_šfo
(
´oûdu»
* 
´oc
)

1139 
loİ
* 
Í
;

1140 
block
* 
bb
;

1141 
š¡r
* 
š¡
;

1142 
i
,
j
,
k
;

1143 
FILE
* 
å
 = 
¡dout
;

1145 
	`årštf
(
å
, "Printing incoming block information\n");

1146 
i
 = 0; i < 
´oc
->
num_bb
; i++)

1148 
	`as£¹
(
´oc
->
bbli¡
[
i
]);

1149 
bb
 = 
´oc
->
bbli¡
[
i
];

1150 
	`årštf
(
å
, "Basiøblock id = (%d.%d.0x%x.¡¬t=%Lu.fšish=%Lu)\n", 
´oc
->
pid
,

1151 
bb
->
bbid
, ()bb, bb->
¡¬t_time
, bb->
fšish_time
);

1152 
	`årštf
(
å
, "Incomšg block (TÙ® = %d)======> \n", 
bb
->
num_šcomšg
);

1153 
j
 = 0; j < 
bb
->
num_šcomšg
; j++)

1155 
	`årštf
(
å
, "(bb=%d.%x)\n", 
bb
->
šcomšg
[
j
],

1156 ()
´oc
->
bbli¡
[
bb
->
šcomšg
[
j
]]);

1159 
	`årštf
(
å
, "Printing Topological information ====>\n");

1160 
i
 = 
´oc
->
num_tİo
 - 1; i >= 0; i--)

1162 
bb
 = 
´oc
->
tİo
[
i
];

1163 
	`årštf
(
å
, "Õroc=%d.bb=%d)\n", 
bb
->
pid
, bb->
bbid
);

1165 
	`årštf
(
å
, "Printing Loop information ====>\n");

1166 
i
 = 0; i < 
´oc
->
num_loİs
; i++)

1168 
Í
 = 
´oc
->
loİs
[
i
];

1169 
	`as£¹
(
Í
->
loİh—d
);

1170 
	`årštf
(
å
, "(proc=%d.loop=%d.loophead=%d.loopsink=%d.loopexit=%d)\n",

1171 
´oc
->
pid
, 
Í
->
Íid
,†p->
loİh—d
->
bbid
,†p->
loİsšk
->bbid,

1172 
Í
->
loİex™
 ?†p->loİex™->
bbid
 : -1);

1173 
	`årštf
(
å
, "Loop Nodes ====>\n");

1174 
j
 = 
Í
->
num_tİo
 - 1; j >= 0; j--)

1176 
	`as£¹
(
Í
->
tİo
[
j
]);

1177 
	`årštf
(
å
, "(bb=%d)", 
Í
->
tİo
[
j
]->
bbid
);

1179 
	`årštf
(
å
,"\n");

1182 
	`årštf
(
å
, "Printing instruction call„elationship\n");

1183 
i
 = 0; i < 
´oc
->
num_bb
; i++)

1185 
bb
 = 
´oc
->
bbli¡
[
i
];

1187 
j
 = 0; j < 
bb
->
num_š¡r
; j++)

1189 
š¡
 = 
bb
->
š¡¾i¡
[
j
];

1190 if(
	`IS_CALL
(
š¡
->
İ
))

1192 
	`årštf
(
å
, "PROCEDURE CALL ENCOUNTERED‡ˆ%s\n", 
	`GET_CALLEE
(
š¡
));

1194 if(!
´oc
->
ÿÎs
)

1196 
k
 = 0; k < 
´oc
->
num_ÿÎs
; k++)

1198 
ušt
 
ÿÎ“_id
 = 
´oc
->
ÿÎs
[
k
];

1199 
´oûdu»
* 
ÿÎ“
 = 
´ocs
[
ÿÎ“_id
];

1200 
	`as£¹
(
ÿÎ“
);

1201 
	`årštf
(
å
, "Got start‡ddress = %x\n",

1202 
ÿÎ“
->
tİo
[ÿÎ“->
num_tİo
 - 1]->
¡¬ddr
);

1207 
	}
}

1211 
´oûdu»
* 
	$g‘_sk_ÿÎ“
(
ušt
 
¡¬ddr
)

1213 
i
;

1214 
´oûdu»
* 
ÿÎ“
;

1215 
block
* 
f_block
;

1217 
	`as£¹
(
cur_sk
);

1219  
i
 = 0; i < 
cur_sk
->
num_´oc
; i++ )

1221 
ÿÎ“
 = 
cur_sk
->
´oc_cg_±r
[
i
].
´oc
[0];

1222 
	`as£¹
(
ÿÎ“
);

1225 
f_block
 = 
ÿÎ“
->
tİo
[ÿÎ“->
num_tİo
 - 1];

1229 if(
f_block
->
¡¬ddr
 == startaddr)

1230  
ÿÎ“
;

1234  
NULL
;

1235 
	}
}

1238 
´oûdu»
* 
	$g‘C®Ëe
(
š¡r
* 
š¡
, 
´oûdu»
* 
´oc
)

1240 
i
;

1241 
´oûdu»
* 
ÿÎ“
;

1242 
block
* 
f_block
;

1243 
ušt
 
addr
;

1250 if(!
´oc
->
ÿÎs
)

1251  
NULL
;

1253 
addr
 = 
	`g‘_hex
(
	`GET_CALLEE
(
š¡
));

1257 if(
cur_sk
)

1258  
	`g‘_sk_ÿÎ“
(
addr
);

1260 
i
 = 0; i < 
´oc
->
num_ÿÎs
; i++)

1262 
ÿÎ“
 = 
´ocs
[
´oc
->
ÿÎs
[
i
]];

1263 
	`as£¹
(
ÿÎ“
);

1265 
f_block
 = 
ÿÎ“
->
tİo
[ÿÎ“->
num_tİo
 - 1];

1270 #ifdeà
_DEBUG


1271 
	`årštf
(
¡dout
, "jump‡ddress = %x, callee‡ddress = %x\n",

1272 
	`g‘_hex
(
	`GET_CALLEE
(
š¡
)), 
f_block
->
¡¬ddr
);

1276 if(
f_block
->
¡¬ddr
 =ğ
addr
)

1281  
ÿÎ“
;

1291  
NULL
;

1292 
	}
}

1294 #ifdeà
_DEBUG


1296 
	$dump_´e_´oc_chmc
(
´oûdu»
* 
´oc
)

1298 
i
,
j
,
k
;

1299 
block
* 
bb
;

1300 
š¡r
* 
š¡
;

1302 
i
 = 0; i < 
´oc
->
num_bb
; i++)

1304 
bb
 = 
´oc
->
bbli¡
[
i
];

1306 
j
 = 0; j < 
bb
->
num_š¡r
; j++)

1308 
š¡
 = 
bb
->
š¡¾i¡
[
j
];

1309 
	`årštf
(
¡dout
, "In¡ruùiÚ‡dd»s ğ% ==>\n", 
š¡
->
addr
);

1310 
k
 = 0; k < 
bb
->
num_chmc
; k++)

1312 if(
š¡
->
acc_t
[
k
] =ğ
L1_HIT
)

1313 
	`årštf
(
¡dout
, "L1_HIT\n");

1315 
	`årštf
(
¡dout
, "L2_MISS\n");

1319 
	}
}

1323 
	$şassify_š¡_L2
(
š¡r
* 
š¡
, 
CHMC
** 
chmc_l2
, 
n_chmc_l2
, 
š¡_id
)

1325 
i
, 
j
;

1326 
ušt
 
addr
 = 
	`g‘_hex
(
š¡
->addr);

1328 if(!
n_chmc_l2
)

1332 if(!
š¡
->
acc_t_l2
)

1333 
š¡
->
acc_t_l2
 = (
acc_ty³
 *)
	`m®loc
(
n_chmc_l2
 * (acc_type));

1334 if(!
š¡
->
acc_t_l2
)

1335 
	`´”r
("Error: Out of memory");

1337 
	`mem£t
(
š¡
->
acc_t_l2
, 0, 
n_chmc_l2
 * (
acc_ty³
));

1339 
i
 = 0; i < 
n_chmc_l2
; i++)

1341 
	`as£¹
(
chmc_l2
[
i
]);

1343 if(!
chmc_l2
[
i
]->
h™miss_addr
) ;

1345 if((
chmc_l2
[
i
]->
h™miss_addr
[
š¡_id
] =ğ
ALWAYS_HIT
) &&

1346 
š¡
->
acc_t
[
i
] !ğ
L1_HIT
)

1348 
š¡
->
acc_t_l2
[
i
] = 
L2_HIT
;

1351 
	}
}

1354 
	$şassify_š¡
(
š¡r
* 
š¡
, 
CHMC
** 
chmc
, 
n_chmc
, 
š¡_id
)

1356 
i
, 
j
;

1357 
ušt
 
addr
 = 
	`g‘_hex
(
š¡
->addr);

1359 if(!
n_chmc
)

1363 if(!
š¡
->
acc_t
)

1364 
š¡
->
acc_t
 = (
acc_ty³
 *)
	`m®loc
(
n_chmc
 * (acc_type));

1365 if(!
š¡
->
acc_t
)

1366 
	`´”r
("Error: Out of memory");

1368 
	`mem£t
(
š¡
->
acc_t
, 0, 
n_chmc
 * (
acc_ty³
));

1370 
i
 = 0; i < 
n_chmc
; i++)

1372 
	`as£¹
(
chmc
[
i
]);

1376 if(!
chmc
[
i
]->
h™miss_addr
) {

1380 if(
chmc
[
i
]->
h™miss_addr
[
š¡_id
] =ğ
ALWAYS_HIT
)

1382 
š¡
->
acc_t
[
i
] = 
L1_HIT
;

1385 
	}
}

1389 
	$»£t_time¡amps
(
´oûdu»
* 
´oc
, 
uÎ
 
¡¬t_time
)

1391 
i
;

1392 
block
* 
bb
;

1394 
i
 = 0; i < 
´oc
->
num_bb
; i++)

1396 
bb
 = 
´oc
->
bbli¡
[
i
];

1397 
bb
->
¡¬t_time
 = bb->
fšish_time
 = start_time;

1399 
	}
}

1403 
	$´•roûss_chmc_L2
(
´oûdu»
* 
´oc
)

1405 
i
,
j
;

1406 
block
* 
bb
;

1407 
š¡r
* 
š¡
;

1409 
i
 = 0; i < 
´oc
->
num_bb
; i++)

1411 
bb
 = 
´oc
->
bbli¡
[
i
];

1413 
j
 = 0; j < 
bb
->
num_š¡r
; j++)

1415 
š¡
 = 
bb
->
š¡¾i¡
[
j
];

1416 
	`şassify_š¡_L2
(
š¡
, 
bb
->
chmc_L2
, bb->
num_chmc_L2
, 
j
);

1419 
	}
}

1422 
	$´•roûss_chmc
(
´oûdu»
* 
´oc
)

1424 
i
,
j
;

1425 
block
* 
bb
;

1426 
š¡r
* 
š¡
;

1428 
i
 = 0; i < 
´oc
->
num_bb
; i++)

1430 
bb
 = 
´oc
->
bbli¡
[
i
];

1432 
j
 = 0; j < 
bb
->
num_š¡r
; j++)

1434 
š¡
 = 
bb
->
š¡¾i¡
[
j
];

1435 
	`şassify_š¡
(
š¡
, 
bb
->
chmc
, bb->
num_chmc
, 
j
);

1438 
	}
}

1442 
acc_ty³
 
	$check_h™_miss
(
block
* 
bb
, 
š¡r
* 
š¡
)

1444 
i
;

1448 if(
g_‹¡šg_mode
)

1449  
L2_MISS
;

1452 if(!
š¡
->
acc_t
)

1453  
L2_MISS
;

1455 if(
š¡
->
acc_t
[
cur_cÚ‹xt
] =ğ
L1_HIT
)

1456  
L1_HIT
;

1458 if(!
š¡
->
acc_t_l2
)

1459  
L2_MISS
;

1460 if(
š¡
->
acc_t_l2
[
cur_cÚ‹xt
] =ğ
L2_HIT
)

1462 #ifdeà
_DEBUG


1463 
	`årštf
(
¡dout
, "Returning L2 HIT\n");

1465  
L2_HIT
;

1468  
L2_MISS
;

1469 
	}
}

1473 
	$£t_¡¬t_time
(
block
* 
bb
, 
´oûdu»
* 
´oc
)

1475 
i
, 
š_šdex
;

1476 
uÎ
 
max_¡¬t
 = 
bb
->
¡¬t_time
;

1479 
	`as£¹
(
bb
);

1481 
i
 = 0; i < 
bb
->
num_šcomšg
; i++)

1483 
š_šdex
 = 
bb
->
šcomšg
[
i
];

1484 
	`as£¹
(
´oc
->
bbli¡
[
š_šdex
]);

1486 if(
max_¡¬t
 < 
´oc
->
bbli¡
[
š_šdex
]->
fšish_time
)

1487 
max_¡¬t
 = 
´oc
->
bbli¡
[
š_šdex
]->
fšish_time
;

1492 
bb
->
¡¬t_time
 = 
max_¡¬t
;

1494 #ifdeà
_DEBUG


1495 
	`´štf
("S‘tšg max s¹ oàbb %d = %Lu\n", 
bb
->
bbid
, 
max_¡¬t
);

1497 
	}
}

1499 
	$£t_¡¬t_time_İt
(
block
* 
bb
, 
´oûdu»
* 
´oc
, 
ušt
 
cÚ‹xt
)

1501 
i
, 
š_šdex
;

1502 
uÎ
 
max_¡¬t
 = 
bb
->
¡¬t_İt
[
cÚ‹xt
];

1505 
	`as£¹
(
bb
);

1507 
i
 = 0; i < 
bb
->
num_šcomšg
; i++)

1509 
š_šdex
 = 
bb
->
šcomšg
[
i
];

1510 
	`as£¹
(
´oc
->
bbli¡
[
š_šdex
]);

1512 if(
max_¡¬t
 < 
´oc
->
bbli¡
[
š_šdex
]->
fš_İt
[
cÚ‹xt
]) {

1515 if(
´oc
->
bbli¡
[
š_šdex
]->
Ï‹¡_bus
[
cÚ‹xt
])

1516 
bb
->
Ï‹¡_bus
[
cÚ‹xt
] = 
´oc
->
bbli¡
[
š_šdex
]->latest_bus[context];

1517 if(
´oc
->
bbli¡
[
š_šdex
]->
Ï‹¡_Ï‹ncy
[
cÚ‹xt
])

1518 
bb
->
Ï‹¡_Ï‹ncy
[
cÚ‹xt
] = 
´oc
->
bbli¡
[
š_šdex
]->latest_latency[context];

1519 
max_¡¬t
 = 
´oc
->
bbli¡
[
š_šdex
]->
fš_İt
[
cÚ‹xt
];

1525 
bb
->
¡¬t_İt
[
cÚ‹xt
] = 
max_¡¬t
;

1527 #ifdeà
_DEBUG


1528 
	`´štf
("S‘tšg max s¹ oàbb %d = %Lu\n", 
bb
->
bbid
, 
max_¡¬t
);

1530 
	}
}

1534 
ušt
 
	$compu‹_wa™šg_time
(
cÜe_sched_p
 
h—d_cÜe
, 
uÎ
 
¡¬t_time
, 
acc_ty³
 
ty³
)

1536 
d–
, 
check_Ën
, 
check_Ën_p
;

1537 
ušt
 
d–ay_–em
;

1538 
ušt
 
Ï‹ncy
;

1540 if(
ty³
 =ğ
L2_HIT
)

1541 
Ï‹ncy
 = 
L2_HIT_LATENCY
;

1542 if(
ty³
 =ğ
L2_MISS
)

1543 
Ï‹ncy
 = 
MISS_PENALTY
;

1545 
	`as£¹
(
h—d_cÜe
);

1547 
d–
 = 
¡¬t_time
 - 
h—d_cÜe
->start_time;

1552 if(
d–
 < 0)

1553 
d–ay_–em
 = 
	`abs
(
d–
);

1556 
check_Ën_p
 = (
d–
 - ((d–/
h—d_cÜe
->
š‹rv®
) * head_core->interval));

1557 if(
check_Ën_p
 < 
h—d_cÜe
->
¦Ù_Ën
)

1558 
d–ay_–em
 = 0;

1561 
check_Ën
 = (((
d–
 / 
h—d_cÜe
->
š‹rv®
) + 1) * head_core->interval);

1562 
d–ay_–em
 = 
check_Ën
 - 
d–
;

1566  
d–ay_–em
;

1567 
	}
}

1571 
	$compu‹_bus_d–ay
(
uÎ
 
¡¬t_time
, 
ušt
 
ncÜe
, 
acc_ty³
 
ty³
)

1573 
sched_p
 
glob_sched
 = 
NULL
;

1574 
£gm’t_p
 
cur_£g
 = 
NULL
;

1575 
cÜe_sched_p
 
cur_cÜe_sched
;

1576 
ušt
 
add_d–ay
 = 0;

1579 
glob_sched
 = 
	`g‘ScheduË
();

1580 
	`as£¹
(
glob_sched
);

1581 
	`as£¹
(
ncÜe
 < 
glob_sched
->
n_cÜes
);

1585 if(
glob_sched
->
ty³
 !ğ
SCHED_TYPE_1
)

1587 
cur_£g
 = 
	`fšd_£gm’t
(
glob_sched
->
£g_li¡
, glob_sched->
n_£gm’ts
,

1588 
¡¬t_time
);

1591 
cur_£g
 = 
glob_sched
->
£g_li¡
[0];

1593 
	`as£¹
(
cur_£g
->
³r_cÜe_sched
);

1594 
	`as£¹
(
cur_£g
->
³r_cÜe_sched
[
ncÜe
]);

1596 
cur_cÜe_sched
 = 
cur_£g
->
³r_cÜe_sched
[
ncÜe
];

1598 
add_d–ay
 = 
	`compu‹_wa™šg_time
(
cur_cÜe_sched
, 
¡¬t_time
, 
ty³
);

1601 #ifdeà
_NPRINT


1602 if(
add_d–ay
 < 0 ||‡dd_delay > 50)

1603 
	`årštf
(
¡dout
, "Requestime = %Lu‡nd Waitingime = %d\n",

1604 
¡¬t_time
, 
add_d–ay
);

1606 
acc_bus_d–ay
 +ğ
add_d–ay
;

1608 if(!
g_no_bus_mod–šg
)

1610 if(
ty³
 =ğ
L2_HIT
)

1611  (
ušt
)(
add_d–ay
 + 
L2_HIT_LATENCY
);

1612 if(
ty³
 =ğ
L2_MISS
)

1613  (
ušt
)(
add_d–ay
 + 
MISS_PENALTY
);

1616  (
ušt
)(
MISS_PENALTY
 + 
MAX_BUS_DELAY
);

1617 
	}
}

1621 
loİ
* 
	$check_loİ
(
block
* 
bb
, 
´oûdu»
* 
´oc
)

1623 
i
;

1625 
i
 = 0; i < 
´oc
->
num_loİs
; i++)

1627 
	`as£¹
(
´oc
->
loİs
[
i
]);

1628 
	`as£¹
(
´oc
->
loİs
[
i
]->
loİh—d
);

1629 if(
´oc
->
loİs
[
i
]->
loİh—d
->
bbid
 =ğ
bb
->bbid)

1630  
´oc
->
loİs
[
i
];

1633  
NULL
;

1634 
	}
}

1638 
ušt
 
	$d‘”mše_Ï‹ncy
(
block
* 
bb
, 
ušt
 
cÚ‹xt
, ušˆ
bb_co¡
, 
acc_ty³
 
ty³
)

1640 
uÎ
 
d–ay
 = 0;

1641 
uÎ
 
off£t
;

1642 
uÎ
 
š‹rv®
;

1643 
ušt
 
¦Ù_Ën
;

1644 
ušt
 
Ï‹ncy
;

1645 
ušt
 
p_Ï‹ncy
;

1646 
n
;

1647 
ncÜe
 = 4;

1649 
off£t
 = 
bb
->
¡¬t_İt
[
cÚ‹xt
] + 
bb_co¡
 - bb->
Ï‹¡_bus
[context];

1652 
¦Ù_Ën
 = 
glob®_sched_d©a
->
£g_li¡
[0]->
³r_cÜe_sched
[0]->slot_len;

1653 
š‹rv®
 = 
glob®_sched_d©a
->
£g_li¡
[0]->
³r_cÜe_sched
[0]->interval;

1656 if(
g_no_bus_mod–šg
)

1658 if(
ty³
 =ğ
L2_HIT
)

1659  ((
ncÜe
 - 1è* 
š‹rv®
 + 2 * 
L2_HIT_LATENCY
);

1660 if(
ty³
 =ğ
L2_MISS
)

1661  ((
ncÜe
 - 1è* 
š‹rv®
 + 2 * 
MISS_PENALTY
);

1666 if(!
bb
->
Ï‹¡_bus
[
cÚ‹xt
]) {

1667 
bb
->
Ï‹¡_bus
[
cÚ‹xt
] = bb->
¡¬t_İt
[cÚ‹xt] + 
bb_co¡
;

1668 if(
ty³
 =ğ
L2_HIT
) {

1669 
bb
->
Ï‹¡_bus
[
cÚ‹xt
] +ğ
L2_HIT_LATENCY
;

1670 
bb
->
Ï‹¡_Ï‹ncy
[
cÚ‹xt
] = 
L2_HIT_LATENCY
;

1671 
d–ay
 = (
š‹rv®
 - 
¦Ù_Ën
è+ 
L2_HIT_LATENCY
;

1673 if(
ty³
 =ğ
L2_MISS
) {

1674 
bb
->
Ï‹¡_bus
[
cÚ‹xt
] +ğ
MISS_PENALTY
;

1675 
bb
->
Ï‹¡_Ï‹ncy
[
cÚ‹xt
] = 
MISS_PENALTY
;

1676 
d–ay
 = (
š‹rv®
 - 
¦Ù_Ën
è+ 
MISS_PENALTY
;

1679 if((
off£t
 < 
¦Ù_Ën
 - 
L2_HIT_LATENCY
è&& 
ty³
 =ğ
L2_HIT
)

1680 
d–ay
 = 
L2_HIT_LATENCY
;

1681 if((
off£t
 < 
¦Ù_Ën
 - 
MISS_PENALTY
è&& 
ty³
 =ğ
L2_MISS
)

1682 
d–ay
 = 
MISS_PENALTY
;

1686 if(
ty³
 =ğ
L2_HIT
)

1687 
Ï‹ncy
 = 
L2_HIT_LATENCY
;

1689 
Ï‹ncy
 = 
MISS_PENALTY
;

1691 
p_Ï‹ncy
 = (
bb
->
Ï‹¡_Ï‹ncy
[
cÚ‹xt
]);

1693 
n
 = ((
off£t
 + 
p_Ï‹ncy
è/ (
ncÜe
 * 
¦Ù_Ën
)) + 1;

1695 if(
off£t
 <ğ((
n
 - 1è* 
ncÜe
 + 1è* 
¦Ù_Ën
 - 
Ï‹ncy
 - 
p_Ï‹ncy
)

1696 
d–ay
 = 
Ï‹ncy
;

1699 
d–ay
 = (
n
 * 
ncÜe
 * 
¦Ù_Ën
è+ 
Ï‹ncy
 - 
p_Ï‹ncy
 - 
off£t
;

1700 
bb
->
Ï‹¡_bus
[
cÚ‹xt
] = bb->
¡¬t_İt
[cÚ‹xt] + 
bb_co¡
 + 
d–ay
;

1701 
bb
->
Ï‹¡_Ï‹ncy
[
cÚ‹xt
] = 
Ï‹ncy
;

1704 #ifdeà
_PRINT


1706 if(
d–ay
 > 
¦Ù_Ën
 * (
ncÜe
 - 1è+ 2 * 
MISS_PENALTY
)

1708 
	`årštf
(
¡dout
, "Bu d–ayƒxûeded maximum†im™ (%Lu)\n", 
d–ay
);

1711  
d–ay
;

1712 
	}
}

1715 
	$´•roûss_Úe_loİ
(
loİ
* 
Í
, 
´oûdu»
* 
´oc
, 
uÎ
 
¡¬t_time
)

1717 
i
,
j
,
k
;

1718 
block
* 
bb
;

1719 
loİ
* 
šÍ
 = 
NULL
;

1720 
CHMC
* 
cur_chmc
;

1721 
CHMC
* 
cur_chmc_L2
;

1722 
š¡r
* 
š¡
;

1723 
ušt
 
bb_co¡
 = 0;

1724 
ušt
 
Ï‹ncy
 = 0;

1725 
ušt
 
Íbound
;

1726 
ušt
 
max_fš
[64] = {0};

1729 if(
Í
->
wût_İt
[0])

1732 #ifdeà
_NPRINT


1733 
	`årštf
(
¡dout
, "Vis™šg†oİ = %d.%d.0x%x\n", 
Í
->
pid
,Í->
Íid
,()lp);

1737 
Íbound
 = 
Í
->
loİex™
 ?†p->
loİbound
 : (lp->loopbound + 1);

1742 
i
 = 
Í
->
num_tİo
 - 1; i >= 0; i--)

1744 
bb
 = 
Í
->
tİo
[
i
];

1746 
	`as£¹
(
bb
);

1748 
bb_co¡
 = 0;

1749 
	`mem£t
(
max_fš
, 0, 64);

1752 
j
 = 0; j < 
bb
->
num_chmc
; j++)

1754 
cur_chmc
 = (
CHMC
 *)
bb
->
chmc
[
j
];

1755 
cur_chmc_L2
 = (
CHMC
 *)
bb
->
chmc_L2
[
j
];

1757 
bb
->
¡¬t_İt
[
j
] = 0;

1758 
bb
->
fš_İt
[
j
] = 0;

1759 
bb_co¡
 = 0;

1763 if((
šÍ
 = 
	`check_loİ
(
bb
, 
´oc
)è&& 
i
 !ğ
Í
->
num_tİo
 - 1)

1766 
	`£t_¡¬t_time_İt
(
bb
, 
´oc
, 
j
);

1767 
	`´•roûss_Úe_loİ
(
šÍ
, 
´oc
, 
bb
->
¡¬t_İt
[
j
]);

1768 
bb
->
fš_İt
[
j
] = bb->
¡¬t_İt
[j] + 
šÍ
->
wût_İt
[2*j] +

1769 
šÍ
->
wût_İt
[2*
j
+1] * iÆp->
loİbound
;

1773 if(
i
 =ğ
Í
->
num_tİo
 - 1)

1774 
bb
->
¡¬t_İt
[
j
] = 
¡¬t_time
;

1776 
	`£t_¡¬t_time_İt
(
bb
, 
´oc
, 
j
);

1777 #ifdeà
_NPRINT


1778 
	`årštf
(
¡dout
, "Cu¼’ˆCHMC = 0x%x\n", ()
cur_chmc
);

1779 
	`årštf
(
¡dout
, "Cu¼’ˆCHMC L2 = 0x%x\n", ()
cur_chmc_L2
);

1781 
k
 = 0; k < 
bb
->
num_š¡r
; k++)

1783 
š¡
 = 
bb
->
š¡¾i¡
[
k
];

1785 
	`as£¹
(
š¡
);

1787 #ifdeà
_NPRINT


1788 if(
cur_chmc
->
h™miss_addr
[
k
] !ğ
ALWAYS_HIT
)

1789 
	`årštf
(
¡dout
, "L1 mis © 0x%x\n", ()
bb
->
¡¬ddr
);

1793 if(
cur_chmc
->
h™miss_addr
[
k
] =ğ
ALWAYS_HIT
)

1795 
bb_co¡
 +ğ
L1_HIT_LATENCY
;

1798 ià(
cur_chmc_L2
->
h™miss_addr
[
k
] =ğ
ALWAYS_HIT
)

1801 
Ï‹ncy
 = 
	`d‘”mše_Ï‹ncy
(
bb
, 
j
, 
bb_co¡
, 
L2_HIT
);

1802 #ifdeà
_NPRINT


1803 
	`årštf
(
¡dout
, "L©’cy = %u\n", 
Ï‹ncy
);

1805 
bb_co¡
 +ğ
Ï‹ncy
;

1811 
Ï‹ncy
 = 
	`d‘”mše_Ï‹ncy
(
bb
, 
j
, 
bb_co¡
, 
L2_MISS
);

1812 #ifdeà
_NPRINT


1813 
	`årštf
(
¡dout
, "L©’cy = %u\n", 
Ï‹ncy
);

1815 
bb_co¡
 +ğ
Ï‹ncy
;

1818 if(
	`IS_CALL
(
š¡
->
İ
))

1820 
´oûdu»
* 
ÿÎ“
 = 
	`g‘C®Ëe
(
š¡
, 
´oc
);

1823 if(
ÿÎ“
)

1828 
	`compu‹WCET_´oc
(
ÿÎ“
, 
bb
->
¡¬t_İt
[
j
] + 
bb_co¡
);

1830 
bb_co¡
 +ğ
ÿÎ“
->
ruÂšg_co¡
;

1835 
bb
->
fš_İt
[
j
] = bb->
¡¬t_İt
[j] + 
bb_co¡
;

1837 if(
max_fš
[
j
] < 
bb
->
fš_İt
[j])

1838 
max_fš
[
j
] = 
bb
->
fš_İt
[j];

1841 
j
 = 0; j < 
Í
->
loİh—d
->
num_chmc
; j++)

1843 
Í
->
wût_İt
[
j
] = (
max_fš
[j] - 1);

1844 #ifdeà
_NPRINT


1845 
	`årštf
(
¡dout
, "WCET oàloİ (%d.%d.0x%x)[%d] = %Lu\n", 
Í
->
pid
,†p->
Íid
,

1846 ()
Í
, 
j
,†p->
wût_İt
[j]);

1849 
	}
}

1852 
	$´•roûss_®l_loİs
(
´oûdu»
* 
´oc
)

1854 
i
;

1858 
i
 = 
´oc
->
num_loİs
 - 1; i >= 0; i--)

1862 if(
´oc
->
loİs
[
i
]->
Ëv–
 == 0)

1863 
	`´•roûss_Úe_loİ
(
´oc
->
loİs
[
i
],…roc, 1);

1865 
	}
}

1870 
	$compu‹WCET_loİ
(
loİ
* 
Í
, 
´oûdu»
* 
´oc
)

1872 
i
, 
Íbound
;

1873 
j
;

1874 
block
* 
bb
;

1876 #ifdeà
_DEBUG


1877 
	`årštf
(
¡dout
, "Vis™šg†oİ = (%d.%x)\n", 
Í
->
Íid
, ()lp);

1881 
Íbound
 = 
Í
->
loİex™
 ?†p->
loİbound
 : (lp->loopbound + 1);

1885 
i
 = 0; i < 
Íbound
; i++)

1888 if(
i
 == 0)

1889 
cur_cÚ‹xt
 *= 2;

1890 ià(
i
 == 1)

1891 
cur_cÚ‹xt
 = cur_context + 1;

1894 
j
 = 
Í
->
num_tİo
 - 1; j >= 0; j--)

1896 
bb
 = 
Í
->
tİo
[
j
];

1897 
	`as£¹
(
bb
);

1903 if(
bb
->
bbid
 =ğ
Í
->
loİh—d
->bbid && 
i
 == 0)

1904 
	`£t_¡¬t_time
(
bb
, 
´oc
);

1905 if(
bb
->
bbid
 =ğ
Í
->
loİh—d
->bbid)

1907 
	`as£¹
(
Í
->
loİsšk
);

1908 
bb
->
¡¬t_time
 = (bb->¡¬t_tim< 
Í
->
loİsšk
->
fšish_time
)

1909 ? 
Í
->
loİsšk
->
fšish_time


1910 : 
bb
->
¡¬t_time
;

1911 #ifdeà
_DEBUG


1912 
	`´štf
("S‘tšg†oİ %d fšishimğ%Lu\n", 
Í
->
Íid
,

1913 
Í
->
loİsšk
->
fšish_time
);

1917 
	`£t_¡¬t_time
(
bb
, 
´oc
);

1918 
	`compu‹WCET_block
(
bb
, 
´oc
, 
Í
);

1922 
cur_cÚ‹xt
 /= 2;

1923 
	}
}

1926 
	$compu‹WCET_block
(
block
* 
bb
, 
´oûdu»
* 
´oc
, 
loİ
* 
cur_Í
)

1928 
i
;

1929 
loİ
* 
šÍ
;

1930 
š¡r
* 
š¡
;

1931 
ušt
 
acc_co¡
 = 0;

1932 
acc_ty³
 
acc_t
;

1933 
´oûdu»
* 
ÿÎ“
;

1935 #ifdeà
_DEBUG


1936 
	`årštf
(
¡dout
, "Vis™šg block = (%d.%x)\n", 
bb
->
bbid
, ()bb);

1943 if((
šÍ
 = 
	`check_loİ
(
bb
,
´oc
)è&& (!
cur_Í
 || (šÍ->
Íid
 != cur_lp->lpid)))

1945 if(!
g_İtimized
)

1946 
	`compu‹WCET_loİ
(
šÍ
, 
´oc
);

1950 
bb
->
fšish_time
 = bb->
¡¬t_time
 + 
šÍ
->
wût_İt
[0] +

1951 
šÍ
->
wût_İt
[1] * iÆp->
loİbound
;

1959 
i
 = 0; i < 
bb
->
num_š¡r
; i++)

1961 
š¡
 = 
bb
->
š¡¾i¡
[
i
];

1962 
	`as£¹
(
š¡
);

1965 if(
	`IS_CALL
(
š¡
->
İ
))

1967 
ÿÎ“
 = 
	`g‘C®Ëe
(
š¡
, 
´oc
);

1970 if(
ÿÎ“
)

1975 
	`compu‹WCET_´oc
(
ÿÎ“
, 
bb
->
¡¬t_time
 + 
acc_co¡
);

1977 
acc_co¡
 +ğ(
ÿÎ“
->
ruÂšg_co¡
 + 1);

1983 
®l_š¡
++;

1985 if((
acc_t
 = 
	`check_h™_miss
(
bb
, 
š¡
)è=ğ
L1_HIT
)

1986 
acc_co¡
 +ğ(
L1_HIT_LATENCY
);

1989 ià(
acc_t
 =ğ
L2_HIT
) {

1990 if(
g_sh¬ed_bus
)

1991 
acc_co¡
 +ğ
	`compu‹_bus_d–ay
(
bb
->
¡¬t_time
 +‡cc_co¡, 
ncÜe
, 
L2_HIT
);

1993 
acc_co¡
 +ğ(
L2_HIT_LATENCY
 + 1);

2003 if(
g_sh¬ed_bus
)

2004 
acc_co¡
 +ğ
	`compu‹_bus_d–ay
(
bb
->
¡¬t_time
 +‡cc_co¡, 
ncÜe
, 
L2_MISS
);

2006 
acc_co¡
 +ğ(
MISS_PENALTY
 + 1);

2012 
bb
->
fšish_time
 = bb->
¡¬t_time
 + 
acc_co¡
;

2014 #ifdeà
_DEBUG


2015 
	`´štf
("S‘tšg block %d fšishimğ%Lu\n", 
bb
->
bbid
,

2016 
bb
->
fšish_time
);

2018 
	}
}

2020 
	$compu‹WCET_´oc
(
´oûdu»
* 
´oc
, 
uÎ
 
¡¬t_time
)

2022 
i
,
j
;

2023 
block
* 
bb
;

2024 
loİ
* 
Í
;

2025 
uÎ
 
max_f_time
 = 0;

2029 
cur_cÚ‹xt
 = 0;

2033 
	`´•roûss_chmc
(
´oc
);

2037 
	`´•roûss_chmc_L2
(
´oc
);

2041 
	`´•roûss_®l_loİs
(
´oc
);

2044 
	`»£t_time¡amps
(
´oc
, 
¡¬t_time
);

2046 #ifdeà
_DEBUG


2047 
	`dump_´e_´oc_chmc
(
´oc
);

2052 
i
 = 
´oc
->
num_tİo
 - 1; i >= 0; i--)

2054 
bb
 = 
´oc
->
tİo
[
i
];

2055 
	`as£¹
(
bb
);

2059 if(
i
 =ğ
´oc
->
num_tİo
 - 1)

2060 
bb
->
¡¬t_time
 = start_time;

2062 
	`£t_¡¬t_time
(
bb
, 
´oc
);

2063 
	`compu‹WCET_block
(
bb
, 
´oc
, 
NULL
);

2066 #ifdeà
_DEBUG


2067 
	`dump_´og_šfo
(
´oc
);

2071 
i
 = 0; i < 
´oc
->
num_tİo
; i++)

2073 
	`as£¹
(
´oc
->
tİo
[
i
]);

2074 if(
´oc
->
tİo
[
i
]->
num_outgošg
 > 0)

2076 if(
max_f_time
 < 
´oc
->
tİo
[
i
]->
fšish_time
)

2077 
max_f_time
 = 
´oc
->
tİo
[
i
]->
fšish_time
;

2080 
´oc
->
ruÂšg_fšish_time
 = 
max_f_time
;

2081 
´oc
->
ruÂšg_co¡
 = 
max_f_time
 - 
¡¬t_time
;

2082 #ifdeà
_DEBUG


2083 
	`årštf
(
¡dout
, "Set worst case cost ofhe…rocedure %d = %Lu\n",

2084 
´oc
->
pid
,…roc->
ruÂšg_co¡
);

2086 
	}
}

2091 
	$compu‹WCET
(
uÎ
 
¡¬t_time
)

2093 
tİ_func
;

2094 
id
;

2096 
acc_bus_d–ay
 = 0;

2097 
cur_sk
 = 
NULL
;

2101 
	`as£¹
(
´oc_cg
);

2102 
id
 = 
num_´ocs
 - 1;

2104 
id
 >= 0)

2106 
tİ_func
 = 
´oc_cg
[
id
];

2108 if(
tİ_func
 >ğ0 &&İ_funø<ğ
num_´ocs
 - 1)

2110 
id
--;

2112 
	`compu‹WCET_´oc
(
´ocs
[
tİ_func
], 
¡¬t_time
);

2114 #ifdeà
_PRINT


2115 
	`årštf
(
¡dout
, "\n\n**************************************************************\n");

2116 
	`årštf
(
¡dout
, "L©e¡ s¹imoàth´og¿m = %Lu s¹_time\n", 
¡¬t_time
);

2117 
	`årštf
(
¡dout
, "Latest finishime ofhe…rogram = %Lu cycles\n",

2118 
´ocs
[
tİ_func
]->
ruÂšg_fšish_time
);

2119 if(
g_sh¬ed_bus
)

2120 
	`årštf
(
¡dout
, "WCET ofhe…rogram with shared bus = %Lu cycles\n",

2121 
´ocs
[
tİ_func
]->
ruÂšg_co¡
);

2123 
	`årštf
(
¡dout
, "WCET ofhe…rogram without shared bus = %Lu cycles\n",

2124 
´ocs
[
tİ_func
]->
ruÂšg_co¡
);

2125 
	`årštf
(
¡dout
, "**************************************************************\n\n");

2127 
	}
}

2132 
	$compu‹BCET
(
uÎ
 
¡¬t_time
)

2134 
tİ_func
;

2135 
id
;

2137 
acc_bus_d–ay
 = 0;

2138 
cur_sk
 = 
NULL
;

2142 
	`as£¹
(
´oc_cg
);

2143 
id
 = 
num_´ocs
 - 1;

2145 
id
 >= 0)

2147 
tİ_func
 = 
´oc_cg
[
id
];

2149 if(
tİ_func
 >ğ0 &&İ_funø<ğ
num_´ocs
 - 1)

2151 
id
--;

2153 
	`compu‹BCET_´oc
(
´ocs
[
tİ_func
], 
¡¬t_time
);

2155 #ifdeà
_PRINT


2156 
	`årštf
(
¡dout
, "\n\n**************************************************************\n");

2157 
	`årštf
(
¡dout
, "E¬l›¡ s¹imoàth´og¿m = %Lu s¹_time\n", 
¡¬t_time
);

2158 
	`årštf
(
¡dout
, "Earliest finishime ofhe…rogram = %Lu cycles\n",

2159 
´ocs
[
tİ_func
]->
ruÂšg_fšish_time
);

2160 if(
g_sh¬ed_bus
)

2161 
	`årštf
(
¡dout
, "BCET ofhe…rogram with shared bus = %Lu cycles\n",

2162 
´ocs
[
tİ_func
]->
ruÂšg_co¡
);

2164 
	`årštf
(
¡dout
, "BCET ofhe…rogram without shared bus = %Lu cycles\n",

2165 
´ocs
[
tİ_func
]->
ruÂšg_co¡
);

2166 
	`årštf
(
¡dout
, "**************************************************************\n\n");

2168 
	}
}

2174 
	$upd©e_succ_Ï‹¡_time
(
MSC
* 
msc
, 
sk_t
* 
sk
)

2176 
i
;

2177 
ušt
 
sid
;

2179 #ifdeà
_DEBUG


2180 
	`årštf
(
¡dout
, "Numb” oàSucûssÜ ğ%d\n", 
sk
->
numSuccs
);

2182 
i
 = 0; i < 
sk
->
numSuccs
; i++)

2184 #ifdeà
_DEBUG


2185 
	`årštf
(
¡dout
, "SucûssÜ id w™h %d found\n", 
sk
->
succLi¡
[
i
]);

2187 
sid
 = 
sk
->
succLi¡
[
i
];

2188 if(
msc
->
skLi¡
[
sid
].
l_¡¬t
 < (
sk
->l_¡¬ˆ+ask->
wût
))

2189 
msc
->
skLi¡
[
sid
].
l_¡¬t
 = 
sk
->l_¡¬ˆ+ask->
wût
;

2190 #ifdeà
_DEBUG


2191 
	`årštf
(
¡dout
, "Updating†atest startime of successor = %Lu\n",

2192 
msc
->
skLi¡
[
sid
].
l_¡¬t
);

2195 
	}
}

2200 
ušt
 
	$g‘_cÜe
(
sk_t
* 
cur_sk
)

2205 
	}
}

2211 
uÎ
 
	$g‘_Ï‹¡_¡¬t_time
(
sk_t
* 
cur_sk
, 
ušt
 
cÜe
)

2213 
uÎ
 
¡¬t
;

2216 if(
g_šd•’d’t_sk
)

2225 if(
cur_sk
->
l_¡¬t
 > 
Ï‹¡
[
cÜe
])

2226 
¡¬t
 = 
cur_sk
->
l_¡¬t
;

2228 
¡¬t
 = 
Ï‹¡
[
cÜe
];

2229 #ifdeà
_DEBUG


2230 
	`årštf
(
¡dout
, "AssignšghÏ‹¡ s¹šgimoàthsk = %Lu\n", 
¡¬t
);

2233  
¡¬t
;

2234 
	}
}

2238 
	$»£t_®l_sk
(
MSC
* 
msc
)

2240 
k
;

2242 
	`as£¹
(
msc
);

2243 
k
 = 0; k < 
msc
->
num_sk
; k++)

2245 
msc
->
skLi¡
[
k
].
l_¡¬t
 = 0;

2247 
	}
}

2251 
	$compu‹_bus_WCET_MSC
(
MSC
 *
msc
) {

2252 
i
, 
j
, 
k
;

2253 
uÎ
 
¡¬t_time
 = 0;

2254 
´oûdu»
* 
´oc
;

2257 
	`£tScheduË
("TDMA_bus_sched_4.db");

2260 
	`mem£t
(
Ï‹¡
, 0, 
num_cÜe
 * (
uÎ
));

2262 
	`»£t_®l_sk
(
msc
);

2264 
k
 = 0; k < 
msc
->
num_sk
; k++)

2266 
acc_bus_d–ay
 = 0;

2268 #ifdeà
_PRINT


2269 
	`årštf
(
¡dout
, "AÇlyzšg Task WCET %s......\n", 
msc
->
skLi¡
[
k
].
sk_Çme
);

2270 
	`fæush
(
¡dout
);

2272 
®l_š¡
 = 0;

2273 
cur_sk
 = &(
msc
->
skLi¡
[
k
]);

2274 
´oc
 = 
msc
->
skLi¡
[
k
].
maš_cİy
;

2276 
ncÜe
 = 
	`g‘_cÜe
(
cur_sk
);

2280 
¡¬t_time
 = 
	`g‘_Ï‹¡_¡¬t_time
(
cur_sk
, 
ncÜe
);

2281 
	`compu‹WCET_´oc
(
´oc
, 
¡¬t_time
);

2283 
msc
->
skLi¡
[
k
].
wût
 = msc->skLi¡[k].
maš_cİy
->
ruÂšg_co¡
;

2285 
Ï‹¡
[
ncÜe
] = 
¡¬t_time
 + 
msc
->
skLi¡
[
k
].
wût
;

2291 
	`upd©e_succ_Ï‹¡_time
(
msc
, 
cur_sk
);

2292 #ifdeà
_PRINT


2293 
	`årštf
(
¡dout
, "\n\n**************************************************************\n");

2294 
	`årštf
(
¡dout
, "L©e¡ s¹imoàth´og¿m = %Lu s¹_time\n", 
¡¬t_time
);

2295 
	`årštf
(
¡dout
, "Latest finishime ofheask = %Lu cycles\n",

2296 
´oc
->
ruÂšg_fšish_time
);

2297 if(
g_sh¬ed_bus
)

2298 
	`årštf
(
¡dout
, "WCET ofheask with shared bus = %Lu cycles\n",

2299 
´oc
->
ruÂšg_co¡
);

2301 
	`årštf
(
¡dout
, "WCET ofheask without shared bus = %Lu cycles\n",

2302 
´oc
->
ruÂšg_co¡
);

2303 
	`årštf
(
¡dout
, "TÙ® in¡ruùiÚ‡Çlyzed = %Lu \n", 
®l_š¡
);

2304 
	`årštf
(
¡dout
, "**************************************************************\n\n");

2305 
	`fæush
(
¡dout
);

2309 
	}
}

2328 
	$şassify_š¡_L2_BCET
(
š¡r
* 
š¡
, 
CHMC
** 
chmc_l2
, 
n_chmc_l2
,

2329 
š¡_id
)

2331 
i
, 
j
;

2332 
ušt
 
addr
 = 
	`g‘_hex
(
š¡
->addr);

2334 if(!
n_chmc_l2
)

2338 if(!
š¡
->
acc_t_l2
)

2339 
š¡
->
acc_t_l2
 = (
acc_ty³
 *)
	`m®loc
(
n_chmc_l2
 * (acc_type));

2340 if(!
š¡
->
acc_t_l2
)

2341 
	`´”r
("Error: Out of memory");

2343 
	`mem£t
(
š¡
->
acc_t_l2
, 0, 
n_chmc_l2
 * (
acc_ty³
));

2345 
i
 = 0; i < 
n_chmc_l2
; i++)

2347 
	`as£¹
(
chmc_l2
[
i
]);

2351 if((
chmc_l2
[
i
]->
h™miss_addr
[
š¡_id
] !ğ
ALWAYS_MISS
)

2352 && 
š¡
->
acc_t
[
i
] !ğ
L1_HIT
)

2354 
š¡
->
acc_t_l2
[
i
] = 
L2_HIT
;

2369 
	}
}

2372 
	$şassify_š¡_BCET
(
š¡r
* 
š¡
, 
CHMC
** 
chmc
, 
n_chmc
, 
š¡_id
)

2374 
i
, 
j
;

2375 
ušt
 
addr
 = 
	`g‘_hex
(
š¡
->addr);

2377 if(!
n_chmc
)

2381 if(!
š¡
->
acc_t
)

2382 
š¡
->
acc_t
 = (
acc_ty³
 *)
	`m®loc
(
n_chmc
 * (acc_type));

2383 if(!
š¡
->
acc_t
)

2384 
	`´”r
("Error: Out of memory");

2386 
	`mem£t
(
š¡
->
acc_t
, 0, 
n_chmc
 * (
acc_ty³
));

2388 
i
 = 0; i < 
n_chmc
; i++)

2390 
	`as£¹
(
chmc
[
i
]);

2393 if(
chmc
[
i
]->
h™miss_addr
[
š¡_id
] !ğ
ALWAYS_MISS
)

2395 
š¡
->
acc_t
[
i
] = 
L1_HIT
;

2408 
	}
}

2412 
	$´•roûss_chmc_L2_BCET
(
´oûdu»
* 
´oc
)

2414 
i
,
j
;

2415 
block
* 
bb
;

2416 
š¡r
* 
š¡
;

2418 
i
 = 0; i < 
´oc
->
num_bb
; i++)

2420 
bb
 = 
´oc
->
bbli¡
[
i
];

2422 
j
 = 0; j < 
bb
->
num_š¡r
; j++)

2424 
š¡
 = 
bb
->
š¡¾i¡
[
j
];

2425 
	`şassify_š¡_L2_BCET
(
š¡
, 
bb
->
chmc_L2
, bb->
num_chmc_L2
, 
j
);

2428 
	}
}

2431 
	$´•roûss_chmc_BCET
(
´oûdu»
* 
´oc
)

2433 
i
,
j
;

2434 
block
* 
bb
;

2435 
š¡r
* 
š¡
;

2437 
i
 = 0; i < 
´oc
->
num_bb
; i++)

2439 
bb
 = 
´oc
->
bbli¡
[
i
];

2441 
j
 = 0; j < 
bb
->
num_š¡r
; j++)

2443 
š¡
 = 
bb
->
š¡¾i¡
[
j
];

2444 
	`şassify_š¡_BCET
(
š¡
, 
bb
->
chmc
, bb->
num_chmc
, 
j
);

2447 
	}
}

2451 
	$£t_¡¬t_time_BCET
(
block
* 
bb
, 
´oûdu»
* 
´oc
)

2453 
i
, 
š_šdex
;

2454 
uÎ
 
mš_¡¬t
;

2457 
	`as£¹
(
bb
);

2459 
i
 = 0; i < 
bb
->
num_šcomšg
; i++)

2461 
š_šdex
 = 
bb
->
šcomšg
[
i
];

2462 
	`as£¹
(
´oc
->
bbli¡
[
š_šdex
]);

2463 if(
i
 == 0)

2464 
mš_¡¬t
 = 
´oc
->
bbli¡
[
š_šdex
]->
fšish_time
;

2466 if(
mš_¡¬t
 > 
´oc
->
bbli¡
[
š_šdex
]->
fšish_time
)

2467 
mš_¡¬t
 = 
´oc
->
bbli¡
[
š_šdex
]->
fšish_time
;

2472 
bb
->
¡¬t_time
 = 
mš_¡¬t
;

2474 #ifdeà
_DEBUG


2475 
	`´štf
("S‘tšg mš s¹ oàbb %d = %Lu\n", 
bb
->
bbid
, 
mš_¡¬t
);

2477 
	}
}

2481 
	$compu‹BCET_loİ
(
loİ
* 
Í
, 
´oûdu»
* 
´oc
)

2483 
i
, 
Íbound
;

2484 
j
;

2485 
block
* 
bb
;

2487 #ifdeà
_DEBUG


2488 
	`årštf
(
¡dout
, "Vis™šg†oİ = (%d.%x)\n", 
Í
->
Íid
, ()lp);

2491 
Íbound
 = 
Í
->
loİbound
;

2495 
i
 = 0; i < 
Íbound
; i++)

2498 if(
i
 == 0)

2499 
cur_cÚ‹xt
 *= 2;

2500 ià(
i
 == 1)

2501 
cur_cÚ‹xt
 = cur_context + 1;

2504 
j
 = 
Í
->
num_tİo
 - 1; j >= 0; j--)

2506 
bb
 = 
Í
->
tİo
[
j
];

2507 
	`as£¹
(
bb
);

2513 if(
bb
->
bbid
 =ğ
Í
->
loİh—d
->bbid && 
i
 == 0)

2514 
	`£t_¡¬t_time_BCET
(
bb
, 
´oc
);

2515 if(
bb
->
bbid
 =ğ
Í
->
loİh—d
->bbid)

2517 
	`as£¹
(
Í
->
loİsšk
);

2518 
bb
->
¡¬t_time
 = (bb->¡¬t_tim< 
Í
->
loİsšk
->
fšish_time
)

2519 ? 
Í
->
loİsšk
->
fšish_time


2520 : 
bb
->
¡¬t_time
;

2521 #ifdeà
_DEBUG


2522 
	`´štf
("S‘tšg†oİ %d fšishimğ%Lu\n", 
Í
->
Íid
,

2523 
Í
->
loİsšk
->
fšish_time
);

2527 
	`£t_¡¬t_time_BCET
(
bb
, 
´oc
);

2528 
	`compu‹BCET_block
(
bb
, 
´oc
, 
Í
);

2532 
cur_cÚ‹xt
 /= 2;

2533 
	}
}

2536 
	$compu‹BCET_block
(
block
* 
bb
, 
´oûdu»
* 
´oc
, 
loİ
* 
cur_Í
)

2538 
i
;

2539 
loİ
* 
šÍ
;

2540 
š¡r
* 
š¡
;

2541 
ušt
 
acc_co¡
 = 0;

2542 
acc_ty³
 
acc_t
;

2543 
´oûdu»
* 
ÿÎ“
;

2545 #ifdeà
_DEBUG


2546 
	`årštf
(
¡dout
, "Vis™šg block = (%d.%x)\n", 
bb
->
bbid
, ()bb);

2553 if((
šÍ
 = 
	`check_loİ
(
bb
,
´oc
)è&& (!
cur_Í
 || (šÍ->
Íid
 != cur_lp->lpid)))

2554 
	`compu‹BCET_loİ
(
šÍ
, 
´oc
);

2560 
i
 = 0; i < 
bb
->
num_š¡r
; i++)

2562 
š¡
 = 
bb
->
š¡¾i¡
[
i
];

2563 
	`as£¹
(
š¡
);

2566 if(
	`IS_CALL
(
š¡
->
İ
))

2568 
ÿÎ“
 = 
	`g‘C®Ëe
(
š¡
, 
´oc
);

2571 if(
ÿÎ“
)

2576 
	`compu‹BCET_´oc
(
ÿÎ“
, 
bb
->
¡¬t_time
 + 
acc_co¡
);

2577 
acc_co¡
 +ğ
ÿÎ“
->
ruÂšg_co¡
;

2584 if((
acc_t
 = 
	`check_h™_miss
(
bb
, 
š¡
)è=ğ
L1_HIT
)

2585 
acc_co¡
 +ğ
L1_HIT_LATENCY
;

2588 ià(
acc_t
 =ğ
L2_HIT
) {

2589 if(
g_sh¬ed_bus
)

2590 
acc_co¡
 +ğ
	`compu‹_bus_d–ay
(
bb
->
¡¬t_time
 +‡cc_co¡, 
ncÜe
, 
L2_HIT
);

2592 
acc_co¡
 +ğ(
L2_HIT_LATENCY
 + 1);

2602 if(
g_sh¬ed_bus
)

2603 
acc_co¡
 +ğ
	`compu‹_bus_d–ay
(
bb
->
¡¬t_time
 +‡cc_co¡, 
ncÜe
, 
L2_MISS
);

2605 
acc_co¡
 +ğ(
MISS_PENALTY
 + 1);

2611 
bb
->
fšish_time
 = bb->
¡¬t_time
 + 
acc_co¡
;

2613 #ifdeà
_DEBUG


2614 
	`´štf
("S‘tšg block %d fšishimğ%Lu\n", 
bb
->
bbid
,

2615 
bb
->
fšish_time
);

2617 
	}
}

2619 
	$compu‹BCET_´oc
(
´oûdu»
* 
´oc
, 
uÎ
 
¡¬t_time
)

2621 
i
,
j
;

2622 
block
* 
bb
;

2623 
loİ
* 
Í
;

2624 
uÎ
 
mš_f_time
;

2628 
cur_cÚ‹xt
 = 0;

2632 
	`´•roûss_chmc_BCET
(
´oc
);

2636 
	`´•roûss_chmc_L2_BCET
(
´oc
);

2639 
	`»£t_time¡amps
(
´oc
, 
¡¬t_time
);

2641 #ifdeà
_DEBUG


2642 
	`dump_´e_´oc_chmc
(
´oc
);

2647 
i
 = 
´oc
->
num_tİo
 - 1; i >= 0; i--)

2649 
bb
 = 
´oc
->
tİo
[
i
];

2650 
	`as£¹
(
bb
);

2654 if(
i
 =ğ
´oc
->
num_tİo
 - 1)

2655 
bb
->
¡¬t_time
 = start_time;

2657 
	`£t_¡¬t_time_BCET
(
bb
, 
´oc
);

2658 
	`compu‹BCET_block
(
bb
, 
´oc
, 
NULL
);

2661 #ifdeà
_DEBUG


2662 
	`dump_´og_šfo
(
´oc
);

2666 
i
 = 0; i < 
´oc
->
num_tİo
; i++)

2668 
	`as£¹
(
´oc
->
tİo
[
i
]);

2669 if(
´oc
->
tİo
[
i
]->
num_outgošg
 > 0)

2671 if(
i
 == 0)

2672 
mš_f_time
 = 
´oc
->
tİo
[
i
]->
fšish_time
;

2673 if(
mš_f_time
 > 
´oc
->
tİo
[
i
]->
fšish_time
)

2674 
mš_f_time
 = 
´oc
->
tİo
[
i
]->
fšish_time
;

2677 
´oc
->
ruÂšg_fšish_time
 = 
mš_f_time
;

2678 
´oc
->
ruÂšg_co¡
 = 
mš_f_time
 - 
¡¬t_time
;

2680 #ifdeà
_DEBUG


2681 
	`årštf
(
¡dout
, "Set best case cost ofhe…rocedure %d = %Lu\n",

2682 
´oc
->
pid
,…roc->
ruÂšg_co¡
);

2684 
	}
}

2690 
	$upd©e_succ_—¾›¡_time
(
MSC
* 
msc
, 
sk_t
* 
sk
)

2692 
i
;

2693 
ušt
 
sid
;

2695 #ifdeà
_DEBUG


2696 
	`årštf
(
¡dout
, "Numb” oàSucûssÜ ğ%d\n", 
sk
->
numSuccs
);

2698 
i
 = 0; i < 
sk
->
numSuccs
; i++)

2700 #ifdeà
_DEBUG


2701 
	`årštf
(
¡dout
, "SucûssÜ id w™h %d found\n", 
sk
->
succLi¡
[
i
]);

2703 
sid
 = 
sk
->
succLi¡
[
i
];

2704 
msc
->
skLi¡
[
sid
].
l_¡¬t
 = 
sk
->l_¡¬ˆ+ask->
bût
;

2705 #ifdeà
_DEBUG


2706 
	`årštf
(
¡dout
, "Updatingƒarliest startime of successor = %Lu\n",

2707 
msc
->
skLi¡
[
sid
].
l_¡¬t
);

2710 
	}
}

2716 
uÎ
 
	$g‘_—¾›¡_¡¬t_time
(
sk_t
* 
cur_sk
, 
ušt
 
cÜe
)

2718 
uÎ
 
¡¬t
;

2726 if(
cur_sk
->
l_¡¬t
 > 
Ï‹¡
[
cÜe
])

2727 
¡¬t
 = 
cur_sk
->
l_¡¬t
;

2729 
¡¬t
 = 
Ï‹¡
[
cÜe
];

2730 #ifdeà
_DEBUG


2731 
	`årštf
(
¡dout
, "AssignšghÏ‹¡ s¹šgimoàthsk = %Lu\n", 
¡¬t
);

2734  
¡¬t
;

2735 
	}
}

2739 
	$compu‹_bus_BCET_MSC
(
MSC
 *
msc
) {

2740 
i
, 
j
, 
k
;

2741 
uÎ
 
¡¬t_time
 = 0;

2742 
´oûdu»
* 
´oc
;

2745 
	`£tScheduË
("TDMA_bus_sched_4.db");

2748 
	`mem£t
(
Ï‹¡
, 0, 
num_cÜe
 * (
uÎ
));

2750 
	`»£t_®l_sk
(
msc
);

2752 
k
 = 0; k < 
msc
->
num_sk
; k++)

2754 
acc_bus_d–ay
 = 0;

2757 #ifdeà
_NPRINT


2758 
	`årštf
(
¡dout
, "AÇlyzšg Task BCET %s......\n", 
msc
->
skLi¡
[
k
].
sk_Çme
);

2759 
	`fæush
(
¡dout
);

2761 
cur_sk
 = &(
msc
->
skLi¡
[
k
]);

2762 
´oc
 = 
msc
->
skLi¡
[
k
].
maš_cİy
;

2764 
ncÜe
 = 
	`g‘_cÜe
(
cur_sk
);

2768 
¡¬t_time
 = 
	`g‘_—¾›¡_¡¬t_time
(
cur_sk
, 
ncÜe
);

2769 
	`compu‹BCET_´oc
(
´oc
, 
¡¬t_time
);

2771 
msc
->
skLi¡
[
k
].
bût
 = msc->skLi¡[k].
maš_cİy
->
ruÂšg_co¡
;

2773 
Ï‹¡
[
ncÜe
] = 
¡¬t_time
 + 
msc
->
skLi¡
[
k
].
bût
;

2779 
	`upd©e_succ_—¾›¡_time
(
msc
, 
cur_sk
);

2780 #ifdeà
_PRINT


2781 
	`årštf
(
¡dout
, "\n\n**************************************************************\n");

2782 
	`årštf
(
¡dout
, "E¬l›¡ s¹imoàth´og¿m = %Lu s¹_time\n", 
¡¬t_time
);

2783 
	`årštf
(
¡dout
, "Earliest finishime ofheask = %Lu cycles\n",

2784 
´oc
->
ruÂšg_fšish_time
);

2785 if(
g_sh¬ed_bus
)

2786 
	`årštf
(
¡dout
, "BCET ofheask with shared bus = %Lu cycles\n",

2787 
´oc
->
ruÂšg_co¡
);

2789 
	`årštf
(
¡dout
, "BCET ofheask without shared bus = %Lu cycles\n",

2790 
´oc
->
ruÂšg_co¡
);

2791 
	`årštf
(
¡dout
, "**************************************************************\n\n"); 
	`fæush
(stdout);

2795 
	}
}

	@analysisEnum.c

6 
	$’um_š_£q_bef
Ğ
bbid
, 
rg‘
, 
ushÜt
 *
bb_£q
, ushÜˆ
bb_Ën
 ) {

8 
i
;

10  
i
 = 
bb_Ën
 - 1; i >ğ0 && 
bb_£q
[i] !ğ
rg‘
; i-- )

11 ifĞ
bb_£q
[
i
] =ğ
bbid
 )

14 
	}
}

17 
	$’um_efãùCªûÎed
Ğ
b¿nch
 *
br
, 
assign
 *
assg
, 
ushÜt
 *
bb_£q
, ushÜˆ
Ën
, 
block
 **
bbli¡
, 
num_bb
 ) {

19 
i
, 
Ê
, 
id
;

21  
i
 = 0; i < 
num_bb
; i++ ) {

22 
id
 = 
bbli¡
[
i
]->
bbid
;

24 ifĞ
id
 =ğ
br
->
bb
->
bbid
 || 
	`’um_š_£q_bef
Ğid, br->bb->bbid, 
bb_£q
, 
Ën
 )) {

26  
Ê
 = 0;†À< 
num_assign
[
br
->
bb
->
pid
][
id
];†n++ ) {

27 ifĞ
assg
 !ğ
NULL
 && 
assigÆi¡
[
br
->
bb
->
pid
][
id
][
Ê
] ==‡ssg )

29 ifĞ
	`¡r¡r
Ğ
br
->
d”i_Œ“
, 
assigÆi¡
[br->
bb
->
pid
][
id
][
Ê
]->d”i_Œ“ ) !ğ
NULL
 )

30  
id
;

35 
	}
}

38 
	$’um_fšdB¿nch
Ğ
b¿nch
 *
br
, 
ushÜt
 *
bb_£q
, ushÜˆ
Ën
 ) {

40 
i
;

41  
i
 = 0; i < 
Ën
; i++ )

42 ifĞ
bb_£q
[
i
] =ğ
br
->
bb
->
bbid
 )

43  
i
;

45 
	}
}

48 
	$’um_BBcÚæiùInP©h
Ğ
b¿nch
 *
bru
, 
dœeùiÚ
, 
block
 *
bv
,

49 
ushÜt
 *
bb_£q
, ushÜˆ
Ën
, 
block
 **
bbli¡
, 
num_bb
 ) {

51 
cf
, 
id
, 
idx
;

52 
»s
;

53 
b¿nch
 *
br
;

56  
cf
 = 0; cà< 
bru
->
num_cÚæiùs
; cf++ ) {

57 
br
 = 
bru
->
cÚæiùs
[
cf
];

59 
id
 = 
	`’um_fšdB¿nch
Ğ
br
, 
bb_£q
, 
Ën
 );

60 ifĞ
id
 == -1 )

63 
idx
 = 
	`g‘block
Ğ
bb_£q
[
id
-1], 
bbli¡
, 0, 
num_bb
-1 );

64 ifĞ
idx
 == -1 )

68 
»s
 = 
	`d‘eùDœeùiÚ
Ğ
br
, 
bbli¡
[
idx
] );

69 ifĞ
dœeùiÚ
 =ğ
bru
->
jump_cÚd
 && bru->
cÚæiùdœ_jump
[
cf
] =ğ
»s
 ||

70 
dœeùiÚ
 =ğ
	`Ãg
Ğ
bru
->
jump_cÚd
 ) && bru->
cÚæiùdœ_çÎ
[
cf
] =ğ
»s
 ) {

73 
id
 = 
	`’um_efãùCªûÎed
Ğ
br
, 
NULL
, 
bb_£q
, 
Ën
, 
bbli¡
, 
num_bb
 );

75 ifĞ
id
 == -1 ) {

76 ifĞ
debug
 )

77 
	`´štf
Ğ"BB %d:%d~%d - %d(%d)\n", 
bru
->
bb
->
pid
, bru->bb->
bbid
, 
bv
->bbid, 
br
->bb->bbid, 
»s
 );

80 ifĞ
debug
 )

81 
	`´štf
Ğ"BB %d:%d~%d - %d(%dèÿnûl[%d]\n", 
bru
->
bb
->
pid
, bru->bb->
bbid
, 
bv
->bbid, 
br
->bb->bbid, 
»s
, 
id
 );

85 
	}
}

88 
	$’um_BAcÚæiùInP©h
Ğ
block
 *
bu
, 
ushÜt
 *
bb_£q
, ushÜˆ
Ën
, block **
bbli¡
, 
num_bb
 ) {

90 
cf
, 
Ê
, 
id
, 
idx
;

91 
»s
;

92 
assign
 *
assg
;

93 
b¿nch
 *
br
;

95  
Ê
 = 0;†À< 
num_assign
[
bu
->
pid
][bu->
bbid
];†n++ ) {

96 
assg
 = 
assigÆi¡
[
bu
->
pid
][bu->
bbid
][
Ê
];

98  
cf
 = 0; cà< 
assg
->
num_cÚæiùs
; cf++ ) {

99 
br
 = 
assg
->
cÚæiùs
[
cf
];

101 
id
 = 
	`’um_fšdB¿nch
Ğ
br
, 
bb_£q
, 
Ën
 );

102 ifĞ
id
 == -1 )

105 
idx
 = 
	`g‘block
Ğ
bb_£q
[
id
-1], 
bbli¡
, 0, 
num_bb
-1 );

106 ifĞ
idx
 == -1 )

110 
»s
 = 
	`d‘eùDœeùiÚ
Ğ
br
, 
bbli¡
[
idx
] );

111 ifĞ
assg
->
cÚæiùdœ
[
cf
] =ğ
»s
 ) {

114 
id
 = 
	`’um_efãùCªûÎed
Ğ
br
, 
assg
, 
bb_£q
, 
Ën
, 
bbli¡
, 
num_bb
 );

116 ifĞ
id
 == -1 ) {

117 ifĞ
debug
 )

118 
	`´štf
Ğ"BA %d:%d - %d(%d)\n", 
bu
->
pid
, bu->
bbid
, 
br
->
bb
->bbid, 
»s
 );

121 ifĞ
debug
 )

122 
	`´štf
Ğ"BA %d:%d - %d(%dèÿnûl[%d]\n", 
bu
->
pid
, bu->
bbid
, 
br
->
bb
->bbid, 
»s
, 
id
 );

127 
	}
}

130 
	$ª®y£EnumDAG
Ğ
objty³
, *
obj
 ) {

132 
´oûdu»
 *
p
;

133 
loİ
 *
Í
;

134 
block
 *
bb
;

136 
block
 **
tİo
;

137 
num_tİo
;

139 
i
, 
j
, 
k
, 
m
, 
id
;

140 
num
, 
Ën
;

141 
dœ
, 
ãasibË
;

143 
b¿nch
 *
br
;

145 
uÎ
 *
·thcouÁs
;

146 *
num_šcomšg
;

148 
FILE
 *
åŒ
;

151 ifĞ
objty³
 =ğ
PROC
 ) {

152 
p
 = (
´oûdu»
*è
obj
;

153 
tİo
 = 
p
->topo;

154 
num_tİo
 = 
p
->num_topo;

156 ifĞ
objty³
 =ğ
LOOP
 ) {

157 
Í
 = (
loİ
*è
obj
;

158 
p
 = 
´ocs
[ 
Í
->
pid
 ];

159 
tİo
 = 
Í
->topo;

160 
num_tİo
 = 
Í
->num_topo;

163 
	`´štf
Ğ"Inv®id objty³…as£dØª®ysisDAG: %d\n", 
objty³
 ), 
	`ex™
(1);

165 
·thcouÁs
 = (
uÎ
*è
	`CALLOC
Ğ·thcouÁs, 
p
->
num_bb
, (ull), "pathcounts" );

167 ifĞ
šãas
 ) {

169 
num_šcomšg
 = (*è
	`CALLOC
Ğnum_šcomšg, 
p
->
num_bb
, (), "num_incoming" );

170  
i
 = 0; i < 
p
->
num_bb
; i++ )

171 
num_šcomšg
[
i
] = 0;

173  
i
 = 0; i < 
num_tİo
; i++ ) {

174 
bb
 = 
tİo
[
i
];

175  
j
 = 0; j < 
bb
->
num_outgošg
; j++ )

176 
num_šcomšg
[ 
bb
->
outgošg
[
j
] ]++;

180  
i
 = 0; i < 
num_tİo
; i++ ) {

181 
bb
 = 
tİo
[
i
];

183 ifĞ
šãas
 ) {

184 
’um_·thËn
[
p
->
pid
][
bb
->
bbid
] = 
NULL
;

185 
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
] = 
NULL
;

188 ifĞ!
bb
->
num_outgošg
 ) {

190 
·thcouÁs
[ 
bb
->
bbid
 ] = 1;

192 ifĞ
šãas
 ) {

193 
’um_·thËn
[
p
->
pid
][
bb
->
bbid
] = (
ushÜt
*)

194 
	`MALLOC
Ğ
’um_·thËn
[
p
->
pid
][
bb
->
bbid
], (
ushÜt
), "enum_pathlen[p][b]" );

195 
’um_·thËn
[
p
->
pid
][
bb
->
bbid
][0] = 1;

197 
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
] = (
ushÜt
**)

198 
	`MALLOC
Ğ
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
], (
ushÜt
*), "enum_pathlist[p][b]" );

199 
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
][0] = (
ushÜt
*)

200 
	`MALLOC
Ğ
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
][0], (
ushÜt
), "enum_pathlist[p][b][0]" );

201 
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
][0][0] = bb->bbid;

206  
j
 = 0; j < 
bb
->
num_outgošg
; j++ ) {

208 ifĞ!
šãas
 ) {

209 
·thcouÁs
[ 
bb
->
bbid
 ] +ğ·thcouÁs[ bb->
outgošg
[
j
] ];

212 
id
 = 
	`g‘block
Ğ
bb
->
outgošg
[
j
], 
tİo
, 0, 
i
-1 );

214  
k
 = 0; k < 
·thcouÁs
[ 
bb
->
outgošg
[
j
] ]; k++ ) {

215 
ãasibË
 = 1;

218 
br
 = 
b¿nchli¡
[
p
->
pid
][
bb
->
bbid
];

220 ifĞ
br
 !ğ
NULL
 && 
id
 != -1 ) {

221 ifĞ
j
 == 1 )

222 
dœ
 = 
br
->
jump_cÚd
;

224 
dœ
 = 
	`Ãg
Ğ
br
->
jump_cÚd
 );

226 ifĞ
	`’um_BBcÚæiùInP©h
Ğ
br
, 
dœ
, 
tİo
[
id
], 
’um_·thli¡
[
p
->
pid
][ 
bb
->
outgošg
[
j
] ][
k
],

227 
’um_·thËn
[
p
->
pid
][ 
bb
->
outgošg
[
j
] ][
k
], 
tİo
, 
num_tİo
 ))

228 
ãasibË
 = 0;

230 ifĞ
ãasibË
 ) {

232 ifĞ
	`’um_BAcÚæiùInP©h
Ğ
bb
, 
’um_·thli¡
[
p
->
pid
][ bb->
outgošg
[
j
] ][
k
],

233 
’um_·thËn
[
p
->
pid
][ 
bb
->
outgošg
[
j
] ][
k
], 
tİo
, 
num_tİo
 ))

234 
ãasibË
 = 0;

237 ifĞ
ãasibË
 ) {

238 
·thcouÁs
[ 
bb
->
bbid
 ]++;

240 
num
 = 
·thcouÁs
[ 
bb
->
bbid
 ];

241 
Ën
 = 
’um_·thËn
[
p
->
pid
][ 
bb
->
outgošg
[
j
] ][
k
] + 1;

244 
’um_·thËn
[
p
->
pid
][
bb
->
bbid
] = (
ushÜt
*)

245 
	`REALLOC
Ğ
’um_·thËn
[
p
->
pid
][
bb
->
bbid
], 
num
 * (
ushÜt
), "enum_pathlist[p][b]" );

246 
’um_·thËn
[
p
->
pid
][
bb
->
bbid
][
num
-1] = 
Ën
;

248 
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
] = (
ushÜt
**)

249 
	`REALLOC
Ğ
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
], 
num
 * (
ushÜt
*), "enum_pathlist[p][b]" );

250 
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
][
num
-1] = (
ushÜt
*)

251 
	`MALLOC
Ğ
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
][
num
-1], 
Ën
 * (
ushÜt
), "enum_pathlist[p][b][n]" );

254  
m
 = 0; m < 
Ën
 - 1; m++ )

255 
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
][
num
-1][
m
] =ƒnum_·thli¡[p->pid][ bb->
outgošg
[
j
] ][
k
][m];

258 
’um_·thli¡
[
p
->
pid
][
bb
->
bbid
][
num
-1][
Ën
-1] = bb->bbid;

262 
num_šcomšg
[ 
bb
->
outgošg
[
j
] ]--;

263 ifĞ!
num_šcomšg
[ 
bb
->
outgošg
[
j
] ] ) {

266  
m
 = 0; m < 
·thcouÁs
[ 
bb
->
outgošg
[
j
] ]; m++ )

267 
	`ä“
Ğ
’um_·thli¡
[
p
->
pid
][ 
bb
->
outgošg
[
j
] ][
m
] );

269 
	`ä“
Ğ
’um_·thli¡
[
p
->
pid
][ 
bb
->
outgošg
[
j
] ] );

270 
	`ä“
Ğ
’um_·thËn
[
p
->
pid
][ 
bb
->
outgošg
[
j
] ] );

274 ifĞ
do_šlše
 ) {

277 ifĞ
bb
->
is_loİh—d
 && ( 
objty³
 !ğ
LOOP
 || bb->
loİid
 !ğ
Í
->
Íid
 ))

278 
·thcouÁs
[ 
bb
->
bbid
 ] *ğ
’um_·ths_loİ
[ bb->
loİid
 ];

281 ifĞ
bb
->
ÿÎpid
 != -1 )

282 
·thcouÁs
[ 
bb
->
bbid
 ] *ğ
’um_·ths_´oc
[ bb->
ÿÎpid
 ];

284 
	`´štf
Ğ"·thcouÁ‡ˆ%d-%d: %Lu\n", 
p
->
pid
, 
bb
->
bbid
, 
·thcouÁs
[ bb->bbid ] );

287 ifĞ
objty³
 =ğ
PROC
 )

288 
’um_·ths_´oc
[ 
p
->
pid
 ] = 
·thcouÁs
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

290 ifĞ
objty³
 =ğ
LOOP
 )

291 
’um_·ths_loİ
[ 
Í
->
Íid
 ] = 
·thcouÁs
[ 
tİo
[
num_tİo
-1]->
bbid
 ];

293 ifĞ
šãas
 ) {

295 ifĞ
p
->
pid
 == 1 ) {

296 
åŒ
 = 
	`İ’fe
( "paths", "w" );

297  
i
 = 0; i < 
·thcouÁs
[ 
tİo
[
num_tİo
-1]->
bbid
 ]; i++ ) {

298  
j
 = 
’um_·thËn
[
p
->
pid
][ 
tİo
[
num_tİo
-1]->
bbid
 ][
i
] - 1; j >= 0; j-- )

299 
	`årštf
Ğ
åŒ
, "%d ", 
’um_·thli¡
[
p
->
pid
][ 
tİo
[
num_tİo
-1]->
bbid
 ][
i
][
j
] );

300 
	`årštf
Ğ
åŒ
, "\n" );

305  
j
 = 0; j < 
·thcouÁs
[ 
tİo
[
num_tİo
-1]->
bbid
 ]; j++ )

306 
	`ä“
Ğ
’um_·thli¡
[
p
->
pid
][ 
tİo
[
num_tİo
-1]->
bbid
 ][
j
] );

308 
	`ä“
Ğ
’um_·thli¡
[
p
->
pid
][ 
tİo
[
num_tİo
-1]->
bbid
 ] );

309 
	`ä“
Ğ
’um_·thËn
[
p
->
pid
][ 
tİo
[
num_tİo
-1]->
bbid
 ] );

312 
	`ä“
Ğ
·thcouÁs
 );

315 
	}
}

318 
	$ª®y£EnumProc
Ğ
´oûdu»
 *
p
 ) {

320 
i
;

321 
loİ
 *
Í
;

323 
’um_·ths_loİ
 = (
uÎ
*è
	`CALLOC
Ğ’um_·ths_loİ, 
p
->
num_loİs
, (ull), "enum_paths_loop" );

325 ifĞ
šãas
 ) {

326 
’um_·thli¡
[
p
->
pid
] = (
ushÜt
***)

327 
	`MALLOC
Ğ
’um_·thli¡
[
p
->
pid
],…->
num_bb
 * (
ushÜt
**), "enum_pathlist[p]" );

328 
’um_·thËn
[
p
->
pid
] = (
ushÜt
**)

329 
	`MALLOC
Ğ
’um_·thËn
[
p
->
pid
],…->
num_bb
 * (
ushÜt
*), "enum_pathlen[p]" );

333  
i
 = 
p
->
num_loİs
 - 1; i >= 0; i-- ) {

334 
Í
 = 
p
->
loİs
[
i
];

335 
	`ª®y£EnumDAG
Ğ
LOOP
, 
Í
 );

336 
	`´štf
Ğ"#·th š†oİ %d-%d: %Lu\n", 
p
->
pid
, 
Í
->
Íid
, 
’um_·ths_loİ
[lp->lpid] );

340 
	`ª®y£EnumDAG
Ğ
PROC
, 
p
 );

342 
	`ä“
Ğ
’um_·ths_loİ
 );

344 ifĞ
šãas
 ) {

345 
	`ä“
Ğ
’um_·thli¡
[
p
->
pid
] );

346 
	`ä“
Ğ
’um_·thËn
[
p
->
pid
] );

350 
	}
}

353 
	$ª®ysis_’um
() {

355 
i
;

357 
’um_·ths_´oc
 = (
uÎ
*è
	`CALLOC
Ğ’um_·ths_´oc, 
num_´ocs
, (ull), "enum_paths_proc" );

359 ifĞ
šãas
 ) {

360 
’um_·thli¡
 = (
ushÜt
****)

361 
	`MALLOC
Ğ
’um_·thli¡
, 
num_´ocs
 * (
ushÜt
***), "enum_pathlist" );

362 
’um_·thËn
 = (
ushÜt
***)

363 
	`MALLOC
Ğ
’um_·thËn
, 
num_´ocs
 * (
ushÜt
**), "enum_pathlen" );

367  
i
 = 0; i < 
num_´ocs
; i++ ) {

368 
	`ª®y£EnumProc
Ğ
´ocs
[ 
´oc_cg
[
i
] ] );

369 
	`´štf
Ğ"#·th š…roø%d: %Lu\n", 
´oc_cg
[
i
], 
’um_·ths_´oc
[proc_cg[i]] );

372 ifĞ
do_šlše
 )

373 
	`´štf
Ğ"\nTÙ®‚umb” oà·ths: %Lu\n", 
’um_·ths_´oc
[
maš_id
] );

375 
	`ä“
Ğ
’um_·ths_´oc
 );

377 ifĞ
šãas
 ) {

378 
	`ä“
Ğ
’um_·thli¡
 );

379 
	`ä“
Ğ
’um_·thËn
 );

382 
	}
}

	@analysisILP.c

5 
	~<¡dio.h
>

14 
	$»achabËTİo
Ğ
block
 *
¤c
, 
de¡
, block **
bbli¡
, 
¡¬t
, 
’d
, *
vis™ed
 ) {

16 
i
, 
id
;

18 ifĞ
¤c
->
bbid
 =ğ
de¡
 )

21 
vis™ed
[
¤c
->
bbid
] = 1;

23  
i
 = 0; i < 
¤c
->
num_outgošg
; i++ ) {

24 
id
 = 
	`g‘block
Ğ
¤c
->
outgošg
[
i
], 
bbli¡
, 
¡¬t
, 
’d
 );

26 ifĞ
id
 !ğ-1 && !
vis™ed
[
¤c
->
outgošg
[
i
]] )

27 ifĞ
	`»achabËTİo
Ğ
bbli¡
[
id
], 
de¡
, bbli¡, 
¡¬t
, 
’d
, 
vis™ed
 ))

31 
	}
}

39 
	$isR—chabËTİo
Ğ
block
 *
¤c
, 
de¡
, block **
bbli¡
, 
¡¬t
, 
’d
 ) {

41 *
vis™ed
;

42 
»s
;

44 ifĞ
¤c
->
bbid
 =ğ
de¡
 )

47 
vis™ed
 = (*è
	`CALLOC
Ğvis™ed, 
´ocs
[
¤c
->
pid
]->
num_bb
, (), "visited" );

48 
»s
 = 
	`»achabËTİo
Ğ
¤c
, 
de¡
, 
bbli¡
, 
¡¬t
, 
’d
, 
vis™ed
 );

50 
	`ä“
Ğ
vis™ed
 );

51  
»s
;

52 
	}
}

55 
	$g‘BlockExecCouÁ
Ğ
block
 *
bb
 ) {

57 
couÁ
;

58 
loİ
 *
Í
, *
Ín
;

60 
couÁ
 = 1;

61 ifĞ
bb
->
loİid
 != -1 ) {

62 
Í
 = 
´ocs
[
bb
->
pid
]->
loİs
[bb->
loİid
];

64 ifĞ
bb
->
is_loİh—d
 && !
Í
->
is_dowhe
 )

66 
couÁ
 *ğ(
Í
->
loİbound
 + 1);

68 
couÁ
 *ğ
Í
->
loİbound
;

71 
Ín
 = 
Í
;

72  
Ín
->
Ã¡
 != -1 ) {

73 
Ín
 = 
´ocs
[
bb
->
pid
]->
loİs
[Ín->
Ã¡
];

74 
couÁ
 *ğ
Ín
->
loİbound
;

77  
couÁ
;

78 
	}
}

81 
	$ILPcÚ¡DAG
Ğ
objty³
, *
obj
 ) {

83 
i
, 
j
, 
k
, 
Ê
, 
m
, 
cid
;

85 
´oûdu»
 *
p
;

86 
loİ
 *
Í
;

87 
block
 *
bb
;

89 
block
 **
tİo
;

90 
num_tİo
;

92 **
šcomšg
;

93 *
num_šcomšg
;

95 
assign
 *
A
;

96 
b¿nch
 *
B
, *
C
;

98 
dœ
;

99 
jump
, 
çÎ
;

101 
‹mp
[16];

102 
¡r
[1000];

105 ifĞ
objty³
 =ğ
PROC
 ) {

106 
p
 = (
´oûdu»
*è
obj
;

107 
tİo
 = 
p
->topo;

108 
num_tİo
 = 
p
->num_topo;

110 ifĞ
objty³
 =ğ
LOOP
 ) {

111 
Í
 = (
loİ
*è
obj
;

112 
p
 = 
´ocs
[ 
Í
->
pid
 ];

113 
tİo
 = 
Í
->topo;

114 
num_tİo
 = 
Í
->num_topo;

117 
	`´štf
Ğ"Inv®id objty³…as£dØª®ysisDAG: %d\n", 
objty³
 ), 
	`ex™
(1);

121 
num_šcomšg
 = (*è
	`CALLOC
Ğnum_šcomšg, 
p
->
num_bb
, (), "num_incoming" );

122 
šcomšg
 = (**è
	`MALLOC
Ğšcomšg, 
p
->
num_bb
 * (*), "incoming" );

123  
i
 = 0; i < 
p
->
num_bb
; i++ ) {

124 
num_šcomšg
[
i
] = 0;

125 
šcomšg
[
i
] = 
NULL
;

127  
i
 = 0; i < 
num_tİo
; i++ ) {

128 
bb
 = 
tİo
[
i
];

129  
j
 = 0; j < 
bb
->
num_outgošg
; j++ ) {

130 
num_šcomšg
[ 
bb
->
outgošg
[
j
] ]++;

131 
šcomšg
[ 
bb
->
outgošg
[
j
] ] = (*)

132 
	`REALLOC
Ğ
šcomšg
[ 
bb
->
outgošg
[
j
] ], 
num_šcomšg
[bb->outgoing[j]] * (), "incomingƒlm" );

133 
šcomšg
[ 
bb
->
outgošg
[
j
] ][ 
num_šcomšg
[bb->outgošg[j]] - 1 ] = bb->
bbid
;

138  
i
 = 0; i < 
num_tİo
; i++ ) {

139 
bb
 = 
tİo
[
i
];

144 ifĞ
num_šcomšg
[
bb
->
bbid
] ) {

146 
	`årštf
Ğ
pf
, "Y%d", 
bb
->
bbid
 );

147  
j
 = 0; j < 
num_šcomšg
[
bb
->
bbid
]; j++ )

148 
	`årštf
Ğ
pf
, " - Y%d~%d", 
šcomšg
[
bb
->
bbid
][
j
], bb->bbid );

149 
	`årštf
Ğ
pf
, " = 0\n" );

150 
	`fæush
Ğ
pf
 );

154 ifĞ
bb
->
num_outgošg
 ) {

156 
	`årštf
Ğ
pf
, "Y%d", 
bb
->
bbid
 );

157  
j
 = 0; j < 
bb
->
num_outgošg
; j++ )

158 
	`årštf
Ğ
pf
, " - Y%d~%d", 
bb
->
bbid
, bb->
outgošg
[
j
] );

159 
	`årštf
Ğ
pf
, " = 0\n" );

160 
	`fæush
Ğ
pf
 );

164 ifĞ
šãas
 ) {

167 
B
 = 
b¿nchli¡
[
bb
->
pid
][bb->
bbid
];

168 ifĞ
B
 !ğ
NULL
 ) {

170 
çÎ
 = 
	`g‘block
Ğ
bb
->
outgošg
[0], 
tİo
, 0, 
i
-1 );

171 
jump
 = 
	`g‘block
Ğ
bb
->
outgošg
[1], 
tİo
, 0, 
i
-1 );

174 ifĞ
bb
->
is_loİh—d
 ) {

175 ifĞ
objty³
 =ğ
LOOP
 && 
bb
->
loİid
 =ğ
Í
->
Íid
 )

177 
çÎ
 = -1;

180 
jump
 = -1;

185  
k
 = 0; k < 
B
->
num_cÚæiùs
; k++ ) {

186 
C
 = 
B
->
cÚæiùs
[
k
];

188 
cid
 = 
	`g‘block
Ğ
C
->
bb
->
bbid
, 
tİo
, 0, 
i
-1 );

189 ifĞ
cid
 == -1 )

195 
dœ
 = 
B
->
cÚæiùdœ_jump
[
k
];

196 ifĞ
jump
 !ğ-1 && 
dœ
 != -1 ) {

199 
¡r
[0] = '\0';

200 
‹mp
[0] = '\0';

202  
Ê
 = 
i
 - 1;†À>ğ
cid
;†n-- ) {

204 ifĞ
	`isR—chabËTİo
Ğ
tİo
[
jump
],İo[
Ê
]->
bbid
,İo,†n, 
i
 ) &&

205 
	`isR—chabËTİo
Ğ
tİo
[
Ê
], 
C
->
bb
->
bbid
,İo, 
cid
,†n )) {

207  
m
 = 0; m < 
num_assign
[
bb
->
pid
][
tİo
[
Ê
]->
bbid
]; m++ ) {

209 ifĞ
	`¡r¡r
Ğ
B
->
d”i_Œ“
, 
assigÆi¡
[
bb
->
pid
][
tİo
[
Ê
]->
bbid
][
m
]->d”i_Œ“ ) !ğ
NULL
 ) {

212 
	`¥rštf
Ğ
‹mp
, " - Y%d", 
tİo
[
Ê
]->
bbid
 );

213 ifĞ!
	`¡r¡r
Ğ
¡r
, 
‹mp
 ))

214 
	`¡rÿt
Ğ
¡r
, 
‹mp
 );

221 ifĞ
dœ
 =ğ
C
->
jump_cÚd
 )

222 
	`årštf
Ğ
pf
, "Y%d~%d + Y%d~%d%s <= 1\n",

223 
bb
->
bbid
, bb->
outgošg
[1], 
C
->bb->bbid, C->bb->outgošg[1], 
¡r
 );

225 ifĞ
dœ
 =ğ
	`Ãg
Ğ
C
->
jump_cÚd
 ))

226 
	`årštf
Ğ
pf
, "Y%d~%d + Y%d~%d%s <= 1\n",

227 
bb
->
bbid
, bb->
outgošg
[1], 
C
->bb->bbid, C->bb->outgošg[0], 
¡r
 );

231 
dœ
 = 
B
->
cÚæiùdœ_çÎ
[
k
];

232 ifĞ
çÎ
 !ğ-1 && 
dœ
 != -1 ) {

235 
¡r
[0] = '\0';

236 
‹mp
[0] = '\0';

238  
Ê
 = 
i
 - 1;†À>ğ
cid
;†n-- ) {

240 ifĞ
	`isR—chabËTİo
Ğ
tİo
[
çÎ
],İo[
Ê
]->
bbid
,İo,†n, 
i
 ) &&

241 
	`isR—chabËTİo
Ğ
tİo
[
Ê
], 
C
->
bb
->
bbid
,İo, 
cid
,†n )) {

243  
m
 = 0; m < 
num_assign
[
bb
->
pid
][
tİo
[
Ê
]->
bbid
]; m++ ) {

245 ifĞ
	`¡r¡r
Ğ
B
->
d”i_Œ“
, 
assigÆi¡
[
bb
->
pid
][
tİo
[
Ê
]->
bbid
][
m
]->d”i_Œ“ ) !ğ
NULL
 ) {

248 
	`¥rštf
Ğ
‹mp
, " - Y%d", 
tİo
[
Ê
]->
bbid
 );

249 ifĞ!
	`¡r¡r
Ğ
¡r
, 
‹mp
 ))

250 
	`¡rÿt
Ğ
¡r
, 
‹mp
 );

257 ifĞ
dœ
 =ğ
C
->
jump_cÚd
 )

258 
	`årštf
Ğ
pf
, "Y%d~%d + Y%d~%d%s <= 1\n",

259 
bb
->
bbid
, bb->
outgošg
[0], 
C
->bb->bbid, C->bb->outgošg[1], 
¡r
 );

261 ifĞ
dœ
 =ğ
	`Ãg
Ğ
C
->
jump_cÚd
 ))

262 
	`årštf
Ğ
pf
, "Y%d~%d + Y%d~%d%s <= 1\n",

263 
bb
->
bbid
, bb->
outgošg
[0], 
C
->bb->bbid, C->bb->outgošg[0], 
¡r
 );

269  
j
 = 0; j < 
num_assign
[
bb
->
pid
][bb->
bbid
]; j++ ) {

270 
A
 = 
assigÆi¡
[
bb
->
pid
][bb->
bbid
][
j
];

274  
k
 = 0; k < 
A
->
num_cÚæiùs
; k++ ) {

275 
C
 = 
A
->
cÚæiùs
[
k
];

277 
cid
 = 
	`g‘block
Ğ
C
->
bb
->
bbid
, 
tİo
, 0, 
i
 );

278 ifĞ
cid
 == -1 )

284 
¡r
[0] = '\0';

285 
‹mp
[0] = '\0';

287  
Ê
 = 
i
 - 1;†À>ğ
cid
;†n-- ) {

289 ifĞ
	`isR—chabËTİo
Ğ
bb
, 
tİo
[
Ê
]->
bbid
,İo,†n, 
i
 ) &&

290 
	`isR—chabËTİo
Ğ
tİo
[
Ê
], 
C
->
bb
->
bbid
,İo, 
cid
,†n )) {

292  
m
 = 0; m < 
num_assign
[
bb
->
pid
][
tİo
[
Ê
]->
bbid
]; m++ ) {

294 ifĞ
	`¡r¡r
Ğ
A
->
d”i_Œ“
, 
assigÆi¡
[
bb
->
pid
][
tİo
[
Ê
]->
bbid
][
m
]->d”i_Œ“ ) !ğ
NULL
 ) {

297 
	`¥rštf
Ğ
‹mp
, " - Y%d", 
tİo
[
Ê
]->
bbid
 );

298 ifĞ!
	`¡r¡r
Ğ
¡r
, 
‹mp
 ))

299 
	`¡rÿt
Ğ
¡r
, 
‹mp
 );

304 ifĞ
A
->
cÚæiùdœ
[
k
] =ğ
C
->
jump_cÚd
 )

305 
	`årštf
Ğ
pf
, "Y%d + Y%d~%d%s <= 1\n",

306 
bb
->
bbid
, 
C
->bb->bbid, C->bb->
outgošg
[1], 
¡r
 );

308 ifĞ
A
->
cÚæiùdœ
[
k
] =ğ
	`Ãg
Ğ
C
->
jump_cÚd
 ))

309 
	`årštf
Ğ
pf
, "Y%d + Y%d~%d%s <= 1\n",

310 
bb
->
bbid
, 
C
->bb->bbid, C->bb->
outgošg
[0], 
¡r
 );

318 
	`ä“
Ğ
num_šcomšg
 );

319 ifĞ
šcomšg
 !ğ
NULL
 )

320  
i
 = 0; i < 
p
->
num_bb
; i++ )

321 
	`ä“
Ğ
šcomšg
[
i
] );

322 
	`ä“
Ğ
šcomšg
 );

325 
	}
}

328 
	$ILPcÚ¡Proc
Ğ
´oûdu»
 *
p
 ) {

330 
i
;

333  
i
 = 
p
->
num_loİs
 - 1; i >= 0; i-- )

334 
	`ILPcÚ¡DAG
Ğ
LOOP
, 
p
->
loİs
[
i
] );

337 
	`ILPcÚ¡DAG
Ğ
PROC
, 
p
 );

340 
	}
}

343 
	$ª®ysis_p
() {

345 
i
, 
j
, 
k
, 
m
;

347 
´oc
[100];

349 
´oûdu»
 *
p
;

350 
block
 *
bb
;

351 
loİ
 *
Í
;

353 
ušt
 
co¡
;

354 
wût
;

355 
couÁ
;

357 
fœ¡‹rm
;

360 
t
;

361 
tÙ®_t_äm
;

362 
tÙ®_t_sŞ
;

364 
tÙ®_t_äm
 = 0;

365 
tÙ®_t_sŞ
 = 0;

368 
	`cyşe_time
(0);

372  
i
 = 0; i < 
num_´ocs
; i++ ) {

373 
p
 = 
´ocs
[ 
´oc_cg
[
i
] ];

375 
	`¥rštf
Ğ
´oc
, "ap%d", 
p
->
pid
 );

376 
pf
 = 
	`İ’fe
Ğ
´oc
, "w" );

378 
	`årštf
Ğ
pf
, "enter Q\n" );

384 
	`årštf
Ğ
pf
, "maximize\n", 
p
->
pid
 );

386 
fœ¡‹rm
 = 1;

388  
j
 = 
p
->
num_tİo
-1; j >= 0; j-- ) {

389 
bb
 = 
p
->
tİo
[
j
];

391 ifĞ
bb
->
is_loİh—d
 || bb->
¡¬ddr
 == -1 )

394 
co¡
 = 
bb
->cost;

395 ifĞ
bb
->
ÿÎpid
 != -1 )

396 
co¡
 +ğ
´ocs
[ 
bb
->
ÿÎpid
 ]->
wût
;

398 ifĞ!
fœ¡‹rm
 )

399 
	`årštf
Ğ
pf
, " + " );

400 
	`årštf
Ğ
pf
, "%dY%d", 
co¡
, 
bb
->
bbid
 );

401 
fœ¡‹rm
 = 0;

404  
m
 = 0; m < 
p
->
num_loİs
; m++ ) {

405 
Í
 = 
p
->
loİs
[
m
];

407  
j
 = 
Í
->
num_tİo
-1; j >= 0; j-- ) {

408 
bb
 = 
Í
->
tİo
[
j
];

410 ifĞ
bb
->
is_loİh—d
 && bb->
loİid
 !ğ
Í
->
Íid
 || bb->
¡¬ddr
 == -1 )

413 
co¡
 = 
bb
->cost;

414 ifĞ
bb
->
ÿÎpid
 != -1 )

415 
co¡
 +ğ
´ocs
[ 
bb
->
ÿÎpid
 ]->
wût
;

417 
co¡
 *ğ
	`g‘BlockExecCouÁ
Ğ
bb
 );

419 ifĞ!
fœ¡‹rm
 )

420 
	`årštf
Ğ
pf
, " + " );

421 
	`årštf
Ğ
pf
, "%dY%d", 
co¡
, 
bb
->
bbid
 );

422 
fœ¡‹rm
 = 0;

425 
	`årštf
Ğ
pf
, "\n" );

428 
	`årštf
Ğ
pf
, "st\n" );

429 
	`ILPcÚ¡Proc
Ğ
p
 );

432 
	`årštf
Ğ
pf
, "Y%d = 1\n", 
p
->
tİo
[0]->
bbid
 );

433 
	`årštf
Ğ
pf
, "Y%d = 1\n", 
p
->
tİo
[p->
num_tİo
-1]->
bbid
 );

435 
	`årštf
Ğ
pf
, "end\n" );

438 
	`årštf
Ğ
pf
, "change…roblem milp\n" );

440  
j
 = 
p
->
num_tİo
 - 1; j >= 0; j-- ) {

441 
bb
 = 
p
->
tİo
[
j
];

444 ifĞ!
bb
->
is_loİh—d
 )

445 
	`årštf
Ğ
pf
, "chªgty³ Y%d B\n", 
bb
->
bbid
 );

448  
k
 = 0; k < 
bb
->
num_outgošg
; k++ )

449 
	`årštf
Ğ
pf
, "chªgty³ Y%d~%d B\n", 
bb
->
bbid
, bb->
outgošg
[
k
] );

452  
m
 = 0; m < 
p
->
num_loİs
; m++ ) {

453 
Í
 = 
p
->
loİs
[
m
];

455  
j
 = 
Í
->
num_tİo
 - 1; j >= 0; j-- ) {

456 
bb
 = 
Í
->
tİo
[
j
];

459 ifĞ!
bb
->
is_loİh—d
 || bb->
loİid
 =ğ
Í
->
Íid
 )

460 
	`årštf
Ğ
pf
, "chªgty³ Y%d B\n", 
bb
->
bbid
 );

463  
k
 = 0; k < 
bb
->
num_outgošg
; k++ )

464 
	`årštf
Ğ
pf
, "chªgty³ Y%d~%d B\n", 
bb
->
bbid
, bb->
outgošg
[
k
] );

469 
	`årštf
Ğ
pf
, "optimize\n" );

470 
	`årštf
Ğ
pf
, "display solution variables -\n" );

471 
	`årštf
Ğ
pf
, "quit\n" );

473 
	`fşo£
Ğ
pf
 );

476 
t
 = 
	`cyşe_time
(1);

477 
tÙ®_t_äm
 +ğ
t
;

482 
	`¥rštf
Ğ
´oc
, "ıËx < %s.ap%d > %s.ais%d", 
f’ame
, 
p
->
pid
, filename,…->pid );

485 
	`cyşe_time
(0);

487 
	`sy¡em
Ğ
´oc
 );

490 
t
 = 
	`cyşe_time
(1);

491 
tÙ®_t_sŞ
 +ğ
t
;

495 
	`¥rštf
Ğ
´oc
, "grep Objective %s.ais%d | grep solution |‡wk '{print $NF}' > %s.wcet",

496 
f’ame
, 
p
->
pid
, filename );

497 
	`sy¡em
Ğ
´oc
 );

499 
wût
 = 0;

500 
pf
 = 
	`İ’fe
( "wcet", "r" );

501 
	`fsÿnf
Ğ
pf
, "%Ë", &
wût
 );

502 
	`fşo£
Ğ
pf
 );

504 
p
->
wût
 = (
uÎ
) wcet;

508 
	`¥rštf
Ğ
´oc
, "grep Y %s.ais%d | grep \"1\\.00\" |‡wk '{print $1}' | sed '/\\~/d' > %s.bp%d",

509 
f’ame
, 
p
->
pid
, filename,…->pid );

510 
	`sy¡em
Ğ
´oc
 );

512 
	`ä“
Ğ
p
->
w·th
 );

513 
p
->
w·th
 = (*è
	`MALLOC
(…->wpath, (), "proc wpath" );

514 
p
->
w·th
[0] = '\0';

518 
	`¥rštf
Ğ
´oc
, "bp%d", 
p
->
pid
 );

519 
pf
 = 
	`İ’fe
Ğ
´oc
, "r" );

521 
fœ¡‹rm
 = 1;

522  
	`fsÿnf
Ğ
pf
, "Y%d\n", &
j
 ) !ğ
EOF
 ) {

525 ifĞ
fœ¡‹rm
 ) {

526 
	`¥rštf
Ğ
´oc
, "%d", 
j
 );

527 
fœ¡‹rm
 = 0;

530 
	`¥rštf
Ğ
´oc
, "-%d", 
j
 );

532 
p
->
w·th
 = (*è
	`REALLOC
Ğp->w·th, (
	`¡¾’
Õ->w·thè+ sŒËn(
´oc
) + 1) * (), "proc wpath" );

533 
	`¡rÿt
Ğ
p
->
w·th
, 
´oc
 );

536 
bb
 = 
p
->
bbli¡
[
j
];

539 ifĞ
bb
->
¡¬ddr
 != -1 ) {

541 
couÁ
 = 
	`g‘BlockExecCouÁ
Ğ
bb
 );

546 ifĞ
pf
 )

547 
	`fşo£
Ğ
pf
 );

551 
	`´štf
Ğ"Timk’ (ª®ysis-fÜmuÏtiÚ): %àms\n", 
tÙ®_t_äm
/
CYCLES_PER_MSEC
 );

552 
	`´štf
Ğ"Timk’ (ª®ysis-sŞutiÚ): %àms\n", 
tÙ®_t_sŞ
/
CYCLES_PER_MSEC
 );

557 
	}
}

	@block.c

5 
	~<¡ršg.h
>

6 
	~<¡dio.h
>

14 
	$g‘block
Ğ
bbid
, 
block
 **
bbli¡
, 
¡¬t
, 
’d
 ) {

16 
i
;

17  
i
 = 
’d
; i >ğ
¡¬t
; i-- )

18 ifĞ
bbli¡
[
i
]->
bbid
 == bbid )

19  
i
;

21 
	}
}

30 
	$‹¡BlockRªge
Ğ
addr
, 
block
 *
bb
 ) {

32 ifĞ!
bb
 )

33 
	`´štf
Ğ"NuÎ basiøblockƒncouÁ”ed iÀ£¬ch.\n" ), 
	`ex™
(1);

35 ifĞ
addr
 < 
bb
->
¡¬ddr
 )

38 ifĞ
addr
 >ğ
bb
->
¡¬ddr
 + bb->
size
 )

42 
	}
}

48 
	$šProcRªge
Ğ
addr
, 
´oûdu»
 *
p
 ) {

50 
block
 *
Ï¡bb
;

51 
Ï¡id
;

53 ifĞ!
p
 || !p->
num_bb
 )

56 ifĞ
addr
 < 
p
->
bbli¡
[0]->
¡¬ddr
 )

60 
Ï¡id
 = 
p
->
num_bb
 - 1;

61 
Ï¡bb
 = 
p
->
bbli¡
[
Ï¡id
];

62  
Ï¡bb
->
¡¬ddr
 =ğ-1 && 
Ï¡id
 > 0 )

63 
Ï¡bb
 = 
p
->
bbli¡
[ --
Ï¡id
 ];

65 ifĞ
Ï¡bb
->
¡¬ddr
 == -1 )

68 ifĞ
addr
 >ğ
Ï¡bb
->
¡¬ddr
 +†a¡bb->
size
 )

72 
	}
}

79 
block
* 
	$bšS—rch
Ğ
addr
, 
block
 **
bbli¡
, 
¡¬t
, 
’d
 ) {

81 
mid
, 
»l
;

83 ifĞ
¡¬t
 > 
’d
 )

84  
NULL
;

86 
mid
 = (
¡¬t
 + 
’d
) / 2;

87 
»l
 = 
	`‹¡BlockRªge
Ğ
addr
, 
bbli¡
[
mid
] );

89 ifĞ
»l
 == 0 )

90  
bbli¡
[
mid
];

92 ifĞ
»l
 < 0 )

93  
	`bšS—rch
Ğ
addr
, 
bbli¡
, 
¡¬t
, 
mid
 - 1 );

95  
	`bšS—rch
Ğ
addr
, 
bbli¡
, 
mid
 + 1, 
’d
 );

96 
	}
}

103 
block
* 
	$£¬chBBli¡
Ğ
addr
, 
block
 **
bbli¡
, 
Ën
 ) {

115  
	`bšS—rch
Ğ
addr
, 
bbli¡
, 0, 
Ën
 - 1 );

116 
	}
}

122 
block
* 
	$fšdBlock
Ğ
addr
 ) {

124 
i
, 
Ï¡id
;

125 
´oûdu»
 *
p
;

127  
i
 = 0; i < 
num_´ocs
; i++ ) {

128 
p
 = 
´ocs
[
i
];

129 ifĞ
	`šProcRªge
Ğ
addr
, 
p
 )) {

131 
Ï¡id
 = 
p
->
num_bb
 - 1;

132  
p
->
bbli¡
[
Ï¡id
]->
¡¬ddr
 == -1 &&†astid > 0 )

133 
Ï¡id
--;

134  
	`£¬chBBli¡
Ğ
addr
, 
p
->
bbli¡
, 
Ï¡id
 + 1 );

137  
NULL
;

138 
	}
}

144 
	$isB¿nchIn¡r
Ğ
š¡r
 *
š¢
 ) {

146  ( 
	`¡rcmp
Ğ
š¢
->
İ
, "bgez" ) == 0 ||

147 
	`¡rcmp
Ğ
š¢
->
İ
, "bgtz" ) == 0 ||

148 
	`¡rcmp
Ğ
š¢
->
İ
, "blez" ) == 0 ||

149 
	`¡rcmp
Ğ
š¢
->
İ
, "bne" ) == 0 ||

150 
	`¡rcmp
Ğ
š¢
->
İ
, "beq" ) == 0 ||

151 
	`¡rcmp
Ğ
š¢
->
İ
, "bc1f" ) == 0 ||

152 
	`¡rcmp
Ğ
š¢
->
İ
, "bc1t" ) == 0 );

153 
	}
}

156 
	$isAssignIn¡r
Ğ
š¡r
 *
š¢
 ) {

158  ( 
	`¡rcmp
Ğ
š¢
->
İ
, "sw" ) == 0 ||

159 
	`¡rcmp
Ğ
š¢
->
İ
, "sb" ) == 0 ||

160 
	`¡rcmp
Ğ
š¢
->
İ
, "sbu" ) == 0 ||

161 
	`¡rcmp
Ğ
š¢
->
İ
, "sh" ) == 0 );

162 
	}
}

165 *
	$g‘JumpDe¡
Ğ
š¡r
 *
š¢
 ) {

169 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "bgez" ) == 0 ||

170 
	`¡rcmp
Ğ
š¢
->
İ
, "bgtz" ) == 0 ||

171 
	`¡rcmp
Ğ
š¢
->
İ
, "blez" ) == 0 )

172  
š¢
->
r2
;

174 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "bne" ) == 0 ||

175 
	`¡rcmp
Ğ
š¢
->
İ
, "beq" ) == 0 )

176  
š¢
->
r3
;

178 
	`´štf
Ğ"UÄecognized o¸nÙ‡ jum°š¡ruùiÚ: %s\n", 
š¢
->
İ
 );

179  
NULL
;

180 
	}
}

183 
	$hexV®ue
Ğ*
hexSŒ
 ) {

185 
v®
;

187 
	`ssÿnf
Ğ
hexSŒ
, "%x", &
v®
 );

188  
v®
;

189 
	}
}

	@cycle_time.c

2 
	$acûss_couÁ”
(*
hi
, *
lo
)

5 
	`asm
("rdtsc; movl %%edx,%0; movl %%eax,%1"

6 : "ô" (*
hi
), "ô" (*
lo
)

9 
	}
}

14 
	$cyşe_time
(
¡¬t_’d
)

17 
lo1
, 
hi1
, 
lo2
, 
hi2
;

18 
ulo
, 
uhi
, 
bÜrow
;

19 
t
;

21 ià(
¡¬t_’d
 == 0) {

22 
	`acûss_couÁ”
(&
hi1
, &
lo1
);

26 
	`acûss_couÁ”
(&
hi2
, &
lo2
);

27 
ulo
 = 
lo2
 - 
lo1
;

28 
bÜrow
 = 
ulo
 > 
lo2
;

29 
uhi
 = 
hi2
 - 
hi1
 - 
bÜrow
;

30 
t
 = (è
uhi
 * (1 << 30è* 4 + 
ulo
;

31  
t
;

33 
	}
}

	@cycle_time.h

1 #iâdeà
CYCLE_TIME_H


2 
	#CYCLE_TIME_H


	)

10 
cyşe_time
(
¡¬t_’d
);

	@dump.c

5 
	~<¡ršg.h
>

6 
	~<¡dio.h
>

9 
	$´štBlock
Ğ
block
 *
bb
 ) {

11 
i
;

13 
	`´štf
( "%3d %08x (%3d)",

14 
bb
->
bbid
, bb->
¡¬ddr
, bb->
size
);

16  
i
 = 0; i < 
bb
->
num_outgošg
; i++ )

17 
	`´štf
Ğ" %3d", 
bb
->
outgošg
[
i
] );

19  
i
 = 
bb
->
num_outgošg
; i < 2; i++ )

20 
	`´štf
( " " );

22 ifĞ
bb
->
ÿÎpid
 != -1 )

23 
	`´štf
Ğ" P%d", 
bb
->
ÿÎpid
 );

25 
	`´štf
( " " );

27 
	`´štf
(" bb->´oc_±r: %u\n", ()
bb
->
´oc_±r
);

29 ifĞ
bb
->
loİid
 != -1 ) {

30 
	`´štf
Ğ" L%d", 
bb
->
loİid
 );

31 ifĞ
bb
->
is_loİh—d
 )

32 
	`´štf
( "*" );

35 
	`´štf
( "\n" );

38 
	}
}

41 
	$´štProc
Ğ
´oûdu»
 *
p
 ) {

43 
i
;

44 
block
 *
bb
;

46 
	`´štf
Ğ"Proc: %d\n", 
p
->
pid
 );

47  
i
 = 0; i < 
p
->
num_bb
; i++ ) {

48 
bb
 = 
p
->
bbli¡
[
i
];

49 ifĞ!
bb
 )

50 
	`´štf
Ğ"NuÎ basiøblock‡ˆ%d\n", 
i
 ), 
	`ex™
(1);

51 
	`´štBlock
Ğ
bb
 );

53 ifĞ
p
->
num_ÿÎs
 ) {

54 
	`´štf
( "Calls…rocedures:" );

55  
i
 = 0; i < 
p
->
num_ÿÎs
; i++ )

56 
	`´štf
Ğ" %d", 
p
->
ÿÎs
[
i
] );

57 
	`´štf
( "\n" );

60 ifĞ
p
->
num_tİo
 ) {

61 
	`´štf
( "Topo order: " );

62  
i
 = 0; i < 
p
->
num_tİo
; i++ )

63 
	`´štf
Ğ" %d", 
p
->
tİo
[
i
]->
bbid
 );

64 
	`´štf
( "\n" );

66 
	`´štf
( "\n" );

69 
	}
}

72 
	$´št_cfg
() {

74 
i
;

75 
´oûdu»
 *
p
;

77 
max_num_bb
, 
max_´oc
;

79 
max_num_bb
 = 0;

80 
max_´oc
 = -1;

82  
i
 = 0; i < 
num_´ocs
; i++ ) {

83 
p
 = 
´ocs
[
i
];

84 ifĞ!
p
 )

85 
	`´štf
Ğ"NuÎ…roûdu»‡ˆ%d\n", 
i
 ), 
	`ex™
(1);

86 
	`´štProc
Ğ
p
 );

87 ifĞ
p
->
num_bb
 > 
max_num_bb
 ) {

88 
max_num_bb
 = 
p
->
num_bb
;

89 
max_´oc
 = 
i
;

92 
	`´štf
( "\n%d…rocedures (main: %d), %d basic blocks inotal (max %d in…roc %d)\n",

93 
num_´ocs
, 
maš_id
, 
tÙ®_bb
, 
max_num_bb
, 
max_´oc
 );

95 ifĞ
´oc_cg
 !ğ
NULL
 ) {

96 
	`´štf
( "Reverse-topo ordered call graph:" );

97  
i
 = 0; i < 
num_´ocs
; i++ ) {

98 
p
 = 
´ocs
[ 
´oc_cg
[
i
] ];

99 ifĞ!
p
 )

100 
	`´štf
Ğ"NuÎ…roûdu»‡ˆtİØÜd” %d\n", 
i
 ), 
	`ex™
(1);

101 
	`´štf
Ğ" %d", 
p
->
pid
 );

103 
	`´štf
( "\n" );

105 
	`´štf
( "\n--------------------------------\n" );

108 
	}
}

111 
	$´štLoİ
Ğ
loİ
 *
Í
 ) {

113 
i
;

115 
	`´štf
Ğ"Loİ %d-%d (%d, %dè[%d, %d, %d]", 
Í
->
pid
,†p->
Íid
,

116 
Í
->
Ëv–
,†p->
Ã¡
,†p->
loİh—d
->
bbid
,†p->
loİsšk
->bbid,

117 Ğ
Í
->
loİex™
 ?†p->loİex™->
bbid
 : -1 ));

119 ifĞ
Í
->
is_dowhe
 )

120 
	`´štf
( " dw" );

122 
	`´štf
( "‚m" );

123 
	`´štf
Ğ" %d\n", 
Í
->
loİbound
 );

126  
i
 = 0; i < 
Í
->
num_tİo
; i++ )

127 
	`´štBlock
Ğ
Í
->
tİo
[
i
] );

129 
	`´štf
( "\n" );

132 
	}
}

135 
	$´št_loİs
() {

137 
i
, 
j
;

138 
´oûdu»
 *
p
;

139 
loİ
 *
Í
;

141  
i
 = 0; i < 
num_´ocs
; i++ ) {

142 
	`´štf
Ğ"\Åroø%d:\n\n", 
i
 );

143 
p
 = 
´ocs
[
i
];

144 ifĞ!
p
 )

145 
	`´štf
Ğ"NuÎ…roûdu»‡ˆ%d\n", 
i
 ), 
	`ex™
(1);

147  
j
 = 0; j < 
p
->
num_loİs
; j++ ) {

148 
Í
 = 
p
->
loİs
[
j
];

149 ifĞ!
Í
 )

150 
	`´štf
Ğ"NuÎ†oİ‡ˆ%d…roø%d\n", 
j
, 
i
 ), 
	`ex™
(1);

151 
	`´štLoİ
Ğ
Í
 );

154 
	`´štf
( "\n--------------------------------\n" );

157 
	}
}

160 
	$´št_tİo
() {

162 
i
, 
j
, 
k
;

163 
loİ
 *
Í
;

164 
´oûdu»
 *
p
;

166  
i
 = 0; i < 
num_´ocs
; i++ ) {

167 
p
 = 
´ocs
[
i
];

170 
	`´štf
Ğ"Proø%d:", 
p
->
pid
 );

171  
j
 = 0; j < 
p
->
num_tİo
; j++ )

172 
	`´štf
Ğ" %d", 
p
->
tİo
[
j
]->
bbid
 );

173 
	`´štf
( "\n" );

176  
j
 = 0; j < 
p
->
num_loİs
; j++ ) {

177 
Í
 = 
p
->
loİs
[
j
];

178 
	`´štf
Ğ"- Loİ %d-%d:", 
Í
->
pid
,†p->
Íid
 );

179  
k
 = 0; k < 
Í
->
num_tİo
; k++ )

180 
	`´štf
Ğ" %d", 
Í
->
tİo
[
k
]->
bbid
 );

181 
	`´štf
( "\n" );

184 
	`´štf
( "\n--------------------------------\n" );

187 
	}
}

190 
	$´štWCETLoİ
Ğ
loİ
 *
Í
 ) {

192 
	`´štf
Ğ"- Loİ %d-%d: %Lu (%s)\n", 
Í
->
pid
,†p->
Íid
,†p->
wût
[0],†p->
w·th
 );

194 
	}
}

197 
	$´štWCETProc
Ğ
´oûdu»
 *
p
 ) {

199 
	`´štf
Ğ"Proø%d: %Lu (%s)\n", 
p
->
pid
,…->
wût
[0],…->
w·th
 );

201 
	}
}

204 
	$´št_wût
() {

206 
i
, 
j
;

207 
´oûdu»
 *
p
;

209  
i
 = 0; i < 
num_´ocs
; i++ ) {

210 
p
 = 
´ocs
[ 
´oc_cg
[
i
] ];

213 
	`´štWCETProc
Ğ
p
 );

216 ifĞ
m‘hod
 =ğ
DAG
 ) {

217  
j
 = 0; j < 
p
->
num_loİs
; j++ )

218 
	`´štWCETLoİ
Ğ
p
->
loİs
[
j
] );

221 
	`´štf
( "\n--------------------------------\n" );

224 
	}
}

227 
	$´štIn¡r
Ğ
FILE
 *
åŒ
, 
š¡r
 *
š¢
 ) {

229 
	`årštf
Ğ
åŒ
, "% % % % %s\n", 
š¢
->
addr
, in¢->
İ
, in¢->
r1
, in¢->
r2
, in¢->
r3
 );

231 
	}
}

233 
	$´štBlockIn¡r
Ğ
FILE
 *
åŒ
, 
block
 *
bb
 ) {

235 
i
;

236 
š¡r
 *
š¢
;

238  
i
 = 0; i < 
bb
->
num_š¡r
; i++ ) {

239 
š¢
 = 
bb
->
š¡¾i¡
[
i
];

240 
	`årštf
Ğ
åŒ
, "%d %d %d ", 
bb
->
pid
, bb->
bbid
, 
i
 );

241 
	`´štIn¡r
Ğ
åŒ
, 
š¢
 );

244 
	}
}

247 
	$´št_š¡¾i¡
() {

249 
i
, 
j
;

250 
´oûdu»
 *
p
;

251 
FILE
 *
åŒ
;

253 
åŒ
 = 
	`İ’fe
( "blks", "w" );

257  
i
 = 0; i < 
num_´ocs
; i++ ) {

258 
p
 = 
´ocs
[
i
];

259  
j
 = 0; j < 
p
->
num_bb
; j++ ) {

261 
	`´štBlockIn¡r
Ğ
åŒ
, 
p
->
bbli¡
[
j
] );

267 
	`fşo£
Ğ
åŒ
 );

269 
	}
}

272 
	$´štP©h
Ğ
·th
 *
±
 ) {

274 
i
;

276 
	`´štf
Ğ"(%Lu)", 
±
->
co¡
 );

277  
i
 = 0; i < 
±
->
bb_Ën
; i++ )

278 
	`´štf
Ğ" %d", 
±
->
bb_£q
[
i
] );

279 
	`´štf
( " [" );

280  
i
 = 0; i < 
±
->
b¿nch_Ën
; i++ )

281 
	`´štf
Ğ" %d(%d)", 
±
->
b¿nch_eff
[
i
]->
bb
->
bbid
,…t->
b¿nch_dœ
[i] );

282 
	`´štf
( "]\n" );

285 
	}
}

288 
	$´štB¿nch
Ğ
b¿nch
 *
br
, 
´štcf
 ) {

290 
i
;

292 ifĞ
br
 =ğ
NULL
 )

295 
	`´štf
Ğ"B <%d,%3d> ", 
br
->
bb
->
pid
, br->bb->
bbid
 );

297 
	`´štf
( "rhs:" );

298 ifĞ
br
->
rhs_v¬
 )

299 
	`´štf
( "var " );

301 
	`´štf
Ğ"%3d ", 
br
->
rhs
 );

303 
	`´štf
Ğ"jump:%d d”i:%s\n", 
br
->
jump_cÚd
, br->
d”i_Œ“
 );

305 ifĞ!
´štcf
 )

308 ifĞ
br
->
num_cÚæiùs
 ) {

309 
	`´štf
( "- outgoing conflicts:" );

310  
i
 = 0; i < 
br
->
num_cÚæiùs
; i++ ) {

312 ifĞ
br
->
cÚæiùdœ_jump
[
i
] != -1 )

313 
	`´štf
Ğ" %d(j%d)", 
br
->
cÚæiùs
[
i
]->
bb
->
bbid
, br->
cÚæiùdœ_jump
[i] );

317 ifĞ
br
->
cÚæiùdœ_çÎ
[
i
] != -1 )

318 
	`´štf
Ğ" %d(f%d)", 
br
->
cÚæiùs
[
i
]->
bb
->
bbid
, br->
cÚæiùdœ_çÎ
[i] );

322 
	`´štf
( "\n" );

324 ifĞ
br
->
num_šcfs
 ) {

325 
	`´štf
( "- incoming conflicts:" );

326  
i
 = 0; i < 
´ocs
[
br
->
bb
->
pid
]->
num_bb
; i++ )

327 ifĞ
br
->
š_cÚæiù
[
i
] )

328 
	`´štf
Ğ" %d", 
i
 );

329 
	`´štf
( "\n" );

332 
	}
}

334 
	$´štAssign
Ğ
assign
 *
assg
, 
id
, 
´štcf
 ) {

336 
i
;

338 
	`´štf
Ğ"A <%d,%3d,%3d> ", 
assg
->
bb
->
pid
,‡ssg->bb->
bbid
,‡ssg->
lš’o
 );

340 
	`´štf
( "rhs:" );

341 ifĞ
assg
->
rhs_v¬
 )

342 
	`´štf
( "var " );

344 
	`´štf
Ğ"%3d ", 
assg
->
rhs
 );

346 
	`´štf
Ğ"d”i:%s\n", 
assg
->
d”i_Œ“
 );

348 ifĞ!
´štcf
 )

351 ifĞ
assg
->
num_cÚæiùs
 ) {

352 
	`´štf
( "- outgoing conflicts:" );

353  
i
 = 0; i < 
assg
->
num_cÚæiùs
; i++ )

354 
	`´štf
Ğ" %d(%d)", 
assg
->
cÚæiùs
[
i
]->
bb
->
bbid
,‡ssg->
cÚæiùdœ
[i] );

356 
	`´štf
( "\n" );

360 
	}
}

363 
	$´št_efãùs
() {

365 
i
, 
j
, 
k
;

367  
i
 = 0; i < 
num_´ocs
; i++ ) {

368  
j
 = 0; j < 
´ocs
[
i
]->
num_bb
; j++ ) {

370  
k
 = 0; k < 
num_assign
[
i
][
j
]; k++ )

371 
	`´štAssign
Ğ
assigÆi¡
[
i
][
j
][
k
], k, 1 );

373 
	`´štB¿nch
Ğ
b¿nchli¡
[
i
][
j
], 1 );

376 
	`´štf
( "\n--------------------------------\n" );

379 
	}
}

382 
	$dump_loİs
() {

384 
FILE
 *
f
;

386 
i
, 
j
, 
k
;

387 
loİ
 *
Í
;

389 
f
 = 
	`İ’fe
( "loops", "w" );

391  
i
 = 0; i < 
num_´ocs
; i++ ) {

392  
j
 = 0; j < 
´ocs
[
i
]->
num_loİs
; j++ ) {

393 
Í
 = 
´ocs
[
i
]->
loİs
[
j
];

394 
	`årštf
Ğ
f
, "Loİ %d %d %d %d %d %d %d\n", 
Í
->
pid
,†p->
Íid
,

395 
Í
->
Ëv–
,†p->
Ã¡
,†p->
loİh—d
->
bbid
,†p->
loİbound
,†p->
num_tİo
 );

397  
k
 = 0; k < 
Í
->
num_tİo
; k++ )

398 
	`årštf
Ğ
f
, " %d", 
Í
->
tİo
[
k
]->
bbid
 );

399 
	`årštf
Ğ
f
, "\n" );

402 
	`fşo£
Ğ
f
 );

405 
	}
}

408 
	$dump_ÿÎg¿ph
() {

410 
FILE
 *
f
;

411 
i
;

413 ifĞ
´oc_cg
 =ğ
NULL
 )

416 
f
 = 
	`İ’fe
( "cg", "w" );

418  
i
 = 0; i < 
num_´ocs
; i++ )

419 
	`årštf
Ğ
f
, "%d ", 
´ocs
[
´oc_cg
[
i
]]->
pid
 );

420 
	`årštf
Ğ
f
, "\n" );

422 
	`fşo£
Ğ
f
 );

425 
	}
}

428 
	$dumpCacheS‹
(
ÿche_¡©e
 *
cs
)

430 
i
, 
j
, 
k
, 
Í_Ëv–
, 
cİ›s
, 
n
;

435 
	`´štf
("\nCache State\n");

448 
	`´štf
("\nMUST\n");

450 
i
 = 0; i < 
ÿche
.
Ç
; i++)

451 
	`´štf
(" way %d ", 
i
);

452 
	`´štf
("\n");

454 
j
 = 0; j < 
ÿche
.
ns
; j++)

456 
	`´štf
("£ˆ%d ", 
j
);

458  
k
 = 0; k < 
ÿche
.
Ç
; k++)

460 if(
cs
->
mu¡
[
j
][
k
]->
num_’Œy
!=0)

466 
n
 = 0;‚ < 
cs
->
mu¡
[
j
][
k
]->
num_’Œy
;‚++)

467 
	`´štf
(" %d ", 
cs
->
mu¡
[
j
][
k
]->
’Œy
[
n
]);

468 
	`´štf
("; ");

471 
	`´štf
(" ");

473 
	`´štf
("\n");

477 
	`´štf
("\nMAY\n");

479 
i
 = 0; i < 
ÿche
.
Ç
; i++)

480 
	`´štf
(" way %d ", 
i
);

481 
	`´štf
("\n");

483 
j
 = 0; j < 
ÿche
.
ns
; j++)

485 
	`´štf
("£ˆ%d ", 
j
);

487  
k
 = 0; k < 
ÿche
.
Ç
; k++)

489 if(
cs
->
may
[
j
][
k
]->
num_’Œy
!=0)

495 
n
 = 0;‚ < 
cs
->
may
[
j
][
k
]->
num_’Œy
;‚++)

496 
	`´štf
(" %d ", 
cs
->
may
[
j
][
k
]->
’Œy
[
n
]);

497 
	`´štf
("; ");

504 
	`´štf
(" ");

506 
	`´štf
("\n");

509 
	}
}

513 
	$dumpCacheS‹_L2
(
ÿche_¡©e
 *
cs
)

515 
i
, 
j
, 
k
, 
Í_Ëv–
, 
cİ›s
, 
n
;

520 
	`´štf
("\nCache State_L2\n");

533 
	`´štf
("\nMUST\n");

535 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

536 
	`´štf
(" way %d ", 
i
);

537 
	`´štf
("\n");

539 
j
 = 0; j < 
ÿche_L2
.
ns
; j++)

541 
	`´štf
("£ˆ%d ", 
j
);

543  
k
 = 0; k < 
ÿche_L2
.
Ç
; k++)

545 if(
cs
->
mu¡
[
j
][
k
]->
num_’Œy
!=0)

551 
n
 = 0;‚ < 
cs
->
mu¡
[
j
][
k
]->
num_’Œy
;‚++)

552 
	`´štf
(" %d ", 
cs
->
mu¡
[
j
][
k
]->
’Œy
[
n
]);

553 
	`´štf
("; ");

556 
	`´štf
(" ");

558 
	`´štf
("\n");

562 
	`´štf
("\nMAY\n");

564 
i
 = 0; i < 
ÿche_L2
.
Ç
; i++)

565 
	`´štf
(" way %d ", 
i
);

566 
	`´štf
("\n");

568 
j
 = 0; j < 
ÿche_L2
.
ns
; j++)

570 
	`´štf
("£ˆ%d ", 
j
);

572  
k
 = 0; k < 
ÿche_L2
.
Ç
; k++)

574 if(
cs
->
may
[
j
][
k
]->
num_’Œy
!=0)

580 
n
 = 0;‚ < 
cs
->
may
[
j
][
k
]->
num_’Œy
;‚++)

581 
	`´štf
(" %d ", 
cs
->
may
[
j
][
k
]->
’Œy
[
n
]);

582 
	`´štf
("; ");

589 
	`´štf
(" ");

591 
	`´štf
("\n");

594 
	}
}

598 
	$dumpProcCİy
(
sk_t
 *
sk
)

600 
i
, 
j
;

601 
i
 = 0; i < 
sk
->
num_´oc
; i ++)

603 
	`´štf
("\Åroc_cg[%d]: %d\n", 
i
, 
´oc_cg
[i]);

604 
	`´štf
("%d: ", 
sk
->
´oc_cg_±r
[
i
].
num_´oc
);

605 
j
 = 0; j < 
sk
->
´oc_cg_±r
[
i
].
num_´oc
; j++)

607 
	`´štf
("%x ", ()
sk
->
´oc_cg_±r
[
i
].
´oc
[
j
]);

609 
	`´štf
("\n");

611 
	}
}

	@findConflicts.c

5 
	$modif›dInLoİ
Ğ
loİ
 *
Í
, *
d”i_Œ“
 ) {

7 
i
, 
j
;

8 
block
 *
bb
;

12 
loİ
 **
Ã¡ed
;

13 
num_Ã¡ed
;

15 
Ã¡ed
 = 
NULL
;

16 
num_Ã¡ed
 = 0;

18  
i
 = 0; i < 
Í
->
num_tİo
; i++ ) {

19 
bb
 = 
Í
->
tİo
[
i
];

20  
j
 = 0; j < 
num_assign
[
Í
->
pid
][
bb
->
bbid
]; j++ ) {

21 ifĞ
	`¡r¡r
Ğ
d”i_Œ“
, 
assigÆi¡
[
Í
->
pid
][
bb
->
bbid
][
j
]->d”i_Œ“ ) !ğ
NULL
 ) {

22 
	`ä“
Ğ
Ã¡ed
 );

27 ifĞ
i
 < 
Í
->
num_tİo
-1 && 
bb
->
is_loİh—d
 ) {

28 
num_Ã¡ed
++;

29 
Ã¡ed
 = (
loİ
**è
	`REALLOC
ĞÃ¡ed, 
num_Ã¡ed
 * (loop*), "nested" );

30 
Ã¡ed
[
num_Ã¡ed
-1] = 
´ocs
[
bb
->
pid
]->
loİs
[bb->
loİid
];

34  
i
 = 0; i < 
num_Ã¡ed
; i++ ) {

35 ifĞ
	`modif›dInLoİ
Ğ
Ã¡ed
[
i
], 
d”i_Œ“
 )) {

36 
	`ä“
Ğ
Ã¡ed
 );

41 
	`ä“
Ğ
Ã¡ed
 );

43 
	}
}

53 
	$»achabËNoCªûl
Ğ
pid
, 
¤cid
, 
de¡id
, *
d”i_Œ“
,

54 
assign
 *
assg
, 
block
 **
bbli¡
, 
num_bb
, *
vis™ed
 ) {

55 
i
, 
id
;

56 
block
 *
bb
;

58 ifĞ
¤cid
 =ğ
de¡id
 )

62 
bb
 = 
bbli¡
[
¤cid
];

65 ifĞ
assg
 =ğ
NULL
 || 
bb
->
bbid
 !=‡ssg->bb->bbid ) {

66  
i
 = 0; i < 
num_assign
[
pid
][
bb
->
bbid
]; i++ )

67 ifĞ
	`¡r¡r
Ğ
d”i_Œ“
, 
assigÆi¡
[
pid
][
bb
->
bbid
][
i
]->d”i_Œ“ ) !ğ
NULL
 )

72 ifĞ
¤cid
 !ğ
num_bb
 - 1 && 
bb
->
is_loİh—d


73 && 
	`modif›dInLoİ
Ğ
´ocs
[
pid
]->
loİs
[
bb
->
loİid
], 
d”i_Œ“
 ))

76 
vis™ed
[
bb
->
bbid
] = 1;

78  
i
 = 0; i < 
bb
->
num_outgošg
; i++ ) {

79 ifĞ!
vis™ed
[ 
bb
->
outgošg
[
i
] ] ) {

80 
id
 = 
	`g‘block
Ğ
bb
->
outgošg
[
i
], 
bbli¡
, 0, 
¤cid
-1 );

81 ifĞ
id
 !ğ-1 && 
	`»achabËNoCªûl
Ğ
pid
, id, 
de¡id
, 
d”i_Œ“
, 
assg
, 
bbli¡
, 
num_bb
, 
vis™ed
 ))

86 
	}
}

95 
	$isR—chabËNoCªûl
Ğ
pid
, 
¤cid
, 
de¡id
, *
d”i_Œ“
,

96 
assign
 *
assg
, 
block
 **
bbli¡
, 
num_bb
 ) {

98 *
vis™ed
;

99 
»s
;

101 ifĞ
¤cid
 =ğ
de¡id
 )

104 
vis™ed
 = (*è
	`CALLOC
Ğvis™ed, 
´ocs
[
pid
]->
num_bb
, (), "visited" );

105 
»s
 = 
	`»achabËNoCªûl
Ğ
pid
, 
¤cid
, 
de¡id
, 
d”i_Œ“
, 
assg
, 
bbli¡
, 
num_bb
, 
vis™ed
 );

107 
	`ä“
Ğ
vis™ed
 );

108  
»s
;

109 
	}
}

112 
	$addAssign
Ğ
d”i_Œ“
[], 
block
 *
bb
, 
lš’o
, 
rhs
, 
rhs_v¬
 ) {

114 
i
;

115 
assign
 *
assg
;

118  
i
 = 0; i < 
num_assign
[
bb
->
pid
][bb->
bbid
]; i++ ) {

119 
assg
 = 
assigÆi¡
[
bb
->
pid
][bb->
bbid
][
i
];

121 ifĞ
	`¡rcmp
Ğ
assg
->
d”i_Œ“
, deri_tree ) == 0 ) {

123 
assg
->
lš’o
 =†ineno;

124 
assg
->
rhs
 =„hs;

125 
assg
->
rhs_v¬
 =„hs_var;

131 
assg
 = (
assign
*è
	`MALLOC
(‡ssg, (assign), "assign" );

132 
	`¡rıy
Ğ
assg
->
d”i_Œ“
, deri_tree );

133 
assg
->
rhs
 =„hs;

134 
assg
->
rhs_v¬
 =„hs_var;

135 
assg
->
bb
 = bb;

136 
assg
->
lš’o
 =†ineno;

137 
assg
->
num_cÚæiùs
 = 0;

138 
assg
->
cÚæiùs
 = 
NULL
;

139 
assg
->
cÚæiùdœ
 = 
NULL
;

141 
num_assign
[
bb
->
pid
][bb->
bbid
]++;

143 
i
 = 
num_assign
[
bb
->
pid
][bb->
bbid
];

144 
assigÆi¡
[
bb
->
pid
][bb->
bbid
] = (
assign
**)

145 
	`REALLOC
Ğ
assigÆi¡
[
bb
->
pid
][bb->
bbid
], 
i
 * (
assign
*), "assignlist[p][b]" );

146 
assigÆi¡
[
bb
->
pid
][bb->
bbid
][
i
-1] = 
assg
;

149 
	}
}

151 
	$addB¿nch
Ğ
d”i_Œ“
[], 
block
 *
bb
, 
rhs
, 
rhs_v¬
, 
jump_cÚd
 ) {

153 
b¿nch
 *
br
;

155 
br
 = (
b¿nch
*è
	`MALLOC
( br, (branch), "branch" );

156 
	`¡rıy
Ğ
br
->
d”i_Œ“
, deri_tree );

157 
br
->
rhs
 =„hs;

158 
br
->
rhs_v¬
 =„hs_var;

159 
br
->
jump_cÚd
 = jump_cond;

160 
br
->
bb
 = bb;

161 
br
->
num_cÚæiùs
 = 0;

162 
br
->
cÚæiùs
 = 
NULL
;

163 
br
->
cÚæiùdœ_jump
 = 
NULL
;

164 
br
->
cÚæiùdœ_çÎ
 = 
NULL
;

165 
br
->
num_šcfs
 = 0;

166 
br
->
num_aùive_šcfs
 = 0;

167 
br
->
š_cÚæiù
 = (*)

168 
	`CALLOC
Ğ
br
->
š_cÚæiù
, 
´ocs
[
bb
->
pid
]->
num_bb
, (), "branch in_conflict" );

170 
b¿nchli¡
[
bb
->
pid
][bb->
bbid
] = 
br
;

173 
	}
}

176 
	$£tReg2Mem
Ğ
pos
, 
mem_addr
[], 
v®ue
, 
š¡r
 ) {

178 
»g2Mem
[
pos
].
mem_addr
[0] = '\0';

179 
	`¡rıy
Ğ
»g2Mem
[
pos
].
mem_addr
, mem_addr );

180 
»g2Mem
[
pos
].
v®ue
 = value;

181 
»g2Mem
[
pos
].
v®id
 = 1;

182 
»g2Mem
[
pos
].
š¡r
 = instr;

185 
	}
}

192 
	$execu‹
() {

194 
i
, 
j
, 
k
, 
m
;

195 
pow”
;

197 
»gPos1
, 
»gPos2
, 
»gPos3
;

198 
»gv®
;

199 
š_‹¡
;

201 
tmp
[ 
DERI_LEN
 ];

202 
off£t
[ 
DERI_LEN
 ];

204 
j®
, 
ignÜe
;

206 
´oûdu»
 *
p
;

207 
block
 *
bb
;

208 
š¡r
 *
š¢
;

210  
i
 = 0; i < 
num_´ocs
; i++ ) {

211 
p
 = 
´ocs
[
i
];

212 
j®
 = 0;

215 
	`ş—rReg
();

217  
j
 = 0; j < 
p
->
num_bb
; j++ ) {

218 
bb
 = 
p
->
bbli¡
[
j
];

220  
k
 = 0; k < 
bb
->
num_š¡r
; k++ ) {

221 
š¢
 = 
bb
->
š¡¾i¡
[
k
];

225 
ignÜe
 = 
j®
;

226 
j®
 = 0;

228 
tmp
[0] = '\0';

229 ifĞ
	`¡¾’
Ğ
š¢
->
addr
 ) < 2 ) ;

232 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "beq" ) == 0 || strcmp( insn->op, "bne" ) == 0 ) {

234 ifĞ
ignÜe
 )

237 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

238 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

242 ifĞĞ
»g2Mem
[
»gPos1
].
š¡r
 =ğ
SLTI
 ||„eg2Mem[»gPos1].š¡¸=ğ
SLT
 ) &&

243 
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) =ğ0 &&„eg2Mem[»gPos2].
v®ue
 == 0 ) {

248 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "beq" ) == 0 )

250 
	`addB¿nch
Ğ
»g2Mem
[
»gPos1
].
mem_addr
, 
bb
,„eg2Mem[»gPos1].
v®ue
, 0, 
BE
 );

253 
	`addB¿nch
Ğ
»g2Mem
[
»gPos1
].
mem_addr
, 
bb
,„eg2Mem[»gPos1].
v®ue
, 0, 
ST
 );

255 ifĞ
»g2Mem
[
»gPos1
].
š¡r
 =ğ
NIL
 &&„eg2Mem[
»gPos2
].instr == NIL ) {

261 ifĞĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos1
].
mem_addr
 ) > 0 && sŒËnĞ»g2Mem[
»gPos2
].mem_addr ) > 0 ) ||

262 Ğ
	`¡¾’
Ğ
»g2Mem
[
»gPos1
].
mem_addr
 ) =ğ0 && sŒËnĞ»g2Mem[
»gPos2
].mem_addr ) == 0 ))

265 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos1
].
mem_addr
 ) > 0 && sŒËnĞ»g2Mem[
»gPos2
].mem_addr ) == 0 ) {

267 
š_‹¡
 = 
»gPos1
;

268 
»gv®
 = 
»g2Mem
[
»gPos2
].
v®ue
 -„eg2Mem[
»gPos1
].value;

270 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos1
].
mem_addr
 ) =ğ0 && sŒËnĞ»g2Mem[
»gPos2
].mem_addr ) > 0 ) {

272 
š_‹¡
 = 
»gPos2
;

273 
»gv®
 = 
»g2Mem
[
»gPos1
].
v®ue
 -„eg2Mem[
»gPos2
].value;

276 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "bne" ) == 0 )

277 
	`addB¿nch
Ğ
»g2Mem
[
š_‹¡
].
mem_addr
, 
bb
, 
»gv®
, 0, 
NE
 );

279 
	`addB¿nch
Ğ
»g2Mem
[
š_‹¡
].
mem_addr
, 
bb
, 
»gv®
, 0, 
EQ
 );

282 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "bgez" ) == 0 || strcmp( insn->op, "blez" ) == 0 ||

283 
	`¡rcmp
Ğ
š¢
->
İ
, "bgtz" ) == 0 ) {

285 ifĞ
ignÜe
 )

289 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

292 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos1
].
mem_addr
 ) > 0 ) {

294 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "bgez" ) == 0 )

295 
	`addB¿nch
Ğ
»g2Mem
[
»gPos1
].
mem_addr
, 
bb
, 0 -„eg2Mem[»gPos1].
v®ue
, 0, 
BE
 );

296 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "bgtz" ) == 0 )

297 
	`addB¿nch
Ğ
»g2Mem
[
»gPos1
].
mem_addr
, 
bb
, 0 -„eg2Mem[»gPos1].
v®ue
, 0, 
BT
 );

299 
	`addB¿nch
Ğ
»g2Mem
[
»gPos1
].
mem_addr
, 
bb
, 0 -„eg2Mem[»gPos1].
v®ue
, 0, 
SE
 );

305 ifĞ
	`¡rcmp
Ğ
š¢
->
r1
, "$31" ) == 0 || strcmp( insn->r1, "$30" ) == 0 ||

306 
	`¡rcmp
Ğ
š¢
->
r1
, "$29" ) == 0 || strcmp( insn->r1, "$28" ) == 0 ||

307 
	`¡rcmp
Ğ
š¢
->
r3
, "$29" ) == 0 )

313 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "lw" ) == 0 || strcmp( insn->op, "lb" ) == 0 ||

314 
	`¡rcmp
Ğ
š¢
->
İ
, "lbu" ) == 0 || strcmp( insn->op, "l.d" ) == 0 ||

315 
	`¡rcmp
Ğ
š¢
->
İ
, "lh" ) == 0 ) {

320 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

321 
»gPos3
 = 
	`fšdReg
Ğ
š¢
->
r3
 );

326 
	`¥rštf
Ğ
off£t
, "%d", 
»g2Mem
[
»gPos3
].
v®ue
 + 
	`©oi
Ğ
š¢
->
r2
 ));

327 
	`¡rÿt
Ğ
tmp
, 
off£t
 );

328 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos3
].
mem_addr
 ) > 0 ) {

329 
	`¡rÿt
Ğ
tmp
, "pl" );

330 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos3
].
mem_addr
 );

332 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 0, 
NIL
 );

334 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "sw" ) == 0 || strcmp( insn->op, "sb" ) == 0 ||

335 
	`¡rcmp
Ğ
š¢
->
İ
, "sh" ) == 0 || strcmp( insn->op, "sbu" ) == 0 ) {

340 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

341 
»gPos3
 = 
	`fšdReg
Ğ
š¢
->
r3
 );

346 
	`¥rštf
Ğ
off£t
, "%d", 
»g2Mem
[
»gPos3
].
v®ue
 + 
	`©oi
Ğ
š¢
->
r2
 ));

347 
	`¡rÿt
Ğ
tmp
, 
off£t
 );

348 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos3
].
mem_addr
 ) > 0 ) {

349 
	`¡rÿt
Ğ
tmp
, "pl" );

350 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos3
].
mem_addr
 );

352 ifĞ
ignÜe
 && 
	`¡rcmp
Ğ
š¢
->
r1
, 
REG_RETURN
 ) == 0 )

354 
	`addAssign
Ğ
tmp
, 
bb
, 
k
, 0, 1 );

356 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos1
].
mem_addr
 ) =ğ0 &&„eg2Mem[»gPos1].
v®id
 )

358 
	`addAssign
Ğ
tmp
, 
bb
, 
k
, 
»g2Mem
[
»gPos1
].
v®ue
, 0 );

361 
	`addAssign
Ğ
tmp
, 
bb
, 
k
, 0, 1 );

363 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "lui" ) == 0 ) {

365 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

368 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
	`©oi
Ğ
š¢
->
r2
 ) * 65536, 
NIL
 );

370 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "addiu" ) == 0 || strcmp( insn->op, "addi" ) == 0 ) {

374 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

375 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

379 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

380 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
»g2Mem
[
»gPos2
].
v®ue
 + 
	`©oi
Ğ
š¢
->
r3
 ), 
NIL
 );

382 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "ori" ) == 0 ) {

384 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

385 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

389 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

390 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
»g2Mem
[
»gPos2
].
v®ue
 | 
	`©oi
Ğ
š¢
->
r3
 ), 
NIL
 );

392 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "andi" ) == 0 ) {

394 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

395 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

399 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

400 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
»g2Mem
[
»gPos2
].
v®ue
 & 
	`©oi
Ğ
š¢
->
r3
 ), 
NIL
 );

402 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "sll" ) == 0 ) {

405 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

406 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

410 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) > 0 ) {

412 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

413 
	`¡rÿt
Ğ
tmp
, "sll" );

414 
	`¡rÿt
Ğ
tmp
, 
š¢
->
r3
 );

416 
»gv®
 = 
»g2Mem
[
»gPos2
].
v®ue
;

417 
pow”
 = 
	`hexV®ue
Ğ
š¢
->
r3
 );

418  
m
 = 0; m < 
pow”
 ; m++ )

419 
»gv®
 *= 2;

421 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
»gv®
, 
NIL
 );

423 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "srl" ) == 0 ) {

426 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

427 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

431 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) > 0 ) {

433 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

434 
	`¡rÿt
Ğ
tmp
, "srl" );

435 
	`¡rÿt
Ğ
tmp
, 
š¢
->
r3
 );

437 
»gv®
 = 
»g2Mem
[
»gPos2
].
v®ue
;

438 
pow”
 = 
	`hexV®ue
Ğ
š¢
->
r3
 );

439  
m
 = 0; m < 
pow”
 ; m++ )

440 
»gv®
 /= 2;

442 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
»gv®
, 
NIL
 );

444 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "slti" ) == 0 || strcmp( insn->op, "sltiu" ) == 0 ) {

450 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

451 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

455 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

456 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
	`©oi
Ğ
š¢
->
r3
 ) - 
»g2Mem
[
»gPos2
].
v®ue
, 
SLTI
 );

458 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "slt" ) == 0 || strcmp( insn->op, "sltu" ) == 0 ) {

460 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

461 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

462 
»gPos3
 = 
	`fšdReg
Ğ
š¢
->
r3
 );

466 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos3
].
mem_addr
 ) == 0 ) {

468 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

469 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
»g2Mem
[
»gPos3
].
v®ue
 -„eg2Mem[
»gPos2
].v®ue, 
SLT
 );

472 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

473 
	`¡rÿt
Ğ
tmp
, "slt" );

474 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos3
].
mem_addr
 );

475 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
»g2Mem
[
»gPos3
].
v®ue
 -„eg2Mem[
»gPos2
].v®ue, 
KO
 );

478 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "addu" ) == 0 ) {

480 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

481 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

482 
»gPos3
 = 
	`fšdReg
Ğ
š¢
->
r3
 );

486 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) =ğ0 && sŒËnĞ»g2Mem[
»gPos3
].mem_addr ) > 0 )

488 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos3
].
mem_addr
 );

490 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) > 0 && sŒËnĞ»g2Mem[
»gPos3
].mem_addr ) == 0 )

492 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

494 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) > 0 && sŒËnĞ»g2Mem[
»gPos3
].mem_addr ) > 0 ) {

496 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

497 
	`¡rÿt
Ğ
tmp
, "pl" );

498 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos3
].
mem_addr
 );

500 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
»g2Mem
[
»gPos2
].
v®ue
 +„eg2Mem[
»gPos3
].v®ue, 
NIL
 );

502 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "subu" ) == 0 ) {

504 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

505 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

506 
»gPos3
 = 
	`fšdReg
Ğ
š¢
->
r3
 );

510 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) =ğ0 && sŒËnĞ»g2Mem[
»gPos3
].mem_addr ) > 0 )

512 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos3
].
mem_addr
 );

514 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) > 0 && sŒËnĞ»g2Mem[
»gPos3
].mem_addr ) == 0 )

516 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

518 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) > 0 && sŒËnĞ»g2Mem[
»gPos3
].mem_addr ) > 0 ) {

520 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

521 
	`¡rÿt
Ğ
tmp
, "sub" );

522 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos3
].
mem_addr
 );

524 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
»g2Mem
[
»gPos2
].
v®ue
 -„eg2Mem[
»gPos3
].v®ue, 
NIL
 );

526 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "or" ) == 0 ) {

528 
»gPos1
 = 
	`fšdReg
Ğ
š¢
->
r1
 );

529 
»gPos2
 = 
	`fšdReg
Ğ
š¢
->
r2
 );

530 
»gPos3
 = 
	`fšdReg
Ğ
š¢
->
r3
 );

534 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) =ğ0 && sŒËnĞ»g2Mem[
»gPos3
].mem_addr ) > 0 )

536 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos3
].
mem_addr
 );

538 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) > 0 && sŒËnĞ»g2Mem[
»gPos3
].mem_addr ) == 0 )

540 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

542 ifĞ
	`¡¾’
Ğ
»g2Mem
[
»gPos2
].
mem_addr
 ) > 0 && sŒËnĞ»g2Mem[
»gPos3
].mem_addr ) > 0 ) {

544 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos2
].
mem_addr
 );

545 
	`¡rÿt
Ğ
tmp
, "or" );

546 
	`¡rÿt
Ğ
tmp
, 
»g2Mem
[
»gPos3
].
mem_addr
 );

548 
	`£tReg2Mem
Ğ
»gPos1
, 
tmp
, 
»g2Mem
[
»gPos2
].
v®ue
 |„eg2Mem[
»gPos3
].v®ue, 
NIL
 );

550 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "jal" ) == 0 )

551 
j®
 = 1;

553 ifĞ
	`¡rcmp
Ğ
š¢
->
İ
, "j" ) == 0 );

555 ifĞ
debug
 == 2 )

556 
	`´štf
Ğ"IgnÜšg opcode: %s\n", 
š¢
->
İ
 );

589 
	}
}

595 
	$£tBACÚæiù
Ğ
assign
 *
assg
, 
b¿nch
 *
br
, 
id
, 
dœ
 ) {

597 
num
, 
pid
, 
bbid
;

599 
num_BA
++;

600 
pid
 = 
assg
->
bb
->pid;

601 
bbid
 = 
assg
->
bb
->bbid;

603 
assg
->
num_cÚæiùs
++;

604 
num
 = 
assg
->
num_cÚæiùs
;

606 
assg
->
cÚæiùs
 = (
b¿nch
**)

607 
	`REALLOC
Ğ
assg
->
cÚæiùs
, 
num
 * (
b¿nch
*), "assignlist conflicts" );

608 
assg
->
cÚæiùs
[
num
-1] = 
br
;

610 
assg
->
cÚæiùdœ
 = (*)

611 
	`REALLOC
Ğ
assg
->
cÚæiùdœ
, 
num
 * (), "assignlist conflictdir" );

612 
assg
->
cÚæiùdœ
[
num
-1] = 
dœ
;

615 ifĞ!
br
->
š_cÚæiù
[
bbid
] ) {

616 
br
->
š_cÚæiù
[
bbid
] = 1;

617 
br
->
num_šcfs
++;

618 
br
->
num_aùive_šcfs
++;

621 
	}
}

627 
	$£tBBCÚæiù
Ğ
b¿nch
 *
br1
, b¿nch *
br2
, 
dœ1
, 
dœ2
, 
Ãw
 ) {

629 
num
, 
pid
, 
bbid
;

631 
num_BB
++;

632 
pid
 = 
br1
->
bb
->pid;

633 
bbid
 = 
br1
->
bb
->bbid;

635 ifĞ
Ãw
 ) {

637 
br1
->
num_cÚæiùs
++;

638 
num
 = 
br1
->
num_cÚæiùs
;

639 
br1
->
cÚæiùs
 = (
b¿nch
**)

640 
	`REALLOC
Ğ
br1
->
cÚæiùs
, 
num
 * (
b¿nch
*), "branchlist conflicts" );

641 
br1
->
cÚæiùs
[
num
-1] = 
br2
;

643 
br1
->
cÚæiùdœ_jump
 = (*)

644 
	`REALLOC
Ğ
br1
->
cÚæiùdœ_jump
, 
num
 * (), "branchlist conflictdir_jump" );

645 
br1
->
cÚæiùdœ_jump
[
num
-1] = -1;

647 
br1
->
cÚæiùdœ_çÎ
 = (*)

648 
	`REALLOC
Ğ
br1
->
cÚæiùdœ_çÎ
, 
num
 * (), "branchlist conflictdir_fall" );

649 
br1
->
cÚæiùdœ_çÎ
[
num
-1] = -1;

652 ifĞ
dœ1
 =ğ
JUMP
 )

653 
br1
->
cÚæiùdœ_jump
[br1->
num_cÚæiùs
-1] = 
dœ2
;

654 ifĞ
dœ1
 =ğ
FALL
 )

655 
br1
->
cÚæiùdœ_çÎ
[br1->
num_cÚæiùs
-1] = 
dœ2
;

658 ifĞ!
br2
->
š_cÚæiù
[
bbid
] ) {

659 
br2
->
š_cÚæiù
[
bbid
] = 1;

660 
br2
->
num_šcfs
++;

661 
br2
->
num_aùive_šcfs
++;

664 
	}
}

675 
	$d‘eùCÚæiùTİo
Ğ
´oûdu»
 *
p
, 
block
 **
bbli¡
, 
num_bb
, 
Íid
 ) {

677 
i
, 
j
, 
k
, 
id
;

678 
£lf
, 
ÃwcÚæiù
;

680 
b¿nch
 *
bri
, *
brj
;

681 
assign
 *
assg
;

683 
jump
, 
çÎ
;

684 
block
 *
bj
;

687  
i
 = 0; i < 
num_bb
; i++ ) {

688 
id
 = 
bbli¡
[
i
]->
bbid
;

689 
bri
 = 
b¿nchli¡
[
p
->
pid
][
id
];

691 ifĞ
bri
 =ğ
NULL
 || 
p
->
bbli¡
[
id
]->
is_loİh—d
 )

697 
£lf
 = 0;

698  
k
 = 0; k < 
num_assign
[
p
->
pid
][
id
]; k++ ) {

699 
assg
 = 
assigÆi¡
[
p
->
pid
][
id
][
k
];

703 ifĞ
	`¡r¡r
Ğ
bri
->
d”i_Œ“
, 
assg
->d”i_Œ“ ) !ğ
NULL
 )

704 
£lf
 = 1;

707 ifĞ
	`¡rcmp
Ğ
bri
->
d”i_Œ“
, 
assg
->deri_tree ) == 0 ) {

709 ifĞ
	`isBACÚæiù
Ğ
assg
, 
bri
, bri->
jump_cÚd
 ))

710 
	`£tBACÚæiù
Ğ
assg
, 
bri
, 
k
, bri->
jump_cÚd
 );

712 ifĞ
	`isBACÚæiù
Ğ
assg
, 
bri
, 
	`Ãg
Ğbri->
jump_cÚd
 )))

713 
	`£tBACÚæiù
Ğ
assg
, 
bri
, 
k
, 
	`Ãg
Ğbri->
jump_cÚd
 ));

721 ifĞ
£lf
 )

725  
j
 = 
i
 + 1; j < 
num_bb
; j++ ) {

726 
bj
 = 
bbli¡
[
j
];

727 
brj
 = 
b¿nchli¡
[
p
->
pid
][
bj
->
bbid
];

730  
k
 = 0; k < 
num_assign
[
p
->
pid
][
bj
->
bbid
]; k++ ) {

731 
assg
 = 
assigÆi¡
[
p
->
pid
][
bj
->
bbid
][
k
];

734 ifĞ
	`¡rcmp
Ğ
assg
->
d”i_Œ“
, 
bri
->deri_tree ) == 0 ) {

736 ifĞ
	`isR—chabËNoCªûl
Ğ
p
->
pid
, 
j
, 
i
, 
bri
->
d”i_Œ“
, 
assg
, 
bbli¡
, 
num_bb
 )) {

738 ifĞ
	`isBACÚæiù
Ğ
assg
, 
bri
, bri->
jump_cÚd
 ))

739 
	`£tBACÚæiù
Ğ
assg
, 
bri
, 
k
, bri->
jump_cÚd
 );

741 ifĞ
	`isBACÚæiù
Ğ
assg
, 
bri
, 
	`Ãg
Ğbri->
jump_cÚd
 )))

742 
	`£tBACÚæiù
Ğ
assg
, 
bri
, 
k
, 
	`Ãg
Ğbri->
jump_cÚd
 ));

748 ifĞ
brj
 =ğ
NULL
 )

754 ifĞ
	`¡rcmp
Ğ
brj
->
d”i_Œ“
, 
bri
->deri_tree ) == 0 ) {

756 
jump
 = 
	`g‘block
Ğ
bj
->
outgošg
[1], 
bbli¡
, 0, 
j
-1 );

757 
çÎ
 = 
	`g‘block
Ğ
bj
->
outgošg
[0], 
bbli¡
, 0, 
j
-1 );

760 ifĞ
bj
->
is_loİh—d
 ) {

761 ifĞ
bj
->
loİid
 =ğ
Íid
 )

763 
çÎ
 = -1;

766 
jump
 = -1;

770 
ÃwcÚæiù
 = 1;

772 ifĞ
jump
 !ğ-1 && 
	`isR—chabËNoCªûl
Ğ
p
->
pid
, jump, 
i
, 
bri
->
d”i_Œ“
, 
NULL
, 
bbli¡
, 
num_bb
 )) {

773 ifĞ
	`isBBCÚæiù
Ğ
brj
, 
bri
, brj->
jump_cÚd
, bri->jump_cond )) {

774 
	`£tBBCÚæiù
Ğ
brj
, 
bri
, 
JUMP
, bri->
jump_cÚd
, 
ÃwcÚæiù
 );

775 
ÃwcÚæiù
 = 0;

778 ifĞ
	`isBBCÚæiù
Ğ
brj
, 
bri
, brj->
jump_cÚd
, 
	`Ãg
( bri->jump_cond ))) {

779 
	`£tBBCÚæiù
Ğ
brj
, 
bri
, 
JUMP
, 
	`Ãg
Ğbri->
jump_cÚd
 ), 
ÃwcÚæiù
 );

780 
ÃwcÚæiù
 = 0;

784 ifĞ
çÎ
 !ğ-1 && 
	`isR—chabËNoCªûl
Ğ
p
->
pid
, f®l, 
i
, 
bri
->
d”i_Œ“
, 
NULL
, 
bbli¡
, 
num_bb
 )) {

785 ifĞ
	`isBBCÚæiù
Ğ
brj
, 
bri
, 
	`Ãg
Ğbrj->
jump_cÚd
 ), bri->jump_cond )) {

786 
	`£tBBCÚæiù
Ğ
brj
, 
bri
, 
FALL
, bri->
jump_cÚd
, 
ÃwcÚæiù
 );

787 
ÃwcÚæiù
 = 0;

790 ifĞ
	`isBBCÚæiù
Ğ
brj
, 
bri
, 
	`Ãg
Ğbrj->
jump_cÚd
 ),‚eg( bri->jump_cond ))) {

791 
	`£tBBCÚæiù
Ğ
brj
, 
bri
, 
FALL
, 
	`Ãg
Ğbri->
jump_cÚd
 ), 
ÃwcÚæiù
 );

792 
ÃwcÚæiù
 = 0;

801 
	}
}

807 
	$d‘eùCÚæiùs
() {

809 
i
, 
j
;

810 
´oûdu»
 *
p
;

811 
loİ
 *
Í
;

813 
num_BA
 = 0;

814 
num_BB
 = 0;

816  
i
 = 0; i < 
num_´ocs
; i++ ) {

817 
p
 = 
´ocs
[
i
];

820 
	`d‘eùCÚæiùTİo
Ğ
p
,…->
tİo
,…->
num_tİo
, -1 );

823  
j
 = 0; j < 
p
->
num_loİs
; j++ ) {

824 
Í
 = 
p
->
loİs
[
j
];

825 
	`d‘eùCÚæiùTİo
Ğ
p
, 
Í
->
tİo
,†p->
num_tİo
,†p->
Íid
 );

829 
	}
}

	@handler.c

5 
	~<¡dio.h
>

8 
	~"cyşe_time.h
"

18 
	#CYCLES_PER_MSEC
 2992898

	)

19 
	#STARTTIME
 
	`cyşe_time
(0)

	)

20 
	#STOPTIME
 
t
 = 
	`cyşe_time
(1); 
	`´štf
Ğ"==ğ%làm£c\n",/
CYCLES_PER_MSEC
 ); 
	`fæush
Ğ
¡dout
 )

	)

25 
	#MALLOC
Ğ
±r
, 
size
, 
msg
 ) \

26 
	`m®loc
Ğ(
size
) ); \

27 ifĞ!(
±r
èè
	`´štf
Ğ"\nE¼Ü: m®loøçed fÜ %s.\n\n", (
msg
è), 
	`ex™
(1)

	)

29 
	#CALLOC
Ğ
±r
, 
Ën
, 
size
, 
msg
 ) \

30 
	`ÿÎoc
Ğ(
Ën
), (
size
) ); \

31 ifĞ!(
±r
èè
	`´štf
Ğ"\nE¼Ü: c®loøçed fÜ %s.\n\n", (
msg
è), 
	`ex™
(1)

	)

33 
	#REALLOC
Ğ
±r
, 
size
, 
msg
 ) \

34 
	`»®loc
Ğ(
±r
), (
size
) ); \

35 ifĞ!(
±r
èè
	`´štf
Ğ"\nE¼Ü:„—Îoøçed fÜ %s.\n\n", (
msg
è), 
	`ex™
(1)

	)

42 
FILE
* 
	$İ’fe
Ğ*
ext
, *
mode
 ) {

44 
FILE
 *
åŒ
;

45 
â
[80];

47 
	`¥rštf
Ğ
â
, "%s.%s", 
f’ame
, 
ext
 );

48 
åŒ
 = 
	`fİ’
Ğ
â
, 
mode
 );

49 ifĞ!
åŒ
 )

50 
	`´štf
Ğ"E¼Ü o³nšg f%s.\n", 
â
 ), 
	`ex™
(1);

52  
åŒ
;

53 
	}
}

56 
	$šdexOfProc
(
num
)

58 
i
;

59  
i
 = 0; i < 
num_´ocs
; i ++)

60 if(
num
 =ğ
´oc_cg
[
i
])

61  
i
;

63 
	}
}

	@header.h

6 
	~<time.h
>

21 
	tušt
;

22 
	tuÎ
;

27 
	#OP_LEN
 9

28 

	)

29 
	#ILP
 1

30 
	#DAG
 2

31 
	#ENUM
 3

32 

	)

33 
	#INSN_SIZE
 8

	)

34 
	#UNROLL
 2

	)

40 
	#FIRST_ITERATION
 1

	)

41 
	#NEXT_ITERATION
 2

	)

42 
	#INVALID
 0

	)

44 
	#MAX_CACHE_SETS
 1024

	)

45 
	#MAX_NEST_LOOP
 32

	)

46 
	#MAX_LEN
 512

	)

52 
	#MAX_TAG_BITS
 14

	)

54 
	#CACHE_LINE
(
addr
è(×ddrè& 
ÿche
.
l_msk
)

	)

55 
	#SET
(
addr
è((×ddrè& 
ÿche
.
s_msk
è>> cache.
lsb
)

	)

56 
	#TAG
(
addr
è((×ddrè& 
ÿche
.
t_msk
è>> cache.
s_lb
)

	)

57 
	#TAGSET
(
addr
è((×ddrè& 
ÿche
.
t_s_msk
è>> cache.
lsb
)

	)

58 
	#TAGSET2
(
g
, 
£t
è((Ñagè<< 
ÿche
.
nsb
è| (£t))

	)

59 
	#LSB_OFF
(
addr
è(×ddrè>> 
ÿche
.
lsb
)

	)

60 
	#LSB_ON
(
addr
è(×ddrè<< 
ÿche
.
lsb
)

	)

64 
	#CACHE_LINE_L2
(
addr
è(×ddrè& 
ÿche_L2
.
l_msk
)

	)

65 
	#SET_L2
(
addr
è((×ddrè& 
ÿche_L2
.
s_msk
è>> cache_L2.
lsb
)

	)

66 
	#TAG_L2
(
addr
è((×ddrè& 
ÿche_L2
.
t_msk
è>> cache_L2.
s_lb
)

	)

67 
	#TAGSET_L2
(
addr
è((×ddrè& 
ÿche_L2
.
t_s_msk
è>> cache_L2.
lsb
)

	)

68 
	#TAGSET2_L2
(
g
, 
£t
è((Ñagè<< 
ÿche_L2
.
nsb
è| (£t))

	)

69 
	#LSB_OFF_L2
(
addr
è(×ddrè>> 
ÿche_L2
.
lsb
)

	)

70 
	#LSB_ON_L2
(
addr
è(×ddrè<< 
ÿche_L2
.
lsb
)

	)

75 
	#CLEAR_LSB
(
addr
è((×ddrè>> 
ÿche
.
lsb
è<< cache.lsb)

	)

77 
	#CLEAR_LSB_L2
(
addr
è((×ddrè>> 
ÿche_L2
.
lsb
è<< cache_L2.lsb)

	)

79 
	#MBLK_ID
(
§
, 
addr
è(
	`TAGSET
×ddrè- TAGSET(§))

	)

81 
	#IC_HIT
 1

	)

82 
	#IC_MISS
 10

	)

85 
	#IC_HIT_L2
 10

	)

86 
	#IC_MISS_L2
 100

	)

88 
	#MC_INC_SIZE
 8

	)

91 
	#ALWAYS_HIT
 1

	)

92 
	#ALWAYS_MISS
 2

	)

93 
	#FIRST_MISS
 3

	)

94 
	#UNKNOW
 4

	)

95 
	#HIT_UPPER
 5

	)

97 
	#NOT_USED
 0

	)

98 
	#USED
 1

	)

100 
	#MISS
 0

	)

101 
	#HIT
 1

	)

107 
	#´št
 0

	)

109 
	g´ocs
;

110 
	gacc_g
;

113 
	maddr
[
OP_LEN
];

114 
	mİ
[
OP_LEN
];

115 
	mr1
[
OP_LEN
];

116 
	mr2
[
OP_LEN
];

117 
	mr3
[
OP_LEN
];

118 
acc_g
* 
	macc_t
;

119 
acc_g
* 
	macc_t_l2
;

120 } 
	tš¡r
;

126 
	mns
;

127 
	mls
;

128 
	mnsb
;

129 
	mlsb
;

130 
	mcmp
;

131 
	mÇ
;

134 
	mÁ
;

135 
	mÁb
;

138 
	ms_lb
;

139 
	mt_sb
;

140 
	mÁ_s
;

143 
ušt
 
	ml_msk
;

144 
ušt
 
	ms_msk
;

145 
ušt
 
	mt_msk
;

146 
ušt
 
	mt_s_msk
;

147 } 
	tÿche_t
;

170 
	mh™miss
;

171 *
	mh™miss_addr
;

173 
	mh™
, 
	mmiss
, 
	munknow
;

174 *
	mh™_addr
, *
	mmiss_addr
, *
	munknow_addr
;

175 *
	mh™_chªge_miss
, *
	mage
;

176 
	mh™_cİy
;

177 
	munknow_cİy
;

179 
ušt
 
	mbco¡
;

180 
ušt
 
	mbco¡_cİy
;

182 
ušt
 
	mwco¡
;

183 
ušt
 
	mwco¡_cİy
;

184 }
	tCHMC
;

187 
	mnum_’Œy
;

188 *
	m’Œy
;

189 } 
	tÿche_lše_way_t
;

193 
ÿche_lše_way_t
 *** 
	mmu¡
;

194 
ÿche_lše_way_t
 *** 
	mmay
;

195 
ÿche_lše_way_t
 *** 
	m³rsi¡
;

198 } 
	tÿche_¡©e
;

212 
	mbbid
;

213 
	mpid
;

214 
	m¡¬ddr
;

217 *
	moutgošg
;

218 
	mnum_outgošg
;

219 
	mnum_outgošg_cİy
;

221 *
	mšcomšg
;

222 
	mnum_šcomšg
;

224 
	mÿÎpid
;

225 
ušt
 
	msize
;

241 
	mloİid
;

242 
	mis_loİh—d
;

243 
š¡r
 **
	mš¡¾i¡
;

244 
	mnum_š¡r
;

246 
CHMC
 **
	mchmc
, **
	mchmc_L2
;

247 
	mnum_chmc
, 
	mnum_chmc_L2
;

249 
ÿche_¡©e
 *
	mbb_ÿche_¡©e
, *
	mbb_ÿche_¡©e_L2
;

250 
	mnum_ÿche_¡©e
, 
	mnum_ÿche_¡©e_L2
;

251 
´ocs
* 
	m´oc_±r
;

255 
	mnum_acûss
;

257 
	mnum_ÿche_ãtch
;

258 
	mnum_ÿche_ãtch_L2
;

266 
uÎ
 
	m¡¬t_time
;

267 
uÎ
 
	mfšish_time
;

268 
uÎ
 
	m¡¬t_İt
[64];

269 
uÎ
 
	mfš_İt
[64];

270 
uÎ
 
	mÏ‹¡_bus
[64];

271 
uÎ
 
	mÏ‹¡_Ï‹ncy
[64];

272 } 
	tblock
;

276 
	mÍid
;

277 
	mpid
;

278 
	mloİbound
;

279 
block
 *
	mloİh—d
;

280 
block
 *
	mloİsšk
;

281 
block
 *
	mloİex™
;

282 
	mËv–
;

283 
	mÃ¡
;

284 
	mis_dowhe
;

285 
block
 **
	mtİo
;

286 
	mnum_tİo
;

287 
uÎ
 *
	mwût
;

288 
uÎ
 *
	mbût
;

290 
uÎ
 *
	mh™_wût
;

291 
uÎ
 *
	mmiss_wût
;

292 
uÎ
 *
	munknow_wût
;

294 
uÎ
 *
	mh™_wût_L2
;

295 
uÎ
 *
	mmiss_wût_L2
;

296 
uÎ
 *
	munknow_wût_L2
;

299 
uÎ
 *
	mh™_bût
;

300 
uÎ
 *
	mmiss_bût
;

301 
uÎ
 *
	munknow_bût
;

303 
uÎ
 *
	mh™_bût_L2
;

304 
uÎ
 *
	mmiss_bût_L2
;

305 
uÎ
 *
	munknow_bût_L2
;

307 
	mnum_co¡
;

309 
	mnum_fm
;

310 
	mnum_fm_L2
;

312 *
	mw·th
;

313 
uÎ
 
	m¡¬t_İt
[64];

314 
uÎ
 
	mfš_İt
[64];

315 
uÎ
 
	mwût_İt
[64];

316 }
	tloİ
;

320 
	s´ocs
 {

321 
	mpid
;

322 
block
 **
	mbbli¡
;

323 
	mnum_bb
;

324 
loİ
 **
	mloİs
;

325 
	mnum_loİs
;

326 *
	mÿÎs
;

327 
	mnum_ÿÎs
;

328 
block
 **
	mtİo
;

329 
	mnum_tİo
;

331 
uÎ
 *
	mwût
;

332 
uÎ
 *
	mbût
;

334 
uÎ
 *
	mh™_wût
;

335 
uÎ
 *
	mmiss_wût
;

336 
uÎ
 *
	munknow_wût
;

338 
uÎ
 *
	mh™_wût_L2
;

339 
uÎ
 *
	mmiss_wût_L2
;

340 
uÎ
 *
	munknow_wût_L2
;

343 
uÎ
 *
	mh™_bût
;

344 
uÎ
 *
	mmiss_bût
;

345 
uÎ
 *
	munknow_bût
;

347 
uÎ
 *
	mh™_bût_L2
;

348 
uÎ
 *
	mmiss_bût_L2
;

349 
uÎ
 *
	munknow_bût_L2
;

351 
	mnum_co¡
;

353 *
	mw·th
;

354 *
	mh™_ÿche_£t_L2
;

355 
ÿche_lše_way_t
 *
	mh™_addr
;

359 
uÎ
 
	mruÂšg_co¡
;

360 
uÎ
 
	mruÂšg_fšish_time
;

361 }
	t´oûdu»
;

365 
´oûdu»
 **
	m´oc
;

366 
	mnum_´oc
;

367 }
	t´oc_cİy
;

372 
	msk_id
;

373 
	msk_Çme
[
MAX_LEN
];

374 
´oûdu»
 *
	mmaš_cİy
;

375 
	mnum_´oc
;

376 
´oc_cİy
 *
	m´oc_cg_±r
;

377 
´oûdu»
* 
	m’Œy_´oc
;

379 
	mnumSuccs
;

380 * 
	msuccLi¡
;

382 
uÎ
 
	mwût
;

383 
uÎ
 
	mbût
;

385 
uÎ
 
	mh™_wût
;

386 
uÎ
 
	mmiss_wût
;

387 
uÎ
 
	munknow_wût
;

389 
uÎ
 
	mh™_wût_L2
;

390 
uÎ
 
	mmiss_wût_L2
;

391 
uÎ
 
	munknow_wût_L2
;

394 
uÎ
 
	mh™_bût
;

395 
uÎ
 
	mmiss_bût
;

396 
uÎ
 
	munknow_bût
;

398 
uÎ
 
	mh™_bût_L2
;

399 
uÎ
 
	mmiss_bût_L2
;

400 
uÎ
 
	munknow_bût_L2
;

403 
uÎ
 
	ml_¡¬t
;

404 }
	tsk_t
;

408 
sk_t
 *
	mskLi¡
;

409 
	mnum_sk
;

410 
	mmsc_Çme
[
MAX_LEN
];

411 **
	mš‹rãrInfo
;

412 }
	tMSC
;

417 *
	gš‹rã»P©hName
;

418 *
	gf’ame
;

419 *
	gÿche_cÚfig
;

420 *
	gÿche_cÚfig_L2
;

422 *
	gnumCÚæiùTask
;

423 *
	gnumCÚæiùMSC
;

425 
	gm‘hod
;

426 
	gšãas
;

427 
	gdebug
;

429 
	gt
;

432 
´oûdu»
 **
	g´ocs
;

433 
	gnum_´ocs
;

434 
	gmaš_id
;

435 *
	g´oc_cg
;

437 
MSC
 **
	gmsc
;

442 
	gtÙ®_bb
;

445 
	gtimes_™”©iÚ
;

446 
	gnum_cÜe
;

447 
	gš¡r_³r_block
;

448 
	gš¡r_³r_block_L2
;

455 
ÿche_t
 
	gÿche
, 
	gÿche_L2
;

463 *
	gloİ_Ëv–_¬r
;

465 
´oûdu»
 *
	gmaš_cİy
;

468 
	gnum»gs
;

469 
ušt
 *
	g»giÚco¡
;

471 
	g»giÚmode
;

475 
	#L1_HIT_LATENCY
 1

	)

476 
	#L2_HIT_LATENCY
 6

	)

477 
	#MISS_PENALTY
 36

	)

478 
	#MAX_BUS_DELAY
 120

	)

479 
	#IS_CALL
(
x
è((
	`¡rcmp
((x), "j®"è=ğ0è? 1 : 0)

	)

480 
	#GET_CALLEE
(
x
è(x->
r1
)

	)

481 
	eacc_g
{

482 
	mL2_MISS
 = 0,

483 
	mL1_HIT
,

484 
	mL2_HIT


485 } 
	tacc_ty³
;

489 
ušt
 
	gncÜe
;

492 
	#PARTITION_CORE
 -1

	)

494 
	mSCHED_TYPE_1
 = 0,

495 
	mSCHED_TYPE_2
,

496 
	mSCHED_TYPE_3


497 } 
	tsched_ty³
;

499 
	scÜe_sched
 {

500 
uÎ
 
	m¡¬t_time
;

501 
ušt
 
	mš‹rv®
;

502 
ušt
 
	m¦Ù_Ën
;

504 
cÜe_sched
 
	tcÜe_sched_s
;

505 
cÜe_sched
* 
	tcÜe_sched_p
;

507 
	s£gm’t
 {

508 
uÎ
 
	m£g_¡¬t
;

509 
uÎ
 
	m£g_’d
;

510 
cÜe_sched_p
* 
	m³r_cÜe_sched
;

512 
£gm’t
 
	t£gm’t_s
;

513 
£gm’t
* 
	t£gm’t_p
;

515 
	sscheduË
 {

516 
sched_ty³
 
	mty³
;

517 
£gm’t_p
* 
	m£g_li¡
;

518 
ušt
 
	mn_£gm’ts
;

519 
ušt
 
	mn_cÜes
;

521 
scheduË
 
	tsched_s
;

522 
scheduË
* 
	tsched_p
;

525 
sk_t
* 
	gcur_sk
;

528 
uÎ
* 
	gÏ‹¡
;

531 
sched_p
 
	gglob®_sched_d©a
;

532 
ušt
 
	gcur_cÚ‹xt
;

533 
ušt
 
	gacc_bus_d–ay
;

536 
ušt
 
	gg_‹¡šg_mode
;

538 
ušt
 
	gg_sh¬ed_bus
;

540 
ušt
 
	gg_šd•’d’t_sk
;

542 
ušt
 
	gg_´iv©e
;

544 
ušt
 
	gg_no_bus_mod–šg
;

547 
uÎ
 
	g®l_š¡
;

549 
	gg_İtimized
;

	@infeasible.c

6 
	$š™RegS‘
() {

8 
	`¡rıy
Ğ
»gName
[0] , "$0" ); strcpy(„egName[1] , "$1" );

9 
	`¡rıy
Ğ
»gName
[2] , "$2" ); strcpy(„egName[3] , "$3" );

10 
	`¡rıy
Ğ
»gName
[4] , "$4" ); strcpy(„egName[5] , "$5" );

11 
	`¡rıy
Ğ
»gName
[6] , "$6" ); strcpy(„egName[7] , "$7" );

12 
	`¡rıy
Ğ
»gName
[8] , "$8" ); strcpy(„egName[9] , "$9" );

13 
	`¡rıy
Ğ
»gName
[10], "$10" ); strcpy(„egName[11], "$11" );

14 
	`¡rıy
Ğ
»gName
[12], "$12" ); strcpy(„egName[13], "$13" );

15 
	`¡rıy
Ğ
»gName
[14], "$14" ); strcpy(„egName[15], "$15" );

16 
	`¡rıy
Ğ
»gName
[16], "$16" ); strcpy(„egName[17], "$17" );

17 
	`¡rıy
Ğ
»gName
[18], "$18" ); strcpy(„egName[19], "$19" );

18 
	`¡rıy
Ğ
»gName
[20], "$20" ); strcpy(„egName[21], "$21" );

19 
	`¡rıy
Ğ
»gName
[22], "$22" ); strcpy(„egName[23], "$23" );

20 
	`¡rıy
Ğ
»gName
[24], "$24" ); strcpy(„egName[25], "$25" );

21 
	`¡rıy
Ğ
»gName
[26], "$26" ); strcpy(„egName[27], "$27" );

22 
	`¡rıy
Ğ
»gName
[28], "$28" ); strcpy(„egName[29], "$29" );

23 
	`¡rıy
Ğ
»gName
[30], "$30" ); strcpy(„egName[31], "$31" );

25 
	`¡rıy
Ğ
»gName
[34], "$f0" ); strcpy(„egName[35], "$f1" );

26 
	`¡rıy
Ğ
»gName
[36], "$f2" ); strcpy(„egName[37], "$f3" );

27 
	`¡rıy
Ğ
»gName
[38], "$f4" ); strcpy(„egName[39], "$f5" );

28 
	`¡rıy
Ğ
»gName
[40], "$f6" ); strcpy(„egName[41], "$f7" );

29 
	`¡rıy
Ğ
»gName
[42], "$f8" ); strcpy(„egName[43], "$f9" );

30 
	`¡rıy
Ğ
»gName
[44], "$f10" ); strcpy(„egName[45], "$f11" );

31 
	`¡rıy
Ğ
»gName
[46], "$f12" ); strcpy(„egName[47], "$f13" );

32 
	`¡rıy
Ğ
»gName
[48], "$f14" ); strcpy(„egName[49], "$f15" );

33 
	`¡rıy
Ğ
»gName
[50], "$f16" ); strcpy(„egName[51], "$f17" );

34 
	`¡rıy
Ğ
»gName
[52], "$f18" ); strcpy(„egName[53], "$f19" );

35 
	`¡rıy
Ğ
»gName
[54], "$f20" ); strcpy(„egName[55], "$f21" );

36 
	`¡rıy
Ğ
»gName
[56], "$f22" ); strcpy(„egName[57], "$f23" );

37 
	`¡rıy
Ğ
»gName
[58], "$f24" ); strcpy(„egName[59], "$f25" );

38 
	`¡rıy
Ğ
»gName
[60], "$f26" ); strcpy(„egName[61], "$f27" );

39 
	`¡rıy
Ğ
»gName
[62], "$f28" ); strcpy(„egName[63], "$f29" );

40 
	`¡rıy
Ğ
»gName
[64], "$f30" ); strcpy(„egName[65], "$f31" );

42 
	`¡rıy
Ğ
»gName
[66], "$fcc" );

44 
»g2Mem
[0].
mem_addr
[0] = '\0';

45 
»g2Mem
[0].
v®ue
 = 0;

46 
»g2Mem
[0].
v®id
 = 1;

47 
»g2Mem
[0].
š¡r
 = 
NIL
;

49 
	`¡rıy
Ğ
»g2Mem
[28].
mem_addr
, "$28" );

50 
»g2Mem
[28].
v®ue
 = 0;

51 
»g2Mem
[28].
v®id
 = 0;

52 
»g2Mem
[28].
š¡r
 = 
NIL
;

54 
	`¡rıy
Ğ
»g2Mem
[30].
mem_addr
, "$30" );

55 
»g2Mem
[30].
v®ue
 = 0;

56 
»g2Mem
[30].
v®id
 = 0;

57 
»g2Mem
[30].
š¡r
 = 
NIL
;

60 
	}
}

63 
	$ş—rReg
() {

65 
i
;

66  
i
 = 1; i < 
NO_REG
; i++ ) {

68 ifĞ
i
 == 28 || i == 30 )

71 
»g2Mem
[
i
].
mem_addr
[0] = '\0';

72 
»g2Mem
[
i
].
v®ue
 = 0;

73 
»g2Mem
[
i
].
v®id
 = 0;

74 
»g2Mem
[
i
].
š¡r
 = 
NIL
;

77 
	}
}

80 
	$fšdReg
Ğ
key
[] ) {

82 
i
;

83  
i
 = 0; i < 
NO_REG
; i++ ) {

84 ifĞ
	`¡rcmp
Ğ
key
, 
»gName
[
i
] ) == 0 )

85  
i
;

87 
	}
}

90 
	$Ãg
Ğ
a
 ) {

92 ifĞ
a
 =ğ
BT
 )  
SE
;

93 ifĞ
a
 =ğ
BE
 )  
ST
;

94 ifĞ
a
 =ğ
SE
 )  
BT
;

95 ifĞ
a
 =ğ
ST
 )  
BE
;

96 ifĞ
a
 =ğ
EQ
 )  
NE
;

97 ifĞ
a
 =ğ
NE
 )  
EQ
;

98  
NA
;

99 
	}
}

105 
	$‹¡CÚæiù
Ğ
a
, 
rhs_a
, 
b
, 
rhs_b
 ) {

107 ifĞ
a
 =ğ
BT
 ) {

108 ifĞ
b
 =ğ
ST
 || b =ğ
SE
 || b =ğ
EQ
 ) {

109 ifĞ
rhs_a
 < 
rhs_b
 )  0;

114 ifĞ
a
 =ğ
ST
 ) {

115 ifĞ
b
 =ğ
BT
 || b =ğ
BE
 || b =ğ
EQ
 ) {

116 ifĞ
rhs_a
 > 
rhs_b
 )  0;

121 ifĞ
a
 =ğ
BE
 ) {

122 ifĞ
b
 =ğ
ST
 ) {

123 ifĞ
rhs_a
 < 
rhs_b
 )  0;

126 ifĞ
b
 =ğ
SE
 || b =ğ
EQ
 ) {

127 ifĞ
rhs_a
 <ğ
rhs_b
 )  0;

132 ifĞ
a
 =ğ
SE
 ) {

133 ifĞ
b
 =ğ
BT
 ) {

134 ifĞ
rhs_a
 > 
rhs_b
 )  0;

137 ifĞ
b
 =ğ
BE
 || b =ğ
EQ
 ) {

138 ifĞ
rhs_a
 >ğ
rhs_b
 )  0;

143 ifĞ
a
 =ğ
EQ
 ) {

144 ifĞ
b
 =ğ
NE
 ) {

145 ifĞ
rhs_a
 !ğ
rhs_b
 )  0;

148 ifĞ
b
 =ğ
EQ
 ) {

149 ifĞ
rhs_a
 =ğ
rhs_b
 )  0;

152 ifĞ
b
 =ğ
ST
 ) {

153 ifĞ
rhs_a
 < 
rhs_b
 )  0;

156 ifĞ
b
 =ğ
BT
 ) {

157 ifĞ
rhs_a
 > 
rhs_b
 )  0;

160 ifĞ
b
 =ğ
SE
 ) {

161 ifĞ
rhs_a
 <ğ
rhs_b
 )  0;

164 ifĞ
b
 =ğ
BE
 ) {

165 ifĞ
rhs_a
 >ğ
rhs_b
 )  0;

169 ifĞ
a
 =ğ
NE
 ) {

170 ifĞ
b
 =ğ
EQ
 && ( 
rhs_a
 =ğ
rhs_b
 ))

175 
	}
}

184 
	$isBBCÚæiù
Ğ
b¿nch
 *
A
, b¿nch *
B
, 
r1
, 
r2
 ) {

186  
	`‹¡CÚæiù
Ğ
r1
, 
A
->
rhs
, 
r2
, 
B
->rhs );

187 
	}
}

190 
	$isBACÚæiù
Ğ
assign
 *
A
, 
b¿nch
 *
B
, 
r
 ) {

192 ifĞ
A
->
rhs_v¬
 )  0;

193  
	`‹¡CÚæiù
Ğ
EQ
, 
A
->
rhs
, 
r
, 
B
->rhs );

194 
	}
}

200 
	$š™Inãas
() {

202 
i
, 
j
;

203 
´oûdu»
 *
p
;

206 
	`š™RegS‘
();

209 
num_assign
 = (**è
	`MALLOC
Ğnum_assign, 
num_´ocs
 * (*), "num_assign" );

210 
assigÆi¡
 = (
assign
****è
	`MALLOC
ĞassigÆi¡, 
num_´ocs
 * (assign***), "assignlist" );

211 
b¿nchli¡
 = (
b¿nch
***è
	`MALLOC
Ğb¿nchli¡, 
num_´ocs
 * (branch**), "branchlist" );

213  
i
 = 0; i < 
num_´ocs
; i++ ) {

214 
p
 = 
´ocs
[
i
];

216 
num_assign
[
i
] = (*è
	`CALLOC
Ğnum_assign[i], 
p
->
num_bb
, (), "num_assignƒlm" );

217 
assigÆi¡
[
i
] = (
assign
***è
	`MALLOC
ĞassigÆi¡[i], 
p
->
num_bb
 * (assign**), "assignlistƒlm" );

218 
b¿nchli¡
[
i
] = (
b¿nch
**è
	`MALLOC
Ğb¿nchli¡[i], 
p
->
num_bb
 * (branch*), "branchlistƒlm" );

220  
j
 = 0; j < 
p
->
num_bb
; j++ ) {

221 
assigÆi¡
[
i
][
j
] = 
NULL
;

222 
b¿nchli¡
[
i
][
j
] = 
NULL
;

227 
	`execu‹
();

230 
	`d‘eùCÚæiùs
();

232 
	`´štf
Ğ"D‘eùed %d BB‡nd %d BA\n", 
num_BB
, 
num_BA
 );

234 
	}
}

	@infeasible.h

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<¡ršg.h
>

4 
	~<m©h.h
>

5 
	~<time.h
>

8 
	#REG_RETURN
 
»gName
[2]

	)

12 
	#DERI_LEN
 800

13 
	#INSN_LEN
 50

14 
	#NO_REG
 68

	)

16 
	#JUMP
 1

	)

17 
	#FALL
 2

	)

19 
	#BT
 1

20 
	#BE
 2

21 
	#ST
 3

22 
	#SE
 4

23 
	#EQ
 5

24 
	#NE
 6

25 
	#NA
 0

26 

	)

30 
	#KO
 -2

31 
	#NIL
 -1

	)

32 
	#SLTI
 1

	)

33 
	#SLT
 2

	)

37 
	mmem_addr
[
DERI_LEN
];

38 
	mv®ue
;

39 
	mv®id
;

40 
	mš¡r
;

41 } 
	td”i_Œ“
;

43 
	sbrch
 {

44 
	md”i_Œ“
[
DERI_LEN
];

45 
	mrhs
;

46 
	mrhs_v¬
;

47 
	mjump_cÚd
;

48 
block
 *
	mbb
;

49 
	mnum_aùive_šcfs
;

50 
	mnum_šcfs
;

51 *
	mš_cÚæiù
;

52 
	mnum_cÚæiùs
;

53 
brch
 **
	mcÚæiùs
;

54 *
	mcÚæiùdœ_jump
;

55 *
	mcÚæiùdœ_çÎ
;

56 } 
	tb¿nch
;

59 
	md”i_Œ“
[
DERI_LEN
];

60 
	mrhs
;

61 
	mrhs_v¬
;

62 
block
 *
	mbb
;

63 
	mlš’o
;

64 
	mnum_cÚæiùs
;

65 
b¿nch
 **
	mcÚæiùs
;

66 *
	mcÚæiùdœ
;

67 } 
	tassign
;

71 
uÎ
 
	mco¡
;

72 
	mbb_Ën
;

73 *
	mbb_£q
;

74 
	mb¿nch_Ën
;

75 
b¿nch
 **
	mb¿nch_eff
;

76 *
	mb¿nch_dœ
;

77 } 
	t·th
;

80 
	g»gName
[
NO_REG
][
OP_LEN
];

81 
d”i_Œ“
 
	g»g2Mem
[
NO_REG
];

83 **
	gnum_assign
;

84 
assign
 ****
	gassigÆi¡
;

85 
b¿nch
 ***
	gb¿nchli¡
;

87 
	gnum_BA
;

88 
	gnum_BB
;

90 *
	gnum_·ths
;

91 
·th
 ***
	g·thli¡
;

93 
	gmax_·ths
;

94 *
	g·thF»ed
;

	@loopdetect.c

5 
	~<¡ršg.h
>

6 
	~<¡dio.h
>

13 
	$»achabË
Ğ
¤c
, 
de¡
, 
block
 **
bbli¡
, *
vis™ed
 ) {

15 
i
;

16 
block
 *
bb
;

18 ifĞ
¤c
 =ğ
de¡
 )

21 
vis™ed
[
¤c
] = 1;

23 
bb
 = 
bbli¡
[
¤c
];

24 ifĞ!
bb
 )

25 
	`´štf
Ğ"»achabË: NuÎ basiøblock‡ˆ%d.\n", 
¤c
 ), 
	`ex™
(1);

27  
i
 = 0; i < 
bb
->
num_outgošg
; i++ ) {

28 ifĞ!
vis™ed
[ 
bb
->
outgošg
[
i
] ] )

29 ifĞ
	`»achabË
Ğ
bb
->
outgošg
[
i
], 
de¡
, 
bbli¡
, 
vis™ed
 ))

33 
	}
}

39 
	$isR—chabË
Ğ
¤c
, 
de¡
, 
block
 **
bbli¡
, 
num_bb
 ) {

41 *
vis™ed
;

42 
»s
;

44 
vis™ed
 = (*è
	`CALLOC
Ğvis™ed, 
num_bb
, (), "visited" );

45 
»s
 = 
	`»achabË
Ğ
¤c
, 
de¡
, 
bbli¡
, 
vis™ed
 );

47 
	`ä“
Ğ
vis™ed
 );

48  
»s
;

49 
	}
}

56 
	$Ã¡ed
Ğ
šloİid
, 
ouoİid
, 
loİ
 **
loİs
 ) {

58 
loİ
 *
š
;

60 ifĞ
šloİid
 == -1 )

63 
š
 = 
loİs
[
šloİid
];

64 ifĞ!
š
 )

65 
	`´štf
Ğ"NuÎ†oİ‡ˆ%d\n", 
šloİid
 ), 
	`ex™
(1);

67 ifĞ
š
->
Ã¡
 == -1 )

70 ifĞ
š
->
Ã¡
 =ğ
ouoİid
 )

73  
	`Ã¡ed
Ğ
š
->
Ã¡
, 
ouoİid
, 
loİs
 );

74 
	}
}

80 
	$»moveEdge
Ğ
block
 *
bb
, 
outid
 ) {

84 
bb
->
num_outgošg
--;

87 ifĞ
bb
->
num_outgošg
 && 
outid
 == 0 )

88 
bb
->
outgošg
[0] = bb->outgoing[1];

91 
	}
}

97 
	$»moveEx™Edges
Ğ
´oûdu»
 *
p
 ) {

99 
i
, 
j
, 
k
;

100 
loİ
 *
Í
;

101 
block
 *
bb
, *
e
;

103  
i
 = 0; i < 
p
->
num_loİs
; i++ ) {

104 
Í
 = 
p
->
loİs
[
i
];

106  
j
 = 0; j < 
Í
->
num_tİo
; j++ ) {

107 
bb
 = 
Í
->
tİo
[
j
];

109  
k
 = 0; k < 
bb
->
num_outgošg
; k++ ) {

110 
e
 = 
p
->
bbli¡
[ 
bb
->
outgošg
[
k
] ];

112 ifĞ
e
->
loİid
 !ğ
Í
->
Íid
 && !
	`Ã¡ed
Ğe->loİid,†p->Íid, 
p
->
loİs
 )) {

113 
	`»moveEdge
Ğ
bb
, 
k
 );

120 
	}
}

126 
	$»moveBackEdges
Ğ
loİ
 **
loİs
, 
num_loİs
 ) {

128 
i
;

129 
loİ
 *
Í
;

130 
block
 *
bb
;

132  
i
 = 0; i < 
num_loİs
; i++ ) {

133 
Í
 = 
loİs
[
i
];

134 
bb
 = 
Í
->
loİsšk
;

136 ifĞ
bb
->
num_outgošg
 =ğ1 && bb->
outgošg
[0] =ğ
Í
->
loİh—d
->
bbid
 )

137 
bb
->
num_outgošg
--;

138 ifĞ
bb
->
num_outgošg
 == 2 ) {

140 ifĞ
bb
->
outgošg
[0] =ğ
Í
->
loİh—d
->
bbid
 ) {

141 
bb
->
outgošg
[0] = bb->outgoing[1];

142 
bb
->
num_outgošg
--;

144 ifĞ
bb
->
outgošg
[1] =ğ
Í
->
loİh—d
->
bbid
 )

145 
bb
->
num_outgošg
--;

148 
bb
->
num_outgošg_cİy
 = bb->
num_outgošg
;

152 
	}
}

158 
	$šEx™s
Ğ
id
, 
block
 **
ex™s
, 
num_ex™s
 ) {

160 
i
;

161  
i
 = 0; i < 
num_ex™s
; i++ )

162 ifĞ
ex™s
[
i
]->
bbid
 =ğ
id
 )

163  
i
;

165 
	}
}

176 
block
 *
	$´om±LoİEx™
Ğ
loİ
 *
Í
, 
block
 **
ex™s
, 
num_ex™s
 ) {

178 
i
, 
»s
;

179 
´oc
[100];

181 
š¡r
 *
š¢
;

183 
	`´štLoİ
Ğ
Í
 );

184 
	`´štf
Ğ"%dƒx™ d‘eùed fÜ†oİ %d-%d:\n", 
num_ex™s
, 
Í
->
pid
,†p->
Íid
 );

186  
i
 = 0; i < 
num_ex™s
; i++ ) {

194 
	`´štf
Ğ"Ex™[%d]: %3d\À", 
i
, 
ex™s
[i]->
bbid
 ); 
	`fæush
Ğ
¡dout
 );

212 
»s
 = 
ex™s
[0]->
bbid
;

215  
i
 = 0; i < 
num_ex™s
; i++ ) {

216 ifĞ
»s
 =ğ
ex™s
[
i
]->
bbid
 )

217  
ex™s
[
i
];

221 
	`´štf
( "Sorry,hat was‡n invalid choice.\n" );

222  
	`´om±LoİEx™
Ğ
Í
, 
ex™s
, 
num_ex™s
 );

223 
	}
}

231 
	$»adLoİEx™
Ğ
loİ
 *
Í
, 
block
 **
ex™s
, 
num_ex™s
 ) {

233 
FILE
 *
åŒ
;

234 
pid
, 
Íid
, 
ex
, 
id
;

236 
åŒ
 = 
	`İ’fe
( "ex", "r" );

238  
	`fsÿnf
Ğ
åŒ
, "%d %d %d", &
pid
, &
Íid
, &
ex
 ) !ğ
EOF
 ) {

240 ifĞ
pid
 =ğ
Í
->pid && 
Íid
 ==†p->lpid ) {

241 
id
 = 
	`šEx™s
Ğ
ex
, 
ex™s
, 
num_ex™s
 );

243 ifĞ
id
 != -1 ) {

244 
Í
->
loİex™
 = 
ex™s
[
id
];

245 
	`fşo£
Ğ
åŒ
 );

250 
	`fşo£
Ğ
åŒ
 );

252 
	}
}

259 
	$d‘”mšeLoİEx™s
Ğ
loİ
 **
loİs
, 
num_loİs
, 
block
 **
bbli¡
, 
num_bb
 ) {

261 
block
 **
ex™s
;

262 
num_ex™s
;

264 
i
, 
j
, 
k
;

265 
sucûss
;

266 
´oc
[100];

268 
loİ
 *
Í
;

269 
block
 *
b
;

271  
i
 = 0; i < 
num_loİs
; i++ ) {

272 
Í
 = 
loİs
[
i
];

274 
ex™s
 = 
NULL
;

275 
num_ex™s
 = 0;

278  
j
 = 0; j < 
Í
->
num_tİo
; j++ ) {

279 
b
 = 
Í
->
tİo
[
j
];

281  
k
 = 0; k < 
b
->
num_outgošg
; k++ ) {

283 ifĞ
	`g‘block
Ğ
b
->
outgošg
[
k
], 
Í
->
tİo
, 0,†p->
num_tİo
-1 ) == -1 ) {

286 ifĞ
	`šEx™s
Ğ
b
->
outgošg
[
k
], 
ex™s
, 
num_ex™s
 ) == -1 ) {

288 
num_ex™s
++;

289 
ex™s
 = (
block
**è
	`REALLOC
Ğex™s, 
num_ex™s
 * (block*), "exits" );

290 
ex™s
[ 
num_ex™s
 - 1 ] = 
bbli¡
[ 
b
->
outgošg
[
k
] ];

298 ifĞ!
num_ex™s
 )

299 
	`´štf
Ğ"Loİex™‚Ù d‘eùed fÜ %d\n", 
Í
->
Íid
 ), 
	`ex™
(1);

301 ifĞ
num_ex™s
 == 1 )

302 
Í
->
loİex™
 = 
ex™s
[0];

306 
sucûss
 = 0;

307 
	`¥rštf
Ğ
´oc
, "l %s.ex 2> /dev/nuÎ", 
f’ame
 );

309 ifĞ!
	`sy¡em
Ğ
´oc
 ))

311 
sucûss
 = 
	`»adLoİEx™
Ğ
Í
, 
ex™s
, 
num_ex™s
 );

313 ifĞ!
sucûss
 )

315 
Í
->
loİex™
 = 
	`´om±LoİEx™
ĞÍ, 
ex™s
, 
num_ex™s
 );

317 
	`ä“
Ğ
ex™s
 );

320 
	}
}

326 
	$»ad_loİ_ªnÙ©iÚ
() {

328 
c
;

330 
FILE
 *
åŒ
;

331 
´oc
[100];

333 
pid
, 
Íid
, 
lb
, 
dw
;

334 
´oûdu»
 *
p
;

335 
loİ
 *
Í
;

338 
	`¥rštf
Ğ
´oc
, "l %s.lb 2> /dev/nuÎ", 
f’ame
 );

339 ifĞ
	`sy¡em
Ğ
´oc
 )) {

342 
	`´štf
( "Loops detected:\n" );

343 
	`´št_loİs
();

345 
	`´štf
Ğ"PËa£…rovidloİ‡ÂÙ©iÚ š f%s.lb iÀthfŞlowšg fÜm©:\n", 
f’ame
 );

346 
	`´štf
( "<proc_id> <loop_id> <loopbound> <is_dowhile>\n" );

351 
	`sÿnf
Ğ"%c", &
c
 );

352 }  
c
 != 'y' );

356 
åŒ
 = 
	`İ’fe
( "lb", "r" );

357  
	`fsÿnf
Ğ
åŒ
, "%d %d %d %d", &
pid
, &
Íid
, &
lb
, &
dw
 ) !ğ
EOF
 ) {

359 
p
 = 
´ocs
[
pid
];

360 ifĞ!
p
 )

361 
	`´štf
Ğ"Inv®id…roûdu» id %d\n", 
pid
 ), 
	`ex™
(1);

363 
Í
 = 
p
->
loİs
[
Íid
];

364 ifĞ!
Í
 )

365 
	`´štf
Ğ"Inv®id†oİ id [%d] %d\n", 
pid
, 
Íid
 ), 
	`ex™
(1);

367 ifĞ
lb
 < 0 )

368 
	`´štf
Ğ"Inv®id†oİ bound [%d][%d] %d (mu¡ bnÚ-Ãg©ive)\n", 
pid
, 
Íid
, 
lb
 ), 
	`ex™
(1);

369 
Í
->
loİbound
 = 
lb
;

371 ifĞ
dw
 != 0 && dw != 1 )

372 
	`´štf
Ğ"Inv®id is_dowh[%d][%d] %d (mu¡ b0/1)\n", 
pid
, 
Íid
, 
dw
 ), 
	`ex™
(1);

373 
Í
->
is_dowhe
 = 
dw
;

375 
	`fşo£
Ğ
åŒ
 );

378 
	}
}

384 
	$»moveLoİCompÚ’t
Ğ
loİ
 *
Í
, 
bbid
 ) {

386 
i
, 
j
;

388  
i
 = 0; i < 
Í
->
num_tİo
; i++ ) {

389 ifĞ
Í
->
tİo
[
i
]->
bbid
 == bbid ) {

392  
j
 = 
i
 + 1; j < 
Í
->
num_tİo
; j++ )

393 
Í
->
tİo
[
j
 - 1] =†p->topo[j];

395 
Í
->
num_tİo
--;

401 
	}
}

408 
	$addToLoİ
Ğ
loİ
 *
Í
, 
block
 *
bb
, 
check
 ) {

410 
i
;

411 
found
;

413 
found
 = 0;

415 ifĞ
check
 ) {

416  
i
 = 
Í
->
num_tİo
 - 1; !
found
 && i >= 0; i-- )

417 ifĞ
Í
->
tİo
[
i
]->
bbid
 =ğ
bb
->bbid )

418 
found
 = 1;

420 ifĞ
found
 )

423 
Í
->
num_tİo
++;

424 
Í
->
tİo
 = (
block
**è
	`REALLOC
ĞÍ->tİo,†p->
num_tİo
 * (block*), "loopopo" );

425 
Í
->
tİo
[†p->
num_tİo
 - 1 ] = 
bb
;

427 
	}
}

437 
	$checkLoİ
Ğ
´oûdu»
 *
p
, 
block
 *
bb
, 
outid
, 
Ëv–
 ) {

439 
loİ
 *
Í
;

440 
block
 *
dummy
;

441 
block
 *
out
;

443 
out
 = 
p
->
bbli¡
[ 
bb
->
outgošg
[
outid
] ];

448 ifĞ
out
->
loİid
 !ğ-1 && 
p
->
loİs
[ out->loİid ]->
Ëv–
 =ğËv– && out->loİid =ğ
bb
->loopid ) {

453 ifĞ
out
->
is_loİh—d
 ) {

457 
Í
 = 
p
->
loİs
[ 
out
->
loİid
 ];

460 ifĞ
Í
->
loİsšk
 =ğ
NULL
 )

461 
Í
->
loİsšk
 = 
bb
;

467 ifĞ
Í
->
loİsšk
->
¡¬ddr
 == -1 )

469 
bb
->
outgošg
[ 
outid
 ] = 
Í
->
loİsšk
->
bbid
;

475 
dummy
 = (
block
*è
	`MALLOC
( dummy, (block), "dummy sink" );

476 
	`mem£t
(
dummy
, 0, (
block
));

477 
	`ü—‹Block
Ğ
dummy
, 
p
->
pid
,…->
num_bb
, -1, 
Í
->
loİh—d
->
bbid
, -1, -1, 
bb
->
loİid
 );

479 
p
->
num_bb
++;

480 
p
->
bbli¡
 = (
block
**è
	`REALLOC
Ğp->bbli¡,…->
num_bb
 * (block*), "bblist" );

481 
p
->
bbli¡
[…->
num_bb
 - 1 ] = 
dummy
;

484 
p
->
bbli¡
[ 
bb
->
bbid
 ]->
outgošg
[ 
outid
 ] = 
dummy
->bbid;

486 ifĞ
Í
->
loİsšk
->
num_outgošg
 &&†p->loİsšk->
outgošg
[0] =ğÍ->
loİh—d
->
bbid
 )

487 
Í
->
loİsšk
->
outgošg
[0] = 
dummy
->
bbid
;

488 ifĞ
Í
->
loİsšk
->
num_outgošg
 > 1 &&†p->loİsšk->
outgošg
[1] =ğÍ->
loİh—d
->
bbid
 )

489 
Í
->
loİsšk
->
outgošg
[1] = 
dummy
->
bbid
;

492 
	`addToLoİ
Ğ
Í
, 
dummy
, 0 );

493 
Í
->
loİsšk
 = 
dummy
;

505 ifĞ
	`isR—chabË
Ğ
out
->
bbid
, 
bb
->bbid, 
p
->
bbli¡
,…->
num_bb
 )) {

510 ifĞ
bb
->
loİid
 == -1 ||

511 
p
->
loİs
[ 
bb
->
loİid
 ]->
Ëv–
 <†evel ) {

515 
Í
 = (
loİ
*è
	`MALLOC
(†p, (loop), "loop" );

516 
	`ü—‹Loİ
Ğ
Í
, 
p
->
pid
,…->
num_loİs
, 
Ëv–
, 
bb
 );

518 
p
->
num_loİs
++;

519 
p
->
loİs
 = (
loİ
**è
	`REALLOC
Ğp->loİs,…->
num_loİs
 * (loop*), "loop†ist" );

520 
p
->
loİs
[…->
num_loİs
 - 1 ] = 
Í
;

522 ifĞ
bb
->
loİid
 != -1 ) {

523 
Í
->
Ã¡
 = 
bb
->
loİid
;

526 
	`»moveLoİCompÚ’t
Ğ
p
->
loİs
[ 
bb
->
loİid
 ], 
out
->
bbid
 );

530 
bb
->
is_loİh—d
 = 1;

531 
bb
->
loİid
 = 
Í
->
Íid
;

532 
out
->
loİid
 = 
Í
->
Íid
;

535 
	`addToLoİ
Ğ
Í
, 
out
, 1 );

545 ifĞ
out
->
loİid
 != -1 )

546 
	`»moveLoİCompÚ’t
Ğ
p
->
loİs
[ 
out
->
loİid
 ], out->
bbid
 );

548 
out
->
loİid
 = 
bb
->loopid;

551 
	`addToLoİ
Ğ
p
->
loİs
[ 
bb
->
loİid
 ], 
out
, 1 );

556 
	}
}

572 
	$d‘eù_loİs
() {

574 
i
, 
k
;

575 
id
, 
»s
;

577 
´oûdu»
 *
p
;

578 
block
 *
bb
;

580 
Ëv–
;

581 
ÍcouÁ
;

584 *
bt
;

585 
btsize
;

588 *
m¬kfš
;

591  
i
 = 0; i < 
num_´ocs
; i++ ) {

592 
p
 = 
´ocs
[
i
];

593 
p
->
num_loİs
 = 0;

595 
Ëv–
 = -1;

596 
ÍcouÁ
 = 0;

602 
k
 = 
p
->
num_loİs
 - 
ÍcouÁ
;

603 
	`»moveBackEdges
Ğ&Ğ
p
->
loİs
[
k
] ), 
ÍcouÁ
 );

606 
Ëv–
++;

607 
ÍcouÁ
 = 0;

610 
m¬kfš
 = (*è
	`CALLOC
Ğm¬kfš, 
p
->
num_bb
, (), "markfin‡rray" );

611 
bt
 = 
NULL
;

612 
btsize
 = 0;

616 
id
 = 0;

620 
bb
 = 
p
->
bbli¡
[
id
];

624 ifĞ
bb
->
¡¬ddr
 == -1 ) {

625 ifĞ!
btsize
 )

627 
id
 = 
bt
[ --
btsize
 ];

632 ifĞ
bb
->
num_outgošg
 == 0 )

633 
m¬kfš
[
id
] = 2;

636 ifĞ
m¬kfš
[
id
] == 2 ) {

637 ifĞ!
btsize
 )

639 
id
 = 
bt
[ --
btsize
 ];

644 
m¬kfš
[
id
]++;

647 ifĞ
m¬kfš
[
id
] == 1 ) {

649 
»s
 = 
	`checkLoİ
Ğ
p
, 
bb
, 0, 
Ëv–
 );

650 ifĞ
»s
 == 1 )

651 
ÍcouÁ
++;

652 ifĞ
»s
 == 2 ) {

653 
m¬kfš
 = (*è
	`REALLOC
Ğm¬kfš, 
p
->
num_bb
 * (), "markfin‡rray" );

654 
m¬kfš
[ 
p
->
num_bb
 - 1 ] = 0;

658 ifĞ
bb
->
num_outgošg
 == 2 ) {

659 
bt
 = (*è
	`REALLOC
Ğbt, ++
btsize
 * (), "backtrack‡rray" );

660 
bt
[ 
btsize
 - 1 ] = 
id
;

663 
m¬kfš
[
id
] = 2;

666 
id
 = 
bb
->
outgošg
[0];

667 ifĞ
m¬kfš
[
id
] > 0 ) {

668 ifĞ!
btsize
 )

670 
id
 = 
bt
[ --
btsize
 ];

676 ifĞ
bb
->
num_outgošg
 < 2 )

677 
	`´štf
Ğ"Unusu® ca£‡ˆ[%d] %d\n", 
bb
->
pid
, bb->
bbid
 ), 
	`ex™
(1);

679 ifĞ
	`checkLoİ
Ğ
p
, 
bb
, 1, 
Ëv–
 ))

680 
ÍcouÁ
++;

683 
id
 = 
bb
->
outgošg
[1];

684 ifĞ
m¬kfš
[
id
] > 0 ) {

685 ifĞ!
btsize
 )

687 
id
 = 
bt
[ --
btsize
 ];

691 
	`ä“
Ğ
m¬kfš
 );

692 
	`ä“
Ğ
bt
 );

694 
k
 = 
p
->
num_loİs
 - 
ÍcouÁ
;

695 
	`d‘”mšeLoİEx™s
Ğ&Ğ
p
->
loİs
[
k
] ), 
ÍcouÁ
,…->
bbli¡
,…->
num_bb
 );

697 }  
ÍcouÁ
 );

705 
	`»ad_loİ_ªnÙ©iÚ
();

708 
	}
}

	@main.c

1 
	~<¡ršg.h
>

2 
	~<¡dio.h
>

4 
	~<time.h
>

5 
	~"h—d”.h
"

7 
	~"cyşe_time.c
"

8 
	~"cyşe_time.h
"

10 
	~"ª®ysis.h
"

11 
	~"šãasibË.h
"

13 
	~"hªdËr.c
"

14 
	~"dump.c
"

15 
	~"block.c
"

16 
	~"·r£CFG.c
"

17 
	~"loİd‘eù.c
"

21 
	~"·th.c
"

24 
	~"tİo.c
"

26 
	~"ª®ysisDAG_WCET.c
"

27 
	~"ª®ysisDAG_BCET.c
"

29 
	~"ª®ysisCache.c
"

30 
	~"ª®ysisCacheL2.c
"

31 
	~"upd©eCacheL2.c
"

32 
	~"·thDAG.c
"

35 
	~"busScheduË.c
"

38 
	tticks
;

39 
	#CPU_MHZ
 3000000000

	)

40 
__šlše__
 
ticks
 
	$g‘ticks
()

42 
a
, 
d
;

43 
asm
 vŞ©e("rdtsc" : "÷" (
a
), "=d" (
d
));

44  ((
ticks
)
a
è| ((Ñicks)
d
) << 32);

45 
	}
}

125 
	$maš
(
¬gc
, **
¬gv
 ) {

127 
FILE
 *
fe
, *
h™miss_¡©i¡ic
, *
fe_wei
, *
fe_´iv©e
, *
wüt
;

128 
wbco¡P©h
[
MAX_LEN
], 
h™miss
[MAX_LEN];

129 
uÎ
 
h™_¡©i¡ics
, 
unknow_¡©i¡ics
, 
miss_¡©i¡ics
, 
difãr
;

130 
uÎ
 
h™_¡©i¡ics_wei
, 
unknow_¡©i¡ics_wei
, 
wût_wei
, 
wût_our
;

131 
n
;

132 
i
, 
j
, 
k
, 
æag
, 
tmp
;

133 
num_sk
 , 
num_msc
;

134 
num_msc
 = 0;

135 
ch¬_tmp
;

136 
sum
;

137 
FILE
 *
š‹rãrP©h
, *
š‹rãrFe
, *
cÚæiùMSC
;

138 
š‹rãrFeName
[
MAX_LEN
], 
´oc
[2*MAX_LEN];

139 
ušt
 
nSuccs
;

140 
si
;

141 
ticks
 
¡¬t
,
’d
;

143 ifĞ
¬gc
 < 4 ) {

148 
g_İtimized
 = 0;

149 
	`maš_unu£d
(
¬gc
,
¬gv
);

150 
	`ex™
(0);

154 
times_™”©iÚ
 = 0;

157 
g_‹¡šg_mode
 = 0;

159 
g_sh¬ed_bus
 = 0;

161 
g_šd•’d’t_sk
 = 1;

163 
g_no_bus_mod–šg
 = 0;

165 
g_İtimized
 = 0;

168 
š‹rã»P©hName
 = 
¬gv
[1];

169 
ÿche_cÚfig
 = 
¬gv
[2];

170 
ÿche_cÚfig_L2
 = 
¬gv
[3];

171 
num_cÜe
 = 
	`©oi
Ğ
¬gv
[4] );

172 
šãas
 = 0;

173 
»giÚmode
 = 0;

176 if(
¬gc
 > 5)

178 
g_´iv©e
 = 
	`©oi
(
¬gv
[5]);

181 
g_´iv©e
 = 0;

185 
Ï‹¡
 = (
uÎ
 *)
	`m®loc
(
num_cÜe
 * (ull));

186 if(!
Ï‹¡
)

187 
	`´”r
("Error: Out of memory");

188 
	`mem£t
(
Ï‹¡
, 0, 
num_cÜe
 * (
uÎ
));

190 ifĞ
¬gc
 > 5 )

191 
debug
 = 
	`©oi
Ğ
¬gv
[5] );

194 
	`£t_ÿche_basic
(
ÿche_cÚfig
);

195 
	`£t_ÿche_basic_L2
(
ÿche_cÚfig_L2
);

198 
numCÚæiùTask
 = (*)
	`CALLOC
ÒumCÚæiùTask, 
ÿche_L2
.
ns
, (),

200 
numCÚæiùMSC
 = (*)
	`CALLOC
ÒumCÚæiùMSC, 
ÿche_L2
.
ns
, (),

204 
n
 = 0;‚ < 
ÿche_L2
.
ns
;‚++)

206 
numCÚæiùTask
[
n
] = 0;

207 
numCÚæiùMSC
[
n
] = 0;

211 if(
debug
)

212 
	`dumpCacheCÚfig
();

213 if(
debug
)

214 
	`dumpCacheCÚfig_L2
();

218 
š‹rãrP©h
 = 
	`fİ’
(
š‹rã»P©hName
, "r");

221 
STARTTIME
;

224 
	`fsÿnf
(
š‹rãrP©h
, "%s\n", 
š‹rãrFeName
)!ğ
EOF
)

226 if(
num_msc
 == 0)

228 
msc
 = (
MSC
**)
	`CALLOC
(msc, 1, (MSC*), "MSC*");

232 
msc
 = (
MSC
**)
	`REALLOC
(msc, (
num_msc
 + 1) * (MSC*), "MSC*");

234 
num_msc
++;

236 
š‹rãrFe
 = 
	`fİ’
(
š‹rãrFeName
,"r");

239 
	`fsÿnf
(
š‹rãrFe
, "%d\n", &
num_sk
);

242 
msc
[
num_msc
 -1] = (
MSC
*)
	`CALLOC
(msc[num_msc -1], 1, (MSC), "MSC");

244 
	`¡rıy
(
msc
[
num_msc
 -1]->
msc_Çme
, 
š‹rãrFeName
);

245 
msc
[
num_msc
 -1]->
num_sk
 =‚um_task;

249 
msc
[
num_msc
 -1]->
skLi¡
 = (
sk_t
*)
	`CALLOC
(msc[num_msø-1], 
num_sk
,

250 (
sk_t
), "taskList");

251 
msc
[
num_msc
 -1]->
š‹rãrInfo
 = (**)
	`CALLOC
(msc[num_msc -1]->interferInfo,

252 
num_sk
, (*), "interferInfo*");

255 
i
 = 0; i < 
num_sk
; i ++)

257 
	`fsÿnf
(
š‹rãrFe
, "%s\n", &(
msc
[
num_msc
 -1]->
skLi¡
[
i
].
sk_Çme
));

260 
	`fsÿnf
(
š‹rãrFe
, "%d", &(
msc
[
num_msc
 - 1]->
skLi¡
[
i
].
numSuccs
));

261 
nSuccs
 = 
msc
[
num_msc
 - 1]->
skLi¡
[
i
].
numSuccs
;

263 
msc
[
num_msc
 - 1]->
skLi¡
[
i
].
succLi¡
 = (
ušt
 *)

264 
	`m®loc
(
nSuccs
 * (
ušt
));

265 if(!
msc
[
num_msc
 - 1]->
skLi¡
[
i
].
succLi¡
)

266 
	`´”r
("Error: Out of Memory");

269 
si
 = 0; s˜< 
nSuccs
; si++)

270 
	`fsÿnf
(
š‹rãrFe
, "%d", &(
msc
[
num_msc
 - 1]->
skLi¡
[
i
].
succLi¡
[
si
]));

271 
	`fsÿnf
(
š‹rãrFe
, "\n");

274 
	`fsÿnf
(
š‹rãrFe
, "\n");

277 
i
 = 0; i < 
num_sk
; i ++)

279 
msc
[
num_msc
 -1]->
skLi¡
[
i
].
sk_id
 = i;

280 
msc
[
num_msc
 -1]->
š‹rãrInfo
[
i
] = (*)
	`CALLOC
(msc[num_msc -1]->

281 
š‹rãrInfo
[
i
], 
num_sk
, (), "interferInfo");

286 
j
 = 0; j < 
num_sk
; j++)

288 
	`fsÿnf
(
š‹rãrFe
, "%d ", &(
msc
[
num_msc
 -1]->
š‹rãrInfo
[
i
][
j
]));

292 
	`fsÿnf
(
š‹rãrFe
, "\n");

295 
	`fşo£
(
š‹rãrFe
);

300 
i
 = 0; i < 
num_sk
; i ++)

302 
f’ame
 = 
msc
[
num_msc
 -1]->
skLi¡
[
i
].
sk_Çme
;

303 
´ocs
 = 
NULL
;

304 
num_´ocs
 = 0;

305 
´oc_cg
 = 
NULL
;

306 
šãas
 = 0;

309 
	`»ad_cfg
();

311 ifĞ
debug
 ) 
	`´št_cfg
();

317 
msc
[
num_msc
 -1]->
skLi¡
[
i
].
´oc_cg_±r
 = (
´oc_cİy
 *)

318 
	`CALLOC
(
msc
[
num_msc
 -1]->
skLi¡
[
i
].
´oc_cg_±r
,

319 
num_´ocs
, (
´oc_cİy
), "proc_copy");

323 
j
 = 0; j < 
num_´ocs
; j ++)

325 
msc
[
num_msc
 -1]->
skLi¡
[
i
].
´oc_cg_±r
[
j
].
num_´oc
 = 0;

326 
msc
[
num_msc
 -1]->
skLi¡
[
i
].
´oc_cg_±r
[
j
].
´oc
 = 
NULL
;

331 
	`»adIn¡r
();

332 ifĞ
debug
 ) 
	`´št_š¡¾i¡
();

335 
	`d‘eù_loİs
();

336 ifĞ
debug
 ) 
	`´št_loİs
();

339 if(
debug
è
	`dump_ÿÎg¿ph
();

340 if(
debug
è
	`dump_loİs
();

344 
	`tİo_sÜt
();

345 ifĞ
debug
 ) 
	`´št_tİo
();

348 
	`ÿlcuÏ‹_šcomšg
();

352 
	`cÚ¡ruùAÎ
(&(
msc
[
num_msc
 -1]->
skLi¡
[
i
]));

356 
msc
[
num_msc
 -1]->
skLi¡
[
i
].
maš_cİy
 = main_copy;

357 
msc
[
num_msc
 -1]->
skLi¡
[
i
].
num_´oc
ğ
num_´ocs
;

367 
	`ÿcheAÇlysis
();

370 
	`ä“AÎCacheS‹
();

372 if(
´št
)

373 
	`´štf
("\ndone L1\n");

376 
	`ÿcheAÇlysis_L2
();

378 
	`ä“AÎ_L2
();

379 if(
´št
)

380 
	`´štf
("\ndone L2\n");

395 
	`´štf
("upd©CS %s\n", 
msc
[
num_msc
 -1]->
msc_Çme
);

398 if(!
g_´iv©e
)

399 
	`upd©eCacheS‹
(
msc
[
num_msc
-1]);

408 
	`·thDAG
(
msc
[
num_msc
 -1]);

416 
g_sh¬ed_bus
 = 1;

418 
¡¬t
 = 
	`g‘ticks
();

419 
	`compu‹_bus_WCET_MSC
(
msc
[
num_msc
 -1]);

420 
’d
 = 
	`g‘ticks
();

426 if(!
g_´iv©e
)

427 
	`»£tH™Miss_L2
(
msc
[
num_msc
 -1]);

431 
	`¥rštf
(
´oc
, "š‹rã»/cÚæiùTaskMSC_%d", 
num_msc
 - 1);

432 
cÚæiùMSC
 = 
	`fİ’
(
´oc
, "w");

434 
sum
 = 0;

436 
n
 = 0;‚ < 
ÿche_L2
.
ns
;‚++)

437 
sum
 = sum + 
numCÚæiùMSC
[
n
];

440 
	`årštf
(
cÚæiùMSC
, "%f", 
sum
/
ÿche_L2
.
ns
);

441 
	`fşo£
(
cÚæiùMSC
);

444 
n
 = 0;‚ < 
ÿche_L2
.
ns
;‚++)

446 
numCÚæiùMSC
[
n
] = 0;

450 
	`fşo£
(
š‹rãrP©h
);

455 if(
g_šd•’d’t_sk
)

457 
	`´štf
("===================================================\n");

458 
	`´štf
("WCET computiÚimğ%là£cs\n", (
’d
 - 
¡¬t
)/((1.0è* 
CPU_MHZ
));

459 
	`´štf
("===================================================\n");

464 
times_™”©iÚ
 ++;

467 
i
 = 1; i <ğ
num_msc
; i ++)

470 
	`¥rštf
(
wbco¡P©h
, "%s_wûtbût_%d", 
msc
[
i
-1]->
msc_Çme
, 
times_™”©iÚ
);

471 
fe
 = 
	`fİ’
(
wbco¡P©h
, "w" );

472 
	`¥rštf
(
h™miss
, "%s_h™miss_¡©i¡ic_%d", 
msc
[
i
-1]->
msc_Çme
, 
times_™”©iÚ
);

473 
h™miss_¡©i¡ic
 = 
	`fİ’
(
h™miss
, "w");

476 
j
 = 0; j < 
msc
[
i
-1]->
num_sk
; j++)

478 
	`årštf
(
fe
, "%Lu %Lu \n", 
msc
[
i
-1]->
skLi¡
[
j
].
wût
,

479 
msc
[
i
-1]->
skLi¡
[
j
].
bût
);

482 
	`årštf
(
h™miss_¡©i¡ic
,"%s\n", 
msc
[
i
-1]->
skLi¡
[
j
].
sk_Çme
);

483 
	`årštf
(
h™miss_¡©i¡ic
,"Only L1\n\nWCET:\nHIT MISS NC\n");

484 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu \n", 
msc
[
i
-1]->

485 
skLi¡
[
j
].
h™_wût
, 
msc
[
i
-1]->skLi¡[j].
miss_wût
,

486 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût
);

487 
	`årštf
(
h™miss_¡©i¡ic
,"\n%Lu\n",

488 (
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût
*
IC_HIT
) +

489 (
msc
[
i
-1]->
skLi¡
[
j
].
miss_wût
 +

490 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût
)* 
IC_MISS_L2
);

491 
	`årštf
(
h™miss_¡©i¡ic
,"\nWith L2\n\nWCET:\nHIT MISS \

492 
NC
 
HIT_L2
 
MISS_L2
 
NC_L2
\
n
");

493 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu ",

494 
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût
, msc[i-1]->skLi¡[j].
miss_wût
,

495 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût
);

496 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu \n",

497 
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût_L2
, msc[i-1]->skLi¡[j].
miss_wût_L2
,

498 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût_L2
);

499 
	`årštf
(
h™miss_¡©i¡ic
,"\n%Lu\n", 
msc
[
i
-1]->
skLi¡
[
j
].
wût
);

500 
	`årštf
(
h™miss_¡©i¡ic
,"\nBCET:\nHIT MISS NC HIT_L2 \

501 
MISS_L2
 
NC_L2
\
n
");

502 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu ",

503 
msc
[
i
-1]->
skLi¡
[
j
].
h™_bût
, msc[i-1]->skLi¡[j].
miss_bût
,

504 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_bût
);

505 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu \n",

506 
msc
[
i
-1]->
skLi¡
[
j
].
h™_bût_L2
, msc[i-1]->skLi¡[j].
miss_bût_L2
,

507 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_bût_L2
);

508 
	`årštf
(
h™miss_¡©i¡ic
,"\n%Lu\n", 
msc
[
i
-1]->
skLi¡
[
j
].
bût
);

509 
	`fæush
(
¡dout
);

513 
	`fşo£
(
fe
);

514 
	`fşo£
(
h™miss_¡©i¡ic
);

519 
i
 = 1; i <ğ
num_msc
; i ++)

521 
	`¥rštf
(
h™miss
, "%s_h™miss_¡©i¡ic_wei", 
msc
[
i
-1]->
msc_Çme
);

522 
h™miss_¡©i¡ic
 = 
	`fİ’
(
h™miss
, "w");

523 
j
 = 0; j < 
msc
[
i
-1]->
num_sk
; j++)

525 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu \n",

526 
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût_L2
,

527 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût_L2
, msc[i-1]->skLi¡[j].
wût
);

528 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu \n",

529 
msc
[
i
-1]->
skLi¡
[
j
].
h™_bût_L2
,

530 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_bût_L2
, msc[i-1]->skLi¡[j].
bût
);

531 
	`fæush
(
¡dout
);

533 
	`fşo£
(
h™miss_¡©i¡ic
);

578 
æag
 = 1;

582 
æag
)

584 
æag
 = 0;

585 
	`´štf
("C®Èwüˆª®ysi th%dime\n", 
times_™”©iÚ
);

587 if(
num_cÜe
 == 2)

588 
	`¥rštf
(
´oc
, "./timing interfere/debie_test.cf interfere/debie_test.pd interfere/debie_test.msg %d",

589 
times_™”©iÚ
);

590 if(
num_cÜe
 == 4)

591 
	`¥rštf
(
´oc
, "./timing interfere/debie_test.cf interfere/debie_test.pd interfere/debie_test.msg %d",

592 
times_™”©iÚ
 );

593 if(
num_cÜe
 == 1)

594 
	`¥rštf
(
´oc
, "./timing interfere/debie_test.cf interfere/debie_test.pd interfere/debie_test.msg %d",

595 
times_™”©iÚ
 );

597 
	`´štf
("num oàcÜ”rÜ!\n"), 
	`ex™
(1);

624 
	`sy¡em
(
´oc
);

627 
	`¥rštf
(
š‹rãrFeName
, "%s_%d", 
š‹rã»P©hName
, 
times_™”©iÚ
);

628 
š‹rãrP©h
 = 
	`fİ’
(
š‹rãrFeName
, "r");

630 
i
 = 0; i < 
num_msc
; i ++)

632 
	`fsÿnf
(
š‹rãrP©h
, "%s\n", &
š‹rãrFeName
);

633 
š‹rãrFe
 = 
	`fİ’
(
š‹rãrFeName
,"r");

636 
	`fsÿnf
(
š‹rãrFe
, "%d\n", &(
tmp
));

640 
j
 = 0; j < 
msc
[
i
]->
num_sk
; j ++)

642 
	`fsÿnf
(
š‹rãrFe
, "%s\n", &(
msc
[
i
]->
skLi¡
[
j
].
sk_Çme
));

645 
	`fsÿnf
(
š‹rãrFe
, "%d ", &(
msc
[
i
]->
skLi¡
[
j
].
numSuccs
));

646 
nSuccs
 = 
msc
[
i
]->
skLi¡
[
j
].
numSuccs
;

648 
msc
[
i
]->
skLi¡
[
j
].
succLi¡
 = (
ušt
 *è
	`m®loc
(
nSuccs
 * (uint));

649 if(!
msc
[
i
]->
skLi¡
[
j
].
succLi¡
)

650 
	`´”r
("Error: Out of Memory");

653 
si
 = 0; s˜< 
nSuccs
; si++)

655 
	`fsÿnf
(
š‹rãrFe
, "%d ", &(
msc
[
i
]->
skLi¡
[
j
].
succLi¡
[
si
]));

657 
	`fsÿnf
(
š‹rãrFe
, "\n");

661 
k
 = 0; k < 
msc
[
i
]->
num_sk
; k ++)

663 
j
 = 0; j < 
msc
[
i
]->
num_sk
; j++)

665 
	`fsÿnf
(
š‹rãrFe
, "%d ", &
tmp
);

667 if(
k
!ğ
j
)

673 if(
tmp
 !ğ
msc
[
i
]->
š‹rãrInfo
[
k
][
j
])

675 
æag
 = 1;

677 
msc
[
i
]->
š‹rãrInfo
[
k
][
j
] = 
tmp
;

680 
	`fsÿnf
(
š‹rãrFe
, "\n");

682 
	`fşo£
(
š‹rãrFe
);

685 
	`fşo£
(
š‹rãrP©h
);

688 if(
æag
 == 0) ;

690 
i
 = 0; i < 
num_msc
; i ++)

692 
	`´štf
("upd©CS fÜ %s\n", 
msc
[
i
]->
msc_Çme
);

695 
	`upd©eCacheS‹
(
msc
[
i
]);

699 
	`·thDAG
(
msc
[
i
]);

704 
	`compu‹_bus_WCET_MSC
(
msc
[
num_msc
 -1]);

706 
	`compu‹_bus_BCET_MSC
(
msc
[
num_msc
 -1]);

708 
	`»£tH™Miss_L2
(
msc
[
i
]);

712 
times_™”©iÚ
 ++;

715 
i
 = 1; i <ğ
num_msc
; i ++)

717 
	`¥rštf
(
wbco¡P©h
, "%s_wûtbût_%d", 
msc
[
i
-1]->
msc_Çme
, 
times_™”©iÚ
);

718 
fe
 = 
	`fİ’
(
wbco¡P©h
, "w" );

719 
	`¥rštf
(
h™miss
, "%s_h™miss_¡©i¡ic_%d", 
msc
[
i
-1]->
msc_Çme
,

720 
times_™”©iÚ
);

721 
h™miss_¡©i¡ic
 = 
	`fİ’
(
h™miss
, "w");

722 
j
 = 0; j < 
msc
[
i
-1]->
num_sk
; j++)

724 
	`årštf
(
fe
, "%Lu %Lu \n", 
msc
[
i
-1]->
skLi¡
[
j
].
wût
,

725 
msc
[
i
-1]->
skLi¡
[
j
].
bût
);

726 
	`årštf
(
h™miss_¡©i¡ic
,"%s\n", 
msc
[
i
-1]->
skLi¡
[
j
].
sk_Çme
);

727 
	`årštf
(
h™miss_¡©i¡ic
,"Only L1\n\nWCET:\nHIT MISS NC\n");

728 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu \n",

729 
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût
, msc[i-1]->skLi¡[j].
miss_wût
,

730 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût
);

731 
	`årštf
(
h™miss_¡©i¡ic
,"\n%Lu\n",

732 (
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût
*
IC_HIT
) +

733 (
msc
[
i
-1]->
skLi¡
[
j
].
miss_wût


734 + 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût
)* 
IC_MISS_L2
);

735 
	`årštf
(
h™miss_¡©i¡ic
,"\nWith L2\n\nWCET:\nHIT MISS \

736 
NC
 
HIT_L2
 
MISS_L2
 
NC_L2
\
n
");

737 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu ",

738 
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût
, msc[i-1]->skLi¡[j].
miss_wût
,

739 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût
);

740 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu \n",

741 
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût_L2
,

742 
msc
[
i
-1]->
skLi¡
[
j
].
miss_wût_L2
,

743 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût_L2
);

744 
	`årštf
(
h™miss_¡©i¡ic
,"\n%Lu\n", 
msc
[
i
-1]->
skLi¡
[
j
].
wût
);

745 
	`årštf
(
h™miss_¡©i¡ic
,"\nBCET:\nHIT MISS NC HIT_L2 \

746 
MISS_L2
 
NC_L2
\
n
");

747 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu ",

748 
msc
[
i
-1]->
skLi¡
[
j
].
h™_bût
,

749 
msc
[
i
-1]->
skLi¡
[
j
].
miss_bût
,

750 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_bût
);

751 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu \n",

752 
msc
[
i
-1]->
skLi¡
[
j
].
h™_bût_L2
,

753 
msc
[
i
-1]->
skLi¡
[
j
].
miss_bût_L2
,

754 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_bût_L2
);

755 
	`årštf
(
h™miss_¡©i¡ic
,"\n%Lu\n", 
msc
[
i
-1]->
skLi¡
[
j
].
bût
);

756 
	`fæush
(
¡dout
);

758 
	`fşo£
(
fe
);

759 
	`fşo£
(
h™miss_¡©i¡ic
);

786 
STOPTIME
;

792 
	`¥rštf
(
h™miss
, "š‹rã»/%d-%s-%s-h™miss.»s", 
num_cÜe
,

793 
ÿche_cÚfig
, 
ÿche_cÚfig_L2
);

794 
h™miss_¡©i¡ic
 = 
	`fİ’
(
h™miss
, "w");

795 
	`¥rštf
(
h™miss
, "š‹rã»/%d-%s-%s-wüt.»s", 
num_cÜe
,

796 
ÿche_cÚfig
, 
ÿche_cÚfig_L2
);

797 
wüt
 = 
	`fİ’
(
h™miss
, "w");

799 
i
 = 1; i <ğ
num_msc
; i ++)

802 
	`¥rštf
(
h™miss
, "%s_h™miss_¡©i¡ic_wei", 
msc
[
i
-1]->
msc_Çme
);

803 
fe_wei
 = 
	`fİ’
(
h™miss
, "r");

805 
	`¥rštf
(
h™miss
, "%s_h™miss_¡©i¡ic_´iv©e", 
msc
[
i
-1]->
msc_Çme
);

806 
fe_´iv©e
 = 
	`fİ’
(
h™miss
, "r");

808 
j
 = 0; j < 
msc
[
i
-1]->
num_sk
; j++)

811 
	`årštf
(
h™miss_¡©i¡ic
, "%s ", 
msc
[
i
-1]->
skLi¡
[
j
].
sk_Çme
);

814 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu ",

815 
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût
,

816 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût
,

817 
msc
[
i
-1]->
skLi¡
[
j
].
miss_wût
);

819 
	`fsÿnf
(
fe_wei
 ,"%Lu ", &
h™_¡©i¡ics_wei
);

820 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
h™_¡©i¡ics_wei
);

821 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût_L2
);

823 
	`fsÿnf
(
fe_´iv©e
 ,"%Lu ", &
h™_¡©i¡ics
);

824 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
h™_¡©i¡ics
);

828 
	`fsÿnf
(
fe_wei
 ,"%Lu ", &
unknow_¡©i¡ics_wei
);

829 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
unknow_¡©i¡ics_wei
);

830 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_wût_L2
);

833 
	`fsÿnf
(
fe_´iv©e
 ,"%Lu \n", &
unknow_¡©i¡ics
);

834 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
unknow_¡©i¡ics
);

837 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
msc
[
i
-1]->
skLi¡
[
j
].
miss_wût_L2
);

843 
difãr
 = 
msc
[
i
-1]->
skLi¡
[
j
].
h™_wût_L2
 - 
h™_¡©i¡ics_wei
;

844 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
difãr
);

848 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
msc
[
i
-1]->
skLi¡
[
j
].
wût
);

850 
	`fsÿnf
(
fe_wei
 ,"%Lu ", &
wût_wei
);

851 
	`fsÿnf
(
fe_wei
, "\n");

852 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
wût_wei
);

855 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu %Lu %Lu ",

856 
msc
[
i
-1]->
skLi¡
[
j
].
h™_bût
,

857 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_bût
,

858 
msc
[
i
-1]->
skLi¡
[
j
].
miss_bût
);

860 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
msc
[
i
-1]->
skLi¡
[
j
].
h™_bût_L2
);

861 
	`fsÿnf
(
fe_wei
 ,"%Lu ", &
h™_¡©i¡ics_wei
);

862 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
h™_¡©i¡ics_wei
);

863 
	`fsÿnf
(
fe_´iv©e
 ,"%Lu ", &
h™_¡©i¡ics
);

864 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
h™_¡©i¡ics
);

866 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
msc
[
i
-1]->
skLi¡
[
j
].
unknow_bût_L2
);

867 
	`fsÿnf
(
fe_wei
 ,"%Lu ", &
unknow_¡©i¡ics_wei
);

868 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
unknow_¡©i¡ics_wei
);

869 
	`fsÿnf
(
fe_´iv©e
 ,"%Lu \n", &
unknow_¡©i¡ics
);

870 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
unknow_¡©i¡ics
);

872 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
msc
[
i
-1]->
skLi¡
[
j
].
miss_bût_L2
);

874 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu ", 
msc
[
i
-1]->
skLi¡
[
j
].
bût
);

876 
	`fsÿnf
(
fe_wei
 ,"%Lu \n", &
wût_wei
);

877 
	`årštf
(
h™miss_¡©i¡ic
,"%Lu \n", 
wût_wei
);

878 
	`fæush
(
¡dout
);

881 
	`fşo£
(
fe_´iv©e
);

882 
	`fşo£
(
fe_wei
);

885 
sum
 = 0;

886 
i
 = 0; i < 
ÿche_L2
.
ns
; i ++)

887 
sum
 = sum + 
numCÚæiùTask
[
i
];

889 
	`´štf
("av”agcÚæiùasks: %f\n", 
sum
/
ÿche_L2
.
ns
);

895 if(
times_™”©iÚ
 > 1)

897 
fe
 = 
	`fİ’
("interfere/2.WCRT", "r");

898 if(!
fe
)

899 
	`´”r
("Error: File interfere/2.WCRT opening failed");

900 
	`fsÿnf
(
fe
, "%Lu", &
wût_our
);

901 
	`årštf
(
wüt
,"ou¸%Lu\n", 
wût_our
);

902 
	`fşo£
(
fe
);

906 
fe
 = 
	`fİ’
("interfere/1.WCRT", "r");

907 
	`fsÿnf
(
fe
, "%Lu", &
wût_our
);

908 
	`årštf
(
wüt
,"ou¸%Lu\n", 
wût_our
);

909 
	`fşo£
(
fe
);

911 
fe
 = 
	`fİ’
("interfere/1.WCRT", "r");

912 
	`fsÿnf
(
fe
, "%Lu", &
wût_wei
);

913 
	`årštf
(
wüt
,"we˜%Lu\n", 
wût_wei
);

914 
	`årštf
(
wüt
,"difã¸%Lu\n", 
wût_wei
 - 
wût_our
);

915 
	`årštf
(
wüt
,"ruÁim%às\n", 
t
/(
CYCLES_PER_MSEC
 * 1000.0));

917 
	`årštf
(
wüt
,"av”agcÚæiùasks/£ˆ %f\n", 
sum
/
ÿche_L2
.
ns
);

919 
	`fşo£
(
fe
);

920 
	`fşo£
(
h™miss_¡©i¡ic
);

921 
	`fşo£
(
wüt
);

923 
	`´štf
("%d cÜe, NØchªgš iÁ”ã»‚ow,ƒx™\n", 
num_cÜe
);

926 
	}
}

930 
	$maš_unu£d
Ğ
¬gc
, **
¬gv
 ) {

932 
i
, 
j
;

933 
´oûdu»
 *
p
;

935 ifĞ
¬gc
 < 2 ) {

936 
	`´štf
Ğ"\nU§ge: o± <f’ame> [debug_Ú]\n" ), 
	`ex™
(1);}

938 
f’ame
 = 
¬gv
[1];

939 ifĞ
¬gc
 > 2 )

940 
debug
 = 
	`©oi
Ğ
¬gv
[2] );

942 if(
debug
) {

943 
	`´štf
Ğ"\nR—dšg CFG...\n" ); 
	`fæush
Ğ
¡dout
 );

945 
´ocs
 = 
NULL
;

946 
num_´ocs
 = 0;

947 
´oc_cg
 = 
NULL
;

949 
	`»ad_cfg
();

950 ifĞ
debug
 )

951 
	`´št_cfg
();

953 if(
debug
)

955 
	`´štf
( "\nReading‡ssembly instructions...\n" );

956 
	`fæush
(
¡dout
);

958 
	`»adIn¡r
();

959 ifĞ
debug
 ) 
	`´št_š¡¾i¡
();

961 if(
debug
) {

962 
	`´štf
Ğ"\nD‘eùšg†oİs...\n" ); 
	`fæush
Ğ
¡dout
 );

964 
	`d‘eù_loİs
();

965 ifĞ
debug
 ) 
	`´št_loİs
();

967 if(
debug
) {

968 
	`´štf
Ğ"\nCÚ¡ruùšgİŞogiÿÈÜd” oà´oûdu» ªd†oİs...\n" ); 
	`fæush
Ğ
¡dout
 );

970 
	`tİo_sÜt
();

971 ifĞ
debug
 ) 
	`´št_tİo
();

974 
	`ÿlcuÏ‹_šcomšg
();

977 
	`´štf
( "\nInitial WCETƒstimation with shared bus...\n" );

980 
	`£tScheduË
("TDMA_bus_sched.db");

993 
ncÜe
 = 0;

994 
g_‹¡šg_mode
 = 1;

996 
g_sh¬ed_bus
 = 1;

997 
	`compu‹WCET
(0);

999 
g_sh¬ed_bus
 = 0;

1000 
	`compu‹WCET
(0);

1003 
	}
}

	@parse.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

5 
	$š™Sched
Ğ
sched_t
 *
sc
 ) {

7 
sc
->
numAssigÃd
 = 0;

8 
sc
->
assigÃdLi¡
 = 
NULL
;

9 
sc
->
¥m
 = 
NULL
;

11 
	}
}

14 
	$š™Ch¬t
Ğ
ch¬t_t
 *
cx
 ) {

16 
i
;

17 
cx
->
numSuccs
 = 0;

18 
cx
->
succLi¡
 = 
NULL
;

19 
cx
->
tİoLi¡L’
 = 0;

20 
cx
->
tİoLi¡
 = 
NULL
;

21 
cx
->
timeTİoLi¡
 = 
NULL
;

22 
cx
->
wüt
 = 0;

24 
cx
->
PELi¡
 = (
sched_t
**è
	`MALLOC
Ğcx->PELi¡, 
numPEs
 * (sched_t*), "PEList" );

25  
i
 = 0; i < 
numPEs
; i++ ) {

26 
cx
->
PELi¡
[
i
] = (
sched_t
*è
	`MALLOC
( cx->PEList[i], (sched_t), "sched_t" );

27 
	`š™Sched
Ğ
cx
->
PELi¡
[
i
] );

30 
	}
}

37 
	$fšdTask
Ğ
Šame
[] ) {

39 
i
;

40  
i
 = 0; i < 
numTasks
; i++ ) {

41 ifĞ
	`¡rcmp
Ğ
skLi¡
[
i
]->
Šame
,name ) == 0 )

42  
i
;

44 
	`´štf
Ğ"W¬nšg:ask % nÙ found.\n", 
Šame
 );

46 
	}
}

53 
	$fšdPE
Ğ
id
 ) {

55 
i
;

56  
i
 = 0; i < 
numPEs
; i++ ) {

57 ifĞ
³ID
[
i
] =ğ
id
 )

58  
i
;

61 
	}
}

68 
	$fšdCh¬t
Ğ
idx
 ) {

70 
i
, 
j
;

71  
i
 = 0; i < 
numCh¬ts
; i++ )

72  
j
 = 0; j < 
msg
[
i
].
tİoLi¡L’
; j++ )

73 ifĞ
msg
[
i
].
tİoLi¡
[
j
] =ğ
idx
 )

74  
i
;

76 
	}
}

82 
	$isP»deûssÜOf
Ğ
´ed
, 
succ
 ) {

84 
i
;

85 
sk_t
 *
ts
 = 
skLi¡
[
succ
];

87 ifĞ
´ed
 =ğ
succ
 )

90  
i
 = 0; i < 
ts
->
numP»ds
; i++ ) {

91 
px
 = 
ts
->
´edLi¡
[
i
];

92 ifĞ
px
 =ğ
´ed
 )

94 ifĞ
	`isP»deûssÜOf
Ğ
´ed
, 
px
 ))

98 
	}
}

106 
	$»adTasks
() {

108 
Šame
[
MAXLEN
];

109 
aùÜ
, 
³
, 
´iÜ™y
;

110 
time_t
 
³riod
;

112 
FILE
 *
åŒ
 = 
	`İ’fe
Ğ
pdÇme
, "r" );

114 
numTasks
 = 0;

115 
skLi¡
 = 
NULL
;

117  
	`fsÿnf
Ğ
åŒ
, "% %d %d %d %Lu", 
Šame
, &
aùÜ
, &
³
, &
´iÜ™y
, &
³riod
 ) !ğ
EOF
 ) {

119 
sk_t
 *
tc
 = (sk_t*è
	`MALLOC
(c, (task_t), "tc" );

120 
	`¡rıy
Ğ
tc
->
Šame
,name );

121 
tc
->
aùÜID
 = 
aùÜ
;

122 
tc
->
³ID
 = 
³
;

123 
tc
->
´iÜ™y
 =…riority;

124 
tc
->
³riod
 =…eriod;

125 
tc
->
ùimeLo
 = 0;

126 
tc
->
ùimeHi
 = 0;

127 
tc
->
numP»ds
 = 0;

128 
tc
->
´edLi¡
 = 
NULL
;

129 
tc
->
numSuccs
 = 0;

130 
tc
->
succLi¡
 = 
NULL
;

131 
tc
->
numMemBlocks
 = 0;

132 
tc
->
memBlockLi¡
 = 
NULL
;

133 
tc
->
®loÿ‹d
 = 
NULL
;

135 
numTasks
++;

136 
skLi¡
 = (
sk_t
**è
	`REALLOC
ĞskLi¡, 
numTasks
 * (task_t*), "taskList" );

137 
skLi¡
[
numTasks
-1] = 
tc
;

139 
	`fşo£
Ğ
åŒ
 );

142 
	}
}

160 
	$»adMSG
() {

162 
Šame
[
MAXLEN
];

163 
gid
, 
numsks
, 
numsuccs
;

164 
pidx
, 
sidx
, 
³x
;

165 
i
, 
k
;

166 
sk_t
 *
tc
;

167 
sched_t
 *
sc
;

169 
FILE
 *
åŒ
 = 
	`İ’fe
Ğ
dgÇme
, "r" );

171 
numCh¬ts
 = 0;

172 
msg
 = 
NULL
;

174 
pCh¬t
 = (*è
	`MALLOC
ĞpCh¬t, 
numTasks
 * (), "pChart" );

175  
k
 = 0; k < 
numTasks
; k++ )

176 
pCh¬t
[
k
] = -1;

178  
	`fsÿnf
Ğ
åŒ
, "%d %d", &
gid
, &
numsuccs
 ) !ğ
EOF
 ) {

180 ifĞ
numCh¬ts
 < 
gid
 + 1 )

181 
numCh¬ts
 = 
gid
 + 1;

182 
msg
 = (
ch¬t_t
*è
	`REALLOC
Ğmsg, 
numCh¬ts
 * (chart_t), "msg" );

185 
msg
[
gid
].
numSuccs
 = 
numsuccs
;

186 
msg
[
gid
].
succLi¡
 = (*è
	`MALLOC
Ğmsg[gid].succLi¡, 
numsuccs
 * (), "msg succList" );

187  
i
 = 0; i < 
numsuccs
; i++ ) {

188 
	`fsÿnf
Ğ
åŒ
, "%d", &
sidx
 );

189 
msg
[
gid
].
succLi¡
[
i
] = 
sidx
;

193 
msg
[
gid
].
PELi¡
 = (
sched_t
**è
	`MALLOC
Ğmsg[gid].PELi¡, 
numPEs
 * (sched_t*), "msg PEList" );

194  
i
 = 0; i < 
numPEs
; i++ ) {

195 
msg
[
gid
].
PELi¡
[
i
] = (
sched_t
*è
	`MALLOC
( msg[gid].PEList[i], (sched_t), "sched" );

196 
	`š™Sched
Ğ
msg
[
gid
].
PELi¡
[
i
] );

200 
	`fsÿnf
Ğ
åŒ
, "%d", &
numsks
 );

201 
msg
[
gid
].
tİoLi¡L’
 = 
numsks
;

202 
msg
[
gid
].
tİoLi¡
 = (*è
	`MALLOC
Ğmsg[gid].tİoLi¡, 
numsks
 * (), "msgopoList" );

204  
i
 = 0; i < 
numsks
; i++ ) {

205 
	`fsÿnf
Ğ
åŒ
, "% %d", 
Šame
, &
numsuccs
 );

207 
pidx
 = 
	`fšdTask
Ğ
Šame
 );

208 ifĞ
pidx
 == -1 )

209 
	`´štf
Ğ"Inv®idask % š ch¬ˆ%d\n", 
Šame
, 
gid
 ), 
	`ex™
(1);

211 
msg
[
gid
].
tİoLi¡
[
i
] = 
pidx
;

212 
pCh¬t
[
pidx
] = 
gid
;

214 
tc
 = 
skLi¡
[
pidx
];

217  
k
 = 0; k < 
numsuccs
; k++ ) {

218 
	`fsÿnf
Ğ
åŒ
, "%s", &
Šame
 );

220 
sidx
 = 
	`fšdTask
Ğ
Šame
 );

221 ifĞ
sidx
 == -1 )

222 
	`´štf
Ğ"Inv®id sucûssÜ %s\n", 
Šame
 ), 
	`ex™
(1);

224 
tc
->
numSuccs
++;

225 
tc
->
succLi¡
 = (*è
	`REALLOC
Ğtc->succLi¡,c->
numSuccs
 * (), "succList" );

226 
tc
->
succLi¡
[tc->
numSuccs
-1] = 
sidx
;

229 
skLi¡
[
sidx
]->
numP»ds
++;

230 
skLi¡
[
sidx
]->
´edLi¡
 = (*)

231 
	`REALLOC
Ğ
skLi¡
[
sidx
]->
´edLi¡
,askLi¡[sidx]->
numP»ds
 * (), "predList" );

232 
skLi¡
[
sidx
]->
´edLi¡
[skLi¡[sidx]->
numP»ds
-1] = 
pidx
;

236 
³x
 = 
	`fšdPE
Ğ
tc
->
³ID
 );

237 ifĞ
³x
 == -1 )

238 
	`´štf
Ğ"Task % assigÃdØšv®id PE %d.\n", 
Šame
, 
tc
->
³ID
 ), 
	`ex™
(1);

240 
sc
 = 
msg
[
gid
].
PELi¡
[
³x
];

241 
sc
->
numAssigÃd
++;

242 
sc
->
assigÃdLi¡
 = (*è
	`REALLOC
Ğsc->assigÃdLi¡, sc->
numAssigÃd
 * (), "assignedList" );

243 
sc
->
assigÃdLi¡
[sc->
numAssigÃd
-1] = 
pidx
;

247 
	`fşo£
Ğ
åŒ
 );

249 
	}
}

252 
	$»adEdgeBounds
() {

254 
FILE
 *
åŒ
 = 
	`İ’ãxt
Ğ
dgÇme
, "eb", "r" );

256 
¤c
, 
d¡
, 
bound
;

257 
tok’
[24];

259 
	`fsÿnf
Ğ
åŒ
, "% %d", 
tok’
, &
¡¬tNode
 );

260 
	`fsÿnf
Ğ
åŒ
, "% %d", 
tok’
, &
’dNode
 );

262 
numEdgeBounds
 = 0;

263 
edgeBounds
 = 
NULL
;

265  
	`fsÿnf
Ğ
åŒ
, "%d %d %d", &
¤c
, &
d¡
, &
bound
 ) !ğ
EOF
 ) {

266 
numEdgeBounds
++;

267 
edgeBounds
 = (
edge_t
*è
	`REALLOC
ĞedgeBounds, 
numEdgeBounds
 * (edge_t), "edgeBounds" );

268 
edgeBounds
[
numEdgeBounds
-1].
¤c
 = src;

269 
edgeBounds
[
numEdgeBounds
-1].
d¡
 = dst;

270 
edgeBounds
[
numEdgeBounds
-1].
bound
 = bound;

272 
	`fşo£
Ğ
åŒ
 );

275 
	}
}

278 
	$»adTaskMemÜyReq
Ğ
sk_t
 *
tc
 ) {

280 
k
;

281 
FILE
 *
åŒ
;

283 
â
, 
bb
, 
addr
, 
tb
, 
nb
, 
cf
;

284 
§
, 
—
, 
sm
, 
x
;

286 
åŒ
 = 
	`İ’ãxt
Ğ
tc
->
Šame
, "cfg", "r" );

288  
	`fsÿnf
Ğ
åŒ
, "%d %d %x %d %d %d", &
â
, &
bb
, &
addr
, &
tb
, &
nb
, &
cf
 ) !ğ
EOF
 ) {

289 
mem_t
 *
mt
 = (mem_t*è
	`MALLOC
( mt, (mem_t), "mt" );

290 
mt
->
âid
 = 
â
;

291 
mt
->
bbid
 = 
bb
;

292 
mt
->
addr
 =‡ddr;

293 
mt
->
äeq
 = 0;

295 
tc
->
numMemBlocks
++;

296 
tc
->
memBlockLi¡
 = (
mem_t
**è
	`REALLOC
Ğtc->memBlockLi¡,c->
numMemBlocks
 * (mem_t*), "memAddrList" );

297 
tc
->
memBlockLi¡
[tc->
numMemBlocks
-1] = 
mt
;

299 
	`fşo£
Ğ
åŒ
 );

302  
k
 = 1; k < 
tc
->
numMemBlocks
; k++ )

303 
tc
->
memBlockLi¡
[
k
-1]->
size
 =c->memBlockLi¡[k]->
addr
 -c->memBlockList[k-1]->addr;

305 
åŒ
 = 
	`İ’ãxt
Ğ
tc
->
Šame
, "arg", "r" );

306 
	`fsÿnf
Ğ
åŒ
, "%x %x %x %d %d %d %d", &
§
, &
—
, &
sm
, &
x
, &x, &x, &x );

307 
	`fşo£
Ğ
åŒ
 );

309 
tc
->
memBlockLi¡
[tc->
numMemBlocks
-1]->
size
 = 
—
 -c->memBlockLi¡[tc->numMemBlocks-1]->
addr
 + 
INSN_SIZE
;

311 
tc
->
®loÿ‹d
 = (*è
	`CALLOC
Ğtc->®loÿ‹d,c->
numMemBlocks
, (), "allocated" );

312  
k
 = 0; k < 
tc
->
numMemBlocks
; k++ )

313 
tc
->
memBlockLi¡
[
k
]->
»®size
 =c->memBlockLi¡[k]->
size
;

316 
	}
}

323 
	$»adMemÜyReq
() {

325 
i
;

326  
i
 = 0; i < 
numTasks
; i++ )

327 
	`»adTaskMemÜyReq
Ğ
skLi¡
[
i
] );

330 
	}
}

333 
	$»adCÚfig
() {

335 
FILE
 *
åŒ
;

336 
tmp
[20];

337 
³
, 
ÿ·c™y
 = 0;

339 
numPEs
 = 0;

340 
³ID
 = 
NULL
;

341 
¥mC­ac™y
 = 
NULL
;

342 
tÙ®ÿ·c™y
 = 0;

344 
åŒ
 = 
	`İ’fe
Ğ
câame
, "r" );

345 
	`fsÿnf
Ğ
åŒ
, "% %d %d", 
tmp
, &
¥m_Ï‹ncy
, &
off_Ï‹ncy
 );

347  
	`fsÿnf
Ğ
åŒ
, "%d %d", &
³
, &
ÿ·c™y
 ) !ğ
EOF
 ) {

348 
numPEs
++;

349 
³ID
 = (*è
	`REALLOC
Ğ³ID, 
numPEs
 * (), "peID" );

350 
³ID
[
numPEs
-1] = 
³
;

351 
¥mC­ac™y
 = (*è
	`REALLOC
Ğ¥mC­ac™y, 
numPEs
 * (), "spmCapacity" );

352 
¥mC­ac™y
[
numPEs
-1] = 
ÿ·c™y
;

354 
tÙ®ÿ·c™y
 +ğ
ÿ·c™y
;

356 
	`fşo£
Ğ
åŒ
 );

358 
	}
}

361 
	$ä“AÎoc
Ğ
®loc_t
 *
ac
 ) {

363 
i
;

364  
i
 = 0; i < 
ac
->
numOv”Ïys
; i++ ) {

365 
	`ä“
Ğ
ac
->
ov”ÏyLi¡
[
i
]->
owÃrTaskLi¡
 );

366 
	`ä“
Ğ
ac
->
ov”ÏyLi¡
[
i
] );

368 
	`ä“
Ğ
ac
->
ov”ÏyLi¡
 );

371 
	}
}

373 
	$ä“Sched
Ğ
sched_t
 *
sc
 ) {

375 ifĞ
sc
->
¥m
 !ğ
NULL
 ) {

376 
	`ä“AÎoc
Ğ
sc
->
¥m
 );

377 
	`ä“
Ğ
sc
->
¥m
 );

379 
	`ä“
Ğ
sc
->
assigÃdLi¡
 );

382 
	}
}

385 
	$ä“Task
Ğ
sk_t
 *
tx
 ) {

387 
	`ä“
Ğ
tx
->
´edLi¡
 );

388 
	`ä“
Ğ
tx
->
succLi¡
 );

389 
	`ä“
Ğ
tx
->
memBlockLi¡
 );

390 
	`ä“
Ğ
tx
->
®loÿ‹d
 );

393 
	}
}

396 
	$ä“Ch¬t
Ğ
ch¬t_t
 *
cx
 ) {

398 
i
;

399  
i
 = 0; i < 
numPEs
; i++ ) {

400 
	`ä“Sched
Ğ
cx
->
PELi¡
[
i
] );

401 
	`ä“
Ğ
cx
->
PELi¡
[
i
] );

403 
	`ä“
Ğ
cx
->
PELi¡
 );

404 
	`ä“
Ğ
cx
->
succLi¡
 );

405 
	`ä“
Ğ
cx
->
tİoLi¡
 );

406 
	`ä“
Ğ
cx
->
timeTİoLi¡
 );

409 
	}
}

412 
	$ä“P©h
Ğ
·th_t
 *
px
 ) {

414 
i
;

416 
	`ä“Ch¬t
Ğ
px
->
msc
 );

417 
	`ä“
Ğ
px
->
msc
 );

419  
i
 = 0; i < 
numCh¬ts
; i++ )

420 
	`ä“
Ğ
px
->
edgeBounds
[
i
] );

421 
	`ä“
Ğ
px
->
edgeBounds
 );

424 
	}
}

427 
	$ä“AÎ
() {

429 
i
;

431  
i
 = 0; i < 
numTasks
; i++ ) {

432 
	`ä“Task
Ğ
skLi¡
[
i
] );

433 
	`ä“
Ğ
skLi¡
[
i
] );

435 
	`ä“
Ğ
skLi¡
 );

436 
	`ä“
Ğ
³ID
 );

437 
	`ä“
Ğ
¥mC­ac™y
 );

439  
i
 = 0; i < 
numCh¬ts
; i++ ) {

440 
	`ä“Ch¬t
Ğ&(
msg
[
i
]) );

441 
	`ä“
Ğ&(
msg
[
i
]) );

443 
	`ä“
Ğ
msg
 );

444 
	`ä“
Ğ
pCh¬t
 );

446 
	`ä“
Ğ
—¾›¡Req
 );

447 
	`ä“
Ğ
Ï‹¡Req
 );

448 
	`ä“
Ğ
—¾›¡Fš
 );

449 
	`ä“
Ğ
Ï‹¡Fš
 );

452 
	}
}

	@parseCFG.c

5 
	~<¡ršg.h
>

6 
	~<¡dio.h
>

8 
ÿlcuÏ‹_šcomšg
();

12 
	$ü—‹Block
Ğ
block
 *
bb
, 
pid
, 
bbid
, 
¡¬ddr
, 
tb
, 
nb
, 
ÿÎpid
, 
loİid
 ) {

14 
bb
->
bbid
 = bbid;

15 
bb
->
pid
 =…id;

16 
bb
->
¡¬ddr
 = startaddr;

17 
bb
->
outgošg
 = 
NULL
;

18 
bb
->
num_outgošg
 = 0;

19 
bb
->
num_outgošg_cİy
 = 0;

21 
bb
->
ÿÎpid
 = callpid;

22 
bb
->
size
 = 0;

28 
bb
->
loİid
 =†oopid;

29 
bb
->
is_loİh—d
 = 0;

30 
bb
->
š¡¾i¡
 = 
NULL
;

31 
bb
->
num_š¡r
 = 0;

32 
bb
->
num_ÿche_¡©e
 = 0;

33 
bb
->
num_ÿche_¡©e_L2
 = 0;

34 
bb
->
num_chmc
 = 0;

35 
bb
->
num_chmc_L2
 = 0;

36 
bb
->
bb_ÿche_¡©e
 = 
NULL
;

37 
bb
->
bb_ÿche_¡©e_L2
ğ
NULL
;

42 
bb
->
´oc_±r
 = 
NULL
;

45 ifĞ
tb
 != -1 ) {

46 
bb
->
num_outgošg
++;

47 
bb
->
num_outgošg_cİy
++;

49 
bb
->
outgošg
 = (*è
	`REALLOC
Ğbb->outgošg, bb->
num_outgošg
 * (), "bb outedge" );

50 
bb
->
outgošg
[ bb->
num_outgošg
 - 1 ] = 
tb
;

52 ifĞ
nb
 != -1 ) {

53 
bb
->
num_outgošg
++;

54 
bb
->
num_outgošg_cİy
++;

56 
bb
->
outgošg
 = (*è
	`REALLOC
Ğbb->outgošg, bb->
num_outgošg
 * (), "bb outedge" );

57 
bb
->
outgošg
[ bb->
num_outgošg
 - 1 ] = 
nb
;

61 
	}
}

67 
	$ü—‹Loİ
Ğ
loİ
 *
Í
, 
pid
, 
Íid
, 
Ëv–
, 
block
 *
loİh—d
 ) {

69 
Í
->
Íid
 =†pid;

70 
Í
->
pid
 =…id;

71 
Í
->
loİbound
 = 0;

72 
Í
->
loİh—d
 =†oophead;

73 
Í
->
loİsšk
 = 
NULL
;

74 
Í
->
loİex™
 = 
NULL
;

75 
Í
->
Ëv–
 =†evel;

76 
Í
->
Ã¡
 = -1;

77 
Í
->
is_dowhe
 = 0;

78 
Í
->
tİo
 = (
block
**è
	`MALLOC
(†p->topo, (block*), "loopopo" );

79 
Í
->
tİo
[0] = 
loİh—d
;

80 
Í
->
num_tİo
 = 1;

81 
Í
->
wût
 = 0;

82 
Í
->
w·th
 = 
NULL
;

83 
Í
->
num_co¡
 = 0;

86 
	}
}

92 
	$ü—‹Proc
Ğ
´oûdu»
 *
p
, 
pid
 ) {

94 
p
->
pid
 =…id;

95 
p
->
bbli¡
 = 
NULL
;

96 
p
->
num_bb
 = 0;

97 
p
->
loİs
 = 
NULL
;

98 
p
->
num_loİs
 = 0;

99 
p
->
ÿÎs
 = 
NULL
;

100 
p
->
num_ÿÎs
 = 0;

101 
p
->
tİo
 = 
NULL
;

102 
p
->
num_tİo
 = 0;

103 
p
->
wût
 = 0;

104 
p
->
w·th
 = 
NULL
;

105 
p
->
num_co¡
 = 0;

109 
	}
}

115 
	$ü—‹In¡r
Ğ
š¡r
 *
i
, 
addr
, *
İ
, *
r1
, *
r2
, *
r3
 ) {

117 
	`¥rštf
Ğ
i
->
addr
, "%08x",‡ddr );

118 
	`¡rıy
Ğ
i
->
İ
, op );

119 
	`¡rıy
Ğ
i
->
r1
,„1 );

120 
	`¡rıy
Ğ
i
->
r2
,„2 );

121 
	`¡rıy
Ğ
i
->
r3
,„3 );

124 
	}
}

135 
	$»ad_¬g
Ğ*
Ï¡addr
, *
mašaddr
 ) {

137 
FILE
 *
åŒ
;

138 
sÿn
;

140 
åŒ
 = 
	`İ’fe
( "arg", "r" );

142 
	`fsÿnf
Ğ
åŒ
, "%x", &
sÿn
 );

143 
	`fsÿnf
Ğ
åŒ
, "%x", 
Ï¡addr
 );

144 
	`fsÿnf
Ğ
åŒ
, "%x", 
mašaddr
 );

147 
	`fşo£
Ğ
åŒ
 );

150 
	}
}

158 
	$couÁIn¡rP»v
Ğ
block
 *
bb
 ) {

160 
´oûdu»
 *
p
;

161 
block
 *
´ev
;

163 ifĞ!
bb
 )

164 
	`´štf
Ğ"NuÎ basiøblock iÀcouÁIn¡rP»v\n" ), 
	`ex™
(1);

166 ifĞ
bb
->
bbid
 == 0 ) {

168 ifĞ
bb
->
pid
 == 0 )

172 
p
 = 
´ocs
[ 
bb
->
pid
 - 1 ];

173 
´ev
 = 
p
->
bbli¡
[…->
num_bb
 - 1 ];

177 
p
 = 
´ocs
[ 
bb
->
pid
 ];

178 
´ev
 = 
p
->
bbli¡
[…->
num_bb
 - 2 ];

180 
´ev
->
size
 = 
bb
->
¡¬ddr
 -…rev->startaddr;

182  
´ev
->
size
;

183 
	}
}

190 
	$couÁIn¡rLa¡
Ğ
Ï¡addr
 ) {

192 
´oûdu»
 *
p
;

193 
block
 *
bb
;

195 
p
 = 
´ocs
[ 
num_´ocs
 - 1];

196 ifĞ!
p
 )

197 
	`´štf
Ğ"NuÎ†a¡…roûdu»\n" ), 
	`ex™
(1);

199 
bb
 = 
p
->
bbli¡
[…->
num_bb
 - 1 ];

200 ifĞ!
bb
 )

201 
	`´štf
Ğ"NuÎ†a¡ basiøblock\n" ), 
	`ex™
(1);

206 
bb
->
size
 = 
Ï¡addr
 - bb->
¡¬ddr
 + 
INSN_SIZE
;

208  
bb
->
size
;

209 
	}
}

215 
	$fšdMašProc
Ğ
mašaddr
 ) {

217 
´oûdu»
 *
p
;

218 
i
;

220  
i
 = 0; i < 
num_´ocs
; i++ ) {

221 
p
 = 
´ocs
[
i
];

223 ifĞ!
p
 || !p->
num_bb
 )

227 ifĞ
mašaddr
 =ğ
p
->
bbli¡
[0]->
¡¬ddr
 )

228  
i
;

231 
	}
}

238 
	$tİo_ÿÎ
() {

240 
i
;

241 
´oûdu»
 *
p
;

243 
´oûdu»
 **
comeäom
;

244 
comeäomsize
;

245 *
m¬kfš
;

246 
fš
;

248 
couÁdÚe
;

250 
comeäom
 = 
NULL
;

251 
comeäomsize
 = 0;

252 
m¬kfš
 = (*è
	`CALLOC
Ğm¬kfš, 
num_´ocs
, (), "topo fin‡rray" );

253 
´oc_cg
 = (*è
	`REALLOC
Ğ´oc_cg, 
num_´ocs
 * (), "procopo" );

255 
couÁdÚe
 = 0;

258 
p
 = 
´ocs
[ 
maš_id
 ];

260  
couÁdÚe
 < 
num_´ocs
 ) {

262 
fš
 = 1;

263  
i
 = 0; 
fš
 && i < 
p
->
num_ÿÎs
; i++ )

264 ifĞ
m¬kfš
[ 
p
->
ÿÎs
[
i
] ] != 2 )

265 
fš
 = 0;

267 ifĞ!
p
->
num_ÿÎs
 || 
fš
 ) {

268 
m¬kfš
[ 
p
->
pid
 ] = 2;

269 
´oc_cg
[ 
couÁdÚe
++ ] = 
p
->
pid
;

272 ifĞ!
comeäomsize
 )

275 
p
 = 
comeäom
[ --
comeäomsize
 ];

279 
m¬kfš
[ 
p
->
pid
 ] = 1;

280 
comeäom
 = (
´oûdu»
**è
	`REALLOC
Ğcomeäom, (
comeäomsize
 + 1) * (procedure*), "topo comefrom‡rray" );

281 
comeäom
[ 
comeäomsize
++ ] = 
p
;

284 
fš
 = 1;

285  
i
 = 0; 
fš
 && i < 
p
->
num_ÿÎs
; i++ ) {

286 ifĞ
m¬kfš
[ 
p
->
ÿÎs
[
i
] ] != 2 ) {

287 
p
 = 
´ocs
[…->
ÿÎs
[
i
] ];

288 
fš
 = 0;

291 ifĞ
fš
 )

292 
	`´štf
Ğ"Unvis™ed c®Ëd…roûdu»‚Ù d‘eùed.\n" ), 
	`ex™
(1);

296 
	`ä“
Ğ
comeäom
 );

297 
	`ä“
Ğ
m¬kfš
 );

300 
	}
}

308 
	$»ad_cfg
() {

310 
FILE
 *
åŒ
;

312 
pid
, 
bbid
, 
bb§
, 
tb
, 
nb
, 
ıid
;

313 
´oûdu»
 *
p
;

314 
block
 *
bb
;

316 
Ï¡addr
;

317 
mašaddr
;

319 
åŒ
 = 
	`İ’fe
( "cfg", "r" );

321  
	`fsÿnf
Ğ
åŒ
, "%d %d %x %d %d %d", &
pid
, &
bbid
, &
bb§
, &
tb
, &
nb
, &
ıid
 ) !ğ
EOF
 ) {

324 ifĞ
pid
 >ğ
num_´ocs
 ) {

327 
p
 = (
´oûdu»
*è
	`MALLOC
(…, (procedure), "procedure" );

329 
	`mem£t
(
p
, 0, (
´oûdu»
));

330 
	`ü—‹Proc
Ğ
p
, 
pid
 );

332 
num_´ocs
++;

333 
´ocs
 = (
´oûdu»
**è
	`REALLOC
Ğ´ocs, 
num_´ocs
 * (procedure*), "procedure†ist" );

334 
´ocs
[ 
num_´ocs
 - 1 ] = 
p
;

337 
p
 = 
´ocs
[
pid
];

338 ifĞ!
p
 )

339 
	`´štf
Ğ"NuÎ…roûdu»‡ˆ%d\n", 
pid
 ), 
	`ex™
(1);

342 
bb
 = (
block
*è
	`MALLOC
( bb, (block), "basic block" );

343 
	`mem£t
(
bb
, 0, (
block
));

344 
	`ü—‹Block
Ğ
bb
, 
pid
, 
bbid
, 
bb§
, 
tb
, 
nb
, 
ıid
, -1 );

346 
p
->
num_bb
++;

347 
p
->
bbli¡
 = (
block
**è
	`REALLOC
Ğp->bbli¡,…->
num_bb
 * (block*), "bblist" );

348 
p
->
bbli¡
[…->
num_bb
 - 1 ] = 
bb
;

351 ifĞ
ıid
 != -1 ) {

352 
p
->
num_ÿÎs
++;

353 
p
->
ÿÎs
 = (*è
	`REALLOC
Ğp->ÿÎs,…->
num_ÿÎs
 * (), "calls" );

354 
p
->
ÿÎs
[…->
num_ÿÎs
 - 1 ] = 
ıid
;

359 
	`couÁIn¡rP»v
Ğ
bb
 );

361 
tÙ®_bb
++;

363 
	`fşo£
Ğ
åŒ
 );

365 
	`»ad_¬g
Ğ&
Ï¡addr
, &
mašaddr
 );

368 
	`couÁIn¡rLa¡
Ğ
Ï¡addr
 );

370 
maš_id
 = 
	`fšdMašProc
Ğ
mašaddr
 );

371 ifĞ
maš_id
 == -1 )

372 
	`´štf
Ğ"Maš…roûdu»‚Ù found.\n" ), 
	`ex™
(1);

375 
	`tİo_ÿÎ
();

380 
	}
}

391 
	$»adIn¡r
() {

393 
FILE
 *
åŒ
;

395 
block
 *
bb
;

396 
š¡r
 *
š¢
;

398 
lše
[ 
INSN_LEN
 ];

399 
İ
[9], 
r1
[9], 
r2
[9], 
r3
[9];

400 
addr
;

402 
åŒ
 = 
	`İ’fe
( "md", "r" );

404  
	`fg‘s
Ğ
lše
, 
INSN_LEN
, 
åŒ
 )) {

406 
İ
[0] = '\0';

407 
r1
[0] = '\0';

408 
r2
[0] = '\0';

409 
r3
[0] = '\0';

411 
	`ssÿnf
Ğ
lše
, "%x % % % %s\n", &
addr
, 
İ
, 
r1
, 
r2
, 
r3
 );

413 
bb
 = 
	`fšdBlock
Ğ
addr
 );

414 ifĞ!
bb
 ) {

416 ifĞ
debug
 )

417 
	`´štf
Ğ"W¬nšg: IgnÜed out-of-¿ngadd»s [%x] % % % %s\n", 
addr
, 
İ
, 
r1
, 
r2
, 
r3
 );

421 
š¢
 = (
š¡r
*è
	`MALLOC
( insn, (instr), "instruction" );

422 
	`ü—‹In¡r
Ğ
š¢
, 
addr
, 
İ
, 
r1
, 
r2
, 
r3
 );

424 
bb
->
num_š¡r
++;

425 
bb
->
š¡¾i¡
 = (
š¡r
**è
	`REALLOC
Ğbb->š¡¾i¡, bb->
num_š¡r
 * (instr*), "instruction†ist" );

426 
bb
->
š¡¾i¡
[ bb->
num_š¡r
 - 1 ] = 
š¢
;

428 
	`fşo£
Ğ
åŒ
 );

431 
	}
}

434 
	$ÿlcuÏ‹_šcomšg
()

436 
i
, 
j
, 
k
, 
n
, 
num_blk
, 
num_loİ
;

437 
block
 *
¤c_bb
, *
d¡_bb
;

438 
´oûdu»
 *
p
;

439 
loİ
 *
Í
;

441 
k
 = 
num_´ocs
 -1; k >= 0; k--)

444 
p
 = 
´ocs
[
k
];

446  
i
 = 0; i < 
p
->
num_bb
; i++ )

448 
p
->
bbli¡
[
i
]->
num_šcomšg
= 0;

449 
p
->
bbli¡
[
i
]->
šcomšg
 =

450 (*)
	`CALLOC
(
p
->
bbli¡
[
i
]->
šcomšg
, 1, (), "incoming");

453  
i
 = 0; i < 
p
->
num_bb
; i++ )

455 
¤c_bb
 = 
p
->
bbli¡
[
i
];

456  
j
 = 0; j < 
¤c_bb
->
num_outgošg
; j++ )

458 
d¡_bb
 = 
p
->
bbli¡
[
¤c_bb
->
outgošg
[
j
]];

460 
d¡_bb
->
num_šcomšg
++;

461 
d¡_bb
->
šcomšg
 =

462 (*è
	`REALLOC
Ğ
d¡_bb
->
šcomšg
, d¡_bb->
num_šcomšg
 * (), "bb inedge" );

463 
d¡_bb
->
šcomšg
[ d¡_bb->
num_šcomšg
 - 1 ] = 
¤c_bb
->
bbid
;

483 
	}
}

	@path.c

6 
	$ä“P©h
Ğ
bbid
, 
±id
 ) {

8 ifĞ
·thli¡
[
bbid
][
±id
] ) {

9 
	`ä“
Ğ
·thli¡
[
bbid
][
±id
]->
bb_£q
 );

10 
	`ä“
Ğ
·thli¡
[
bbid
][
±id
]->
b¿nch_eff
 );

11 
	`ä“
Ğ
·thli¡
[
bbid
][
±id
]->
b¿nch_dœ
 );

13 
	`ä“
Ğ
·thli¡
[
bbid
][
±id
] );

16 
	}
}

19 
	$ä“P©hsInNode
Ğ
bbid
 ) {

21 
i
;

23  
i
 = 0; i < 
num_·ths
[
bbid
]; i++ )

24 
	`ä“P©h
Ğ
bbid
, 
i
 );

25 
	`ä“
Ğ
·thli¡
[
bbid
] );

27 
	}
}

53 
	$id’tiÿlCÚæiù
Ğ
·th
 *
p1
,…©h *
p2
 ) {

55 
i
;

57  
i
 = 0; i < 
p1
->
b¿nch_Ën
; i++ )

58 ifĞ
p1
->
b¿nch_eff
[
i
] !ğ
p2
->branch_eff[i] ||

59 
p1
->
b¿nch_dœ
[
i
] !ğ
p2
->branch_dir[i] )

63 
	}
}

69 
	$hasEdge
Ğ
·th
 *
p
, 
b¿nch
 *
br
, 
dœ
 ) {

71 
i
;

73  
i
 = 0; i < 
p
->
b¿nch_Ën
; i++ ) {

74 ifĞ
p
->
b¿nch_eff
[
i
] =ğ
br
 ) {

75 ifĞ
p
->
b¿nch_dœ
[
i
] =ğ
dœ
 )

83 
	}
}

90 
	$sub£tCÚæiù
Ğ
·th
 *
p1
,…©h *
p2
 ) {

92 
i
;

94 ifĞ
p1
->
b¿nch_Ën
 == 0 )

97 ifĞ
p1
->
b¿nch_Ën
 > 
p2
->branch_len )

100 ifĞ
p1
->
b¿nch_Ën
 =ğ
p2
->branch_len )

102  
	`id’tiÿlCÚæiù
Ğ
p1
, 
p2
 );

105  
i
 = 0; i < 
p1
->
b¿nch_Ën
; i++ ) {

106 ifĞ
p1
->
b¿nch_eff
[
i
] =ğ
NULL
 )

108 ifĞ!
	`hasEdge
Ğ
p2
, 
p1
->
b¿nch_eff
[
i
],…1->
b¿nch_dœ
[i] ))

112 
	}
}

118 
	$sÜtP©h
Ğ
·th
 **
·thli¡
, 
num_·ths
 ) {

120 
i
;

121 
chªged
;

122 
·th
 *
‹mp
;

124 
chªged
 = 1;

125  
chªged
 ) {

127 
chªged
 = 0;

128  
i
 = 0; i < 
num_·ths
 - 1; i++ ) {

130 ifĞ
·thli¡
[
i
]->
co¡
 >…athlist[i+1]->cost ||

131 Ğ
·thli¡
[
i
]->
co¡
 ==…athlist[i+1]->cost &&

132 
·thli¡
[
i
]->
b¿nch_Ën
 <…athlist[i+1]->branch_len )) {

135 
‹mp
 = 
·thli¡
[
i
];

136 
·thli¡
[
i
] =…athlist[i+1];

137 
·thli¡
[
i
+1] = 
‹mp
;

139 
chªged
 = 1;

144 
	}
}

198 
	$cİySeq
Ğ
·th
 *
p1
,…©h *
p2
 ) {

200 
i
;

201  
i
 = 0; i < 
p2
->
bb_Ën
; i++ )

202 
p1
->
bb_£q
[
i
] = 
p2
->bb_seq[i];

204  
i
 = 0; i < 
p2
->
b¿nch_Ën
; i++ ) {

205 
p1
->
b¿nch_eff
[
i
] = 
p2
->branch_eff[i];

206 
p1
->
b¿nch_dœ
[
i
] = 
p2
->branch_dir[i];

209 
	}
}

216 
	$sÜ‹dIn£¹B¿nch
Ğ
·th
 *
±
, 
b¿nch
 *
br
, 
dœ
 ) {

218 
i
;

220 
i
 = 
±
->
b¿nch_Ën
 - 1;

221  
i
 > 0 && 
±
->
b¿nch_eff
[i-1]->
bb
->
bbid
 > 
br
->bb->bbid ) {

222 
±
->
b¿nch_eff
[
i
] =…t->branch_eff[i-1];

223 
±
->
b¿nch_dœ
[
i
] =…t->branch_dir[i-1];

224 
i
--;

226 
±
->
b¿nch_eff
[
i
] = 
br
;

227 
±
->
b¿nch_dœ
[
i
] = 
dœ
;

230 
	}
}

236 
	$»moveB¿nch
Ğ
·th
 *
±
, 
bri
 ) {

238 
i
;

241  
i
 = 
bri
; i < 
±
->
b¿nch_Ën
 - 1; i++ ) {

242 
±
->
b¿nch_eff
[
i
] =…t->branch_eff[i+1];

243 
±
->
b¿nch_dœ
[
i
] =…t->branch_dir[i+1];

245 
±
->
b¿nch_Ën
--;

248 
	}
}

255 
	$fšdB¿nch
Ğ
b¿nch
 *
br
, b¿nch **
b¿nch_eff
, 
b¿nch_Ën
 ) {

257 
i
;

258  
i
 = 0; i < 
b¿nch_Ën
; i++ )

259 ifĞ
b¿nch_eff
[
i
] =ğ
br
 )

260  
i
;

262 
	}
}

	@pathDAG.c

3 
·thFunùiÚ
(
´oûdu»
 * 
´oc
);

6 
·thLoİ
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
);

9 
·thDAG
(
MSC
 *
msc
);

14 
	$·thFunùiÚ
(
´oûdu»
 *
´oc
)

16 
i
, 
út
, 
Í_Ëv–
, 
num_blk
, 
cİ›s
;

17 
tmp
;

18 
´oûdu»
 *
p
 = 
´oc
;

19 
block
 *
bb
;

24 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

25 if(
loİ_Ëv–_¬r
[
i
] =ğ
INVALID
)

27 
Í_Ëv–
 = 
i
 -1;

31 
út
 = 0;

32 
i
 = 0; i <ğ
Í_Ëv–
; i++)

33 if(
loİ_Ëv–_¬r
 [
i
] =ğ
NEXT_ITERATION
)

34 
út
 +ğ(1<<(
Í_Ëv–
 - 
i
));

36 if(
Í_Ëv–
 == -1)

38 
cİ›s
 = 1;

42 
cİ›s
 = (2<<
Í_Ëv–
);

46 if(
´oc
->
num_co¡
 == 0)

48 
´oc
->
num_co¡
 = 
cİ›s
;

50 
´oc
->
wût
 = (
uÎ
*)
	`CALLOC
Õroc->wût, 
cİ›s
, (ull), "ull");

51 
´oc
->
bût
 = (
uÎ
*)
	`CALLOC
Õroc->bût, 
cİ›s
, (ull), "ull");

53 
´oc
->
h™_wût
 = (
uÎ
*)
	`CALLOC
Õroc->h™_wût, 
cİ›s
, (ull), "ull");

54 
´oc
->
miss_wût
 = (
uÎ
*)
	`CALLOC
Õroc->miss_wût, 
cİ›s
, (ull), "ull");

55 
´oc
->
unknow_wût
 = (
uÎ
*)
	`CALLOC
Õroc->unknow_wût, 
cİ›s
, (ull), "ull");

57 
´oc
->
h™_wût_L2
 = (
uÎ
*)
	`CALLOC
Õroc->h™_wût_L2, 
cİ›s
, (ull), "ull");

58 
´oc
->
miss_wût_L2
 = (
uÎ
*)
	`CALLOC
Õroc->miss_wût_L2, 
cİ›s
, (ull), "ull");

59 
´oc
->
unknow_wût_L2
 = (
uÎ
*)
	`CALLOC
Õroc->unknow_wût_L2, 
cİ›s
, (ull), "ull");

63 
´oc
->
h™_bût
 = (
uÎ
*)
	`CALLOC
Õroc->h™_bût, 
cİ›s
, (ull), "ull");

64 
´oc
->
miss_bût
 = (
uÎ
*)
	`CALLOC
Õroc->miss_bût, 
cİ›s
, (ull), "ull");

65 
´oc
->
unknow_bût
 = (
uÎ
*)
	`CALLOC
Õroc->unknow_bût, 
cİ›s
, (ull), "ull");

67 
´oc
->
h™_bût_L2
 = (
uÎ
*)
	`CALLOC
Õroc->h™_bût_L2, 
cİ›s
, (ull), "ull");

68 
´oc
->
miss_bût_L2
 = (
uÎ
*)
	`CALLOC
Õroc->miss_bût_L2, 
cİ›s
, (ull), "ull");

69 
´oc
->
unknow_bût_L2
 = (
uÎ
*)
	`CALLOC
Õroc->unknow_bût_L2, 
cİ›s
, (ull), "ull");

72 
´oc
->
wût
[
út
] = 0;

73 
´oc
->
bût
[
út
] = 0;

75 
´oc
->
h™_wût
[
út
] = 0;

76 
´oc
->
miss_wût
[
út
] = 0;

77 
´oc
->
unknow_wût
[
út
] = 0;

80 
´oc
->
h™_wût_L2
[
út
] = 0;

81 
´oc
->
miss_wût_L2
[
út
] = 0;

82 
´oc
->
unknow_wût_L2
[
út
] = 0;

85 
´oc
->
h™_bût
[
út
] = 0;

86 
´oc
->
miss_bût
[
út
] = 0;

87 
´oc
->
unknow_bût
[
út
] = 0;

90 
´oc
->
h™_bût_L2
[
út
] = 0;

91 
´oc
->
miss_bût_L2
[
út
] = 0;

92 
´oc
->
unknow_bût_L2
[
út
] = 0;

95 
num_blk
 = 
p
->
num_tİo
;

97 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

100 
bb
 = 
p
 ->
tİo
[
i
];

103 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

105 if(
bb
->
is_loİh—d
)

108 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
FIRST_ITERATION
;

109 
	`·thLoİ
(
p
,…->
loİs
[
bb
->
loİid
]);

111 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
NEXT_ITERATION
;

112 
	`·thLoİ
(
p
,…->
loİs
[
bb
->
loİid
]);

114 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
INVALID
;

121 if(
bb
->
ÿÎpid
 != -1)

123 
	`·thFunùiÚ
(
bb
->
´oc_±r
);

189 
	}
}

196 
	$·thLoİ
(
´oûdu»
 *
´oc
, 
loİ
 *
Í
)

198 
i
, 
út
, 
Í_Ëv–
, 
num_blk
, 
cİ›s
;

200 
´oûdu»
 *
p
 = 
´oc
;

201 
block
 *
bb
;

202 
loİ
 *
Í_±r
 = 
Í
;

203 
tmp
;

205 
num_blk
 = 
Í_±r
->
num_tİo
;

209 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

210 if(
loİ_Ëv–_¬r
[
i
] =ğ
INVALID
)

212 
Í_Ëv–
 = 
i
 -1;

216 
út
 = 0;

217 
i
 = 0; i <ğ
Í_Ëv–
; i++)

218 if(
loİ_Ëv–_¬r
 [
i
] =ğ
NEXT_ITERATION
)

219 
út
 +ğ(1<<(
Í_Ëv–
 - 
i
));

222 if(
Í_Ëv–
 == -1)

224 
cİ›s
 = 1;

228 
cİ›s
 = (2<<
Í_Ëv–
);

231 if(
Í_±r
->
num_co¡
 == 0)

233 
Í_±r
->
num_co¡
 = 
cİ›s
;

235 
Í_±r
->
wût
 = (
uÎ
*)
	`CALLOC
Öp_±r->wût, 
cİ›s
, (ull), "ull");

236 
Í_±r
->
bût
 = (
uÎ
*)
	`CALLOC
Öp_±r->bût, 
cİ›s
, (ull), "ull");

238 
Í_±r
->
h™_wût
 = (
uÎ
*)
	`CALLOC
Öp_±r->h™_wût, 
cİ›s
, (ull), "ull");

239 
Í_±r
->
miss_wût
 = (
uÎ
*)
	`CALLOC
Öp_±r->miss_wût, 
cİ›s
, (ull), "ull");

240 
Í_±r
->
unknow_wût
 = (
uÎ
*)
	`CALLOC
Öp_±r->unknow_wût, 
cİ›s
, (ull), "ull");

242 
Í_±r
->
h™_wût_L2
 = (
uÎ
*)
	`CALLOC
Öp_±r->h™_wût_L2, 
cİ›s
, (ull), "ull");

243 
Í_±r
->
miss_wût_L2
 = (
uÎ
*)
	`CALLOC
Öp_±r->miss_wût_L2, 
cİ›s
, (ull), "ull");

244 
Í_±r
->
unknow_wût_L2
 = (
uÎ
*)
	`CALLOC
Öp_±r->unknow_wût_L2, 
cİ›s
, (ull), "ull");

248 
Í_±r
->
h™_bût
 = (
uÎ
*)
	`CALLOC
Öp_±r->h™_bût, 
cİ›s
, (ull), "ull");

249 
Í_±r
->
miss_bût
 = (
uÎ
*)
	`CALLOC
Öp_±r->miss_bût, 
cİ›s
, (ull), "ull");

250 
Í_±r
->
unknow_bût
 = (
uÎ
*)
	`CALLOC
Öp_±r->unknow_bût, 
cİ›s
, (ull), "ull");

252 
Í_±r
->
h™_bût_L2
 = (
uÎ
*)
	`CALLOC
Öp_±r->h™_bût_L2, 
cİ›s
, (ull), "ull");

253 
Í_±r
->
miss_bût_L2
 = (
uÎ
*)
	`CALLOC
Öp_±r->miss_bût_L2, 
cİ›s
, (ull), "ull");

254 
Í_±r
->
unknow_bût_L2
 = (
uÎ
*)
	`CALLOC
Öp_±r->unknow_bût_L2, 
cİ›s
, (ull), "ull");

258 
Í_±r
->
wût
[
út
] = 0;

259 
Í_±r
->
bût
[
út
] = 0;

261 
Í_±r
->
h™_wût
[
út
] = 0;

262 
Í_±r
->
miss_wût
[
út
] = 0;

263 
Í_±r
->
unknow_wût
[
út
] = 0;

265 
Í_±r
->
h™_wût_L2
[
út
] = 0;

266 
Í_±r
->
miss_wût_L2
[
út
] = 0;

267 
Í_±r
->
unknow_wût_L2
[
út
] = 0;

271 
Í_±r
->
h™_bût
[
út
] = 0;

272 
Í_±r
->
miss_bût
[
út
] = 0;

273 
Í_±r
->
unknow_bût
[
út
] = 0;

275 
Í_±r
->
h™_bût_L2
[
út
] = 0;

276 
Í_±r
->
miss_bût_L2
[
út
] = 0;

277 
Í_±r
->
unknow_bût_L2
[
út
] = 0;

280 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

283 
bb
 = 
Í_±r
->
tİo
[
i
];

286 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

288 if(
bb
->
is_loİh—d
 && 
i
!ğ
num_blk
 -1)

291 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
FIRST_ITERATION
;

293 
	`·thLoİ
(
p
,…->
loİs
[
bb
->
loİid
]);

295 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
NEXT_ITERATION
;

296 
	`·thLoİ
(
p
,…->
loİs
[
bb
->
loİid
]);

298 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
INVALID
;

343 if(
bb
->
ÿÎpid
 != -1)

345 
	`·thFunùiÚ
(
bb
->
´oc_±r
);

348 
	}
}

352 
	$·thDAG
(
MSC
 *
msc
)

354 
i
, 
j
;

357 
i
 = 0; i < 
msc
->
num_sk
; i ++)

359 
j
 = 0; j < 
MAX_NEST_LOOP
; j++)

360 
loİ_Ëv–_¬r
[
j
] = 
INVALID
;

362 
	`·thFunùiÚ
(
msc
->
skLi¡
[
i
].
maš_cİy
);

383 
	}
}

	@pathTest.c

3 
	$hasCÚæiù
(
efãùNo
){

4 
k
;

5 
k
 = 0; k < 
EFFECT_LEN
; k ++){

6 if(
	`¡¾’
(
efãùL¡
[
k
].
d”i_Œ“
è< 2 || k =ğ
efãùNo
) ;

7 if(
	`¡rcmp
(
efãùL¡
[
k
].
d”i_Œ“
,efãùL¡[
efãùNo
].deri_tree) == 0){

8 if(
	`isCÚæiù
(
efãùL¡
[
k
],efãùL¡[
efãùNo
]) == -1 ){

14 
	}
}

16 
	$ÿnûlEfãù
(
efãùNo
){

17 
k
;

18 
k
 = 0; k < 
EFFECT_LEN
; k ++){

19 if(
	`¡¾’
(
efãùL¡
[
k
].
d”i_Œ“
è< 2 || k =ğ
efãùNo
) ;

20 if(
	`¡rcmp
(
efãùL¡
[
k
].
d”i_Œ“
,efãùL¡[
efãùNo
].deri_tree) == 0){

21 
efãùL¡
[
k
].
d”i_Œ“
[0] = '\0';

24 
	}
}

27 
	$isF—sibË
(
p
[],
Ëngth
){

28 
i
, 
j
 ,
k
, 
m
; 
pow”
; 
dœeùiÚ
; 
»gPos1
,
»gPos2
,
»gPos3
; 
š_‹¡
; 
ÃwEfãù
 = 1;

29 
tmp
[
MEM_LEN
];

30 
off£t
[
MEM_LEN
];

31 
	`ş—rEfãùL¡
();

34 
efãùNo
 = 0;

40 
m
 = 0; m < 
Ëngth
; m++){

41 
i
 = 
p
[
m
];

44 
j
 = 0; j < 
NO_LINES
; j++){

45 
tmp
[0] = '\0';

46 if(
	`¡¾’
(
š¡rL¡
[
i
][
j
].
lše_no
) < 2) ;

50 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"beq") == 0 ||

51 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"bne") == 0){

52 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

53 
»gPos2
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r2
);

54 if((
»g2MemL¡
[
»gPos1
].
š¡r
 =ğ
SLTI
 ||„eg2MemL¡[»gPos1].š¡¸=ğ
SLT
) &&

55 
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è=ğ0 &&„eg2MemL¡[»gPos2].
v®ue
 == 0 ){

56 
efãùNo
 ++;

57 
efãùL¡
[
efãùNo
].
rhs
 = 
»g2MemL¡
[
»gPos1
].
v®ue
;

58 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"beq") == 0){

59 if(
	`¡rcmp
(
š¡rL¡
[
p
[
m
+1]][0].
lše_no
,š¡rL¡[
i
][
j
].
r3
) == 0)

60 
efãùL¡
[
efãùNo
].
»suÉ
 = 
BE
;

62 
efãùL¡
[
efãùNo
].
»suÉ
 = 
ST
;

65 if(
	`¡rcmp
(
š¡rL¡
[
p
[
m
+1]][0].
lše_no
,š¡rL¡[
i
][
j
].
r3
) == 0)

66 
efãùL¡
[
efãùNo
].
»suÉ
 = 
ST
;

68 
efãùL¡
[
efãùNo
].
»suÉ
 = 
BE
;

71 
	`¡rıy
(
efãùL¡
[
efãùNo
].
d”i_Œ“
,
»g2MemL¡
[
»gPos1
].
mem_addr
);

72 
efãùL¡
[
efãùNo
].
ty³
 = 
BRANCH
;

73 
efãùL¡
[
efãùNo
].
blkNo
 = 
i
;ƒfãùL¡[efãùNo].
ÊNo
 = 
j
;

74 if(
	`hasCÚæiù
(
efãùNo
))  0;

76 if(
»g2MemL¡
[
»gPos1
].
š¡r
 =ğ
NIL
 &&„eg2MemL¡[
»gPos2
].instr == NIL){

78 if((
	`¡¾’
(
»g2MemL¡
[
»gPos1
].
mem_addr
è> 0 && sŒËnÔeg2MemL¡[
»gPos2
].mem_addr) > 0) ||

79 (
	`¡¾’
(
»g2MemL¡
[
»gPos1
].
mem_addr
è=ğ0 && sŒËnÔeg2MemL¡[
»gPos2
].mem_addr)== 0))

82 
efãùNo
 ++;

83 if(
	`¡¾’
(
»g2MemL¡
[
»gPos1
].
mem_addr
è> 0 && sŒËnÔeg2MemL¡[
»gPos2
].mem_addr) == 0){

84 
š_‹¡
 = 
»gPos1
;

85 
efãùL¡
[
efãùNo
].
rhs
 = 
»g2MemL¡
[
»gPos2
].
v®ue
 -„eg2MemL¡[
»gPos1
].value;

87 if(
	`¡¾’
(
»g2MemL¡
[
»gPos1
].
mem_addr
è=ğ0 && sŒËnÔeg2MemL¡[
»gPos2
].mem_addr) > 0){

88 
š_‹¡
 = 
»gPos2
;

89 
efãùL¡
[
efãùNo
].
rhs
 = 
»g2MemL¡
[
»gPos1
].
v®ue
 -„eg2MemL¡[
»gPos2
].value;

91 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"bne") == 0){

92 if(
	`¡rcmp
(
š¡rL¡
[
p
[
m
+1]][0].
lše_no
,š¡rL¡[
i
][
j
].
r3
) == 0)

93 
efãùL¡
[
efãùNo
].
»suÉ
 = 
NE
;

95 
efãùL¡
[
efãùNo
].
»suÉ
 = 
EQ
;

98 if(
	`¡rcmp
(
š¡rL¡
[
p
[
m
+1]][0].
lše_no
,š¡rL¡[
i
][
j
].
r3
) == 0)

99 
efãùL¡
[
efãùNo
].
»suÉ
 = 
EQ
;

101 
efãùL¡
[
efãùNo
].
»suÉ
 = 
NE
;

103 
	`¡rıy
(
efãùL¡
[
efãùNo
].
d”i_Œ“
,
»g2MemL¡
[
š_‹¡
].
mem_addr
);

104 
efãùL¡
[
efãùNo
].
ty³
 = 
BRANCH
;ƒfãùL¡[efãùNo].
blkNo
 = 
i
;ƒfãùL¡[efãùNo].
ÊNo
 = 
j
;

105 if(
	`hasCÚæiù
(
efãùNo
))  0;

108 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"bgez") == 0 ||

109 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"blez") == 0 ||

110 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"bgtz") == 0 ){

111 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

112 if(
	`¡¾’
(
»g2MemL¡
[
»gPos1
].
mem_addr
) > 0){

113 
efãùNo
 ++;

114 
efãùL¡
[
efãùNo
].
rhs
 = 0 - 
»g2MemL¡
[
»gPos1
].
v®ue
;

115 
	`¡rıy
(
efãùL¡
[
efãùNo
].
d”i_Œ“
,
»g2MemL¡
[
»gPos1
].
mem_addr
);

116 
efãùL¡
[
efãùNo
].
ty³
 = 
BRANCH
;

117 
efãùL¡
[
efãùNo
].
blkNo
 = 
i
;ƒfãùL¡[efãùNo].
ÊNo
 = 
j
;

118 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"bgez") == 0){

119 if(
	`¡rcmp
(
š¡rL¡
[
p
[
m
+1]][0].
lše_no
,š¡rL¡[
i
][
j
].
r2
) == 0)

120 
efãùL¡
[
efãùNo
].
»suÉ
 = 
BE
;

122 
efãùL¡
[
efãùNo
].
»suÉ
 = 
ST
;

124 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"bgtz") == 0){

126 if(
	`¡rcmp
(
š¡rL¡
[
p
[
m
+1]][0].
lše_no
,š¡rL¡[
i
][
j
].
r2
) == 0)

127 
efãùL¡
[
efãùNo
].
»suÉ
 = 
BT
;

129 
efãùL¡
[
efãùNo
].
»suÉ
 = 
SE
;

132 if(
	`¡rcmp
(
š¡rL¡
[
p
[
m
+1]][0].
lše_no
,š¡rL¡[
i
][
j
].
r2
) == 0)

133 
efãùL¡
[
efãùNo
].
»suÉ
 = 
SE
;

135 
efãùL¡
[
efãùNo
].
»suÉ
 = 
BT
;

138 if(
	`hasCÚæiù
(
efãùNo
))  0;

145 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
r1
,"$s8[30]") == 0 ||

146 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
r1
,"$gp[28]") == 0) ;

152 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"lw") == 0 ||

153 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"lb") == 0 ||

154 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"lbu") == 0 ||

155 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"l.d") == 0

157 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

158 
»gPos3
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r3
);

159 
	`¥rštf
(
off£t
,"%d",
»g2MemL¡
[
»gPos3
].
v®ue
+
	`©oi
(
š¡rL¡
[
i
][
j
].
r2
));

160 
	`¡rÿt
(
tmp
,
off£t
);

161 if(
	`¡¾’
(
»g2MemL¡
[
»gPos3
].
mem_addr
) > 0){

162 
	`¡rÿt
(
tmp
,"plus");

163 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos3
].
mem_addr
);

165 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

166 
»g2MemL¡
[
»gPos1
].
v®ue
 = 0;

167 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
NIL
;

168 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

171 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"sw") == 0 ||

172 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"sb") == 0){

173 
»gPos3
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r3
);

174 
	`¥rštf
(
off£t
,"%d",
»g2MemL¡
[
»gPos3
].
v®ue
+
	`©oi
(
š¡rL¡
[
i
][
j
].
r2
));

175 
	`¡rÿt
(
tmp
,
off£t
);

176 if(
	`¡¾’
(
»g2MemL¡
[
»gPos3
].
mem_addr
) > 0){

177 
	`¡rÿt
(
tmp
,"plus");

178 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos3
].
mem_addr
);

180 
efãùNo
 ++;

181 
	`¡rıy
(
efãùL¡
[
efãùNo
].
d”i_Œ“
,
tmp
);

182 
efãùL¡
[
efãùNo
].
ty³
 = 
ASSIGN
;ƒfãùL¡[efãùNo].
blkNo
 = 
i
;ƒfãùL¡[efãùNo].
ÊNo
 = 
j
;

184 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

185 if(
	`¡¾’
(
»g2MemL¡
[
»gPos1
].
mem_addr
) == 0){

186 
efãùL¡
[
efãùNo
].
rhs
 = 
»g2MemL¡
[
»gPos1
].
v®ue
;

187 
efãùL¡
[
efãùNo
].
rhs_v¬
 = 0;

190 
efãùL¡
[
efãùNo
].
rhs_v¬
 = 1;

192 
	`ÿnûlEfãù
(
efãùNo
);

195 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"lui") == 0){

196 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

197 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

198 
»g2MemL¡
[
»gPos1
].
v®ue
 = 
	`©oi
(
š¡rL¡
[
i
][
j
].
r2
) * 65536;

199 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
NIL
;

202 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"addiu") == 0 ||

203 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"addi") == 0 ){

205 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

206 
»gPos2
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r2
);

207 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

208 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

209 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

210 
»g2MemL¡
[
»gPos1
].
v®ue
 =„eg2MemL¡[
»gPos2
].v®u+ 
	`©oi
(
š¡rL¡
[
i
][
j
].
r3
);

211 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
NIL
;

214 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"ori") == 0 ){

215 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

216 
»gPos2
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r2
);

217 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

218 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

219 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

220 
»g2MemL¡
[
»gPos1
].
v®ue
 =„eg2MemL¡[
»gPos2
].v®u| 
	`©oi
(
š¡rL¡
[
i
][
j
].
r3
);

221 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
NIL
;

224 ifĞ
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"sll") == 0){

225 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

226 
»gPos2
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r2
);

227 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
) > 0){

228 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

229 
	`¡rÿt
(
tmp
,"¦l"); sŒÿtÑmp,
š¡rL¡
[
i
][
j
].
r3
);

230 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

231 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

234 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

236 
»g2MemL¡
[
»gPos1
].
v®ue
 =„eg2MemL¡[
»gPos2
].value;

237 
	`ssÿnf
(
š¡rL¡
[
i
][
j
].
r3
,"%x",&
pow”
);

238 
k
 = 0; k < 
pow”
 ; k++){ 
»g2MemL¡
[
»gPos1
].
v®ue
 *= 2; }

239 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
NIL
;

241 ifĞ
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"srl") == 0){

242 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

243 
»gPos2
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r2
);

244 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
) > 0){

245 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

246 
	`¡rÿt
(
tmp
,"¤l"); sŒÿtÑmp,
š¡rL¡
[
i
][
j
].
r3
);

247 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

248 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

251 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

253 
»g2MemL¡
[
»gPos1
].
v®ue
 =„eg2MemL¡[
»gPos2
].value;

254 
	`ssÿnf
(
š¡rL¡
[
i
][
j
].
r3
,"%x",&
pow”
);

255 
k
 = 0; k < 
pow”
 ; k++){ 
»g2MemL¡
[
»gPos1
].
v®ue
 /= 2; }

256 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
NIL
;

258 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"slti") == 0 ||

259 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"sltiu") == 0){

263 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

264 
»gPos2
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r2
);

265 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

266 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

267 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

268 
»g2MemL¡
[
»gPos1
].
v®ue
 = 
	`©oi
(
š¡rL¡
[
i
][
j
].
r3
è-„eg2MemL¡[
»gPos2
].value;

269 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
SLTI
;

271 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"slt") == 0 ||

272 
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"sltu") == 0){

273 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

274 
»gPos2
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r2
);

275 
»gPos3
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r3
);

276 if(
	`¡¾’
(
»g2MemL¡
[
»gPos3
].
mem_addr
) == 0){

277 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

278 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

279 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

280 
»g2MemL¡
[
»gPos1
].
v®ue
 =„eg2MemL¡[
»gPos3
].v®u-„eg2MemL¡[
»gPos2
].value;

281 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
SLT
;

284 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

285 
	`¡rÿt
(
tmp
,"slt");

286 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos3
].
mem_addr
);

287 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

288 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

289 
»g2MemL¡
[
»gPos1
].
v®ue
 =„eg2MemL¡[
»gPos3
].v®u-„eg2MemL¡[
»gPos2
].value;

290 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
KO
;

293 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"addu") == 0){

294 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

295 
»gPos2
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r2
);

296 
»gPos3
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r3
);

300 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è=ğ0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) == 0){

301 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

303 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è=ğ0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) > 0){

304 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos3
].
mem_addr
);

305 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

306 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

308 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è> 0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) == 0){

309 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

310 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

311 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

313 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è> 0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) > 0){

314 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

315 
	`¡rÿt
(
tmp
,"plus");

316 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos3
].
mem_addr
);

317 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

318 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

320 
»g2MemL¡
[
»gPos1
].
v®ue
 =„eg2MemL¡[
»gPos2
].v®u+„eg2MemL¡[
»gPos3
].value;

321 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
NIL
;

324 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"subu") == 0 ){

325 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

326 
»gPos2
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r2
);

327 
»gPos3
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r3
);

328 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è=ğ0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) == 0){

329 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

331 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è=ğ0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) > 0){

332 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos3
].
mem_addr
);

333 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

334 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

336 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è> 0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) == 0){

337 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

338 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

339 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

341 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è> 0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) > 0){

342 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

343 
	`¡rÿt
(
tmp
,"sub");

344 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos3
].
mem_addr
);

345 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

346 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

348 
»g2MemL¡
[
»gPos1
].
v®ue
 =„eg2MemL¡[
»gPos2
].v®u-„eg2MemL¡[
»gPos3
].value;

349 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
NIL
;

353 if(
	`¡rcmp
(
š¡rL¡
[
i
][
j
].
İ
,"or") == 0 ){

354 
»gPos1
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r1
);

355 
»gPos2
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r2
);

356 
»gPos3
 = 
	`fšdReg
(
š¡rL¡
[
i
][
j
].
r3
);

357 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è=ğ0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) == 0){

358 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

360 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è=ğ0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) > 0){

361 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos3
].
mem_addr
);

362 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

363 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

365 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è> 0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) == 0){

366 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

367 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

368 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

370 if(
	`¡¾’
(
»g2MemL¡
[
»gPos2
].
mem_addr
è> 0 && sŒËnÔeg2MemL¡[
»gPos3
].mem_addr) > 0){

371 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos2
].
mem_addr
);

372 
	`¡rÿt
(
tmp
,"or");

373 
	`¡rÿt
(
tmp
,
»g2MemL¡
[
»gPos3
].
mem_addr
);

374 
»g2MemL¡
[
»gPos1
].
mem_addr
[0] = '\0';

375 
	`¡rıy
(
»g2MemL¡
[
»gPos1
].
mem_addr
,
tmp
);

377 
»g2MemL¡
[
»gPos1
].
v®ue
 =„eg2MemL¡[
»gPos2
].v®u|„eg2MemL¡[
»gPos3
].value;

378 
»g2MemL¡
[
»gPos1
].
š¡r
 = 
NIL
;

387 
	}
}

	@slacks.c

1 
	#DEBUGSLACK
 0

	)

4 
	$»£tIÁ”ã»nû
Ğ
ch¬t_t
 *
msc
 ) {

6 
i
, 
j
;

7  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ )

8  
j
 = 0; j < 
msc
->
tİoLi¡L’
; j++ )

9 
š‹rã»
[
msc
->
tİoLi¡
[
i
]][msc->tİoLi¡[
j
]] = 1;

12 
	}
}

15 
	$g’”©eWeiCÚæiù
(
ch¬t_t
 *
msc
)

17 
i
, 
k
, 
Ën
 = 
msc
->
tİoLi¡L’
;

18  
i
 = 0; i < 
Ën
; i++ )

20 
ix
 = 
msc
->
tİoLi¡
[
i
];

21  
k
 = 0; k < 
Ën
; k++ )

23 
kx
 = 
msc
->
tİoLi¡
[
k
];

24 ifĞ(
ix
 =ğ
kx
è|| (
skLi¡
[ ix ]->
³ID
 ==askList[ kx ]->peID) )

26 
š‹rã»
[
ix
][
kx
] = 0;

27 
š‹rã»
[
kx
][
ix
] = 0;

31 
š‹rã»
[
ix
][
kx
] = 1;

32 
š‹rã»
[
kx
][
ix
] = 1;

37 
	`´štf
("generateWeiConflict over...\n");

39 
	}
}

42 
	$wr™eWeiCÚæiù
()

45 
	`´štf
("writing interfere of Wei‚ow...\n");

47 
Çme
[20];

48 
i
, 
k
, 
j
, 
ix
, 
kx
, 
Ën
, 
mscNum
 = 
numCh¬ts
;

49 
FILE
 *
š‹rã»Fe
, *
š‹rã»P©h
;

51 
	`¥rštf
(
Çme
, "interferePath");

52 
š‹rã»P©h
 = 
	`fİ’
(
Çme
, "w");

53  
j
 = 1; j <ğ
mscNum
; j++)

56 
	`¥rštf
(
Çme
, "š‹rã»/msc%d", 
j
);

58 
	`årštf
(
š‹rã»P©h
, "%s\n", 
Çme
);

61 
Ën
 = 
msg
[
j
-1].
tİoLi¡L’
;

63 
š‹rã»Fe
 = 
	`fİ’
(
Çme
,"w");

64 
	`årštf
(
š‹rã»Fe
, "%d\n", 
msg
[
j
-1].
tİoLi¡L’
);

65 
i
 = 0; i < 
Ën
; i++)

67 
	`årštf
(
š‹rã»Fe
, "%s\n", 
skLi¡
[
msg
[
j
-1].
tİoLi¡
[
i
]]->
Šame
);

71  
i
 = 0; i < 
Ën
; i++ )

73 
ix
 = (
msg
[
j
-1].
tİoLi¡
)[
i
];

75  
k
 = 0; k < 
Ën
; k++ )

77 
kx
 = (
msg
[
j
-1].
tİoLi¡
)[
k
];

78 
	`årštf
(
š‹rã»Fe
, "%d ", 
š‹rã»
[
ix
][
kx
]);

80 
	`årštf
(
š‹rã»Fe
, "\n");

82 
	`fæush
(
¡dout
);

84 
	`fşo£
(
š‹rã»Fe
);

86 
	`fşo£
(
š‹rã»P©h
);

88 
	}
}

93 
	$£tIÁ”ã»nû
Ğ
ch¬t_t
 *
msc
 ) {

98 
i
, 
k
, 
Ën
 = 
msc
->
tİoLi¡L’
;

104  
i
 = 0; i < 
Ën
; i++ )

106 
ix
 = 
msc
->
tİoLi¡
[
i
];

107  
k
 = 0; k < 
Ën
; k++ )

109 
kx
 = 
msc
->
tİoLi¡
[
k
];

110 ifĞ(
ix
 !ğ
kx
è&& 
	`ÿnCÚæiù
(ix,kx))

112 
š‹rã»
[
ix
][
kx
] = 1;

113 
š‹rã»
[
kx
][
ix
] = 1;

118 
š‹rã»
[
ix
][
kx
] = 0;

119 
š‹rã»
[
kx
][
ix
] = 0;

123 
	}
}

125 
	$dumpIÁ”ã»nû
Ğ
ch¬t_t
 *
msc
 ) {

127 
i
, 
k
, 
Ën
 = 
msc
->
tİoLi¡L’
;

131  
i
 = 0; i < 
Ën
; i++ ) {

132 
	`´štTimes
(
msc
->
tİoLi¡
[
i
]);

136  
i
 = 0; i < 
Ën
; i++ ) {

137 
ix
 = 
msc
->
tİoLi¡
[
i
];

138  
k
 = 0; k < 
Ën
; k++ ) {

139 
kx
 = 
msc
->
tİoLi¡
[
k
];

140 
	`´štf
("%d ", 
š‹rã»
[
ix
][
kx
]);

142 
	`´štf
("\n");

144 
	}
}

147 
	$wr™eIÁ”ã»nû
()

150 
	`´štf
("writing interference‚ow...\n");

152 
Çme
[20];

153 
i
, 
k
, 
j
, 
mscNum
 = 
numCh¬ts
, 
Ën
;

154 
FILE
 *
š‹rã»Fe
, *
š‹rã»P©h
;

156 
	`¥rštf
(
Çme
, "š‹rã»P©h_%s", 
times_™”©iÚ
);

157 
š‹rã»P©h
 = 
	`fİ’
(
Çme
, "w");

158  
j
 = 1; j <ğ
mscNum
; j++)

161 
	`¥rštf
(
Çme
, "š‹rã»/%s_msc%d", 
times_™”©iÚ
, 
j
);

163 
	`årštf
(
š‹rã»P©h
, "%s\n", 
Çme
);

166 
Ën
 = 
msg
[
j
-1].
tİoLi¡L’
;

168 
š‹rã»Fe
 = 
	`fİ’
(
Çme
,"w");

169 
	`årštf
(
š‹rã»Fe
, "%d \n", 
msg
[
j
-1].
tİoLi¡L’
);

170 
i
 = 0; i < 
Ën
; i++)

172 
	`årštf
(
š‹rã»Fe
, "%s\n", 
skLi¡
[
msg
[
j
-1].
tİoLi¡
[
i
]]->
Šame
);

176  
i
 = 0; i < 
Ën
; i++ ) {

177 
ix
 = (
msg
[
j
-1].
tİoLi¡
)[
i
];

179  
k
 = 0; k < 
Ën
; k++ ) {

180 
kx
 = (
msg
[
j
-1].
tİoLi¡
)[
k
];

181 
	`årštf
(
š‹rã»Fe
, "%d ", 
š‹rã»
[
ix
][
kx
]);

183 
	`årštf
(
š‹rã»Fe
, "\n");

185 
	`fæush
(
¡dout
);

187 
	`fşo£
(
š‹rã»Fe
);

189 
	`fşo£
(
š‹rã»P©h
);

191 
	}
}

198 
	$comesBefÜe
Ğ
´ed
, 
succ
, 
ch¬t_t
 *
msc
 ) {

200 
idp
 = 
	`g‘IndexInLi¡
Ğ
´ed
, 
msc
->
timeTİoLi¡
, msc->
tİoLi¡L’
 );

201 
ids
 = 
	`g‘IndexInLi¡
Ğ
succ
, 
msc
->
timeTİoLi¡
, msc->
tİoLi¡L’
 );

202 Ğ
idp
 > -1 && 
ids
 > -1 && idp < ids );

203 
	}
}

206 
	$Ï‹¡Times_¦ack
Ğ
ch¬t_t
 *
msc
, *
tİoA¼
, 
tİosize
 ) {

208 
i
, 
k
;

209 
chªged
 = 0;

214  
i
 = 0; i < 
tİosize
; i++ ) {

215 
idx
 = 
tİoA¼
[
i
];

216 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

219 
time_t
 
v®
 = 1;

220  
k
 = 0; k < 
tİosize
; k++ ) {

222 
kx
 = 
tİoA¼
[
k
];

223 ifĞ
kx
 =ğ
idx
 || 
skLi¡
[kx]->
³ID
 !ğskLi¡[idx]->³ID || 
š‹rã»
[kx][idx] )

225 ifĞ
	`comesBefÜe
Ğ
kx
, 
idx
, 
msc
 ) && 
v®
 < 
Ï‹¡Fš
[kx] ) {

226 
v®
 = 
Ï‹¡Fš
[
kx
];

233  
k
 = 0; k < 
tx
->
numP»ds
; k++ ) {

234 
idm
 = 
tx
->
´edLi¡
[
k
];

235 ifĞ!
	`šLi¡
Ğ
idm
, 
tİoA¼
, 
tİosize
 ) && 
v®
 < 
Ï‹¡Fš
[idm] ) {

236 
v®
 = 
Ï‹¡Fš
[
idm
];

240 
Ï‹¡Req
[
idx
] = 
v®
;

244  
i
 = 0; i < 
tİosize
; i++ ) {

245 
idx
 = 
tİoA¼
[
i
];

246 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

249 
time_t
 
wüt
 = 
	`fixedPoštC®cHi
Ğ
msc
, 
idx
 );

250 
time_t
 
v®ue
 = 
Ï‹¡Req
[
idx
] + 
wüt
;

251 ifĞ
Ï‹¡Fš
[
idx
] !ğ
v®ue
 ) {

252 
Ï‹¡Fš
[
idx
] = 
v®ue
;

253 
chªged
 = 1;

261  
k
 = 0; k < 
tx
->
numSuccs
; k++ ) {

262 
idk
 = 
tx
->
succLi¡
[
k
];

264 ifĞ
Ï‹¡Req
[
idk
] < 
Ï‹¡Fš
[
idx
] ) {

265 
Ï‹¡Req
[
idk
] = 
Ï‹¡Fš
[
idx
];

266 
chªged
 = 1;

276  
chªged
;

277 
	}
}

280 
	$—¾›¡Times_¦ack
Ğ
ch¬t_t
 *
msc
, *
tİoA¼
, 
tİosize
 ) {

282 
i
, 
k
;

283 
chªged
 = 0;

288  
i
 = 0; i < 
tİosize
; i++ ) {

289 
idx
 = 
tİoA¼
[
i
];

290 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

293 
time_t
 
v®
 = 1;

294  
k
 = 0; k < 
tİosize
; k++ ) {

296 
kx
 = 
tİoA¼
[
k
];

298 ifĞ
kx
 =ğ
idx
 || 
skLi¡
[kx]->
³ID
 !ğskLi¡[idx]->³ID || 
š‹rã»
[kx][idx] )

300 ifĞ
	`comesBefÜe
Ğ
kx
, 
idx
, 
msc
 ) && 
v®
 < 
—¾›¡Fš
[kx] ) {

302 
v®
 = 
Ï‹¡Fš
[
kx
];

309  
k
 = 0; k < 
tx
->
numP»ds
; k++ ) {

310 
idm
 = 
tx
->
´edLi¡
[
k
];

311 ifĞ!
	`šLi¡
Ğ
idm
, 
tİoA¼
, 
tİosize
 ) && 
v®
 < 
—¾›¡Fš
[idm] ) {

313 
v®
 = 
Ï‹¡Fš
[
idm
];

317 
—¾›¡Req
[
idx
] = 
v®
;

321  
i
 = 0; i < 
tİosize
; i++ ) {

322 
idx
 = 
tİoA¼
[
i
];

323 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

326 
time_t
 
wüt
 = 
	`fixedPoštC®cLo
Ğ
msc
, 
idx
 );

327 
time_t
 
v®ue
 = 
—¾›¡Req
[
idx
] + 
wüt
;

328 ifĞ
—¾›¡Fš
[
idx
] !ğ
v®ue
 ) {

329 
—¾›¡Fš
[
idx
] = 
v®ue
;

330 
chªged
 = 1;

339  
k
 = 0; k < 
tx
->
numSuccs
; k++ ) {

340 
idk
 = 
tx
->
succLi¡
[
k
];

342 ifĞ
—¾›¡Req
[
idk
] < 
—¾›¡Fš
[
idx
] ) {

343 
—¾›¡Req
[
idk
] = 
—¾›¡Fš
[
idx
];

344 
chªged
 = 1;

354  
chªged
;

355 
	}
}

358 
	$doTimšg
Ğ
ch¬t_t
 *
msc
, 
¦ack
 ) {

360 
i
, 
k
;

361 
chªged
;

364 
time_t
 *
eReq
 = (time_t*è
	`MALLOC
ĞeReq, 
numTasks
 * (time_t), "eReq" );

365 
time_t
 *
lReq
 = (time_t*è
	`MALLOC
ĞlReq, 
numTasks
 * (time_t), "lReq" );

366 
time_t
 *
eFš
 = (time_t*è
	`MALLOC
ĞeFš, 
numTasks
 * (time_t), "eFin" );

367 
time_t
 *
lFš
 = (time_t*è
	`MALLOC
ĞlFš, 
numTasks
 * (time_t), "lFin" );

369 ifĞ
¦ack
 ) {

372 
Ën
 = 
msc
->
tİoLi¡L’
;

375 
msc
->
timeTİoLi¡
 = (*è
	`MALLOC
Ğmsc->timeTİoLi¡, 
Ën
 * (), "timeTopoList" );

376  
k
 = 0; k < 
Ën
; k++ )

377 
msc
->
timeTİoLi¡
[
k
] = msc->
tİoLi¡
[
Ën
-k-1];

386 
chªged
 = 0;

387  
k
 = 1; k < 
Ën
; k++ ) {

388 
idx
 = 
msc
->
timeTİoLi¡
[
k
];

389 
idp
 = 
msc
->
timeTİoLi¡
[
k
-1];

391 ifĞ
Ï‹¡Req
[
idx
] <†©e¡Req[
idp
] ||

392 
Ï‹¡Req
[
idx
] =ğÏ‹¡Req[
idp
] &&

393 (
—¾›¡Req
[
idx
] <ƒ¬l›¡Req[
idp
] ||

394 (
—¾›¡Req
[
idx
] =ğ—¾›¡Req[
idp
] &&

395 (
Ï‹¡Fš
[
idx
] >†©e¡Fš[
idp
] ||

396 (
Ï‹¡Fš
[
idx
] =ğÏ‹¡Fš[
idp
] && 
—¾›¡Fš
[idx] >ƒarliestFin[idp]))))) {

399 
chªged
 = 1;

400 
msc
->
timeTİoLi¡
[
k
] = 
idp
;

401 
msc
->
timeTİoLi¡
[
k
-1] = 
idx
;

404 }  
chªged
 );

414  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

415 
ix
 = 
msc
->
tİoLi¡
[
i
];

417 
eReq
[
ix
] = 
—¾›¡Req
[ix];

418 
lReq
[
ix
] = 
Ï‹¡Req
 [ix];

419 
eFš
[
ix
] = 
—¾›¡Fš
[ix];

420 
lFš
[
ix
] = 
Ï‹¡Fš
 [ix];

422 
—¾›¡Req
[
ix
] = 1;

423 
Ï‹¡Req
 [
ix
] = 1;

424 
—¾›¡Fš
[
ix
] = 0;

425 
Ï‹¡Fš
 [
ix
] = 0;

428 ifĞ
¦ack
 ) {

429  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

434 
	`—¾›¡Times_¦ack
Ğ
msc
, msc->
timeTİoLi¡
, msc->
tİoLi¡L’
 );

439 
	`Ï‹¡Times_¦ack
Ğ
msc
, msc->
timeTİoLi¡
, msc->
tİoLi¡L’
 );

445  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

446 
ix
 = 
msc
->
tİoLi¡
[
i
];

448 *
tİoA¼
 = 
NULL
;

449 
tİosize
 = 
	`tİoSÜtSubg¿ph
Ğ
ix
, &
tİoA¼
 );

457 
	`—¾›¡Times
Ğ
msc
, 
tİoA¼
, 
tİosize
 );

461 
	`Ï‹¡Times
Ğ
msc
, 
tİoA¼
, 
tİosize
 );

465 
	`ä“
Ğ
tİoA¼
 );

469 
chªged
 = 0;

470  
i
 = 0; !
chªged
 && i < 
msc
->
tİoLi¡L’
; i++ ) {

471 
ix
 = 
msc
->
tİoLi¡
[
i
];

472 ifĞ
eReq
[
ix
] !ğ
—¾›¡Req
[ix] || 
lReq
[ix] !ğ
Ï‹¡Req
[ix] || 
eFš
[ix] !ğ
—¾›¡Fš
[ix] || 
lFš
[ix] !ğ
Ï‹¡Fš
[ix] )

473 
chªged
 = 1;

477  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

478 
ix
 = 
msc
->
tİoLi¡
[
i
];

479  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

480 
kx
 = 
msc
->
tİoLi¡
[
k
];

481 ifĞ
ix
 !ğ
kx
 && (
	`ÿnP»em±
(ix,kx) || canPreempt(kx,ix)) ) {

482 
š‹rã»
[
ix
][
kx
] = 1;

483 
š‹rã»
[
kx
][
ix
] = 1;

487 
š‹rã»
[
ix
][
kx
] = 0;

488 
š‹rã»
[
kx
][
ix
] = 0;

495 
	`ä“
Ğ
eReq
 );

496 
	`ä“
Ğ
lReq
 );

497 
	`ä“
Ğ
eFš
 );

498 
	`ä“
Ğ
lFš
 );

500  
chªged
;

501 
	}
}

504 
	$g‘AÎoÿ‹dSize
Ğ
sk_t
 *
ts
 ) {

506 
i
;

507 
sum
 = 0;

509  
i
 = 0; i < 
ts
->
numMemBlocks
; i++ )

510 ifĞ
ts
->
®loÿ‹d
[
i
] )

511 
sum
 +ğ
ts
->
memBlockLi¡
[
i
]->
size
;

513  
sum
;

514 
	}
}

516 
time_t
 
	$e¡Gaš
Ğ
sk_t
 *
ts
, 
ÿ·c™y
 ) {

518 
i
;

519 
chªged
 = 1;

521 
numUÇÎoc
 = 0;

522 
mem_t
 **
sÜtBlocks
 = 
NULL
;

524 
»maš
 = 
ÿ·c™y
;

525 
time_t
 
gaš
 = 0;

528  
i
 = 0; i < 
ts
->
numMemBlocks
; i++ ) {

529 ifĞ!
ts
->
®loÿ‹d
[
i
] ) {

530 
numUÇÎoc
++;

531 
sÜtBlocks
 = (
mem_t
**è
	`REALLOC
ĞsÜtBlocks, 
numUÇÎoc
 * (mem_t*), "sortBlocks" );

532 
sÜtBlocks
[
numUÇÎoc
-1] = 
ts
->
memBlockLi¡
[
i
];

536  
chªged
 ) {

537 
chªged
 = 0;

538  
i
 = 1; i < 
numUÇÎoc
; i++ ) {

539 ifĞ
sÜtBlocks
[
i
]->
äeq
 > sortBlocks[i-1]->freq ) {

540 
mem_t
 *
tmp
 = 
sÜtBlocks
[
i
-1];

541 
sÜtBlocks
[
i
-1] = sortBlocks[i];

542 
sÜtBlocks
[
i
] = 
tmp
;

543 
chªged
 = 1;

548  
i
 = 0; i < 
numUÇÎoc
 && 
»maš
 > 0; i++ ) {

549 
mem_t
 *
mt
 = 
sÜtBlocks
[
i
];

550 ifĞ
mt
->
size
 <ğ
»maš
 ) {

551 
»maš
 -ğ
mt
->
size
;

552 
gaš
 +ğ
mt
->
äeq
 * (mt->
size
 / 
FETCH_SIZE
è* (
off_Ï‹ncy
 - 
¥m_Ï‹ncy
);

555 
	`ä“
Ğ
sÜtBlocks
 );

557  
gaš
;

558 
	}
}

561 
	$š£¹SÏcks
Ğ
ch¬t_t
 *
msc
 ) {

563 
i
, 
k
, 
n
;

564 
chªged
;

566 
round
 = 0;

567  
round
 < 
MAXCR
 ) {

570 
maxTask
 = -1;

571 
maxVic
 = -1;

573 
time_t
 
mšNewTime
 = 0;

575  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

576 
ix
 = 
msc
->
tİoLi¡
[
i
];

577 
sk_t
 *
ti
 = 
skLi¡
[
ix
];

579 ifĞ
isCr™iÿl
[
ix
] != 1 )

582  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

583 
kx
 = 
msc
->
tİoLi¡
[
k
];

584 
sk_t
 *
tk
 = 
skLi¡
[
kx
];

586 
time_t
 
maxFš
, 
¦ack
, 
®locGaš
;

588 ifĞ
ix
 =ğ
kx
 || !
isCr™iÿl
[kx] || !
š‹rã»
[kx][ix] || !š‹rã»[ix][kx] || !
	`ÿnP»em±
(kx,ix) )

594 
maxFš
 = 
msc
->
wüt
;

595 
¦ack
 = 
Ï‹¡Fš
[
ix
] -†©e¡Fš[
kx
];

597  
n
 = 0;‚ < 
msc
->
tİoLi¡L’
;‚++ ) {

598 
nx
 = 
msc
->
tİoLi¡
[
n
];

600 ifĞ
nx
 =ğ
ix
 ||‚x =ğ
kx
 )

603 ifĞ
	`isP»deûssÜOf
Ğ
kx
, 
nx
 ))

605 
maxFš
 = 
	`tmax
ĞmaxFš, 
Ï‹¡Fš
[
nx
] + 
¦ack
 );

607 ifĞ!
š‹rã»
[
nx
][
kx
] || !interfere[kx][nx] ) {

609 ifĞ
—¾›¡Req
[
nx
] >ğ
Ï‹¡Fš
[
kx
] &&ƒ¬l›¡Req[nx] <†©e¡Fš[kx] + 
¦ack
 )

610 
maxFš
 = 
	`tmax
ĞmaxFš, 
Ï‹¡Fš
[
nx
] + (Ï‹¡Fš[
kx
] + 
¦ack
 - 
—¾›¡Req
[nx]) );

615 
®locGaš
 = 
	`e¡Gaš
Ğ
ti
, 
	`g‘AÎoÿ‹dSize
(
tk
) ) +ƒstGain(k, getAllocatedSize(ti) );

618 
maxFš
 -ğ(
Ï‹¡Fš
[
kx
] - 
—¾›¡Req
[kx]è+ 
®locGaš
;

620 
	`´štf
( "Current WCRT: %Lu\t Projected‡llocGain: %Lu\t Projected WCRT: %Lu\t Gain: %lf\n",

621 
msc
->
wüt
, 
®locGaš
, 
maxFš
, (() msc->wcrt - () maxFin) );

624 ifĞ
maxFš
 <ğ
msc
->
wüt
 && ( 
mšNewTime
 == 0 || maxFin < minNewTime )) {

625 
maxTask
 = 
kx
;

626 
maxVic
 = 
ix
;

628 
mšNewTime
 = 
maxFš
;

632 ifĞ
maxTask
 =ğ-1 || 
maxVic
 == -1 )

636 
	`´štf
Ğ"Elimš©š‹rã»nû % by %s\n", 
	`g‘TaskName
(
maxVic
), g‘TaskName(
maxTask
è); 
	`fæush
Ğ
¡dout
 );

637 
š‹rã»
[
maxTask
][
maxVic
] = 0;

638 
š‹rã»
[
maxVic
][
maxTask
] = 0;

642 
chªged
 = 
	`doTimšg
Ğ
msc
, 1 );

643 }  
chªged
 );

645 
	`´štf
Ğ"%s:\t[%12Lu/%12Lu, %12Lu/%12Lu)\n", 
	`g‘TaskName
(
maxVic
),

646 
—¾›¡Req
[
maxVic
], 
Ï‹¡Req
[maxVic], 
—¾›¡Fš
[maxVic], 
Ï‹¡Fš
[maxVic] );

647 
	`´štf
Ğ"%s:\t[%12Lu/%12Lu, %12Lu/%12Lu)\n\n", 
	`g‘TaskName
(
maxTask
),

648 
—¾›¡Req
[
maxTask
], 
Ï‹¡Req
[maxTask], 
—¾›¡Fš
[maxTask], 
Ï‹¡Fš
[maxTask] );

652 
round
++;

656 
	}
}

	@timing.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

4 
	~<m©h.h
>

7 
	#DEBUGTHIS
 0

	)

11 
	$ÿnP»em±
Ğ
su¥eù
, 
viùim
 ) {

14 ifĞ
skLi¡
[
su¥eù
]->
³ID
 !ğskLi¡[
viùim
]->peID )

18 ifĞ
skLi¡
[
su¥eù
]->
´iÜ™y
 >askLi¡[
viùim
]->priority )

24 ifĞ
	`isP»deûssÜOf
Ğ
su¥eù
, 
viùim
 ) || isPredecessorOf( victim, suspect ))

28 ifĞ
—¾›¡Req
[
su¥eù
] > 0 && 
Ï‹¡Fš
[
viùim
] > 0 &&ƒarliestReq[suspect] >=†atestFin[victim] )

30 ifĞ
Ï‹¡Fš
[
su¥eù
] > 0 && 
—¾›¡Req
[
viùim
] > 0 &&†atestFin[suspect] <=ƒarliestReq[victim] )

34 ifĞ
—¾›¡Req
[
su¥eù
] > 0 && 
—¾›¡Fš
[
viùim
] > 0 && 
Ï‹¡Req
[su¥eù] > 0 && 
Ï‹¡Fš
[victim] > 0

35 && 
—¾›¡Req
[
su¥eù
] >ğ
—¾›¡Fš
[
viùim
] && 
Ï‹¡Req
[su¥eù] >ğ
Ï‹¡Fš
[victim] )

37 ifĞ
—¾›¡Fš
[
su¥eù
] > 0 && 
—¾›¡Req
[
viùim
] > 0 && 
Ï‹¡Fš
[su¥eù] > 0 && 
Ï‹¡Req
[victim] > 0

38 && 
—¾›¡Fš
[
su¥eù
] <ğ
—¾›¡Req
[
viùim
] && 
Ï‹¡Fš
[su¥eù] <ğ
Ï‹¡Req
[victim] )

42 
	}
}

46 
	$ÿnCÚæiù
Ğ
su¥eù
, 
viùim
 ) {

59 if(
skLi¡
[
su¥eù
]->
³ID
 =ğskLi¡[
viùim
]->peID)  0;

60 ifĞ
	`isP»deûssÜOf
Ğ
su¥eù
, 
viùim
 ))  0;

61 ifĞ
	`isP»deûssÜOf
Ğ
viùim
, 
su¥eù
))  0;

64 ifĞ
—¾›¡Req
[
su¥eù
] > 0 && 
Ï‹¡Fš
[
viùim
] > 0 &&ƒarliestReq[suspect] >=†atestFin[victim] )

67 ifĞ
—¾›¡Req
[
su¥eù
] > 0 && 
Ï‹¡Fš
[
viùim
] > 0 &&ƒarliestReq[victim] >=†atestFin[suspect] )

75 ifĞ(
Ï‹¡Fš
[
su¥eù
] > 0 &&†©e¡Fš[
viùim
] > 0 && 
—¾›¡Req
[victim] > 0) && (latestFin[suspect] >ƒarliestReq[victim]) && (latestFin[suspect] <=†atestFin[victim]))

78 ifĞ(
Ï‹¡Fš
[
su¥eù
] > 0 &&†©e¡Fš[
viùim
] > 0 && 
—¾›¡Req
[victim] > 0) && (latestFin[victim] >ƒarliestReq[suspect]) && (latestFin[victim] <=†atestFin[suspect]))

82 
	}
}

85 
	$fšdCr™iÿlP©h
Ğ
ch¬t_t
 *
msc
 ) {

87 
i
, 
k
, 
cu¼
;

88 
numCr™iÿl
;

90 
maxTask
 = -1;

91 
time_t
 
maxFš
 = 0;

94  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ )

95 
isCr™iÿl
[ 
msc
->
tİoLi¡
[
i
] ] = 0;

98  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

99 
ix
 = 
msc
->
tİoLi¡
[
i
];

100 ifĞ
maxFš
 < 
Ï‹¡Fš
[
ix
] ) {

101 
maxTask
 = 
ix
;

102 
maxFš
 = 
Ï‹¡Fš
[
ix
];

105 ifĞ
maxTask
 > -1 )

106 
isCr™iÿl
[
maxTask
] = 1;

109 
cu¼
 = 
maxTask
;

110  
cu¼
 > -1 ) {

111 
maxTask
 = -1;

112 
maxFš
 = 0;

113  
i
 = 0; i < 
skLi¡
[
cu¼
]->
numP»ds
; i++ ) {

114 
idk
 = 
skLi¡
[
cu¼
]->
´edLi¡
[
i
];

115 ifĞ
maxFš
 < 
Ï‹¡Fš
[
idk
] ) {

116 
maxTask
 = 
idk
;

117 
maxFš
 = 
Ï‹¡Fš
[
idk
];

120 ifĞ
maxTask
 > -1 )

121 
isCr™iÿl
[
maxTask
] = 1;

122 
cu¼
 = 
maxTask
;

126  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

127 
ix
 = 
msc
->
tİoLi¡
[
i
];

128 ifĞ!
isCr™iÿl
[
ix
] )

130  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

131 
kx
 = 
msc
->
tİoLi¡
[
k
];

132 ifĞ!
isCr™iÿl
[
kx
] && 
	`ÿnP»em±
(kx,
ix
) )

133 
isCr™iÿl
[
kx
] = 2;

137 
numCr™iÿl
 = 0;

138 
	`´štf
( "Criticalasks:\n" );

139  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

140 
ix
 = 
msc
->
tİoLi¡
[
i
];

141 ifĞ
isCr™iÿl
[
ix
] > 0 ) {

142 
numCr™iÿl
++;

143 
	`´štf
Ğ"- % (%d)\n", 
	`g‘TaskName
(
ix
), 
isCr™iÿl
[ix] );

147 
®locweight
 = 
numCr™iÿl
 / (è
msc
->
tİoLi¡L’
;

148 
	`´štf
Ğ"Cr™iÿÈ·th d’s™y: %lf\n", 
®locweight
 );

151 
	}
}

154 
time_t
 
	$gxC®cHi
Ğ
ch¬t_t
 *
msc
, 
idx
, 
time_t
 
x
 ) {

156 
k
;

157 
time_t
 
š‹¼u±
 = 0;

162  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

163 
kx
 = 
msc
->
tİoLi¡
[
k
];

164 
sk_t
 *
tc
 = 
skLi¡
[
kx
];

165 ifĞ
kx
 !ğ
idx
 && 
	`ÿnP»em±
( kx, idx )) {

168 
š‹¼u±
 +ğ
tc
->
ùimeHi
;

174  (
skLi¡
[
idx
]->
ùimeHi
 + 
š‹¼u±
);

175 
	}
}

178 
time_t
 
	$gxC®cLo
Ğ
ch¬t_t
 *
msc
, 
idx
, 
time_t
 
x
 ) {

180 
k
;

181 
time_t
 
š‹¼u±
 = 0;

186  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

187 
kx
 = 
msc
->
tİoLi¡
[
k
];

188 
sk_t
 *
tc
 = 
skLi¡
[
kx
];

189 ifĞ
kx
 !ğ
idx
 && 
	`ÿnP»em±
( kx, idx )) {

192 
š‹¼u±
 +ğ
tc
->
ùimeLo
;

198  (
skLi¡
[
idx
]->
ùimeLo
 + 
š‹¼u±
);

199 
	}
}

202 
time_t
 
	$fixedPoštC®cHi
Ğ
ch¬t_t
 *
msc
, 
idx
 ) {

204 
k
;

205 
time_t
 
x
, 
gx
;

206 
ut
 = 0;

208  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

209 
kx
 = 
msc
->
tİoLi¡
[
k
];

210 
sk_t
 *
tc
 = 
skLi¡
[
kx
];

211 ifĞ
kx
 !ğ
idx
 && 
	`ÿnP»em±
( kx, idx )) {

212 
ut
 +ğ(
tc
->
ùimeHi
 / (ètc->
³riod
);

216 ifĞ
ut
 >= 1 )

217 
	`´štf
Ğ"\nScheduË i šãasibË.\n\n" ), 
	`ex™
(1);

219 
x
 = (
time_t
è
	`û
Ğ
skLi¡
[
idx
]->
ùimeHi
 / (1 - 
ut
));

221 
gx
 = 
	`gxC®cHi
Ğ
msc
, 
idx
, 
x
 );

223  
x
 < 
gx
 ) {

224 
x
 = 
gx
;

225 
gx
 = 
	`gxC®cHi
Ğ
msc
, 
idx
, 
x
 );

227  
x
;

228 
	}
}

231 
time_t
 
	$fixedPoštC®cLo
Ğ
ch¬t_t
 *
msc
, 
idx
 ) {

233 
k
;

234 
time_t
 
x
, 
gx
;

235 
ut
 = 0;

237  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

238 
kx
 = 
msc
->
tİoLi¡
[
k
];

239 
sk_t
 *
tc
 = 
skLi¡
[
kx
];

240 ifĞ
kx
 !ğ
idx
 && 
	`ÿnP»em±
( kx, idx )) {

241 
ut
 +ğ(
tc
->
ùimeLo
 / (ètc->
³riod
);

245 ifĞ
ut
 >= 1 )

246 
	`´štf
Ğ"\nScheduË i šãasibË.\n\n" ), 
	`ex™
(1);

248 
x
 = (
time_t
è
	`æoÜ
Ğ
skLi¡
[
idx
]->
ùimeLo
 / (1 - 
ut
));

250 
gx
 = 
	`gxC®cLo
Ğ
msc
, 
idx
, 
x
 );

252  
x
 < 
gx
 ) {

253 
x
 = 
gx
;

254 
gx
 = 
	`gxC®cLo
Ğ
msc
, 
idx
, 
x
 );

256  
x
;

257 
	}
}

260 
	$Ï‹¡Times
Ğ
ch¬t_t
 *
msc
, *
tİoA¼
, 
tİosize
 ) {

262 
i
, 
k
;

263 
chªged
 = 0;

268  
i
 = 0; i < 
tİosize
; i++ ) {

269 
idx
 = 
tİoA¼
[
i
];

270 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

274 
time_t
 
v®
 = 1;

275  
k
 = 0; k < 
tx
->
numP»ds
; k++ ) {

276 
idm
 = 
tx
->
´edLi¡
[
k
];

278 ifĞ!
	`šLi¡
Ğ
idm
, 
tİoA¼
, 
tİosize
 )) {

279 ifĞ
v®
 < 
Ï‹¡Fš
[
idm
] ) {

280 
v®
 = 
Ï‹¡Fš
[
idm
];

285 
Ï‹¡Req
[
idx
] = 
v®
;

289  
i
 = 
tİosize
 - 1; i >= 0; i-- ) {

290 
idx
 = 
tİoA¼
[
i
];

291 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

294 
time_t
 
wüt
 = 
skLi¡
[
idx
]->
ùimeHi
;

295 
time_t
 
v®ue
 = 
Ï‹¡Req
[
idx
] + 
wüt
;

296 ifĞ
Ï‹¡Fš
[
idx
] !ğ
v®ue
 ) {

297 
Ï‹¡Fš
[
idx
] = 
v®ue
;

298 
chªged
 = 1;

307  
k
 = 0; k < 
tx
->
numSuccs
; k++ ) {

308 
idk
 = 
tx
->
succLi¡
[
k
];

310 ifĞ
Ï‹¡Req
[
idk
] < 
Ï‹¡Fš
[
idx
] ) {

311 
Ï‹¡Req
[
idk
] = 
Ï‹¡Fš
[
idx
];

312 
chªged
 = 1;

321  
chªged
;

322 
	}
}

325 
	$—¾›¡Times
Ğ
ch¬t_t
 *
msc
, *
tİoA¼
, 
tİosize
 ) {

327 
i
, 
k
;

328 
chªged
 = 0;

333  
i
 = 0; i < 
tİosize
; i++ ) {

334 
idx
 = 
tİoA¼
[
i
];

335 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

339 
time_t
 
v®
 = 1;

340  
k
 = 0; k < 
tx
->
numP»ds
; k++ ) {

341 
idm
 = 
tx
->
´edLi¡
[
k
];

343 ifĞ!
	`šLi¡
Ğ
idm
, 
tİoA¼
, 
tİosize
 )) {

344 ifĞ
v®
 < 
—¾›¡Fš
[
idm
] ) {

345 
v®
 = 
—¾›¡Fš
[
idm
];

350 
—¾›¡Req
[
idx
] = 
v®
;

354  
i
 = 
tİosize
 - 1; i >= 0; i-- ) {

355 
idx
 = 
tİoA¼
[
i
];

356 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

359 
time_t
 
wüt
 = 
skLi¡
[
idx
]->
ùimeLo
;

360 
time_t
 
v®ue
 = 
—¾›¡Req
[
idx
] + 
wüt
;

361 ifĞ
—¾›¡Fš
[
idx
] !ğ
v®ue
 ) {

362 
—¾›¡Fš
[
idx
] = 
v®ue
;

363 
chªged
 = 1;

373  
k
 = 0; k < 
tx
->
numSuccs
; k++ ) {

374 
idk
 = 
tx
->
succLi¡
[
k
];

376 ifĞ
—¾›¡Req
[
idk
] < 
—¾›¡Fš
[
idx
] ) {

377 
—¾›¡Req
[
idk
] = 
—¾›¡Fš
[
idx
];

378 
chªged
 = 1;

387  
chªged
;

388 
	}
}

395 
time_t
 
	$compu‹WCRT
Ğ
ch¬t_t
 *
msc
 ) {

397 
i
;

399 
isS‘
 = 0;

400 
time_t
 
mšS¹
 = 1;

401 
time_t
 
maxFš
 = 0;

403 
	`´štf
( "\n" );

404  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

405 
ix
 = 
msc
->
tİoLi¡
[
i
];

408 
	`´štf
Ğ"%s:\t[%8Lu/%8Lu, %8Lu/%8Lu)\n", 
	`g‘TaskName
(
ix
), 
—¾›¡Req
[ix], 
Ï‹¡Req
[ix], 
—¾›¡Fš
[ix], 
Ï‹¡Fš
[ix] );

411 ifĞ!
isS‘
 || 
mšS¹
 > 
—¾›¡Req
[
ix
] ) {

412 
mšS¹
 = 
—¾›¡Req
[
ix
];

413 
isS‘
 = 1;

415 ifĞ
maxFš
 < 
Ï‹¡Fš
[
ix
] )

416 
maxFš
 = 
Ï‹¡Fš
[
ix
];

418 
	`´štf
Ğ"ExecutiÚ„uÁime: [%Lu,%Lu): %Lu\n\n", 
mšS¹
, 
maxFš
, (maxFin - minStart) );

420  (
maxFš
 - 
mšS¹
);

421 
	}
}

424 
	$timšgE¡im©eMSC
Ğ
ch¬t_t
 *
msc
 ) {

426 
i
, 
¡•
;

427 
time_t
 
ŞdWCRT
, 
ÃwWCRT
;

429 
¡•
 = 0;

430 
ŞdWCRT
 = 0;

431 
ÃwWCRT
 = 0;

434  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

435 
id
 = 
msc
->
tİoLi¡
[
i
];

436 
—¾›¡Req
[
id
] = 1;

437 
Ï‹¡Req
 [
id
] = 1;

438 
—¾›¡Fš
[
id
] = 0;

439 
Ï‹¡Fš
 [
id
] = 0;

443  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

444 
id
 = 
msc
->
tİoLi¡
[
i
];

448 *
tİoA¼
 = 
NULL
;

449 
tİosize
 = 
	`tİoSÜtSubg¿ph
Ğ
id
, &
tİoA¼
 );

460 
	`—¾›¡Times
Ğ
msc
, 
tİoA¼
, 
tİosize
 );

464 
	`Ï‹¡Times
Ğ
msc
, 
tİoA¼
, 
tİosize
 );

468 
	`ä“
Ğ
tİoA¼
 );

471 
	`´štf
Ğ"\nAá”‡Çlysi round %d\n", 
¡•
 );

472 
ÃwWCRT
 = 
	`compu‹WCRT
Ğ
msc
 );

473 ifĞ
ÃwWCRT
 =ğ
ŞdWCRT
 )

476 
	`fšdCr™iÿlP©h
Ğ
msc
 );

478 
ŞdWCRT
 = 
ÃwWCRT
;

479 
¡•
++;

481 }  
¡•
 < 
MAXSTEP
 );

483 
msc
->
wüt
 = 
ÃwWCRT
;

486 
	}
}

	@timingMSG.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<m©h.h
>

9 
	$cİyTask
Ğ
sk_t
 *
d¡
,ask_ˆ*
¤c
 ) {

11 
i
;

13 
	`¡rıy
Ğ
d¡
->
Šame
, 
¤c
->tname );

14 
d¡
->
aùÜID
 = 
¤c
->actorID;

15 
d¡
->
³ID
 = 
¤c
->peID;

16 
d¡
->
´iÜ™y
 = 
¤c
->priority;

17 
d¡
->
³riod
 = 
¤c
->period;

18 
d¡
->
ùimeLo
 = 
¤c
->ctimeLo;

19 
d¡
->
ùimeHi
 = 
¤c
->ctimeHi;

21 
d¡
->
numP»ds
 = 
¤c
->numPreds;

22 
d¡
->
´edLi¡
 = (*è
	`MALLOC
Ğd¡->´edLi¡, d¡->
numP»ds
 * (), "dst->predList" );

23  
i
 = 0; i < 
d¡
->
numP»ds
; i++ )

24 
d¡
->
´edLi¡
[
i
] = 
¤c
->predList[i];

26 
d¡
->
numSuccs
 = 
¤c
->numSuccs;

27 
d¡
->
succLi¡
 = (*è
	`MALLOC
Ğd¡->succLi¡, d¡->
numSuccs
 * (), "dst->succList" );

28  
i
 = 0; i < 
d¡
->
numSuccs
; i++ )

29 
d¡
->
succLi¡
[
i
] = 
¤c
->succList[i];

31 
d¡
->
numMemBlocks
 = 
¤c
->numMemBlocks;

32 
d¡
->
memBlockLi¡
 = (
mem_t
**è
	`MALLOC
Ğd¡->memBlockLi¡, d¡->
numMemBlocks
 * (mem_t*), "dst->memBlockList" );

33  
i
 = 0; i < 
d¡
->
numMemBlocks
; i++ )

34 
d¡
->
memBlockLi¡
[
i
] = 
¤c
->memBlockList[i];

36 
d¡
->
®loÿ‹d
 = (*è
	`CALLOC
Ğd¡->®loÿ‹d, d¡->
numMemBlocks
, (), "dst->allocated" );

39 
	}
}

42 
	$m­D•’d’cy
Ğ
sk_t
 *
tc
, *
m­
 ) {

44 
i
;

46  
i
 = 0; i < 
tc
->
numP»ds
; i++ )

47 
tc
->
´edLi¡
[
i
] = 
m­
[tc->predList[i]];

49  
i
 = 0; i < 
tc
->
numSuccs
; i++ )

50 
tc
->
succLi¡
[
i
] = 
m­
[tc->succList[i]];

53 
	}
}

63 
	$addCh¬tTasks
Ğ
ch¬tid
, 
ch¬t_t
 *
ùx
 ) {

65 
i
, 
k
;

67 *
m­
 = 
NULL
;

69 
ch¬t_t
 *
cid
 = &(
msg
[
ch¬tid
]);

70 
toDup
 = 
	`šLi¡
Ğ
cid
->
tİoLi¡
[0], 
ùx
->tİoLi¡, ctx->
tİoLi¡L’
 );

73 
ÃwËn
 = 
ùx
->
tİoLi¡L’
 + 
cid
->topoListLen;

74 
ùx
->
tİoLi¡
 = (*è
	`REALLOC
Ğùx->tİoLi¡, 
ÃwËn
 * (), "ctx->topoList" );

76 ifĞ
toDup
 ) {

79 
ÃwS¹
 = 
numTasks
;

81 
m­
 = (*è
	`MALLOC
Ğm­, 
numTasks
 * (), "map" );

82  
i
 = 0; i < 
numTasks
; i++ )

83 
m­
[
i
] = i;

85  
i
 = 0; i < 
cid
->
tİoLi¡L’
; i++ ) {

86 
idx
 = 
cid
->
tİoLi¡
[
i
];

89 
sk_t
 *
tc
 = (sk_t*è
	`MALLOC
(c, (task_t), "tc" );

90 
	`cİyTask
Ğ
tc
, 
skLi¡
[
idx
] );

93 
m­
[
idx
] = 
numTasks
;

98 
numTasks
++;

99 
skLi¡
 = (
sk_t
**è
	`REALLOC
ĞskLi¡, 
numTasks
 * (task_t*), "taskList" );

100 
skLi¡
[
numTasks
-1] = 
tc
;

106  
i
 = 
ÃwS¹
; i < 
numTasks
; i++ )

107 
	`m­D•’d’cy
Ğ
skLi¡
[
i
], 
m­
 );

112  
i
 = 0; i < 
cid
->
tİoLi¡L’
; i++ )

113 
ùx
->
tİoLi¡
[ùx->
tİoLi¡L’
 + 
i
] = 
m­
[
cid
->topoList[i]];

114 
ùx
->
tİoLi¡L’
 = 
ÃwËn
;

117  
k
 = 0; k < 
numPEs
; k++ ) {

118 
sched_t
 *
sc
 = 
ùx
->
PELi¡
[
k
];

119 
sched_t
 *
¤
 = 
cid
->
PELi¡
[
k
];

121 
Ãwassg
 = 
sc
->
numAssigÃd
 + 
¤
->numAssigned;

122 ifĞ
Ãwassg
 <= 0 )

125 
sc
->
assigÃdLi¡
 = (*è
	`REALLOC
Ğsc->assigÃdLi¡, 
Ãwassg
 * (), "sc->assignedList" );

126  
i
 = 0; i < 
¤
->
numAssigÃd
; i++ ) {

127 
sc
->
assigÃdLi¡
[sc->
numAssigÃd
 + 
i
] = 
m­
[
¤
->assignedList[i]];

129 
sc
->
numAssigÃd
 = 
Ãwassg
;

131 
	`ä“
Ğ
m­
 );

133  
ÃwËn
;

137  
i
 = 0; i < 
cid
->
tİoLi¡L’
; i++ )

138 
ùx
->
tİoLi¡
[ùx->
tİoLi¡L’
 + 
i
] = 
cid
->topoList[i];

139 
ùx
->
tİoLi¡L’
 = 
ÃwËn
;

141  
k
 = 0; k < 
numPEs
; k++ ) {

142 
sched_t
 *
sc
 = 
ùx
->
PELi¡
[
k
];

143 
sched_t
 *
¤
 = 
cid
->
PELi¡
[
k
];

145 
Ãwassg
 = 
sc
->
numAssigÃd
 + 
¤
->numAssigned;

146 ifĞ
Ãwassg
 <= 0 )

149 
sc
->
assigÃdLi¡
 = (*è
	`REALLOC
Ğsc->assigÃdLi¡, 
Ãwassg
 * (), "sc->assignedList" );

150  
i
 = 0; i < 
¤
->
numAssigÃd
; i++ ) {

151 
sc
->
assigÃdLi¡
[sc->
numAssigÃd
 + 
i
] = 
¤
->assignedList[i];

153 
sc
->
numAssigÃd
 = 
Ãwassg
;

155  
ÃwËn
;

156 
	}
}

159 
	$cİyCh¬t
Ğ
ch¬t_t
 *
Ãw
, ch¬t_ˆ*
¤c
, 
Ï¡node
, 
Ãxtsucc
 ) {

161 
i
;

162 
¡İnode
 = 
msg
[
Ï¡node
].
succLi¡
[
Ãxtsucc
-1];

163 
¡İsk
 = 
msg
[
¡İnode
].
tİoLi¡
[0];

165  
i
 = 0; i < 
¤c
->
tİoLi¡L’
; i++ ) {

166 ifĞ
¤c
->
tİoLi¡
[
i
] =ğ
¡İsk
 )

168 
	`’queue
Ğ
¤c
->
tİoLi¡
[
i
], &(
Ãw
->tİoLi¡), &Òew->
tİoLi¡L’
) );

170  
Ãw
->
tİoLi¡L’
;

171 
	}
}

178 
	$pİNode
Ğ*
node
, *
Ãxt
, **
bpSck
, **
ÃxtSucc
, *
Ën
 ) {

180 *
node
 = (*
bpSck
)[(*
Ën
)-1];

181 *
Ãxt
 = (*
ÃxtSucc
)[(*
Ën
)-1];

183 (*
ÃxtSucc
)[(*
Ën
)-1]++;

184 ifĞ(*
ÃxtSucc
)[(*
Ën
)-1] >ğ
msg
[(*Ën)-1].
numSuccs
 )

185 (*
Ën
)--;

188 
	}
}

191 
	$couÁEdge
Ğ
·th_t
 *
px
, 
¤c
, 
d¡
 ) {

193 
px
->
edgeBounds
[
¤c
][
d¡
]--;

194  
px
->
edgeBounds
[
¤c
][
d¡
];

195 
	}
}

203 
	$addCÚÿtD•’d’cy
Ğ
ch¬t_t
 *
cx
, **
´edRecÜd
, **
succRecÜd
, *
»cÜdL’
 ) {

205 
i
, 
k
;

207  
i
 = 0; i < 
cx
->
tİoLi¡L’
 - 1; i++ ) {

208 
ix
 = 
cx
->
tİoLi¡
[
i
];

209 
sk_t
 *
ti
 = 
skLi¡
[
ix
];

210 
found
 = 0;

212  
k
 = 
i
+1; !
found
 && k < 
cx
->
tİoLi¡L’
; k++ ) {

213 
kx
 = 
cx
->
tİoLi¡
[
k
];

214 
sk_t
 *
tk
 = 
skLi¡
[
kx
];

216 ifĞ
ti
->
aùÜID
 =ğ
tk
->actorID ) {

217 
found
 = 1;

218 
	`’queueUnique
Ğ
ix
, &(
tk
->
´edLi¡
), &Ñk->
numP»ds
) );

219 
	`’queueUnique
Ğ
kx
, &(
ti
->
succLi¡
), &Ñi->
numSuccs
) );

220 
	`’queuePaœ
Ğ
ix
, 
´edRecÜd
, 
kx
, 
succRecÜd
, 
»cÜdL’
 );

227 
	}
}

234 
	$»cov”CÚÿtD•’d’cy
Ğ*
´edRecÜd
, *
succRecÜd
, 
»cÜdL’
 ) {

236 
i
;

237 
sk_t
 *
tx
;

239  
i
 = 0; i < 
»cÜdL’
; i++ ) {

240 
´ed
 = 
´edRecÜd
[
i
];

241 
succ
 = 
succRecÜd
[
i
];

244 
tx
 = 
skLi¡
[
´ed
];

245 ifĞ
tx
->
succLi¡
[tx->
numSuccs
-1] =ğ
succ
 ) {

246 
tx
->
succLi¡
[tx->
numSuccs
-1] = -1;

247 
tx
->
numSuccs
--;

252 
tx
 = 
skLi¡
[
succ
];

253 ifĞ
tx
->
´edLi¡
[tx->
numP»ds
-1] =ğ
´ed
 ) {

254 
tx
->
´edLi¡
[tx->
numP»ds
-1] = -1;

255 
tx
->
numP»ds
--;

261 
	}
}

264 
	$š™P©h
Ğ
·th_t
 *
px
 ) {

266 
i
, 
k
;

268 
px
->
msc
 = (
ch¬t_t
*è
	`MALLOC
(…x->msc, (chart_t), "chart_t" );

269 
	`š™Ch¬t
Ğ
px
->
msc
 );

271 
px
->
edgeBounds
 = (**è
	`MALLOC
Ğpx->edgeBounds, 
numCh¬ts
 * (*), "px->edgeBounds" );

272  
i
 = 0; i < 
numCh¬ts
; i++ ) {

273 
px
->
edgeBounds
[
i
] = (*è
	`MALLOC
Ğpx->edgeBounds[i], 
numCh¬ts
 * (), "px->edgeBounds[i]" );

274  
k
 = 0; k < 
numCh¬ts
; k++ )

275 
px
->
edgeBounds
[
i
][
k
] = 
MAX_UNFOLD
;

277  
i
 = 0; i < 
numEdgeBounds
; i++ ) {

278 
edge_t
 *
eb
 = &(
edgeBounds
[
i
]);

279 
px
->
edgeBounds
[
eb
->
¤c
][eb->
d¡
] =ƒb->
bound
;

282 
	}
}

285 
	$cİyP©h
Ğ
·th_t
 *
Ãw
,…©h_ˆ*
¤c
, 
Ï¡node
, 
Ãxtsucc
 ) {

287 
i
;

288 
cu¼
, 
´ev
;

290 
¡İnode
 = 
msg
[
Ï¡node
].
succLi¡
[
Ãxtsucc
-1];

291 
¡İsk
 = 
msg
[
¡İnode
].
tİoLi¡
[0];

293 
´ev
 = -1;

294  
i
 = 0; i < 
¤c
->
msc
->
tİoLi¡L’
; i++ ) {

295 
cu¼
 = 
¤c
->
msc
->
tİoLi¡
[
i
];

296 ifĞ
cu¼
 =ğ
¡İsk
 )

298 
	`’queue
Ğ
cu¼
, &(
Ãw
->
msc
->
tİoLi¡
), &Òew->msc->
tİoLi¡L’
) );

299 ifĞ
´ev
 > -1 )

300 
	`couÁEdge
Ğ
Ãw
, 
´ev
, 
cu¼
 );

301 
´ev
 = 
cu¼
;

303  
Ãw
->
msc
->
tİoLi¡L’
;

304 
	}
}

307 
	$g‘NextV®idSuccId
Ğ
·th_t
 *
px
, 
ch¬tid
, 
äom
 ) {

309 
i
;

311  
i
 = 
äom
; i < 
msg
[
ch¬tid
].
numSuccs
; i++ ) {

312 
succ
 = 
msg
[
ch¬tid
].
succLi¡
[
i
];

313 ifĞ
px
->
edgeBounds
[
ch¬tid
][
succ
] > 0 )

314  
i
;

317 
	}
}

320 
	$timšgE¡im©e_synch_acyşic
() {

322 
i
, 
k
;

324 
time_t
 *
cummu
 = (time_t*è
	`CALLOC
Ğcummu, 
numCh¬ts
, (time_t), "cummulated WCRT" );

325 *
w·th
 = (*è
	`CALLOC
Ğw·th, 
numCh¬ts
, (), "WCRT…ath" );

327 ifĞ
®locm‘hod
 =ğ
NONE
 ) {

328  
i
 = 0; i < 
numCh¬ts
; i++ ) {

329 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

331 
	`timšgE¡im©eMSC
Ğ&(
msg
[
i
]) );

334 ifĞ
®locm‘hod
 =ğ
SLACK_CRITICAL
 ) {

335  
i
 = 0; i < 
numCh¬ts
; i++ ) {

336 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

337 
	`»£tAÎoÿtiÚ
Ğ&(
msg
[
i
]) );

338 
	`timšgAÎocMSC_¦ackCr™iÿl
Ğ&(
msg
[
i
]) );

342  
i
 = 0; i < 
numCh¬ts
; i++ ) {

343 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

344 
	`»£tAÎoÿtiÚ
Ğ&(
msg
[
i
]) );

345 
	`timšgAÎocMSC
Ğ&(
msg
[
i
]) );

349  
i
 = 0; i < 
numCh¬ts
; i++ )

350 
	`´štf
Ğ"WCRT[%d]: %Lu\n", 
i
, 
msg
[i].
wüt
 );

351 
	`´štf
( "\n" );

354  
i
 = 
numCh¬ts
-1; i >= 0; i-- ) {

355 
id
 = 
tİoMSG
[
i
];

357 
time_t
 
max
 = 0;

358 
maxID
 = -1;

361  
k
 = 0; k < 
msg
[
id
].
numSuccs
; k++ ) {

362 
sid
 = 
msg
[
id
].
succLi¡
[
k
];

363 ifĞ
cummu
[
sid
] > 
max
 ) {

364 
max
 = 
cummu
[
sid
];

365 
maxID
 = 
sid
;

368 
cummu
[
id
] = 
max
 + 
msg
[id].
wüt
;

369 
w·th
[
id
] = 
maxID
;

371 
	`´štf
Ğ"TÙ® WCRT: %Lu\n", 
cummu
[
tİoMSG
[0]] );

374 
i
 = 
tİoMSG
[0];

375 
	`´štf
( "Longest…ath:" );

376  
i
 != -1 ) {

377 
	`´štf
Ğ" %d", 
i
 );

378 
i
 = 
w·th
[i];

380 
	`´štf
( "\n" );

382 
	`ä“
Ğ
cummu
 );

383 
	`ä“
Ğ
w·th
 );

386 
	}
}

392 
	$timšgE¡im©e_synch
() {

394 
i
, 
k
;

395 
FILE
 *
pf
;

397 
sŞn
;

399 **
šcomšg
;

400 *
šcomšgL’
;

402 ifĞ
®locm‘hod
 =ğ
NONE
 ) {

403  
i
 = 0; i < 
numCh¬ts
; i++ ) {

404 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

406 
	`timšgE¡im©eMSC
Ğ&(
msg
[
i
]) );

409 ifĞ
®locm‘hod
 =ğ
SLACK_CRITICAL
 ) {

410  
i
 = 0; i < 
numCh¬ts
; i++ ) {

411 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

412 
	`»£tAÎoÿtiÚ
Ğ&(
msg
[
i
]) );

413 
	`timšgAÎocMSC_¦ackCr™iÿl
Ğ&(
msg
[
i
]) );

417  
i
 = 0; i < 
numCh¬ts
; i++ ) {

418 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

419 
	`»£tAÎoÿtiÚ
Ğ&(
msg
[
i
]) );

420 
	`timšgAÎocMSC
Ğ&(
msg
[
i
]) );

424  
i
 = 0; i < 
numCh¬ts
; i++ )

425 
	`´štf
Ğ"WCRT[%d]: %Lu\n", 
i
, 
msg
[i].
wüt
 );

426 
	`´štf
( "\n" );

428 
pf
 = 
	`İ’fe
( "wcrtsyn.ilp", "w" );

430 
	`årštf
Ğ
pf
, "enter Q\n" );

433 
	`årštf
Ğ
pf
, "maximize\n" );

434  
i
 = 0; i < 
numCh¬ts
; i++ ) {

435 
	`årštf
Ğ
pf
, "%Lu Node%d", 
msg
[
i
].
wüt
, i );

436 ifĞ
i
 < 
numCh¬ts
 - 1 )

437 
	`årštf
Ğ
pf
, " + " );

440 
	`årštf
Ğ
pf
, "\nst\n" );

443 
	`årštf
Ğ
pf
, "Ya_%d = 1\n", 
¡¬tNode
 );

444 
	`årštf
Ğ
pf
, "Y%d_z = 1\n", 
’dNode
 );

447  
i
 = 0; i < 
numEdgeBounds
; i++ )

448 
	`årštf
Ğ
pf
, "Y%d_%d = %d\n", 
edgeBounds
[
i
].
¤c
,ƒdgeBounds[i].
d¡
,ƒdgeBounds[i].
bound
 );

451  
i
 = 0; i < 
numCh¬ts
; i++ ) {

452 
ch¬t_t
 *
cx
 = &(
msg
[
i
]);

453 
	`årštf
Ğ
pf
, "Node%d", 
i
 );

454  
k
 = 0; k < 
cx
->
numSuccs
; k++ )

455 
	`årštf
Ğ
pf
, " - Y%d_%d", 
i
, 
cx
->
succLi¡
[
k
] );

456 ifĞ
i
 =ğ
’dNode
 )

457 
	`årštf
Ğ
pf
, " - Y%d_z", 
i
 );

458 
	`årštf
Ğ
pf
, " = 0\n" );

462 
šcomšg
 = (**è
	`MALLOC
Ğšcomšg, 
numCh¬ts
 * (*), "incoming" );

463 
šcomšgL’
 = (*è
	`CALLOC
ĞšcomšgL’, 
numCh¬ts
, (), "incomingLen" );

464  
i
 = 0; i < 
numCh¬ts
; i++ )

465 
šcomšg
[
i
] = 
NULL
;

467  
i
 = 0; i < 
numCh¬ts
; i++ ) {

468 
ch¬t_t
 *
cx
 = &(
msg
[
i
]);

469  
k
 = 0; k < 
cx
->
numSuccs
; k++ ) {

470 
sx
 = 
cx
->
succLi¡
[
k
];

471 
	`’queue
Ğ
i
, &(
šcomšg
[
sx
]), &(
šcomšgL’
[sx]) );

476  
i
 = 0; i < 
numCh¬ts
; i++ ) {

477 
	`årštf
Ğ
pf
, "Node%d", 
i
 );

478  
k
 = 0; k < 
šcomšgL’
[
i
]; k++ )

479 
	`årštf
Ğ
pf
, " - Y%d_%d", 
šcomšg
[
i
][
k
], i );

480 ifĞ
i
 =ğ
¡¬tNode
 )

481 
	`årštf
Ğ
pf
, " - Ya_%d", 
i
 );

482 
	`årštf
Ğ
pf
, " = 0\n" );

485 
	`årštf
Ğ
pf
, "end\n" );

499  
i
 = 0; i < 
numCh¬ts
; i++ )

500 
	`ä“
Ğ
šcomšg
[
i
] );

501 
	`ä“
Ğ
šcomšg
 );

502 
	`ä“
Ğ
šcomšgL’
 );

506 
	`årštf
Ğ
pf
, "optimize\n" );

507 
	`årštf
Ğ
pf
, "display solution variables -\n" );

508 
	`årštf
Ğ
pf
, "quit\n" );

510 
	`fşo£
Ğ
pf
 );

513 
	`sy¡em
( "cplex < wcrtsyn.ilp > wcrtsyn.sol" );

516 
	`sy¡em
( "grep Objective wcrtsyn.sol |‡wk '{print $NF}' > wcrtsyn.val" );

518 
pf
 = 
	`İ’fe
( "wcrtsyn.val", "r" );

519 
	`fsÿnf
Ğ
pf
, "%Ë", &
sŞn
 );

520 
	`fşo£
Ğ
pf
 );

523 
	`sy¡em
( "grep Node wcrtsyn.sol" );

525 
	`´štf
Ğ"\nTÙ® WCRT: %Lu\n\n", (
time_t
è
sŞn
 );

528 
	}
}

531 
	$timšgE¡im©e_asynch_acyşic
() {

534 
idx
;

535 
time_t
 
max
;

536 
ch¬t_t
 *
cx
, *
maxcx
, *
´evcx
;

538 
back±
;

539 
Ãxtsc
;

542 
backŒackËn
 = 0;

543 *
backŒack
 = 
NULL
;

544 *
Ãxtsucc
 = 
NULL
;

547 
»cÜdL’
;

548 *
´edRecÜd
;

549 *
succRecÜd
;

552 
numP©hs
 = 0;

555 
cx
 = (
ch¬t_t
*è
	`MALLOC
( cx, (chart_t), "chart_t" );

556 
	`š™Ch¬t
Ğ
cx
 );

560 
idx
 = 
¡¬tNode
;

562 
max
 = 0;

563 
maxcx
 = 
NULL
;

564 
´evcx
 = 
NULL
;

568 
	`addCh¬tTasks
Ğ
idx
, 
cx
 );

570 ifĞ
msg
[
idx
].
numSuccs
 <= 0 ) {

573 
numP©hs
++;

578 
»cÜdL’
 = 0;

579 
´edRecÜd
 = 
NULL
;

580 
succRecÜd
 = 
NULL
;

581 
	`addCÚÿtD•’d’cy
Ğ
cx
, &
´edRecÜd
, &
succRecÜd
, &
»cÜdL’
 );

585 
	`»£tIÁ”ã»nû
Ğ
cx
 );

587 ifĞ
®locm‘hod
 =ğ
NONE
 )

588 
	`timšgE¡im©eMSC
Ğ
cx
 );

590 
	`»£tAÎoÿtiÚ
Ğ
cx
 );

591 ifĞ
®locm‘hod
 =ğ
SLACK_CRITICAL
 )

592 
	`timšgAÎocMSC_¦ackCr™iÿl
Ğ
cx
 );

594 
	`timšgAÎocMSC
Ğ
cx
 );

598 
	`»cov”CÚÿtD•’d’cy
Ğ
´edRecÜd
, 
succRecÜd
, 
»cÜdL’
 );

599 
	`ä“
Ğ
´edRecÜd
 );

600 
	`ä“
Ğ
succRecÜd
 );

602 ifĞ
backŒackËn
 <= 0 )

605 
´evcx
 = 
cx
;

608 
cx
 = (
ch¬t_t
*è
	`MALLOC
( cx, (chart_t), "chart_t" );

609 
	`š™Ch¬t
Ğ
cx
 );

612 
	`pİNode
Ğ&
back±
, &
Ãxtsc
, &
backŒack
, &
Ãxtsucc
, &
backŒackËn
 );

616 
	`cİyCh¬t
Ğ
cx
, 
´evcx
, 
back±
, 
Ãxtsc
 );

619 
idx
 = 
msg
[
back±
].
succLi¡
[
Ãxtsc
];

621 
	`´štf
Ğ"WCRT[%d]: %Lu\n", 
numP©hs
-1, 
´evcx
->
wüt
 );

622 ifĞ
´evcx
->
wüt
 > 
max
 ) {

623 
max
 = 
´evcx
->
wüt
;

624 
maxcx
 = 
´evcx
;

627 
	`ä“Ch¬t
Ğ
´evcx
 );

633 ifĞ
msg
[
idx
].
numSuccs
 > 1 )

634 
	`’queuePaœ
Ğ
idx
, &
backŒack
, 1, &
Ãxtsucc
, &
backŒackËn
 );

637 
idx
 = 
msg
[idx].
succLi¡
[0];

651 
	`´štf
Ğ"\n\nGlob® WCRT: %Lu\n\n", 
max
 );

653 
	`´štTaskLi¡
Ğ
maxcx
 );

655 
	`ä“
Ğ
backŒack
 );

656 
	`ä“
Ğ
Ãxtsucc
 );

658 
	`ä“Ch¬t
Ğ
maxcx
 );

659 
	`ä“
Ğ
maxcx
 );

668 
	}
}

674 
	$timšgE¡im©e_asynch_
() {

676 
idx
, 
´ev
;

677 
time_t
 
max
;

679 
·th_t
 *
px
, *
maxpx
, *
´evpx
;

680 
ch¬t_t
 *
cx
;

682 
back±
;

683 
Ãxtsc
;

684 
ÃxŠextsc
;

687 
backŒackËn
 = 0;

688 *
backŒack
 = 
NULL
;

689 *
Ãxtsucc
 = 
NULL
;

692 
»cÜdL’
;

693 *
´edRecÜd
;

694 *
succRecÜd
;

697 
numP©hs
 = 0;

699 
FILE
 *
·thf
 = 
	`İ’fe
( "wcrtasyn.paths", "w" );

700 
	`årštf
Ğ
·thf
, "P©h %d\n", 
numP©hs
 );

701 
	`´štf
Ğ"P©h %d\n", 
numP©hs
 ); 
	`fæush
Ğ
¡dout
 );

703 
px
 = (
·th_t
*è
	`MALLOC
(…x, (path_t), "path_t" );

704 
	`š™P©h
Ğ
px
 );

707 
idx
 = 
¡¬tNode
;

710 
cx
 = &(
msg
[
’dNode
]);

711 
	`’queue
Ğ
numCh¬ts
, &(
cx
->
succLi¡
), &(cx->
numSuccs
) );

713 
max
 = 0;

714 
maxpx
 = 
NULL
;

715 
´evpx
 = 
NULL
;

719 
ch¬t_t
 *
cx
 = 
px
->
msc
;

721 
	`årštf
Ğ
·thf
, " %d", 
idx
 );

722 
	`´štf
Ğ" %d", 
idx
 ); 
	`fæush
Ğ
¡dout
 );

724 ifĞ
idx
 < 
numCh¬ts
 )

725 
	`addCh¬tTasks
Ğ
idx
, 
cx
 );

730 
numP©hs
++;

731 
	`årštf
Ğ
·thf
, "\n\n" );

732 
	`´štf
Ğ"\n\n" ); 
	`fæush
Ğ
¡dout
 );

735 
»cÜdL’
 = 0;

736 
´edRecÜd
 = 
NULL
;

737 
succRecÜd
 = 
NULL
;

738 
	`addCÚÿtD•’d’cy
Ğ
cx
, &
´edRecÜd
, &
succRecÜd
, &
»cÜdL’
 );

742 
	`»£tIÁ”ã»nû
Ğ
cx
 );

744 ifĞ
®locm‘hod
 =ğ
NONE
 )

745 
	`timšgE¡im©eMSC
Ğ
cx
 );

747 
	`»£tAÎoÿtiÚ
Ğ
cx
 );

748 ifĞ
®locm‘hod
 =ğ
SLACK_CRITICAL
 )

749 
	`timšgAÎocMSC_¦ackCr™iÿl
Ğ
cx
 );

751 
	`timšgAÎocMSC
Ğ
cx
 );

755 
	`»cov”CÚÿtD•’d’cy
Ğ
´edRecÜd
, 
succRecÜd
, 
»cÜdL’
 );

756 
	`ä“
Ğ
´edRecÜd
 );

757 
	`ä“
Ğ
succRecÜd
 );

759 ifĞ
backŒackËn
 <= 0 )

764 
	`pİNode
Ğ&
back±
, &
Ãxtsc
, &
backŒack
, &
Ãxtsucc
, &
backŒackËn
 );

765 
Ãxtsc
 = 
	`g‘NextV®idSuccId
Ğ
px
, 
back±
,‚extsc );

766 }  
Ãxtsc
 == -1 );

769 
idx
 = 
msg
[
back±
].
succLi¡
[
Ãxtsc
];

770 ifĞ
idx
 < 
numCh¬ts
 )

771 
	`couÁEdge
Ğ
px
, 
back±
, 
idx
 );

774 
´evpx
 = 
px
;

775 
px
 = (
·th_t
*è
	`MALLOC
(…x, (path_t), "path_t" );

776 
	`š™P©h
Ğ
px
 );

779 
	`cİyP©h
Ğ
px
, 
´evpx
, 
back±
, 
Ãxtsc
 );

781 
	`´štf
Ğ"WCRT[%d]: %Lu\n", 
numP©hs
-1, 
´evpx
->
msc
->
wüt
 );

782 ifĞ
´evpx
->
msc
->
wüt
 > 
max
 ) {

783 
max
 = 
´evpx
->
msc
->
wüt
;

784 
maxpx
 = 
´evpx
;

787 
	`ä“P©h
Ğ
´evpx
 );

789 
	`årštf
Ğ
·thf
, "P©h %d\n", 
numP©hs
 );

790 
	`´štf
Ğ"P©h %d\n", 
numP©hs
 ); 
	`fæush
Ğ
¡dout
 );

796 
Ãxtsc
 = 
	`g‘NextV®idSuccId
Ğ
px
, 
idx
, 0 );

797 ifĞ
Ãxtsc
 == -1 ) {

800 
	`årštf
Ğ
·thf
, " X\n\n" );

801 
	`´štf
Ğ" X\n\n" ); 
	`fæush
Ğ
¡dout
 );

803 ifĞ
backŒackËn
 <= 0 )

808 
	`pİNode
Ğ&
back±
, &
Ãxtsc
, &
backŒack
, &
Ãxtsucc
, &
backŒackËn
 );

809 
Ãxtsc
 = 
	`g‘NextV®idSuccId
Ğ
px
, 
back±
,‚extsc );

810 }  
Ãxtsc
 == -1 );

813 
idx
 = 
msg
[
back±
].
succLi¡
[
Ãxtsc
];

814 ifĞ
idx
 < 
numCh¬ts
 )

815 
	`couÁEdge
Ğ
px
, 
back±
, 
idx
 );

818 
´evpx
 = 
px
;

819 
px
 = (
·th_t
*è
	`MALLOC
(…x, (path_t), "path_t" );

820 
	`š™P©h
Ğ
px
 );

823 
	`cİyP©h
Ğ
px
, 
´evpx
, 
back±
, 
Ãxtsc
 );

825 
	`årštf
Ğ
·thf
, "P©h %d\n", 
numP©hs
 );

826 
	`´štf
Ğ"P©h %d\n", 
numP©hs
 ); 
	`fæush
Ğ
¡dout
 );

832 
ÃxŠextsc
 = 
	`g‘NextV®idSuccId
Ğ
px
, 
idx
, 
Ãxtsc
 + 1 );

833 ifĞ
Ãxtsc
 > -1 )

834 
	`’queuePaœ
Ğ
idx
, &
backŒack
, 
ÃxŠextsc
, &
Ãxtsucc
, &
backŒackËn
 );

837 
´ev
 = 
idx
;

838 
idx
 = 
msg
[
´ev
].
succLi¡
[
Ãxtsc
];

839 ifĞ
idx
 < 
numCh¬ts
 )

840 
	`couÁEdge
Ğ
px
, 
´ev
, 
idx
 );

842 
	`fşo£
Ğ
·thf
 );

844 
	`´štf
Ğ"\n\nGlob® WCRT: %Lu\n\n", 
max
 );

845 
	`´štTaskLi¡
Ğ
maxpx
->
msc
 );

847 
	`ä“
Ğ
backŒack
 );

848 
	`ä“
Ğ
Ãxtsucc
 );

850 
	`ä“P©h
Ğ
maxpx
 );

851 
	`ä“
Ğ
maxpx
 );

854 
	}
}

862 
	$timšgE¡im©e_asynch
() {

864 
FILE
 *
·thf
;

865 
tok’
[24];

867 
i
, 
idx
;

868 
id
, 
Ën
;

869 
ÜgNumTasks
;

871 
maxid
;

872 
time_t
 
max
;

873 
ch¬t_t
 *
cx
, *
maxcx
;

876 
»cÜdL’
;

877 *
´edRecÜd
;

878 *
succRecÜd
;

881 
·thf
 = 
	`İ’ãxt
Ğ
dgÇme
, "paths", "r" );

882  
	`fsÿnf
Ğ
·thf
, "% %d %d", 
tok’
, &
id
, &
Ën
 ) !ğ
EOF
 ) {

885 
cx
 = (
ch¬t_t
*è
	`MALLOC
( cx, (chart_t), "chart_t" );

886 
	`š™Ch¬t
Ğ
cx
 );

889 
ÜgNumTasks
 = 
numTasks
;

892 
	`´štf
Ğ"\nP©h %d:", 
id
 );

893  
i
 = 0; i < 
Ën
; i++ ) {

894 
	`fsÿnf
Ğ
·thf
, "%d", &
idx
 );

895 
	`´štf
Ğ" %d", 
idx
 );

896 
	`addCh¬tTasks
Ğ
idx
, 
cx
 );

901 
	`´štf
( "\n\n" );

904 ifĞ
numTasks
 > 
ÜgNumTasks
 ) {

906 
—¾›¡Req
 = (
time_t
*è
	`REALLOC
Ğ—¾›¡Req, 
numTasks
 * (time_t), "earliestReq" );

907 
Ï‹¡Req
 = (
time_t
*è
	`REALLOC
ĞÏ‹¡Req, 
numTasks
 * (time_t), "latestReq" );

908 
—¾›¡Fš
 = (
time_t
*è
	`REALLOC
Ğ—¾›¡Fš, 
numTasks
 * (time_t), "earliestFin" );

909 
Ï‹¡Fš
 = (
time_t
*è
	`REALLOC
ĞÏ‹¡Fš, 
numTasks
 * (time_t), "latestFin" );

911 
š‹rã»
 = (**è
	`REALLOC
Ğš‹rã», 
numTasks
 * (*), "interfere" );

912  
i
 = 0; i < 
numTasks
; i++ ) {

913 
š‹rã»
[
i
] = (*è
	`CALLOC
Ğš‹rã»[i], 
numTasks
, (), "interfere[i]" );

918 
»cÜdL’
 = 0;

919 
´edRecÜd
 = 
NULL
;

920 
succRecÜd
 = 
NULL
;

921 
	`addCÚÿtD•’d’cy
Ğ
cx
, &
´edRecÜd
, &
succRecÜd
, &
»cÜdL’
 );

925 
	`»£tIÁ”ã»nû
Ğ
cx
 );

927 ifĞ
®locm‘hod
 =ğ
NONE
 )

928 
	`timšgE¡im©eMSC
Ğ
cx
 );

930 
	`»£tAÎoÿtiÚ
Ğ
cx
 );

931 ifĞ
®locm‘hod
 =ğ
SLACK_CRITICAL
 )

932 
	`timšgAÎocMSC_¦ackCr™iÿl
Ğ
cx
 );

934 
	`timšgAÎocMSC
Ğ
cx
 );

938 
	`»cov”CÚÿtD•’d’cy
Ğ
´edRecÜd
, 
succRecÜd
, 
»cÜdL’
 );

939 
	`ä“
Ğ
´edRecÜd
 );

940 
	`ä“
Ğ
succRecÜd
 );

943 ifĞ
numTasks
 > 
ÜgNumTasks
 ) {

944  
i
 = 
ÜgNumTasks
; i < 
numTasks
; i++ ) {

945 
	`ä“Task
Ğ
skLi¡
[
i
] );

946 
	`ä“
Ğ
skLi¡
[
i
] );

947 
	`ä“
Ğ
š‹rã»
[
i
] );

949 
numTasks
 = 
ÜgNumTasks
;

952 
	`´štf
Ğ"WCRT[%d]: %Lu\n", 
id
, 
cx
->
wüt
 );

953 ifĞ
cx
->
wüt
 > 
max
 ) {

954 
max
 = 
cx
->
wüt
;

955 
maxid
 = 
id
;

956 
maxcx
 = 
cx
;

959 
	`ä“Ch¬t
Ğ
cx
 );

960 
	`ä“
Ğ
cx
 );

963 
	`fşo£
Ğ
·thf
 );

965 
	`´štf
Ğ"\n\nGlob® WCRT: %Lu\n\n", 
max
 );

966 
	`´štf
Ğ"WCRT P©h %d\n", 
maxid
 );

969 
	`ä“Ch¬t
Ğ
maxcx
 );

970 
	`ä“
Ğ
maxcx
 );

973 
	}
}

976 
	$timšgE¡im©e
() {

978 ifĞ
cÚÿt
 =ğ
ASYNCH
 )

979  
	`timšgE¡im©e_asynch
();

981  
	`timšgE¡im©e_synch
();

982 
	}
}

	@topo.c

5 
	~<¡dio.h
>

19 
	$tİo_sÜt_loİ
Ğ
loİ
 *
Í
 ) {

21 
i
, 
k
, 
exid
;

22 
block
 *
bb
, *
nb
;

23 
loİ
 *
Ín
;

25 
block
 **
unsÜ‹d
;

26 
block
 **
comeäom
;

27 
comeäomsize
;

28 *
m¬kfš
;

29 
fš
;

31 
couÁdÚe
;

33 
comeäom
 = 
NULL
;

34 
comeäomsize
 = 0;

35 
m¬kfš
 = (*è
	`CALLOC
Ğm¬kfš, 
Í
->
num_tİo
, (), "loopopo fin‡rray" );

38 
unsÜ‹d
 = (
block
**è
	`MALLOC
ĞunsÜ‹d, 
Í
->
num_tİo
 * (block*), "loopopo copy" );

39  
i
 = 0; i < 
Í
->
num_tİo
; i++ )

40 
unsÜ‹d
[
i
] = 
Í
->
tİo
[i];

42 
couÁdÚe
 = 0;

47 
bb
 = 
unsÜ‹d
[0];

49  
couÁdÚe
 < 
Í
->
num_tİo
 ) {

59 ifĞ
bb
->
is_loİh—d
 && bb->
loİid
 !ğ
Í
->
Íid
 ) {

61 
k
 = 
	`g‘block
Ğ
bb
->
bbid
, 
unsÜ‹d
, 0, 
Í
->
num_tİo
-1 );

63 ifĞ!
m¬kfš
[
k
] ) {

64 
Ín
 = 
´ocs
[ 
Í
->
pid
 ]->
loİs
[ 
bb
->
loİid
 ];

67 
nb
 = (
block
*è
	`MALLOC
(‚b, (block), "blackbox" );

68 
	`mem£t
(
nb
, 0, (
block
));

69 
	`ü—‹Block
Ğ
nb
, 
Í
->
pid
, 
bb
->
bbid
, bb->
¡¬ddr
, 
Ín
->
loİex™
->bbid, -1, -1,†²->
Íid
 );

70 
nb
->
is_loİh—d
 = 1;

71 
nb
->
size
 = 
bb
->size;

74 
nb
->
num_š¡r
 = 
bb
->num_instr;

75 
nb
->
š¡¾i¡
 = 
bb
->instrlist;

82 
unsÜ‹d
[
k
] = 
nb
;

84 
bb
 = 
nb
;

88 
exid
 = 
	`g‘block
Ğ
Ín
->
loİex™
->
bbid
, 
unsÜ‹d
, 0, 
Í
->
num_tİo
-1 );

89 ifĞ
exid
 =ğ-1 || 
m¬kfš
[exid] == 2 ) {

91 
m¬kfš
[
k
] = 2;

92 
Í
->
tİo
[ 
couÁdÚe
++ ] = 
bb
;

95 ifĞ!
comeäomsize
 )

97 
bb
 = 
comeäom
[ --
comeäomsize
 ];

100 
m¬kfš
[
k
] = 1;

101 
comeäom
 = (
block
**è
	`REALLOC
Ğcomeäom, (
comeäomsize
 + 1) * (block*), "topo comefrom‡rray" );

102 
comeäom
[ 
comeäomsize
++ ] = 
bb
;

105 
bb
 = 
Ín
->
loİex™
;

111 
fš
 = 1;

112  
i
 = 0; 
fš
 && i < 
bb
->
num_outgošg
; i++ ) {

113 
k
 = 
	`g‘block
Ğ
bb
->
outgošg
[
i
], 
unsÜ‹d
, 0, 
Í
->
num_tİo
-1 );

114 ifĞ
k
 !ğ-1 && 
m¬kfš
[k] != 2 )

115 
fš
 = 0;

118 
k
 = 
	`g‘block
Ğ
bb
->
bbid
, 
unsÜ‹d
, 0, 
Í
->
num_tİo
-1 );

120 ifĞ
bb
->
bbid
 =ğ
Í
->
loİsšk
->bbid || !bb->
num_outgošg
 || 
fš
 ) {

122 
m¬kfš
[
k
] = 2;

123 
Í
->
tİo
[ 
couÁdÚe
++ ] = 
bb
;

126 ifĞ!
comeäomsize
 )

128 
bb
 = 
comeäom
[ --
comeäomsize
 ];

130 ifĞ!
m¬kfš
[
k
] ) {

131 
m¬kfš
[
k
] = 1;

132 
comeäom
 = (
block
**è
	`REALLOC
Ğcomeäom, (
comeäomsize
 + 1) * (block*), "topo comefrom‡rray" );

133 
comeäom
[ 
comeäomsize
++ ] = 
bb
;

136 
k
 = 
	`g‘block
Ğ
bb
->
outgošg
[0], 
unsÜ‹d
, 0, 
Í
->
num_tİo
-1 );

137 ifĞ
k
 != -1 )

138 
bb
 = 
unsÜ‹d
[
k
];

141 ifĞ!
comeäomsize
 )

143 
bb
 = 
comeäom
[ --
comeäomsize
 ];

146 ifĞ
bb
->
num_outgošg
 > 1 ) {

147 
comeäom
 = (
block
**è
	`REALLOC
Ğcomeäom, (
comeäomsize
 + 1) * (block*), "topo comefrom‡rray" );

148 
comeäom
[ 
comeäomsize
++ ] = 
bb
;

152 
k
 = 
	`g‘block
Ğ
bb
->
outgošg
[1], 
unsÜ‹d
, 0, 
Í
->
num_tİo
-1 );

153 ifĞ
k
 != -1 )

154 
bb
 = 
unsÜ‹d
[
k
];

157 ifĞ!
comeäomsize
 )

159 
bb
 = 
comeäom
[ --
comeäomsize
 ];

163 
	`´štf
Ğ"Unusu® ca£‡ˆ%d.\n", 
bb
->
bbid
 ), 
	`ex™
(1);

168 
Í
->
num_tİo
 = 
couÁdÚe
;

171 
	`ä“
Ğ
unsÜ‹d
 );

172 
	`ä“
Ğ
comeäom
 );

173 
	`ä“
Ğ
m¬kfš
 );

176 
	}
}

179 
	$tİo_sÜt_´oc
Ğ
´oûdu»
 *
p
 ) {

181 
i
;

182 
block
 *
bb
, *
nb
;

183 
loİ
 *
Í
;

185 
block
 **
comeäom
;

186 
comeäomsize
;

187 *
m¬kfš
;

188 
fš
;

190 
couÁdÚe
;

192 
comeäom
 = 
NULL
;

193 
comeäomsize
 = 0;

194 
m¬kfš
 = (*è
	`CALLOC
Ğm¬kfš, 
p
->
num_bb
, (), "procopo fin‡rray" );

195 
p
->
tİo
 = (
block
**è
	`REALLOC
Ğp->tİo,…->
num_bb
 * (block*), "procopo‡rray" );

197 
couÁdÚe
 = 0;

202 
bb
 = 
p
->
bbli¡
[0];

204  
couÁdÚe
 < 
p
->
num_bb
 ) {

215 ifĞ
bb
->
is_loİh—d
 ) {

217 ifĞ!
m¬kfš
[ 
bb
->
bbid
 ] ) {

218 
Í
 = 
p
->
loİs
[ 
bb
->
loİid
 ];

221 
nb
 = (
block
*è
	`MALLOC
(‚b, (block), "blackbox" );

222 
	`mem£t
(
nb
, 0, (
block
));

223 
	`ü—‹Block
Ğ
nb
, 
p
->
pid
, 
bb
->
bbid
, bb->
¡¬ddr
, 
Í
->
loİex™
->bbid, -1, -1,†p->
Íid
 );

225 
nb
->
is_loİh—d
 = 1;

226 
nb
->
size
 = 
bb
->size;

229 
nb
->
num_š¡r
 = 
bb
->num_instr;

230 
nb
->
š¡¾i¡
 = 
bb
->instrlist;

236 
bb
 = 
nb
;

240 ifĞ
m¬kfš
[ 
Í
->
loİex™
->
bbid
 ] == 2 ) {

242 
m¬kfš
[ 
bb
->
bbid
 ] = 2;

243 
p
->
tİo
[ 
couÁdÚe
++ ] = 
bb
;

246 ifĞ!
comeäomsize
 )

248 
bb
 = 
comeäom
[ --
comeäomsize
 ];

251 
m¬kfš
[ 
bb
->
bbid
 ] = 1;

252 
comeäom
 = (
block
**è
	`REALLOC
Ğcomeäom, (
comeäomsize
 + 1) * (block*), "topo comefrom‡rray" );

253 
comeäom
[ 
comeäomsize
++ ] = 
bb
;

256 
bb
 = 
Í
->
loİex™
;

262 ifĞ
bb
->
loİid
 != -1 ) {

264 ifĞ!
comeäomsize
 )

266 
bb
 = 
comeäom
[ --
comeäomsize
 ];

271 
fš
 = 1;

272  
i
 = 0; 
fš
 && i < 
bb
->
num_outgošg
; i++ )

273 ifĞ
m¬kfš
[ 
bb
->
outgošg
[
i
] ] != 2 )

274 
fš
 = 0;

276 ifĞ!
bb
->
num_outgošg
 || 
fš
 ) {

278 
m¬kfš
[ 
bb
->
bbid
 ] = 2;

279 
p
->
tİo
[ 
couÁdÚe
++ ] = 
bb
;

282 ifĞ!
comeäomsize
 )

284 
bb
 = 
comeäom
[ --
comeäomsize
 ];

286 ifĞ!
m¬kfš
[ 
bb
->
bbid
 ] ) {

287 
m¬kfš
[ 
bb
->
bbid
 ] = 1;

288 
comeäom
 = (
block
**è
	`REALLOC
Ğcomeäom, (
comeäomsize
 + 1) * (block*), "topo comefrom‡rray" );

289 
comeäom
[ 
comeäomsize
++ ] = 
bb
;

292 
bb
 = 
p
->
bbli¡
[ bb->
outgošg
[0] ];

294 ifĞ
bb
->
num_outgošg
 > 1 ) {

295 
comeäom
 = (
block
**è
	`REALLOC
Ğcomeäom, (
comeäomsize
 + 1) * (block*), "topo comefrom‡rray" );

296 
comeäom
[ 
comeäomsize
++ ] = 
bb
;

299 
bb
 = 
p
->
bbli¡
[ bb->
outgošg
[1] ];

302 
	`´štf
Ğ"Unusu® ca£‡ˆ%d.\n", 
bb
->
bbid
 ), 
	`ex™
(1);

307 
p
->
num_tİo
 = 
couÁdÚe
;

310 
	`ä“
Ğ
comeäom
 );

311 
	`ä“
Ğ
m¬kfš
 );

314 
	}
}

320 
	$tİo_sÜt
() {

322 
i
, 
j
;

323 
´oûdu»
 *
p
;

325  
i
 = 0; i < 
num_´ocs
; i++ ) {

326 
p
 = 
´ocs
[
i
];

329  
j
 = 0; j < 
p
->
num_loİs
; j++ )

330 
	`tİo_sÜt_loİ
Ğ
p
->
loİs
[
j
] );

333 
	`tİo_sÜt_´oc
Ğ
p
 );

337 
	}
}

	@updateCacheL2.c

5 
	~<¡dio.h
>

8 
upd©eCacheS‹
(
MSC
 *
msc
);

11 
upd©eLoİ
(
MSC
 *
msc
, 
šdex
, 
´oûdu»
 *
´oc
, 
loİ
 *
Í
);

14 
upd©eFunùiÚC®l
(
MSC
 *
msc
, 
šdex
, 
´oûdu»
* 
´oc
);

17 
	$cÚæiùSti¡ics
(
MSC
 *
msc
, 
šdex
, 
£t_no
, 
cu¼’t_addr
)

19 
i
, 
j
, 
k
, 
’Œy
, 
æag
 = 0, 
cÚæiù
 = 0;

20 *
hi¡Üy
 = 
NULL
, 
út
 = 0;

21 
hi¡Üy
 = (*)
	`CALLOC
(hi¡Üy, 
MAX_LEN
 * 2, (), "history int[]");

23 
i
 = 0; i < 
msc
->
num_sk
; i++)

25 if(
i
 !ğ
šdex
)

27 
j
 = 0; j < 
msc
->
skLi¡
[
i
].
maš_cİy
->
h™_addr
[
£t_no
].
num_’Œy
; j++)

29 
’Œy
 = 
msc
->
skLi¡
[
i
].
maš_cİy
->
h™_addr
[
£t_no
].’Œy[
j
];

30 if(
’Œy
 =ğ
cu¼’t_addr
) ;

31 if(
	`isInWay
(
’Œy
, 
hi¡Üy
, 
út
)) ;

32 
cÚæiù
++;

33 
hi¡Üy
[
út
] = 
’Œy
;

34 
út
++;

35 if(
út
 >ğ
MAX_LEN
 * 2è
	`´štf
("’Œy ov”æow!\n"), 
	`ex™
(1);

39 
	`ä“
(
hi¡Üy
);

40  
cÚæiù
;

41 
	}
}

44 
	$upd©eCacheS‹
(
MSC
 *
msc
)

46 
i
, 
j
;

49 
i
 = 0; i < 
msc
->
num_sk
; i ++)

51 
j
 = 0; j < 
MAX_NEST_LOOP
; j++)

52 
loİ_Ëv–_¬r
[
i
] = 
INVALID
;

54 
	`upd©eFunùiÚC®l
(
msc
, 
i
, msc->
skLi¡
[i].
maš_cİy
);

56 
	}
}

59 
	$upd©eLoİ
(
MSC
 *
msc
, 
šdex
, 
´oûdu»
 *
´oc
, 
loİ
 *
Í
)

63 
i
, 
j
, 
k
, 
n
, 
£t_no
, 
út
, 
addr
, 
Í_Ëv–
, 
num_cÚæiù
;

64 
tmp
;

65 
´oûdu»
 *
p
 = 
´oc
;

66 
block
 *
bb
;

67 
CHMC
 * 
cu¼’t_chmc
;

68 
off£t
;

70 
num_blk
 = 
Í
->
num_tİo
;

74 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

75 if(
loİ_Ëv–_¬r
[
i
] =ğ
INVALID
)

77 
Í_Ëv–
 = 
i
 -1;

81 
út
 = 0;

82 
i
 = 0; i <ğ
Í_Ëv–
; i++)

83 if(
loİ_Ëv–_¬r
 [
i
] =ğ
NEXT_ITERATION
)

84 
út
 +ğ(1<<(
Í_Ëv–
 - 
i
));

85 
n
 = 0;

87 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

90 
bb
 = 
Í
 ->
tİo
[
i
];

93 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

95 if(
´št
è
	`´štf
("\nThi i  bb %d iÀ´oø%d\n", 
bb
->
bbid
, 
´oc
->
pid
);

97 if(
bb
->
is_loİh—d
 && 
i
!ğ
num_blk
 -1)

100 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
FIRST_ITERATION
;

102 if(
´št
)

103 
	`´štf
("\nThe firstime go into†oop\n");

104 
	`upd©eLoİ
(
msc
, 
šdex
, 
p
,…->
loİs
[
bb
->
loİid
]);

105 if(
´št
)

106 
	`´štf
("\nThe secondime go into†oop\n");

108 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
NEXT_ITERATION
;

109 
	`upd©eLoİ
(
msc
, 
šdex
, 
p
,…->
loİs
[
bb
->
loİid
]);

111 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
INVALID
;

116 
cu¼’t_chmc
 = 
bb
->
chmc_L2
[
út
];

121 
k
 = 0; k < 
msc
->
num_sk
; k++)

123 if(
k
 =ğ
šdex
||(
msc
->
š‹rãrInfo
[index][k] == 0)) ;

126 
j
 = 0; j < 
cu¼’t_chmc
->
h™
; j++)

128 if(
cu¼’t_chmc
->
h™_chªge_miss
[
j
] =ğ
HIT
)

130 
addr
 = 
cu¼’t_chmc
->
h™_addr
[
j
];

131 
£t_no
 = 
	`SET_L2
(
addr
);

132 
off£t
 = (
addr
 - 
bb
->
¡¬ddr
è/ 
INSN_SIZE
;

133 if(
msc
->
skLi¡
[
k
].
maš_cİy
->
h™_ÿche_£t_L2
[
£t_no
] =ğ
USED
)

138 if(
cu¼’t_chmc
->
age
[
j
] + 
num_cÚæiù
 >ğ
ÿche_L2
.
Ç
)

141 if(
off£t
 > 0)

142 
cu¼’t_chmc
->
h™miss_addr
[
off£t
] = 
UNKNOW
;

143 
cu¼’t_chmc
->
h™_chªge_miss
[
j
] = 
MISS
;

144 
cu¼’t_chmc
->
h™
--;

145 
cu¼’t_chmc
->
unknow
++;

147 
n
++;

148 
cu¼’t_chmc
->
wco¡
 +ğ(
IC_MISS_L2
 - 
IC_HIT_L2
);

159 if(
´št
)

164 
	`´štf
("\nL2:\nbb->sizğ%d, bb->¡¬dd¸ğ%d\n", 
bb
->
size
, bb->
¡¬ddr
);

165 
	`´štf
("num oàãtch = %d, h™ = %d, missğ%d, unknow = %d\n", 
cu¼’t_chmc
->
h™miss
, cu¼’t_chmc->
h™
, cu¼’t_chmc->
miss
, cu¼’t_chmc->
unknow
);

167 
	`´štf
("num oàãtch = %d, h™ = %d, missğ%d, unknow = %d\n", 
bb
->
chmc
[
út
]->
h™miss
, bb->chmc[út]->
h™
, bb->chmc[út]->
miss
, bb->chmc[út]->
unknow
);

169 
	`´štf
("\núˆğ%d, wco¡ = %d, bco¡ = %d\n", 
út
, 
cu¼’t_chmc
->
wco¡
, cu¼’t_chmc->
bco¡
);

171 if(
´št
)

172 
	`sÿnf
("%c", &
tmp
);

175 if(
´št
)

176 
	`´štf
("\nL2 Loİ: bb->wco¡ = %d\n", 
cu¼’t_chmc
->
wco¡
);

177 if(
´št
)

178 
	`´štf
("\nL2 Loİ: bb->bco¡ = %d\n", 
cu¼’t_chmc
->
bco¡
);

183 if(
bb
->
ÿÎpid
 !ğ-1è
	`upd©eFunùiÚC®l
(
msc
, 
šdex
, bb->
´oc_±r
);

190 
	}
}

194 
	$upd©eFunùiÚC®l
(
MSC
 *
msc
, 
šdex
, 
´oûdu»
* 
´oc
)

196 
i
, 
j
, 
k
, 
n
, 
£t_no
, 
út
, 
addr
, 
Í_Ëv–
, 
num_cÚæiù
;

197 
tmp
;

198 
´oûdu»
 *
p
 = 
´oc
;

199 
block
 *
bb
;

200 
CHMC
 * 
cu¼’t_chmc
;

201 
off£t
;

202 
num_blk
 = 
p
->
num_tİo
;

206 
i
 = 0; i < 
MAX_NEST_LOOP
; i++)

207 if(
loİ_Ëv–_¬r
[
i
] =ğ
INVALID
)

209 
Í_Ëv–
 = 
i
 -1;

213 
út
 = 0;

214 
i
 = 0; i <ğ
Í_Ëv–
; i++)

215 if(
loİ_Ëv–_¬r
 [
i
] =ğ
NEXT_ITERATION
)

216 
út
 +ğ(1<<(
Í_Ëv–
 - 
i
));

218 
n
 = 0;

220 
i
 = 
num_blk
 -1 ; i >= 0 ; i--)

223 
bb
 = 
p
 ->
tİo
[
i
];

226 
bb
 = 
p
->
bbli¡
[ bb->
bbid
 ];

228 if(
´št
è
	`´štf
("\nThi i  bb %d iÀ´oø%d\n", 
bb
->
bbid
, 
´oc
->
pid
);

232 if(
bb
->
is_loİh—d
)

235 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
FIRST_ITERATION
;

237 if(
´št
)

238 
	`´štf
("\nThe firstime go into†oop\n");

239 
	`upd©eLoİ
(
msc
, 
šdex
, 
p
,…->
loİs
[
bb
->
loİid
]);

240 if(
´št
)

241 
	`´štf
("\nThe secondime go into†oop\n");

243 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
NEXT_ITERATION
;

244 
	`upd©eLoİ
(
msc
, 
šdex
, 
p
,…->
loİs
[
bb
->
loİid
]);

246 
loİ_Ëv–_¬r
[
Í_Ëv–
 +1] = 
INVALID
;

251 
cu¼’t_chmc
 = 
bb
->
chmc_L2
[
út
];

254 
k
 = 0; k < 
msc
->
num_sk
; k++)

256 if(
k
 =ğ
šdex
||(
msc
->
š‹rãrInfo
[index][k] == 0)) ;

259 
j
 = 0; j < 
cu¼’t_chmc
->
h™
; j++)

261 if(
cu¼’t_chmc
->
h™_chªge_miss
[
j
] =ğ
HIT
)

263 
addr
 = 
cu¼’t_chmc
->
h™_addr
[
j
];

264 
£t_no
 = 
	`SET_L2
(
addr
);

265 
off£t
 = (
addr
 - 
bb
->
¡¬ddr
è/ 
INSN_SIZE
;

266 if(
msc
->
skLi¡
[
k
].
maš_cİy
->
h™_ÿche_£t_L2
[
£t_no
] =ğ
USED
)

271 if(
cu¼’t_chmc
->
age
[
j
] + 
num_cÚæiù
 >ğ
ÿche_L2
.
Ç
)

273 if(
off£t
 > 0)

274 
cu¼’t_chmc
->
h™miss_addr
[
off£t
] = 
UNKNOW
;

275 
cu¼’t_chmc
->
h™_chªge_miss
[
j
] = 
MISS
;

276 
cu¼’t_chmc
->
h™
--;

277 
cu¼’t_chmc
->
unknow
++;

279 
n
++;

280 
cu¼’t_chmc
->
wco¡
 +ğ(
IC_MISS_L2
 - 
IC_HIT_L2
);

292 if(
´št
)

297 
	`´štf
("\nL2:\nbb->sizğ%d, bb->¡¬dd¸ğ%d\n", 
bb
->
size
, bb->
¡¬ddr
);

298 
	`´štf
("num oàãtch = %d, h™ = %d, missğ%d, unknow = %d\n", 
cu¼’t_chmc
->
h™miss
, cu¼’t_chmc->
h™
, cu¼’t_chmc->
miss
, cu¼’t_chmc->
unknow
);

300 
	`´štf
("num oàãtch = %d, h™ = %d, missğ%d, unknow = %d\n", 
bb
->
chmc
[
út
]->
h™miss
, bb->chmc[út]->
h™
, bb->chmc[út]->
miss
, bb->chmc[út]->
unknow
);

302 
	`´štf
("\nwco¡ = %d, bco¡ = %d\n", 
cu¼’t_chmc
->
wco¡
, cu¼’t_chmc->
bco¡
);

304 if(
´št
)

305 
	`sÿnf
("%c", &
tmp
);

308 if(
´št
)

309 
	`´štf
("\nL2 funùiÚ: bb->wco¡ = %d\n", 
cu¼’t_chmc
->
wco¡
);

310 if(
´št
)

311 
	`´štf
("\nL2 funùiÚ: bb->bco¡ = %d\n", 
cu¼’t_chmc
->
bco¡
);

316 if(
bb
->
ÿÎpid
 != -1)

318 
	`upd©eFunùiÚC®l
(
msc
, 
šdex
, 
bb
->
´oc_±r
);

326 
	}
}

	@wcrt/alloc.c

1 
	~"şu¡”.c
"

2 
	~"£ËùcÚ‹Á.c
"

3 
	~"g¿phcŞÜšg.c
"

4 
	~"¦acks.c
"

11 
	$fœ¡AÎoc
() {

13 
i
, 
pidx
;

14 
ov”Ïy_t
 
ox
;

16 
ox
.
numOwÃrTasks
 = 1;

17 
ox
.
owÃrTaskLi¡
 = (*è
	`MALLOC
( ox.ownerTaskList, (), "ownerTaskList" );

19  
i
 = 0; i < 
numTasks
; i++ ) {

20 
pidx
 = 
	`fšdPE
Ğ
skLi¡
[
i
]->
³ID
 );

21 
ox
.
owÃrTaskLi¡
[0] = 
i
;

22 ifĞ
pidx
 !ğ-1 && 
¥mC­ac™y
[pidx] > 0 ) {

23 
	`doAÎoÿtiÚ
Ğ
NULL
, &
ox
, 
¥mC­ac™y
[
pidx
] );

27 
	`ä“
Ğ
ox
.
owÃrTaskLi¡
 );

30 
	}
}

33 
	$»£tAÎoÿtiÚ
Ğ
ch¬t_t
 *
msc
 ) {

35 
i
, 
k
, 
pidx
;

36 
ov”Ïy_t
 
ox
;

37 
time_t
 
wût
, 
bût
;

39 
ox
.
numOwÃrTasks
 = 1;

40 
ox
.
owÃrTaskLi¡
 = (*è
	`MALLOC
( ox.ownerTaskList, (), "ownerTaskList" );

42  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

43 
ix
 = 
msc
->
tİoLi¡
[
i
];

44 
sk_t
 *
tx
 = 
skLi¡
[
ix
];

46 
pidx
 = 
	`fšdPE
Ğ
tx
->
³ID
 );

47 
ox
.
owÃrTaskLi¡
[0] = 
ix
;

48 ifĞ
pidx
 !ğ-1 && 
¥mC­ac™y
[pidx] > 0 )

49 
	`doAÎoÿtiÚ
Ğ
msc
, &
ox
, 
¥mC­ac™y
[
pidx
] );

53 
tx
->
ùimeLo
 = 
bût
;

55  
k
 = 0; k < 
tx
->
numMemBlocks
; k++ )

56 
tx
->
®loÿ‹d
[
k
] = 0;

60 
tx
->
ùimeHi
 = 
wût
;

62 
	`ä“
Ğ
ox
.
owÃrTaskLi¡
 );

65 
	}
}

72 
	$upd©eAÎoÿtiÚGC
Ğ
sched_t
 *
sc
, 
ch¬t_t
 *
msc
, 
¥mC­ac™y
 ) {

74 
i
;

75 
chªged
;

78 
chªged
 = 
	`doClu¡”šg
Ğ
sc
, 
msc
 );

83  
i
 = 0; i < 
sc
->
¥m
->
numOv”Ïys
; i++ ) {

85 
ov”Ïy_t
 
ox
;

86 *
cŞÜAssg
;

87 
numCŞÜs
;

90 
numMemb”s
 = 
sc
->
¥m
->
ov”ÏyLi¡
[
i
]->
numOwÃrTasks
;

91 *
memb”Li¡
 = 
sc
->
¥m
->
ov”ÏyLi¡
[
i
]->
owÃrTaskLi¡
;

93 
	`´štf
Ğ"\nDØ®loÿtiÚ fÜ %d-th ov”Ïy (%dasks)\n", 
i
, 
numMemb”s
 ); 
	`fæush
Ğ
¡dout
 );

95 ifĞ
numMemb”s
 == 1 ) {

96 
ox
.
numOwÃrTasks
 = 1;

97 
ox
.
owÃrTaskLi¡
 = (*è
	`MALLOC
( ox.ownerTaskList, (), "ownerTaskList" );

98 
ox
.
owÃrTaskLi¡
[0] = 
memb”Li¡
[0];

99 
	`doAÎoÿtiÚ
Ğ
msc
, &
ox
, 
¥mC­ac™y
 );

100 
	`ä“
Ğ
ox
.
owÃrTaskLi¡
 );

105 
cŞÜAssg
 = (*è
	`MALLOC
ĞcŞÜAssg, 
numMemb”s
 * (), "colorAssg" );

106 
numCŞÜs
 = 
	`skCŞÜšg
Ğ
sc
->
¥m
->
ov”ÏyLi¡
[
i
], &
cŞÜAssg
 );

109 
	`cŞÜAÎoÿtiÚ
Ğ
msc
, 
sc
->
¥m
->
ov”ÏyLi¡
[
i
], 
cŞÜAssg
, 
numCŞÜs
, 
¥mC­ac™y
 );

110 
	`ä“
Ğ
cŞÜAssg
 );

113 
	}
}

119 
	$upd©eAÎoÿtiÚIC
Ğ
sched_t
 *
sc
, 
ch¬t_t
 *
msc
, 
¥mC­ac™y
 ) {

121 
i
;

122 
chªged
;

125 
chªged
 = 
	`doClu¡”šg
Ğ
sc
, 
msc
 );

130 
	`´štf
Ğ"\nDØ®loÿtiÚ\n" ); 
	`fæush
Ğ
¡dout
 );

131  
i
 = 0; i < 
sc
->
¥m
->
numOv”Ïys
; i++ )

132 
	`doAÎoÿtiÚ
Ğ
msc
, 
sc
->
¥m
->
ov”ÏyLi¡
[
i
], 
¥mC­ac™y
 );

135 
	}
}

141 
	$upd©eAÎoÿtiÚPK
Ğ
sched_t
 *
sc
, 
ch¬t_t
 *
msc
, 
¥mC­ac™y
 ) {

143 
i
;

144 
ov”Ïy_t
 *
ox
 = (ov”Ïy_t*è
	`MALLOC
( ox, (overlay_t), "ox" );

147 
ox
->
numOwÃrTasks
 = 
sc
->
numAssigÃd
;

148 
ox
->
owÃrTaskLi¡
 = (*è
	`MALLOC
Ğox->owÃrTaskLi¡, ox->
numOwÃrTasks
 * (), "ownerTaskList" );

149  
i
 = 0; i < 
sc
->
numAssigÃd
; i++ )

150 
ox
->
owÃrTaskLi¡
[
i
] = 
sc
->
assigÃdLi¡
[i];

152 
	`doAÎoÿtiÚ
Ğ
msc
, 
ox
, 
¥mC­ac™y
 );

155 
sc
->
¥m
->
numOv”Ïys
 = 1;

156 
sc
->
¥m
->
ov”ÏyLi¡
 = (
ov”Ïy_t
**è
	`MALLOC
( sc->spm->overlayList, (overlay_t*), "overlayList" );

157 
sc
->
¥m
->
ov”ÏyLi¡
[0] = 
ox
;

160 
	}
}

163 
	$upd©eAÎoÿtiÚ
Ğ
³ID
, 
ch¬t_t
 *
msc
 ) {

165 
sched_t
 *
sc
 = 
msc
->
PELi¡
[
³ID
];

167 
i
;

168 
chªged
;

170 
t
;

172 ifĞ
sc
->
numAssigÃd
 == 0 )

174 ifĞ
¥mC­ac™y
[
³ID
] <ğ0 || 
sc
->
¥m
 =ğ
NULL
 )

177 
	`´štf
Ğ"\nS¹‡ÎoÿtiÚ fÜ PE %d\n\n", 
³ID
 ); 
	`fæush
Ğ
¡dout
 );

179  
®locm‘hod
 ) {

180 1: 
STARTTIME
; 
	`upd©eAÎoÿtiÚPK
Ğ
sc
, 
msc
, 
¥mC­ac™y
[
³ID
] ); 
STOPTIME
; ;

181 2: 
STARTTIME
; 
	`upd©eAÎoÿtiÚIC
Ğ
sc
, 
msc
, 
¥mC­ac™y
[
³ID
] ); 
STOPTIME
; ;

183 4: 
STARTTIME
; 
	`upd©eAÎoÿtiÚGC
Ğ
sc
, 
msc
, 
¥mC­ac™y
[
³ID
] ); 
STOPTIME
; ;

188 
	`´štf
Ğ"\nUpd©ruÁimes\n" ); 
	`fæush
Ğ
¡dout
 );

190 
chªged
 = 0;

191  
i
 = 0; i < 
sc
->
numAssigÃd
; i++ ) {

193 
time_t
 
wût
, 
bût
;

194 
sk_t
 *
tc
 = 
skLi¡
[
sc
->
assigÃdLi¡
[
i
]];

198 
	`´štf
Ğ"%s\t%8Lu\t%8Lu\n", 
tc
->
Šame
, 
bût
, 
wût
 );

199 ifĞ
tc
->
ùimeHi
 !ğ
wût
 ) {

200 ifĞ
tc
->
ùimeHi
 < 
wût
 )

201 
	`´štf
Ğ">>>> D‘”iÜ©iÚ d‘eùed: % ùimeH˜%Lu --> %Lu\n", 
tc
->
Šame
,c->
ùimeHi
, 
wût
 );

202 
tc
->
ùimeHi
 = 
wût
;

203 
chªged
 = 1;

205 ifĞ
tc
->
ùimeLo
 !ğ
bût
 ) {

206 ifĞ
tc
->
ùimeLo
 < 
bût
 )

207 
	`´štf
Ğ">>>> D‘”iÜ©iÚ d‘eùed: % ùimeLØ%Lu --> %Lu\n", 
tc
->
Šame
,c->
ùimeLo
, 
bût
 );

208 
tc
->
ùimeLo
 = 
bût
;

209 
chªged
 = 1;

212  
chªged
;

213 
	}
}

216 
	$š™AÎoc
Ğ
ch¬t_t
 *
msc
 ) {

218 
i
, 
j
;

219  
i
 = 0; i < 
numPEs
; i++ ) {

220 
sched_t
 *
sc
 = 
msc
->
PELi¡
[
i
];

221 ifĞ
¥mC­ac™y
[
i
] > 0 ) {

222 
sc
->
¥m
 = (
®loc_t
*è
	`MALLOC
( sc->spm, (alloc_t), "spm" );

223 
sc
->
¥m
->
numOv”Ïys
 = 0;

224 
sc
->
¥m
->
ov”ÏyLi¡
 = 
NULL
;

227  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

228 
sk_t
 *
tc
 = 
skLi¡
[
msc
->
tİoLi¡
[
i
]];

229  
j
 = 0; j < 
tc
->
numMemBlocks
; j++ )

230 
tc
->
®loÿ‹d
[
j
] = 0;

233 
	}
}

236 
	$timšgAÎocMSC
Ğ
ch¬t_t
 *
msc
 ) {

238 
i
, 
¡•
;

239 
tmChªged
, 
®locChªged
;

240 
time_t
 
wüt
, 
Ï¡wüt
;

246 
	`š™AÎoc
Ğ
msc
 );

250 
tmChªged
 = 
	`doTimšg
Ğ
msc
, 0 );

251 }  
tmChªged
 );

253 
	`´štf
( "\nInitial‡nalysis\n" );

254 
wüt
 = 
	`compu‹WCRT
Ğ
msc
 );

255 
msc
->
wüt
 = wcrt;

257 
	`fšdCr™iÿlP©h
Ğ
msc
 );

259 
¡•
 = 0;

266 
¡•
++;

267 
Ï¡wüt
 = 
wüt
;

295 
®locChªged
 = 0;

296  
i
 = 0; i < 
numPEs
; i++ )

297 
®locChªged
 |ğ
	`upd©eAÎoÿtiÚ
Ğ
i
, 
msc
 );

302 
tmChªged
 = 
	`doTimšg
Ğ
msc
, 1 );

303 }  
tmChªged
 );

305 
	`´štf
Ğ"\nAá”‡Çlysi round %d\n", 
¡•
 );

306 
wüt
 = 
	`compu‹WCRT
Ğ
msc
 );

308 ifĞ
wüt
 > 
Ï¡wüt
 ) {

309 
	`´štf
Ğ"Deü—sšg…”fÜmªû: %Lu --„Şlšg backØ´eviou decisiÚ.\n", 
wüt
 );

310 
wüt
 = 
Ï¡wüt
;

314 
msc
->
wüt
 = wcrt;

315 
	`fšdCr™iÿlP©h
Ğ
msc
 );

329 }  (
wüt
 !ğ
Ï¡wüt
 || 
®locChªged
è&& 
¡•
 < 
MAXSTEP
 );

331 ifĞ
¡•
 =ğ
MAXSTEP
 )

332 
	`´štf
( "\n\nIteration†imit„eached.\n" );

334 
	`´štf
Ğ"\n\nNØmÜim´ovem’t, stİpšg‡ˆ¡• %d\n", 
¡•
 );

335 
	`´štf
Ğ"Fš®‡µliÿtiÚ WCRT: %Lu\n\n", 
wüt
 );

337 
msc
->
wüt
 = wcrt;

340 
	}
}

343 
	$timšgAÎocMSC_¦ackCr™iÿl
Ğ
ch¬t_t
 *
msc
 ) {

345 
i
, 
¡•
;

346 
tmChªged
, 
®locChªged
;

347 
time_t
 
wüt
, 
Ï¡wüt
;

353 
	`š™AÎoc
Ğ
msc
 );

357 
tmChªged
 = 
	`doTimšg
Ğ
msc
, 0 );

358 }  
tmChªged
 );

360 
	`´štf
( "\nInitial‡nalysis\n" );

361 
wüt
 = 
	`compu‹WCRT
Ğ
msc
 );

362 
msc
->
wüt
 = wcrt;

364 
	`fšdCr™iÿlP©h
Ğ
msc
 );

366 
¡•
 = 0;

373 
¡•
++;

374 
Ï¡wüt
 = 
wüt
;

377 
	`š£¹SÏcks
Ğ
msc
 );

396 
®locChªged
 = 0;

397  
i
 = 0; i < 
numPEs
; i++ )

398 
®locChªged
 |ğ
	`upd©eAÎoÿtiÚ
Ğ
i
, 
msc
 );

402 
tmChªged
 = 
	`doTimšg
Ğ
msc
, 1 );

403 }  
tmChªged
 );

405 
	`´štf
Ğ"\nAá”‡Çlysi round %d\n", 
¡•
 );

406 
wüt
 = 
	`compu‹WCRT
Ğ
msc
 );

408 ifĞ
wüt
 > 
Ï¡wüt
 ) {

409 
	`´štf
Ğ"Deü—sšg…”fÜmªû: %Lu --„Şlšg backØ´eviou decisiÚ.\n", 
wüt
 );

410 
wüt
 = 
Ï¡wüt
;

414 
msc
->
wüt
 = wcrt;

415 
	`fšdCr™iÿlP©h
Ğ
msc
 );

429 }  (
wüt
 !ğ
Ï¡wüt
 || 
®locChªged
è&& 
¡•
 < 
MAXSTEP
 );

431 ifĞ
¡•
 =ğ
MAXSTEP
 )

432 
	`´štf
( "\n\nIteration†imit„eached.\n" );

434 
	`´štf
Ğ"\n\nNØmÜim´ovem’t, stİpšg‡ˆ¡• %d\n", 
¡•
 );

435 
	`´štf
Ğ"Fš®‡µliÿtiÚ WCRT: %Lu\n\n", 
wüt
 );

437 
msc
->
wüt
 = wcrt;

440 
	}
}

	@wcrt/analysis.c

1 
	$addF»q
Ğ
sk_t
 *
tc
, 
âid
, 
bbid
, 
äeq
 ) {

3 
i
;

4  
i
 = 0; i < 
tc
->
numMemBlocks
; i++ ) {

5 
mem_t
 *
mt
 = 
tc
->
memBlockLi¡
[
i
];

6 ifĞ
mt
->
âid
 =ğâid && mt->
bbid
 == bbid ) {

7 
mt
->
äeq
 += freq;

8  
i
;

11 
	`´štf
Ğ"W¬nšg: block %d-%d‚Ù found.\n", 
âid
, 
bbid
 );

13 
	}
}

16 
	$g‘NumF‘ch
Ğ
size
 ) {

18 
n
 = 
size
 / 
FETCH_SIZE
;

19 ifĞ
size
 % 
FETCH_SIZE
 == 0 )

20  
n
;

21  
n
+1;

22 
	}
}

25 
	$»adCo¡
() {

27 
FILE
 *
åŒ
;

28 
f•©h
[512];

29 
i
, 
j
;

64 
i
 = 0; i < 
numCh¬ts
; i++)

66 
	`¥rštf
(
f•©h
, "š‹rã»/msc%d_wûtbût_%s", 
i
+1, 
times_™”©iÚ
);

67 
åŒ
 = 
	`İ’fe
Ğ
f•©h
, "r" );

69 
j
 = 0; j < 
msg
[
i
].
tİoLi¡L’
; j++)

71 
	`fsÿnf
(
åŒ
, "%Lu %Lu \n", &(
skLi¡
[
msg
[
i
].
tİoLi¡
[
j
]]->
ùimeHi
), &ÑaskLi¡[msg[i].tİoLi¡[j]]->
ùimeLo
));

76 
	`fşo£
Ğ
åŒ
 );

118 
	}
}

	@wcrt/cluster.c

4 
	$doClu¡”šg
Ğ
sched_t
 *
sc
, 
ch¬t_t
 *
msc
 ) {

6 
chªged
 = 0;

8 
i
, 
k
, 
m
, 
x
;

9 
idx
, 
groupid
;

10 
upd©ed
;

14 
numOv”Ïys
;

15 *
numOwÃrTasks
 = 
NULL
;

16 **
owÃrTaskLi¡
 = 
NULL
;

17 
time_t
 *
tmS¹Li¡
 = 
NULL
;

18 
time_t
 *
tmEndLi¡
 = 
NULL
;

22 
idx
 = 
sc
->
assigÃdLi¡
[0];

24 
numOv”Ïys
 = 1;

25 
numOwÃrTasks
 = (*è
	`REALLOC
(‚umOwnerTasks, (), "numOwnerTasks" );

26 
owÃrTaskLi¡
 = (**è
	`REALLOC
( ownerTaskList, (*), "ownerTaskList" );

27 
tmS¹Li¡
 = (
time_t
*è
	`REALLOC
(mStartList, (time_t), "tmStartList" );

28 
tmEndLi¡
 = (
time_t
*è
	`REALLOC
(mEndList, (time_t), "tmEndList" );

30 
numOwÃrTasks
[0] = 1;

31 
owÃrTaskLi¡
[0] = (*è
	`MALLOC
( ownerTaskList[0], (), "ownerTaskList[0]" );

32 
owÃrTaskLi¡
[0][0] = 
idx
;

33 
tmS¹Li¡
[0] = 
Ï‹¡Req
[
idx
];

34 
tmEndLi¡
[0] = 
Ï‹¡Fš
[
idx
];

37  
i
 = 1; i < 
sc
->
numAssigÃd
; i++ ) {

38 
idx
 = 
sc
->
assigÃdLi¡
[
i
];

41 
groupid
 = -1;

42  
k
 = 0; 
groupid
 =ğ-1 && k < 
numOv”Ïys
; k++ ) {

43 ifĞ
numOwÃrTasks
[
k
] <= 0 );

44 ifĞ
Ï‹¡Req
[
idx
] >ğ
tmEndLi¡
[
k
] );

45 ifĞ
Ï‹¡Fš
[
idx
] <ğ
tmS¹Li¡
[
k
] );

47 
groupid
 = 
k
;

49 ifĞ
groupid
 == -1 ) {

52 
groupid
 = 
numOv”Ïys
;

53 
numOv”Ïys
++;

55 
numOwÃrTasks
 = (*è
	`REALLOC
ĞnumOwÃrTasks, 
numOv”Ïys
 * (), "numOwnerTasks" );

56 
owÃrTaskLi¡
 = (**è
	`REALLOC
ĞowÃrTaskLi¡, 
numOv”Ïys
 * (*), "ownerTaskList" );

57 
tmS¹Li¡
 = (
time_t
*è
	`REALLOC
ĞtmS¹Li¡, 
numOv”Ïys
 * (time_t), "tmStartList" );

58 
tmEndLi¡
 = (
time_t
*è
	`REALLOC
ĞtmEndLi¡, 
numOv”Ïys
 * (time_t), "tmEndList" );

60 
numOwÃrTasks
[
groupid
] = 1;

61 
owÃrTaskLi¡
[
groupid
] = (*è
	`MALLOC
( ownerTaskList[groupid], (), "ownerTaskList[.]" );

62 
owÃrTaskLi¡
[
groupid
][0] = 
idx
;

63 
tmS¹Li¡
[
groupid
] = 
Ï‹¡Req
[
idx
];

64 
tmEndLi¡
 [
groupid
] = 
Ï‹¡Fš
[
idx
];

70 
ex‹nded
 = 0;

76 
	`’queue
Ğ
idx
, &(
owÃrTaskLi¡
[
groupid
]), &(
numOwÃrTasks
[groupid]) );

79 ifĞ
tmS¹Li¡
[
groupid
] > 
Ï‹¡Req
[
idx
] ) {

80 
tmS¹Li¡
[
groupid
] = 
Ï‹¡Req
[
idx
];

81 
ex‹nded
 = 1;

83 ifĞ
tmEndLi¡
[
groupid
] < 
Ï‹¡Fš
[
idx
] ) {

84 
tmEndLi¡
[
groupid
] = 
Ï‹¡Fš
[
idx
];

85 
ex‹nded
 = 1;

87 ifĞ!
ex‹nded
 )

93 
upd©ed
 = 1;

94  
upd©ed
 ) {

95 
upd©ed
 = 0;

96  
k
 = 0; k < 
numOv”Ïys
; k++ ) {

97 ifĞ
k
 =ğ
groupid
 || 
numOwÃrTasks
[k] <= 0 )

99 ifĞ
tmS¹Li¡
[
groupid
] >ğ
tmEndLi¡
[
k
] )

101 ifĞ
tmEndLi¡
[
groupid
] <ğ
tmS¹Li¡
[
k
] )

105  
m
 = 0; m < 
numOwÃrTasks
[
k
]; m++ )

106 
	`’queue
Ğ
owÃrTaskLi¡
[
k
][
m
], &(owÃrTaskLi¡[
groupid
]), &(
numOwÃrTasks
[groupid]) );

112 
ex‹nded
 = 0;

113 ifĞ
tmS¹Li¡
[
groupid
] >mS¹Li¡[
k
] ) {

114 
tmS¹Li¡
[
groupid
] =mS¹Li¡[
k
];

115 
ex‹nded
 = 1;

117 ifĞ
tmEndLi¡
[
groupid
] <mEndLi¡[
k
] ) {

118 
tmEndLi¡
[
groupid
] =mEndLi¡[
k
];

119 
ex‹nded
 = 1;

124 
	`ä“
Ğ
owÃrTaskLi¡
[
k
] );

125 
owÃrTaskLi¡
[
k
] = 
NULL
;

126 
numOwÃrTasks
[
k
] = 0;

127 
tmS¹Li¡
[
k
] = 0;

128 
tmEndLi¡
 [
k
] = 0;

130 
upd©ed
 = 1;

136 
upd©ed
 = 1;

137  
upd©ed
 ) {

138 
upd©ed
 = 0;

139  
k
 = 0; k < 
numOwÃrTasks
[
groupid
]-1; k++ ) {

140 ifĞ
owÃrTaskLi¡
[
groupid
][
k
] > ownerTaskList[groupid][k+1] ) {

141 
tmp
 = 
owÃrTaskLi¡
[
groupid
][
k
];

142 
owÃrTaskLi¡
[
groupid
][
k
] = ownerTaskList[groupid][k+1];

143 
owÃrTaskLi¡
[
groupid
][
k
+1] = 
tmp
;

144 
upd©ed
 = 1;

151 
upd©ed
 = 1;

152  
upd©ed
 ) {

153 
upd©ed
 = 0;

154  
i
 = 0; i < 
numOv”Ïys
-1; i++ ) {

155 ifĞ
tmS¹Li¡
[
i
] <mStartList[i+1] ) {

156 
tmpNum
 = 
numOwÃrTasks
[
i
];

157 *
tmpPŒ
 = 
owÃrTaskLi¡
[
i
];

158 
time_t
 
tmpS¹
 = 
tmS¹Li¡
[
i
];

159 
time_t
 
tmpEnd
 = 
tmEndLi¡
 [
i
];

162 
numOwÃrTasks
[
i
] =‚umOwnerTasks[i+1];

163 
owÃrTaskLi¡
[
i
] = ownerTaskList[i+1];

164 
tmS¹Li¡
[
i
] =mStartList[i+1];

165 
tmEndLi¡
 [
i
] =mEndList [i+1];

167 
numOwÃrTasks
[
i
+1] = 
tmpNum
;

168 
owÃrTaskLi¡
[
i
+1] = 
tmpPŒ
;

169 
tmS¹Li¡
[
i
+1] = 
tmpS¹
;

170 
tmEndLi¡
 [
i
+1] = 
tmpEnd
;

172 
upd©ed
 = 1;

177 
k
 = 
numOv”Ïys
 - 1;

178  
k
 >ğ0 && 
numOwÃrTasks
[k] <= 0 ) {

179 
numOv”Ïys
--;

180 
k
--;

183  
x
 = 0; x < 
numOv”Ïys
; x++ ) {

184 
	`´štf
Ğ"group%d: [%8Lu, %8Lu):\n", 
x
, 
tmS¹Li¡
[x], 
tmEndLi¡
[x] );

185  
k
 = 0; k < 
numOwÃrTasks
[
x
]; k++ ) {

188 
	`´štf
Ğ"------------------------------ %s\n", 
	`g‘TaskName
Ğ
owÃrTaskLi¡
[
x
][
k
] ));

190 
	`´štf
( "\n" );

194 ifĞ
numOv”Ïys
 !ğ
sc
->
¥m
->numOverlays )

195 
chªged
 = 1;

197  
i
 = 0; !
chªged
 && i < 
numOv”Ïys
; i++ ) {

198 ifĞ
numOwÃrTasks
[
i
] !ğ
sc
->
¥m
->
ov”ÏyLi¡
[i]->numOwnerTasks )

199 
chªged
 = 1;

200  
k
 = 0; !
chªged
 && k < 
numOwÃrTasks
[
i
]; k++ ) {

201 ifĞ
owÃrTaskLi¡
[
i
][
k
] !ğ
sc
->
¥m
->
ov”ÏyLi¡
[i]->ownerTaskList[k] )

202 
chªged
 = 1;

205 ifĞ!
chªged
 )

209 
	`ä“AÎoc
Ğ
sc
->
¥m
 );

210 
sc
->
¥m
->
numOv”Ïys
 =‚umOverlays;

211 
sc
->
¥m
->
ov”ÏyLi¡
 = (
ov”Ïy_t
**è
	`MALLOC
Ğsc->¥m->ov”ÏyLi¡, 
numOv”Ïys
 * (overlay_t*), "overlayList" );

212  
i
 = 0; i < 
numOv”Ïys
; i++ ) {

213 
ov”Ïy_t
 *
ox
;

214 
sc
->
¥m
->
ov”ÏyLi¡
[
i
] = (
ov”Ïy_t
*è
	`MALLOC
Ğsc->¥m->ov”ÏyLi¡[i], 
numOv”Ïys
 * (overlay_t), "overlayList[i]" );

215 
ox
 = 
sc
->
¥m
->
ov”ÏyLi¡
[
i
];

217 
ox
->
tmS¹
 = 
tmS¹Li¡
[
i
];

218 
ox
->
tmEnd
 = 
tmEndLi¡
[
i
];

219 
ox
->
numOwÃrTasks
 =‚umOwÃrTasks[
i
];

220 
ox
->
owÃrTaskLi¡
 = (*è
	`MALLOC
Ğox->owÃrTaskLi¡, ox->
numOwÃrTasks
 * (), "ox->ownerTaskList" );

221  
k
 = 0; k < 
ox
->
numOwÃrTasks
; k++ )

222 
ox
->
owÃrTaskLi¡
[
k
] = owÃrTaskLi¡[
i
][k];

234 
	`ä“
Ğ
owÃrTaskLi¡
[
i
] );

236 
	`ä“
Ğ
owÃrTaskLi¡
 );

237 
	`ä“
Ğ
numOwÃrTasks
 );

238 
	`ä“
Ğ
tmS¹Li¡
 );

239 
	`ä“
Ğ
tmEndLi¡
 );

241  
chªged
;

242 
	}
}

	@wcrt/cycle_time.c

2 
	$acûss_couÁ”
(*
hi
, *
lo
)

5 
	`asm
("rdtsc; movl %%edx,%0; movl %%eax,%1"

6 : "ô" (*
hi
), "ô" (*
lo
)

9 
	}
}

14 
	$cyşe_time
(
¡¬t_’d
)

17 
lo1
, 
hi1
, 
lo2
, 
hi2
;

18 
ulo
, 
uhi
, 
bÜrow
;

19 
t
;

21 ià(
¡¬t_’d
 == 0) {

22 
	`acûss_couÁ”
(&
hi1
, &
lo1
);

26 
	`acûss_couÁ”
(&
hi2
, &
lo2
);

27 
ulo
 = 
lo2
 - 
lo1
;

28 
bÜrow
 = 
ulo
 > 
lo2
;

29 
uhi
 = 
hi2
 - 
hi1
 - 
bÜrow
;

30 
t
 = (è
uhi
 * (1 << 30è* 4 + 
ulo
;

31  
t
;

33 
	}
}

	@wcrt/cycle_time.h

1 #iâdeà
CYCLE_TIME_H


2 
	#CYCLE_TIME_H


	)

10 
cyşe_time
(
¡¬t_’d
);

	@wcrt/dp.c

1 
	~<¡dio.h
>

3 
g‘v®
Ğ
row
, 
cŞ
 );

9 
	$dpmš
Ğ
N
, 
S
, **
v®
 ) {

11 
i
, 
w
, 
k
, 
»m
;

12 **
dec
;

14 **
mš
;

15 
Ãw
;

17 
mš
 = (**è
	`m®loc
Ğ(
N
+1) * () );

18 
dec
 = (**è
	`m®loc
Ğ(
N
+1) * () );

19  
i
 = 0; i <ğ
N
; i++ ) {

20 
mš
[
i
] = (*è
	`m®loc
Ğ(
S
+1) * () );

21 
dec
[
i
] = (*è
	`m®loc
Ğ(
S
+1) * () );

25  
w
 = 0; w <ğ
S
; w++ )

26 
mš
[0][
w
] = 0;

29  
i
 = 1; i <ğ
N
; i++ ) {

30  
w
 = 0; w <ğ
S
; w++ ) {

32 
dec
[
i
][
w
] = -1;

34  
k
 = 0; k <ğ
w
; k++ ) {

35 ifĞ
v®
[
i
-1][
k
] =ğ-1 || 
mš
[i-1][
w
-k] == -1 )

41 
Ãw
 = 
v®
[
i
-1][
k
] + 
mš
[i-1][
w
-k];

43 ifĞ
dec
[
i
][
w
] =ğ-1 || 
mš
[i][w] >ğ
Ãw
 ) {

44 
mš
[
i
][
w
] = 
Ãw
;

45 
dec
[
i
][
w
] = 
k
;

48 ifĞ
dec
[
i
][
w
] == -1 )

49 
mš
[
i
][
w
] = -1;

53 
	`´štf
Ğ"O±im® v®ue: %f\n", 
mš
[
N
][
S
] );

56 
»m
 = 
S
;

57  
i
 = 
N
; i > 0; i-- ) {

62 
£gsh¬e
[
i
-1] = 
dec
[i][
»m
];

63 
»m
 -ğ
dec
[
i
][rem];

65 
	`´štf
( "\n" );

68  
i
 = 0; i <ğ
N
; i++ ) {

69 
	`ä“
Ğ
mš
[
i
] );

70 
	`ä“
Ğ
dec
[
i
] );

72 
	`ä“
Ğ
mš
 );

73 
	`ä“
Ğ
dec
 );

76 
	}
}

	@wcrt/dump.c

1 
	~<¡dio.h
>

2 
	~<¡ršg.h
>

5 * 
	$exŒaùTaskName
Ğ*
fuÎÇme
 ) {

7 *
c
 = 
	`¡¼chr
Ğ
fuÎÇme
, '/' );

8 ifĞ
c
 !ğ
NULL
 )

9  
c
 + 1;

10  
fuÎÇme
;

11 
	}
}

17 * 
	$g‘TaskName
Ğ
pidx
 ) {

19  
	`exŒaùTaskName
Ğ
skLi¡
[
pidx
]->
Šame
 );

20 
	}
}

46 
	$´štTask
Ğ
pidx
 ) {

48 
k
;

49 
sk_t
 *
tc
 = 
skLi¡
[
pidx
];

51 
	`´štf
( "%s\t Actor:%d PE:%d Priority:%d Period:%Lu",

52 
	`g‘TaskName
(
pidx
), 
tc
->
aùÜID
,c->
³ID
,c->
´iÜ™y
,c->
³riod
 );

54 ifĞ
tc
->
ùimeLo
 > 0 ||c->
ùimeHi
 > 0 )

55 
	`´štf
Ğ" Time:[%6Lu,%6Lu)", 
tc
->
ùimeLo
,c->
ùimeHi
 );

57 
	`´štf
Ğ" <--(" ); 
	`fæush
Ğ
¡dout
 );

58  
k
 = 0; k < 
tc
->
numP»ds
; k++ )

59 
	`´štf
Ğ" %s", 
	`g‘TaskName
Ğ
tc
->
´edLi¡
[
k
] ));

61 
	`´štf
Ğ" ) -->(" ); 
	`fæush
Ğ
¡dout
 );

62  
k
 = 0; k < 
tc
->
numSuccs
; k++ )

63 
	`´štf
Ğ" %s", 
	`g‘TaskName
Ğ
tc
->
succLi¡
[
k
] ));

65 
	`´štf
( " )\n" );

68 
	}
}

71 
	$´štPE
Ğ
³ID
, 
¥mC­ac™y
, 
sched_t
 *
sc
 ) {

73 
k
;

75 
	`´štf
Ğ"PE %d (%d by‹ SPM):\n", 
³ID
, 
¥mC­ac™y
 );

76  
k
 = 0; k < 
sc
->
numAssigÃd
; k++ )

77 
	`´štf
Ğ"- %s\n", 
	`g‘TaskName
Ğ
sc
->
assigÃdLi¡
[
k
] ));

78 
	`´štf
( "\n" );

81 
	}
}

84 
	$´štTaskLi¡
Ğ
ch¬t_t
 *
msc
 ) {

86 
i
;

87  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ )

88 
	`´štf
Ğ"- %s\n", 
	`g‘TaskName
Ğ
msc
->
tİoLi¡
[
i
] ));

89 
	`´štf
( "\n" );

92 
	}
}

95 
	$dumpTaskInfo
() {

97 
i
, 
k
;

99 
	`´štf
( "=======================\n" );

100 
	`´štf
Ğ"%dask š†i¡\n", 
numTasks
 );

101 
	`´štf
( "=======================\n" );

103  
i
 = 0; i < 
numTasks
; i++ )

104 
	`´štTask
Ğ
i
 );

106 
	`´štf
( "\nMSG inopological order:\n" );

107  
k
 = 0; k < 
numCh¬ts
; k++ ) {

108 
id
 = 
tİoMSG
[
k
];

110 
	`´štf
Ğ"Ch¬ˆ%d -->(", 
id
 );

111  
i
 = 0; i < 
msg
[
id
].
numSuccs
; i++ )

112 
	`´štf
Ğ" %d", 
msg
[
id
].
succLi¡
[
i
] );

113 
	`´štf
( " ):\n" );

115 
	`´štTaskLi¡
Ğ&(
msg
[
id
]) );

117  
i
 = 0; i < 
numPEs
; i++ )

118 
	`´štPE
Ğ
³ID
[
i
], 
¥mC­ac™y
[i], 
msg
[
id
].
PELi¡
[i] );

119 
	`´štf
( "\n" );

121 
	`´štf
( "\n" );

124 
	}
}

127 
	$´štTask_d•
Ğ
pidx
 ) {

129 
k
;

130 
sk_t
 *
tc
 = 
skLi¡
[
pidx
];

132 
	`´štf
Ğ"[%d]%s\ˆ", 
pidx
, 
	`g‘TaskName
(pidx) );

134 
	`´štf
Ğ" <--(" ); 
	`fæush
Ğ
¡dout
 );

135  
k
 = 0; k < 
tc
->
numP»ds
; k++ )

136 
	`´štf
Ğ" [%d]%s", 
tc
->
´edLi¡
[
k
], 
	`g‘TaskName
(tc->predList[k]) );

138 
	`´štf
Ğ" ) -->(" ); 
	`fæush
Ğ
¡dout
 );

139  
k
 = 0; k < 
tc
->
numSuccs
; k++ )

140 
	`´štf
Ğ" [%d]%s", 
tc
->
succLi¡
[
k
], 
	`g‘TaskName
(tc->succList[k]) );

142 
	`´štf
( " )\n" );

144 
	}
}

146 
	$dumpTaskInfo_d•
() {

148 
i
;

150 
	`´štf
( "\n=======================\n" );

151 
	`´štf
Ğ"%dask š†i¡\n", 
numTasks
 );

152 
	`´štf
( "=======================\n" );

154  
i
 = 0; i < 
numTasks
; i++ )

155 
	`´štTask_d•
Ğ
i
 );

156 
	`´štf
( "\n" );

159 
	}
}

162 
	$´štTimes
Ğ
idx
 ) {

165 
	`´štf
Ğ"%s\ˆReq[%Lu,%Luè Fš[%Lu,%Lu)\n", 
	`g‘TaskName
(
idx
),

166 
—¾›¡Req
[
idx
], 
Ï‹¡Req
[idx], 
—¾›¡Fš
[idx], 
Ï‹¡Fš
[idx] );

178 
	}
}

181 
	$´štMem
Ğ
pidx
, 
v”bo£
 ) {

183 
i
, 
sum
 = 0;

184 
sk_t
 *
tc
 = 
skLi¡
[
pidx
];

186 
	`´štf
Ğ"%s", 
	`g‘TaskName
(
pidx
) );

187 ifĞ
v”bo£
 )

188 
	`´štf
( "\n" );

189  
i
 = 0; i < 
tc
->
numMemBlocks
; i++ ) {

190 
mem_t
 *
mt
 = 
tc
->
memBlockLi¡
[
i
];

191 
sum
 +ğ
mt
->
size
;

192 ifĞ
v”bo£
 )

193 
	`´štf
Ğ"[%d][%d] %x %d %d (%d)\n", 
mt
->
âid
, mt->
bbid
, mt->
addr
, mt->
size
, mt->
äeq
, 
tc
->
®loÿ‹d
[
i
] );

195 
	`´štf
Ğ":\t%5d by‹s\n", 
sum
 );

198 
	}
}

	@wcrt/graphcoloring.c

5 
	$g¿phCŞÜšg
Ğ
numNodes
, *
outdeg»e
, **
ou‹dges
, **
cŞÜAssg
 ) {

7 
numCŞÜs
;

8 *
sÜ‹dIndex
;

10 
i
, 
j
;

11 
chªged
;

13 
cŞÜ
;

14 
numCŞÜed
;

17 
sÜ‹dIndex
 = (*è
	`MALLOC
ĞsÜ‹dIndex, 
numNodes
 * (), "sortedIndex" );

18  
i
 = 0; i < 
numNodes
; i++ )

19 
sÜ‹dIndex
[
i
] = i;

21 
chªged
 = 1;

22  
chªged
 ) {

23 
chªged
 = 0;

25  
i
 = 1; i < 
numNodes
; i++ ) {

26 ifĞ
outdeg»e
[
sÜ‹dIndex
[
i
]] > outdegree[sortedIndex[i-1]] ) {

27 
‹mp
;

28 
chªged
 = 1;

29 
‹mp
 = 
sÜ‹dIndex
[
i
-1];

30 
sÜ‹dIndex
[
i
-1] = sortedIndex[i];

31 
sÜ‹dIndex
[
i
] = 
‹mp
;

36  
i
 = 0; i < 
numNodes
; i++ )

37 (*
cŞÜAssg
)[
i
] = -1;

40 
numCŞÜed
 = 0;

41  
cŞÜ
 = 0; 
numCŞÜed
 < 
numNodes
; color++ ) {

44  
i
 = 0; i < 
numNodes
; i++ ) {

45 
id
 = 
sÜ‹dIndex
[
i
];

46 
found
 = 0;

49 ifĞ(*
cŞÜAssg
)[
id
] != -1 )

53  
j
 = 0; !
found
 && j < 
outdeg»e
[
id
]; j++ )

54 ifĞ(*
cŞÜAssg
)[
ou‹dges
[
id
][
j
]] =ğ
cŞÜ
 )

55 
found
 = 1;

57 ifĞ!
found
 ) {

58 (*
cŞÜAssg
)[
id
] = 
cŞÜ
;

59 
numCŞÜed
++;

64 
numCŞÜs
 = 
cŞÜ
;

95 
	`ä“
Ğ
sÜ‹dIndex
 );

121  
numCŞÜs
;

122 
	}
}

130 
	$skCŞÜšg
Ğ
ov”Ïy_t
 *
ox
, **
cŞÜAssg
 ) {

132 
i
, 
j
;

133 
numCŞÜs
;

135 *
memb”Li¡
 = 
ox
->
owÃrTaskLi¡
;

136 
numMemb”s
 = 
ox
->
numOwÃrTasks
;

138 *
outdeg»e
 = (*è
	`MALLOC
Ğoutdeg»e, 
numMemb”s
 * (), "outdegree" );

139 **
ou‹dges
 = (**è
	`MALLOC
Ğou‹dges, 
numMemb”s
 * (*), "outedges" );

144  
i
 = 0; i < 
numMemb”s
; i++ ) {

145 
idx
 = 
memb”Li¡
[
i
];

147 
outdeg»e
[
i
] = 0;

148 
ou‹dges
[
i
] = 
NULL
;

150  
j
 = 0; j < 
numMemb”s
; j++ ) {

151 
idj
 = 
memb”Li¡
[
j
];

155 ifĞ
idx
 !ğ
idj
 && (
	`ÿnP»em±
(idx,idj) || canPreempt(idj,idx)) ) {

156 
outdeg»e
[
i
]++;

157 
ou‹dges
[
i
] = (*è
	`REALLOC
Ğou‹dges[i], 
outdeg»e
[i] * (), "outedges[i]" );

158 
ou‹dges
[
i
][
outdeg»e
[i]-1] = 
j
;

169 
numCŞÜs
 = 
	`g¿phCŞÜšg
Ğ
numMemb”s
, 
outdeg»e
, 
ou‹dges
, 
cŞÜAssg
 );

171 
	`´štf
Ğ"%d cŞÜ u£d:", 
numCŞÜs
 ); 
	`fæush
Ğ
¡dout
 );

172  
i
 = 0; i < 
numMemb”s
; i++ )

173 
	`´štf
Ğ" %d", (*
cŞÜAssg
)[
i
] );

174 
	`´štf
Ğ"\n" ); 
	`fæush
Ğ
¡dout
 );

176 
	`ä“
Ğ
outdeg»e
 );

177  
i
 = 0; i < 
numMemb”s
; i++ )

178 
	`ä“
Ğ
ou‹dges
[
i
] );

179 
	`ä“
Ğ
ou‹dges
 );

181  
numCŞÜs
;

182 
	}
}

189 
	$cŞÜP¬t™iÚ
Ğ*
memb”Li¡
, 
numMemb”s
, *
cŞÜAssg
, **
cŞÜSh¬e
, 
ÿ·c™y
 ) {

191 
FILE
 *
åŒ
;

192 
i
, 
k
;

193 
pid
, 
size
;

195 
t
;

198 
åŒ
 = 
	`İ’fe
( "dopartn.par", "w" );

199 
	`årštf
Ğ
åŒ
, "š¢siz%d\n", 
INSN_SIZE
 );

200 
	`årštf
Ğ
åŒ
, "ãtchsiz%d\n", 
FETCH_SIZE
 );

201 
	`årštf
Ğ
åŒ
, "Ï‹ncy_¥m %d\n", 
¥m_Ï‹ncy
 );

202 
	`årštf
Ğ
åŒ
, "Ï‹ncy_ofà%d\n", 
off_Ï‹ncy
 );

203 
	`årštf
Ğ
åŒ
, "ÿ·c™y %d\n", 
ÿ·c™y
 );

204 
	`fşo£
Ğ
åŒ
 );

207 
åŒ
 = 
	`İ’fe
( "dopartn.tsk", "w" );

208 
	`årštf
Ğ
åŒ
, "%d\n", 
numMemb”s
 );

209  
i
 = 0; i < 
numMemb”s
; i++ ) {

210 
sk_t
 *
tx
 = 
skLi¡
[
memb”Li¡
[
i
]];

213 
tÙsize
 = 0;

214 
mšsize
 = -1;

215  
k
 = 0; k < 
tx
->
numMemBlocks
; k++ ) {

216 
mem_t
 *
mt
 = 
tx
->
memBlockLi¡
[
k
];

217 
tÙsize
 +ğ
mt
->
size
;

218 ifĞ
mšsize
 =ğ-1 || mšsiz> 
mt
->
size
 )

219 
mšsize
 = 
mt
->
size
;

221 
	`årštf
Ğ
åŒ
, "% %Lu %Lu %d %d\n", 
tx
->
Šame
,x->
ùimeHi
,x->
³riod
, 
mšsize
, 
tÙsize
 );

223 
	`fşo£
Ğ
åŒ
 );

226 
	`sy¡em
( "sort dopartn.tsk >mp; mvmp dopartn.tsk" );

229 
åŒ
 = 
	`İ’fe
( "dopartn.split", "w" );

230  
i
 = 0; i < 
numMemb”s
; i++ ) {

231 
idx
 = 
memb”Li¡
[
i
];

232 
	`årštf
Ğ
åŒ
, "%d %s\n", 
cŞÜAssg
[
i
], 
skLi¡
[
idx
]->
Šame
 );

234 
	`fşo£
Ğ
åŒ
 );

237 
STARTTIME
;

238 
	`sy¡em
( "partnspm dopartn dopartn >…artnspm.trace\n" );

239 
STOPTIME
;

242 
åŒ
 = 
	`İ’fe
( "dopartn.partnspm", "r" );

243  
	`fsÿnf
Ğ
åŒ
, "%d %d", &
pid
, &
size
 ) !ğ
EOF
 ) {

244 (*
cŞÜSh¬e
)[
pid
] = 
size
;

247 
	`fşo£
Ğ
åŒ
 );

252 
	}
}

258 
	$cŞÜAÎoÿtiÚ
Ğ
ch¬t_t
 *
msc
, 
ov”Ïy_t
 *
ox
, *
cŞÜAssg
, 
numCŞÜs
, 
ÿ·c™y
 ) {

260 
i
;

261 
FILE
 *
åŒ
;

263 
k
, 
idx
;

264 
âid
, 
bbid
, 
addr
, 
æag
;

265 
Šame
[
MAXLEN
];

267 
sk_t
 *
tx
;

268 
»s
;

271 *
sksh¬e
 = (*è
	`CALLOC
Ğsksh¬e, 
ox
->
numOwÃrTasks
, (), "taskshare" );

272 *
cŞÜsh¬e
 = (*è
	`CALLOC
ĞcŞÜsh¬e, 
numCŞÜs
, (), "colorshare" );

275 
åŒ
 = 
	`İ’fe
( "doalloc.par", "w" );

276 
	`årštf
Ğ
åŒ
, "š¢siz%d\n", 
INSN_SIZE
 );

277 
	`årštf
Ğ
åŒ
, "ãtchsiz%d\n", 
FETCH_SIZE
 );

278 
	`årštf
Ğ
åŒ
, "Ï‹ncy_¥m %d\n", 
¥m_Ï‹ncy
 );

279 
	`årštf
Ğ
åŒ
, "Ï‹ncy_ofà%d\n", 
off_Ï‹ncy
 );

280 
	`årštf
Ğ
åŒ
, "ÿ·c™y %d\n", 
ÿ·c™y
 );

281 
	`fşo£
Ğ
åŒ
 );

284 
åŒ
 = 
	`İ’fe
( "doalloc.tsc", "w" );

285 
	`årštf
Ğ
åŒ
, "%d\n", 
ox
->
numOwÃrTasks
 );

287 ifĞ
ox
->
numOwÃrTasks
 == 1 ) {

288 
sk_t
 *
ti
 = 
skLi¡
[
ox
->
owÃrTaskLi¡
[0]];

289 
	`årštf
Ğ
åŒ
, "% %Lu %Lu 1.0 0\n", 
ti
->
Šame
,i->
ùimeHi
,i->
³riod
 );

290 
	`fşo£
Ğ
åŒ
 );

293  
i
 = 0; i < 
ox
->
numOwÃrTasks
; i++ ) {

294 
ix
 = 
ox
->
owÃrTaskLi¡
[
i
];

295 
sk_t
 *
ti
 = 
skLi¡
[
ix
];

307 
adju¡
 = 
®locweight
;

308 ifĞ
msc
 !ğ
NULL
 ) {

309 ifĞ
isCr™iÿl
[
ix
] == 1 )

310 
adju¡
 +ğ(
Ï‹¡Fš
[
ix
] - 
—¾›¡Req
[ix]è/ (è
msc
->
wüt
;

311 ifĞ
isCr™iÿl
[
ix
] == 2 )

312 
adju¡
 +ğ
ti
->
ùimeHi
 / (è
msc
->
wüt
;

315 
	`årštf
Ğ
åŒ
, "% %Lu %Lu %là%d\n", 
ti
->
Šame
,i->
ùimeHi
,i->
³riod
, 
adju¡
, 
cŞÜAssg
[
i
] );

317 
	`fşo£
Ğ
åŒ
 );

320 
	`sy¡em
( "sort doalloc.tsc >mp; mvmp doalloc.tsc" );

324 
	`sy¡em
( "spmcolors doalloc doalloc 1 > ilptrace\n" );

327 
åŒ
 = 
	`İ’fe
( "doalloc.alloc", "r" );

328 ifĞ
	`fsÿnf
Ğ
åŒ
, "% %d %d %x", 
Šame
, &
âid
, &
bbid
, &
addr
 ) =ğ
EOF
 ) {

330 
	`fşo£
Ğ
åŒ
 );

331 
	`´štf
( "Optimal solution failed -- using induced solution.\n" );

332 
	`sy¡em
( "spmcolorsInduce doalloc doalloc 1 > ilptrace\n" );

335 
	`fşo£
Ğ
åŒ
 );

338 
	`sy¡em
( "grep Area ilptrace | sort" );

340 
	`sy¡em
( "grep Area ilptrace | sed '/A/s/Area//' > colorshare" );

341 
åŒ
 = 
	`İ’fe
( "colorshare", "r" );

342  
	`fsÿnf
Ğ
åŒ
, "%d %lf", &
idx
, &
»s
 ) !ğ
EOF
 )

343 
cŞÜsh¬e
[
idx
] = (è
»s
;

344 
	`fşo£
Ğ
åŒ
 );

350 
åŒ
 = 
	`İ’fe
( "doalloc.alloc", "r" );

351  
	`fsÿnf
Ğ
åŒ
, "% %d %d %x", 
Šame
, &
âid
, &
bbid
, &
addr
 ) !ğ
EOF
 ) {

356 
k
 = 
ox
->
numOwÃrTasks
 - 1;

357  
k
 > 0 && 
	`¡rcmp
Ğ
skLi¡
[
ox
->
owÃrTaskLi¡
[k]]->
Šame
,name ) != 0 )

358 
k
--;

359 
tx
 = 
skLi¡
[
ox
->
owÃrTaskLi¡
[
k
]];

362 
idx
 = 
tx
->
numMemBlocks
 - 1;

363  
idx
 > 0 && 
tx
->
memBlockLi¡
[idx]->
addr
 !=‡ddr )

364 
idx
--;

365 
tx
->
®loÿ‹d
[
idx
] = 1;

367 
sksh¬e
[
k
] +ğ
tx
->
memBlockLi¡
[
idx
]->
size
;

373 
	`fşo£
Ğ
åŒ
 );

376  
i
 = 0; i < 
ox
->
numOwÃrTasks
; i++ ) {

377 
sk_t
 *
tc
 = 
skLi¡
[
ox
->
owÃrTaskLi¡
[
i
]];

378  
k
 = 0; k < 
tc
->
numMemBlocks
; k++ )

379 
tc
->
memBlockLi¡
[
k
]->
»®size
 =c->memBlockLi¡[k]->
size
;

383 
åŒ
 = 
	`İ’fe
( "doalloc.jump", "r" );

384  
	`fsÿnf
Ğ
åŒ
, "% %d %d %x %d", 
Šame
, &
âid
, &
bbid
, &
addr
, &
æag
 ) !ğ
EOF
 ) {

387 
k
 = 
ox
->
numOwÃrTasks
 - 1;

388  
k
 > 0 && 
	`¡rcmp
Ğ
skLi¡
[
ox
->
owÃrTaskLi¡
[k]]->
Šame
,name ) != 0 )

389 
k
--;

391 
tx
 = 
skLi¡
[
ox
->
owÃrTaskLi¡
[
k
]];

392  
idx
 = 0; idx < 
tx
->
numMemBlocks
; idx++ ) {

393 
mem_t
 *
mt
 = 
tx
->
memBlockLi¡
[
idx
];

394 ifĞ
mt
->
âid
 =ğâid && mt->
bbid
 == bbid ) {

395 
mt
->
»®size
 +ğ
INSN_SIZE
;

399 ifĞ
æag
 )

400 
sksh¬e
[
k
] +ğ
INSN_SIZE
;

402 
	`fşo£
Ğ
åŒ
 );

404  
i
 = 0; i < 
ox
->
numOwÃrTasks
; i++ )

405 
	`´štf
Ğ"%s:\t%4d/%4d by‹ (%d)\n", 
	`g‘TaskName
(
ox
->
owÃrTaskLi¡
[
i
]),

406 
sksh¬e
[
i
], 
cŞÜsh¬e
[
cŞÜAssg
[i]], colorAssg[i] );

408 
	`ä“
Ğ
sksh¬e
 );

409 
	`ä“
Ğ
cŞÜsh¬e
 );

414 
	}
}

	@wcrt/handler.c

5 
	~<¡dio.h
>

7 
	~"cyşe_time.h
"

8 
	~"cyşe_time.c
"

17 
	#CYCLES_PER_MSEC
 3000000

	)

18 
	#STARTTIME
 
	`cyşe_time
(0)

	)

19 
	#STOPTIME
 
t
 = 
	`cyşe_time
(1); 
	`´štf
Ğ"==ğ%àms\n",/
CYCLES_PER_MSEC
 ); 
	`fæush
Ğ
¡dout
 )

	)

21 
	#NAMELEN
 40

	)

26 
	#MALLOC
Ğ
±r
, 
size
, 
msg
 ) \

27 
	`m®loc
Ğ(
size
) ); \

28 ifĞ!(
±r
èè
	`´štf
Ğ"\nE¼Ü: m®loø%d by‹ çed fÜ %s.\n\n", (
size
), (
msg
è), 
	`ex™
(1)

	)

30 
	#CALLOC
Ğ
±r
, 
Ën
, 
size
, 
msg
 ) \

31 
	`ÿÎoc
Ğ(
Ën
), (
size
) ); \

32 ifĞ!(
±r
èè
	`´štf
Ğ"\nE¼Ü: c®loø%d by‹ çed fÜ %s.\n\n", (
size
), (
msg
è), 
	`ex™
(1)

	)

34 
	#REALLOC
Ğ
±r
, 
size
, 
msg
 ) \

35 
	`»®loc
Ğ(
±r
), (
size
) ); \

36 ifĞ!(
±r
èè
	`´štf
Ğ"\nE¼Ü:„—Îoø%d by‹ çed fÜ %s.\n\n", (
size
), (
msg
è), 
	`ex™
(1)

	)

42 
FILE
* 
	$İ’fe
Ğ*
f’ame
, *
mode
 ) {

44 
FILE
 *
åŒ
;

46 
åŒ
 = 
	`fİ’
Ğ
f’ame
, 
mode
 );

47 ifĞ!
åŒ
 )

48 
	`´štf
Ğ"E¼Ü o³nšg f%s.\n", 
f’ame
 ), 
	`ex™
(1);

50  
åŒ
;

51 
	}
}

57 
FILE
* 
	$İ’ãxt
Ğ*
f’ame
, *
ext
, *
mode
 ) {

59 
â
[80];

61 
	`¥rštf
Ğ
â
, "%s.%s", 
f’ame
, 
ext
 );

62  
	`İ’fe
Ğ
â
, 
mode
 );

63 
	}
}

66 
	$‹¡İ’
Ğ*
f’ame
 ) {

68 
FILE
 *
åŒ
;

70 
åŒ
 = 
	`fİ’
Ğ
f’ame
, "r" );

71 ifĞ
åŒ
 !ğ
NULL
 ) {

72 
	`fşo£
Ğ
åŒ
 );

76 
	}
}

79 
	$‹¡İ’ãxt
Ğ*
f’ame
, *
ext
 ) {

81 
â
[80];

83 
	`¥rštf
Ğ
â
, "%s.%s", 
f’ame
, 
ext
 );

84  
	`‹¡İ’
Ğ
â
 );

85 
	}
}

	@wcrt/header.h

1 
	#time_t
 

	)

3 
	#MAXSTEP
 20

	)

4 
	#MAXLEN
 512

	)

5 
	#MAXCR
 100

6 
	#MAX_UNFOLD
 100

7 

	)

8 
	#INSN_EXEC_TIME
 1

	)

10 
	#INSN_SIZE
 8

	)

11 
	#FETCH_SIZE
 16

	)

13 
	#DEFAULT_SPM_LATENCY
 1

	)

14 
	#DEFAULT_OFF_LATENCY
 10

	)

16 
	#DOWNTIME_TOLERANCE
 5

	)

19 
	#DEFAULT_ALLOCWEIGHT
 0.4

	)

22 
	#DEFAULT_LIMITSOLN
 2

	)

25 
	#SYNCH
 0

	)

26 
	#ASYNCH
 1

	)

29 
	#NONE
 0

30 
	#PROFILE_KNAPSACK
 1

31 
	#INTERFERENCE_CLUSTER
 2

32 
	#GRAPH_COLORING
 3

33 
	#SLACK_CRITICAL
 4

34 

	)

35 
	#CLUSTER_BASED
 ( 
®locm‘hod
 !ğ
NONE
 &&‡Îocm‘hod !ğ
PROFILE_KNAPSACK
 )

	)

37 
	gALLOCHEUR
 = 0;

38 
	gGREEDY
 = 1;

39 
	gDEBUG
 = 0;

43 
time_t
 
	mtmS¹
;

44 
time_t
 
	mtmEnd
;

45 
	mnumOwÃrTasks
;

46 *
	mowÃrTaskLi¡
;

47 } 
	tov”Ïy_t
;

50 
	mnumOv”Ïys
;

51 
ov”Ïy_t
 **
	mov”ÏyLi¡
;

52 } 
	t®loc_t
;

55 
	mnumAssigÃd
;

56 *
	massigÃdLi¡
;

57 
®loc_t
* 
	m¥m
;

58 } 
	tsched_t
;

61 
	mâid
, 
	mbbid
;

62 
	maddr
;

63 
	msize
;

64 
	m»®size
;

65 
	mäeq
;

66 } 
	tmem_t
;

69 
	mŠame
[
MAXLEN
];

70 
	maùÜID
;

71 
	m³ID
;

72 
	m´iÜ™y
;

73 
time_t
 
	m³riod
;

74 
time_t
 
	mùimeLo
;

75 
time_t
 
	mùimeHi
;

76 
	mnumP»ds
;

77 *
	m´edLi¡
;

78 
	mnumSuccs
;

79 *
	msuccLi¡
;

80 
	mnumMemBlocks
;

81 
mem_t
 **
	mmemBlockLi¡
;

82 *
	m®loÿ‹d
;

83 } 
	tsk_t
;

86 
	mnumSuccs
;

87 *
	msuccLi¡
;

88 
	mtİoLi¡L’
;

89 *
	mtİoLi¡
;

90 *
	mtimeTİoLi¡
;

91 
time_t
 
	mwüt
;

92 
sched_t
 **
	mPELi¡
;

93 } 
	tch¬t_t
;

96 
	m¤c
;

97 
	md¡
;

98 
	mbound
;

99 } 
	tedge_t
;

102 
ch¬t_t
 *
	mmsc
;

103 **
	medgeBounds
;

104 } 
	t·th_t
;

112 *
	gcâame
;

113 *
	gpdÇme
;

114 *
	gdgÇme
;

115 *
	gtimes_™”©iÚ
;

116 
	g®locm‘hod
;

117 
	gcÚÿt
;

119 
	gtÙ®ÿ·c™y
;

121 
	g¥m_Ï‹ncy
;

122 
	goff_Ï‹ncy
;

124 
	gnumPEs
;

125 *
	g³ID
;

126 *
	g¥mC­ac™y
;

128 
	gnumCh¬ts
;

129 
ch¬t_t
 *
	gmsg
;

130 *
	gtİoMSG
;

132 
	g¡¬tNode
;

133 
	g’dNode
;

135 
edge_t
 *
	gedgeBounds
;

136 
	gnumEdgeBounds
;

139 *
	gpCh¬t
;

141 
	gnumTasks
;

142 
sk_t
 **
	gskLi¡
;

145 
time_t
 *
	g—¾›¡Req
;

146 
time_t
 *
	gÏ‹¡Req
;

147 
time_t
 *
	gÏ‹¡Req_cİy
;

149 
time_t
 *
	g—¾›¡Fš
;

150 
time_t
 *
	gÏ‹¡Fš
;

153 **
	gš‹rã»
;

154 **
	g³”s
;

161 *
	gisCr™iÿl
;

163 
	g®locweight
;

	@wcrt/knapsack.c

9 
	$DP_kÇp§ck
Ğ
ÿ·c™y
, 
num_™ems
, *
gaš
, *
weight
, *
®loc
 ) {

11 *
´ev_gaš
 = 
NULL
;

12 *
cu¼_gaš
;

13 **
´ev_®loc
 = 
NULL
;

14 **
cu¼_®loc
;

16 
gašN
, 
gašY
;

17 
i
, 
w
, 
¥aû
;

18 
™
;

20 ifĞ
ÿ·c™y
 <= 0 ) {

21 ifĞ
®loc
 !ğ
NULL
 ) {

22  
i
 = 0; i < 
num_™ems
; i++ )

23 
®loc
[
i
] = 0;

28  
i
 = 0; i < 
num_™ems
; i++ ) {

30 
cu¼_gaš
 = (*è
	`CALLOC
Ğcu¼_gaš, 
ÿ·c™y
, (), "curr_gain in DP" );

32 ifĞ
®loc
 !ğ
NULL
 ) {

33 
cu¼_®loc
 = (**è
	`MALLOC
Ğcu¼_®loc, 
ÿ·c™y
 * (*), "curr_alloc in DP" );

34  
w
 = 0; w < 
ÿ·c™y
; w++ ) {

35 
cu¼_®loc
[
w
] = (*è
	`CALLOC
Ğcu¼_®loc[w], 
num_™ems
, (), "curr_allocƒlm in DP" );

39  
w
 = 0; w < 
ÿ·c™y
; w++ ) {

42 ifĞ
i
 > 0 )

43 
gašN
 = 
´ev_gaš
[
w
];

45 
gašN
 = 0;

48 
¥aû
 = 
w
 + 1 - 
weight
[
i
];

49 ifĞ
¥aû
 >= 0 ) {

50 
gašY
 = 
gaš
[
i
];

51 ifĞ
¥aû
 > 0 && 
i
 > 0 )

52 
gašY
 +ğ
´ev_gaš
[
¥aû
-1];

55 
gašY
 = 0;

57 ifĞ
gašY
 >ğ
gašN
 ) {

58 
cu¼_gaš
[
w
] = 
gašY
;

60 ifĞ
®loc
 !ğ
NULL
 ) {

62 ifĞ
¥aû
 >= 0 ) {

64 
cu¼_®loc
[
w
][
i
] = 1;

67 ifĞ
¥aû
 > 0 && 
i
 > 0 )

68  
™
 = 0; iˆ< 
i
; it++ )

69 
cu¼_®loc
[
w
][
™
] = 
´ev_®loc
[
¥aû
-1][it];

74 
cu¼_gaš
[
w
] = 
gašN
;

77 ifĞ
®loc
 !ğ
NULL
 ) {

78 ifĞ
i
 > 0 ) {

79  
™
 = 0; iˆ< 
i
; it++ )

80 
cu¼_®loc
[
w
][
™
] = 
´ev_®loc
[w][it];

91 
	`ä“
Ğ
´ev_gaš
 );

92 
´ev_gaš
 = 
cu¼_gaš
;

94 ifĞ
®loc
 !ğ
NULL
 ) {

95 ifĞ
´ev_®loc
 !ğ
NULL
 ) {

96  
w
 = 0; w < 
ÿ·c™y
; w++ )

97 
	`ä“
Ğ
´ev_®loc
[
w
] );

98 
	`ä“
Ğ
´ev_®loc
 );

100 
´ev_®loc
 = 
cu¼_®loc
;

103 
gašY
 = 
cu¼_gaš
[
ÿ·c™y
 - 1];

106 ifĞ
®loc
 !ğ
NULL
 ) {

107  
i
 = 0; i < 
num_™ems
; i++ )

108 ifĞ
cu¼_®loc
[
ÿ·c™y
 - 1][
i
] )

109 
®loc
[
i
] = 1;

112 
	`ä“
Ğ
cu¼_gaš
 );

114 ifĞ
®loc
 !ğ
NULL
 ) {

115  
w
 = 0; w < 
ÿ·c™y
; w++ )

116 
	`ä“
Ğ
cu¼_®loc
[
w
] );

117 
	`ä“
Ğ
cu¼_®loc
 );

120  
gašY
;

121 
	}
}

	@wcrt/main.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

4 
	~"h—d”.h
"

5 
	~"hªdËr.c
"

6 
	~"ut.c
"

8 
	~"·r£.c
"

9 
	~"dump.c
"

11 
	~"tİo.c
"

12 
	~"timšg.c
"

14 
	~"timšgMSG.c
"

15 
	~"ª®ysis.c
"

17 
	~"®loc.c
"

18 
FILE
* 
	gtimeå
;

21 
	$maš
Ğ
¬gc
, *
¬gv
[] ) {

23 
i
, 
j
;

28 ifĞ
¬gc
 < 3 ) {

29 
	`´štf
( "Usage: ./mpspm <config_file> <task_desc> <dpd_graph> <times_iteration>\n" );

34 
	`ex™
(1);

37 
câame
 = 
¬gv
[1];

38 
pdÇme
 = 
¬gv
[2];

39 
dgÇme
 = 
¬gv
[3];

40 
times_™”©iÚ
 = 
¬gv
[4];

41 
DEBUG
 = 0;

48 
®locweight
 = 
DEFAULT_ALLOCWEIGHT
;

52 
	`»adCÚfig
();

53 
	`»adTasks
();

54 
	`»adMSG
();

55 
	`»adEdgeBounds
();

56 
	`tİoTask
();

57 
	`tİoG¿ph
();

59 
	`dumpTaskInfo
();

68 
isCr™iÿl
 = (*è
	`CALLOC
ĞisCr™iÿl, 
numTasks
, (), "isCritical" );

72 
š‹rã»
 = (**è
	`MALLOC
Ğš‹rã», 
numTasks
 * (*), "interfere" );

73  
i
 = 0; i < 
numTasks
; i++ ) {

74 
š‹rã»
[
i
] = (*è
	`CALLOC
Ğš‹rã»[i], 
numTasks
, (), "interfere[i]" );

77 
i
 = 0; i < 
numCh¬ts
; i++)

79 
	`g’”©eWeiCÚæiù
(&(
msg
[
i
]));

81 
	`wr™eWeiCÚæiù
();

82 
	`´štf
("Done writing Wei conflict....\n");

83 
	`fæush
(
¡dout
);

93 
	`»adCo¡
();

95 
	`´štf
("Writing our conflict‚ow....\n");

96 
	`fæush
(
¡dout
);

100 
—¾›¡Req
 = (
time_t
*è
	`CALLOC
Ğ—¾›¡Req, 
numTasks
, (time_t), "earliestReq" );

101 
Ï‹¡Req
 = (
time_t
*è
	`CALLOC
ĞÏ‹¡Req, 
numTasks
, (time_t), "latestReq" );

102 
Ï‹¡Req_cİy
 = (
time_t
*è
	`CALLOC
ĞÏ‹¡Req_cİy, 
numTasks
, (time_t),

106 
—¾›¡Fš
 = (
time_t
*è
	`CALLOC
Ğ—¾›¡Fš, 
numTasks
, (time_t), "earliestFin" );

107 
Ï‹¡Fš
 = (
time_t
*è
	`CALLOC
ĞÏ‹¡Fš, 
numTasks
, (time_t), "latestFin" );

109 
³”s
 = (**)
	`CALLOC
Õ“rs, 
numTasks
, (*), "peers");

111 
i
 = 0; i < 
numTasks
; i++)

113 
³”s
[
i
] = (*)
	`CALLOC
Õ“rs[i], 
numTasks
, (), "peers[i]");

115 
j
 = 0; j < 
numTasks
; j++)

116 
³”s
[
i
][
j
] = 0;

118 
cÚÿt
 = 
SYNCH
;

119 
	`timšgE¡im©e
();

124 if(!
timeå
)

125 
timeå
 = 
	`fİ’
("task_timing.db", "w");

126 if(!
timeå
)

128 
	`årštf
(
¡dout
, "Error: File opening failed\n");

129 
	`ex™
(-1);

134 
i
 = 0; i < 
numCh¬ts
; i++)

136 
	`årštf
(
timeå
, "MSC ID %d \n\n", 
i
);

137 
	`£tIÁ”ã»nû
(&(
msg
[
i
]));

143 
	`fşo£
(
timeå
);

144 
	`wr™eIÁ”ã»nû
();

146 
	`´štf
("Done writing our conflict....\n");

147 
	`fæush
(
¡dout
);

153 
	}
}

	@wcrt/parse.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<¡ršg.h
>

5 
	$š™Sched
Ğ
sched_t
 *
sc
 ) {

7 
sc
->
numAssigÃd
 = 0;

8 
sc
->
assigÃdLi¡
 = 
NULL
;

9 
sc
->
¥m
 = 
NULL
;

11 
	}
}

14 
	$š™Ch¬t
Ğ
ch¬t_t
 *
cx
 ) {

16 
i
;

17 
cx
->
numSuccs
 = 0;

18 
cx
->
succLi¡
 = 
NULL
;

19 
cx
->
tİoLi¡L’
 = 0;

20 
cx
->
tİoLi¡
 = 
NULL
;

21 
cx
->
timeTİoLi¡
 = 
NULL
;

22 
cx
->
wüt
 = 0;

24 
cx
->
PELi¡
 = (
sched_t
**è
	`MALLOC
Ğcx->PELi¡, 
numPEs
 * (sched_t*), "PEList" );

25  
i
 = 0; i < 
numPEs
; i++ ) {

26 
cx
->
PELi¡
[
i
] = (
sched_t
*è
	`MALLOC
( cx->PEList[i], (sched_t), "sched_t" );

27 
	`š™Sched
Ğ
cx
->
PELi¡
[
i
] );

30 
	}
}

37 
	$fšdTask
Ğ
Šame
[] ) {

39 
i
;

40  
i
 = 0; i < 
numTasks
; i++ ) {

41 ifĞ
	`¡rcmp
Ğ
skLi¡
[
i
]->
Šame
,name ) == 0 )

42  
i
;

44 
	`´štf
Ğ"W¬nšg:ask % nÙ found.\n", 
Šame
 );

46 
	}
}

53 
	$fšdPE
Ğ
id
 ) {

55 
i
;

56  
i
 = 0; i < 
numPEs
; i++ ) {

57 ifĞ
³ID
[
i
] =ğ
id
 )

58  
i
;

61 
	}
}

68 
	$fšdCh¬t
Ğ
idx
 ) {

70 
i
, 
j
;

71  
i
 = 0; i < 
numCh¬ts
; i++ )

72  
j
 = 0; j < 
msg
[
i
].
tİoLi¡L’
; j++ )

73 ifĞ
msg
[
i
].
tİoLi¡
[
j
] =ğ
idx
 )

74  
i
;

76 
	}
}

82 
	$isP»deûssÜOf
Ğ
´ed
, 
succ
 ) {

84 
i
;

85 
sk_t
 *
ts
 = 
skLi¡
[
succ
];

87 ifĞ
´ed
 =ğ
succ
 )

90  
i
 = 0; i < 
ts
->
numP»ds
; i++ ) {

91 
px
 = 
ts
->
´edLi¡
[
i
];

92 ifĞ
px
 =ğ
´ed
 )

94 ifĞ
	`isP»deûssÜOf
Ğ
´ed
, 
px
 ))

98 
	}
}

106 
	$»adTasks
() {

108 
Šame
[
MAXLEN
];

109 
aùÜ
, 
³
, 
´iÜ™y
;

110 
time_t
 
³riod
;

112 
FILE
 *
åŒ
 = 
	`İ’fe
Ğ
pdÇme
, "r" );

114 
numTasks
 = 0;

115 
skLi¡
 = 
NULL
;

117  
	`fsÿnf
Ğ
åŒ
, "% %d %d %d %Lu", 
Šame
, &
aùÜ
, &
³
, &
´iÜ™y
, &
³riod
 ) !ğ
EOF
 ) {

119 
sk_t
 *
tc
 = (sk_t*è
	`MALLOC
(c, (task_t), "tc" );

120 
	`¡rıy
Ğ
tc
->
Šame
,name );

121 
tc
->
aùÜID
 = 
aùÜ
;

122 
tc
->
³ID
 = 
³
;

123 
tc
->
´iÜ™y
 =…riority;

124 
tc
->
³riod
 =…eriod;

125 
tc
->
ùimeLo
 = 0;

126 
tc
->
ùimeHi
 = 0;

127 
tc
->
numP»ds
 = 0;

128 
tc
->
´edLi¡
 = 
NULL
;

129 
tc
->
numSuccs
 = 0;

130 
tc
->
succLi¡
 = 
NULL
;

131 
tc
->
numMemBlocks
 = 0;

132 
tc
->
memBlockLi¡
 = 
NULL
;

133 
tc
->
®loÿ‹d
 = 
NULL
;

135 
numTasks
++;

136 
skLi¡
 = (
sk_t
**è
	`REALLOC
ĞskLi¡, 
numTasks
 * (task_t*), "taskList" );

137 
skLi¡
[
numTasks
-1] = 
tc
;

139 
	`fşo£
Ğ
åŒ
 );

142 
	}
}

160 
	$»adMSG
() {

162 
Šame
[
MAXLEN
];

163 
gid
, 
numsks
, 
numsuccs
;

164 
pidx
, 
sidx
, 
³x
;

165 
i
, 
k
;

166 
sk_t
 *
tc
;

167 
sched_t
 *
sc
;

169 
FILE
 *
åŒ
 = 
	`İ’fe
Ğ
dgÇme
, "r" );

171 
numCh¬ts
 = 0;

172 
msg
 = 
NULL
;

174 
pCh¬t
 = (*è
	`MALLOC
ĞpCh¬t, 
numTasks
 * (), "pChart" );

175  
k
 = 0; k < 
numTasks
; k++ )

176 
pCh¬t
[
k
] = -1;

178  
	`fsÿnf
Ğ
åŒ
, "%d %d", &
gid
, &
numsuccs
 ) !ğ
EOF
 ) {

180 ifĞ
numCh¬ts
 < 
gid
 + 1 )

181 
numCh¬ts
 = 
gid
 + 1;

182 
msg
 = (
ch¬t_t
*è
	`REALLOC
Ğmsg, 
numCh¬ts
 * (chart_t), "msg" );

185 
msg
[
gid
].
numSuccs
 = 
numsuccs
;

186 
msg
[
gid
].
succLi¡
 = (*è
	`MALLOC
Ğmsg[gid].succLi¡, 
numsuccs
 * (), "msg succList" );

187  
i
 = 0; i < 
numsuccs
; i++ ) {

188 
	`fsÿnf
Ğ
åŒ
, "%d", &
sidx
 );

189 
msg
[
gid
].
succLi¡
[
i
] = 
sidx
;

193 
msg
[
gid
].
PELi¡
 = (
sched_t
**è
	`MALLOC
Ğmsg[gid].PELi¡, 
numPEs
 * (sched_t*), "msg PEList" );

194  
i
 = 0; i < 
numPEs
; i++ ) {

195 
msg
[
gid
].
PELi¡
[
i
] = (
sched_t
*è
	`MALLOC
( msg[gid].PEList[i], (sched_t), "sched" );

196 
	`š™Sched
Ğ
msg
[
gid
].
PELi¡
[
i
] );

200 
	`fsÿnf
Ğ
åŒ
, "%d", &
numsks
 );

201 
msg
[
gid
].
tİoLi¡L’
 = 
numsks
;

202 
msg
[
gid
].
tİoLi¡
 = (*è
	`MALLOC
Ğmsg[gid].tİoLi¡, 
numsks
 * (), "msgopoList" );

204  
i
 = 0; i < 
numsks
; i++ ) {

205 
	`fsÿnf
Ğ
åŒ
, "% %d", 
Šame
, &
numsuccs
 );

207 
pidx
 = 
	`fšdTask
Ğ
Šame
 );

208 ifĞ
pidx
 == -1 )

209 
	`´štf
Ğ"Inv®idask % š ch¬ˆ%d\n", 
Šame
, 
gid
 ), 
	`ex™
(1);

211 
msg
[
gid
].
tİoLi¡
[
i
] = 
pidx
;

212 
pCh¬t
[
pidx
] = 
gid
;

214 
tc
 = 
skLi¡
[
pidx
];

217  
k
 = 0; k < 
numsuccs
; k++ ) {

218 
	`fsÿnf
Ğ
åŒ
, "%s", &
Šame
 );

220 
sidx
 = 
	`fšdTask
Ğ
Šame
 );

221 ifĞ
sidx
 == -1 )

222 
	`´štf
Ğ"Inv®id sucûssÜ %s\n", 
Šame
 ), 
	`ex™
(1);

224 
tc
->
numSuccs
++;

225 
tc
->
succLi¡
 = (*è
	`REALLOC
Ğtc->succLi¡,c->
numSuccs
 * (), "succList" );

226 
tc
->
succLi¡
[tc->
numSuccs
-1] = 
sidx
;

229 
skLi¡
[
sidx
]->
numP»ds
++;

230 
skLi¡
[
sidx
]->
´edLi¡
 = (*)

231 
	`REALLOC
Ğ
skLi¡
[
sidx
]->
´edLi¡
,askLi¡[sidx]->
numP»ds
 * (), "predList" );

232 
skLi¡
[
sidx
]->
´edLi¡
[skLi¡[sidx]->
numP»ds
-1] = 
pidx
;

236 
³x
 = 
	`fšdPE
Ğ
tc
->
³ID
 );

237 ifĞ
³x
 == -1 )

238 
	`´štf
Ğ"Task % assigÃdØšv®id PE %d.\n", 
Šame
, 
tc
->
³ID
 ), 
	`ex™
(1);

240 
sc
 = 
msg
[
gid
].
PELi¡
[
³x
];

241 
sc
->
numAssigÃd
++;

242 
sc
->
assigÃdLi¡
 = (*è
	`REALLOC
Ğsc->assigÃdLi¡, sc->
numAssigÃd
 * (), "assignedList" );

243 
sc
->
assigÃdLi¡
[sc->
numAssigÃd
-1] = 
pidx
;

247 
	`fşo£
Ğ
åŒ
 );

249 
	}
}

252 
	$»adEdgeBounds
() {

254 
FILE
 *
åŒ
 = 
	`İ’ãxt
Ğ
dgÇme
, "eb", "r" );

258 if(!
åŒ
)

260 
	`ex™
(-1);

263 
¤c
, 
d¡
, 
bound
;

264 
tok’
[24];

266 
	`fsÿnf
Ğ
åŒ
, "% %d", 
tok’
, &
¡¬tNode
 );

267 
	`fsÿnf
Ğ
åŒ
, "% %d", 
tok’
, &
’dNode
 );

269 
numEdgeBounds
 = 0;

270 
edgeBounds
 = 
NULL
;

272  
	`fsÿnf
Ğ
åŒ
, "%d %d %d", &
¤c
, &
d¡
, &
bound
 ) !ğ
EOF
 ) {

273 
numEdgeBounds
++;

274 
edgeBounds
 = (
edge_t
*è
	`REALLOC
ĞedgeBounds, 
numEdgeBounds
 * (edge_t), "edgeBounds" );

275 
edgeBounds
[
numEdgeBounds
-1].
¤c
 = src;

276 
edgeBounds
[
numEdgeBounds
-1].
d¡
 = dst;

277 
edgeBounds
[
numEdgeBounds
-1].
bound
 = bound;

279 
	`fşo£
Ğ
åŒ
 );

282 
	}
}

285 
	$»adTaskMemÜyReq
Ğ
sk_t
 *
tc
 ) {

287 
k
;

288 
FILE
 *
åŒ
;

290 
â
, 
bb
, 
addr
, 
tb
, 
nb
, 
cf
;

291 
§
, 
—
, 
sm
, 
x
;

293 
åŒ
 = 
	`İ’ãxt
Ğ
tc
->
Šame
, "cfg", "r" );

295  
	`fsÿnf
Ğ
åŒ
, "%d %d %x %d %d %d", &
â
, &
bb
, &
addr
, &
tb
, &
nb
, &
cf
 ) !ğ
EOF
 ) {

296 
mem_t
 *
mt
 = (mem_t*è
	`MALLOC
( mt, (mem_t), "mt" );

297 
mt
->
âid
 = 
â
;

298 
mt
->
bbid
 = 
bb
;

299 
mt
->
addr
 =‡ddr;

300 
mt
->
äeq
 = 0;

302 
tc
->
numMemBlocks
++;

303 
tc
->
memBlockLi¡
 = (
mem_t
**è
	`REALLOC
Ğtc->memBlockLi¡,c->
numMemBlocks
 * (mem_t*), "memAddrList" );

304 
tc
->
memBlockLi¡
[tc->
numMemBlocks
-1] = 
mt
;

306 
	`fşo£
Ğ
åŒ
 );

309  
k
 = 1; k < 
tc
->
numMemBlocks
; k++ )

310 
tc
->
memBlockLi¡
[
k
-1]->
size
 =c->memBlockLi¡[k]->
addr
 -c->memBlockList[k-1]->addr;

312 
åŒ
 = 
	`İ’ãxt
Ğ
tc
->
Šame
, "arg", "r" );

313 
	`fsÿnf
Ğ
åŒ
, "%x %x %x %d %d %d %d", &
§
, &
—
, &
sm
, &
x
, &x, &x, &x );

314 
	`fşo£
Ğ
åŒ
 );

316 
tc
->
memBlockLi¡
[tc->
numMemBlocks
-1]->
size
 = 
—
 -c->memBlockLi¡[tc->numMemBlocks-1]->
addr
 + 
INSN_SIZE
;

318 
tc
->
®loÿ‹d
 = (*è
	`CALLOC
Ğtc->®loÿ‹d,c->
numMemBlocks
, (), "allocated" );

319  
k
 = 0; k < 
tc
->
numMemBlocks
; k++ )

320 
tc
->
memBlockLi¡
[
k
]->
»®size
 =c->memBlockLi¡[k]->
size
;

323 
	}
}

330 
	$»adMemÜyReq
() {

332 
i
;

333  
i
 = 0; i < 
numTasks
; i++ )

334 
	`»adTaskMemÜyReq
Ğ
skLi¡
[
i
] );

337 
	}
}

340 
	$»adCÚfig
() {

342 
FILE
 *
åŒ
;

343 
tmp
[20];

344 
³
, 
ÿ·c™y
 = 0;

346 
numPEs
 = 0;

347 
³ID
 = 
NULL
;

348 
¥mC­ac™y
 = 
NULL
;

349 
tÙ®ÿ·c™y
 = 0;

351 
åŒ
 = 
	`İ’fe
Ğ
câame
, "r" );

352 
	`fsÿnf
Ğ
åŒ
, "% %d %d", 
tmp
, &
¥m_Ï‹ncy
, &
off_Ï‹ncy
 );

354  
	`fsÿnf
Ğ
åŒ
, "%d %d", &
³
, &
ÿ·c™y
 ) !ğ
EOF
 ) {

355 
numPEs
++;

356 
³ID
 = (*è
	`REALLOC
Ğ³ID, 
numPEs
 * (), "peID" );

357 
³ID
[
numPEs
-1] = 
³
;

358 
¥mC­ac™y
 = (*è
	`REALLOC
Ğ¥mC­ac™y, 
numPEs
 * (), "spmCapacity" );

359 
¥mC­ac™y
[
numPEs
-1] = 
ÿ·c™y
;

361 
tÙ®ÿ·c™y
 +ğ
ÿ·c™y
;

363 
	`fşo£
Ğ
åŒ
 );

365 
	}
}

368 
	$ä“AÎoc
Ğ
®loc_t
 *
ac
 ) {

370 
i
;

371  
i
 = 0; i < 
ac
->
numOv”Ïys
; i++ ) {

372 
	`ä“
Ğ
ac
->
ov”ÏyLi¡
[
i
]->
owÃrTaskLi¡
 );

373 
	`ä“
Ğ
ac
->
ov”ÏyLi¡
[
i
] );

375 
	`ä“
Ğ
ac
->
ov”ÏyLi¡
 );

378 
	}
}

380 
	$ä“Sched
Ğ
sched_t
 *
sc
 ) {

382 ifĞ
sc
->
¥m
 !ğ
NULL
 ) {

383 
	`ä“AÎoc
Ğ
sc
->
¥m
 );

384 
	`ä“
Ğ
sc
->
¥m
 );

386 
	`ä“
Ğ
sc
->
assigÃdLi¡
 );

389 
	}
}

392 
	$ä“Task
Ğ
sk_t
 *
tx
 ) {

394 
	`ä“
Ğ
tx
->
´edLi¡
 );

395 
	`ä“
Ğ
tx
->
succLi¡
 );

396 
	`ä“
Ğ
tx
->
memBlockLi¡
 );

397 
	`ä“
Ğ
tx
->
®loÿ‹d
 );

400 
	}
}

403 
	$ä“Ch¬t
Ğ
ch¬t_t
 *
cx
 ) {

405 
i
;

406  
i
 = 0; i < 
numPEs
; i++ ) {

407 
	`ä“Sched
Ğ
cx
->
PELi¡
[
i
] );

408 
	`ä“
Ğ
cx
->
PELi¡
[
i
] );

410 
	`ä“
Ğ
cx
->
PELi¡
 );

411 
	`ä“
Ğ
cx
->
succLi¡
 );

412 
	`ä“
Ğ
cx
->
tİoLi¡
 );

413 
	`ä“
Ğ
cx
->
timeTİoLi¡
 );

416 
	}
}

419 
	$ä“P©h
Ğ
·th_t
 *
px
 ) {

421 
i
;

423 
	`ä“Ch¬t
Ğ
px
->
msc
 );

424 
	`ä“
Ğ
px
->
msc
 );

426  
i
 = 0; i < 
numCh¬ts
; i++ )

427 
	`ä“
Ğ
px
->
edgeBounds
[
i
] );

428 
	`ä“
Ğ
px
->
edgeBounds
 );

431 
	}
}

434 
	$ä“AÎ
() {

436 
i
;

438  
i
 = 0; i < 
numTasks
; i++ ) {

439 
	`ä“Task
Ğ
skLi¡
[
i
] );

440 
	`ä“
Ğ
skLi¡
[
i
] );

442 
	`ä“
Ğ
skLi¡
 );

443 
	`ä“
Ğ
³ID
 );

444 
	`ä“
Ğ
¥mC­ac™y
 );

446  
i
 = 0; i < 
numCh¬ts
; i++ ) {

447 
	`ä“Ch¬t
Ğ&(
msg
[
i
]) );

448 
	`ä“
Ğ&(
msg
[
i
]) );

450 
	`ä“
Ğ
msg
 );

451 
	`ä“
Ğ
pCh¬t
 );

453 
	`ä“
Ğ
—¾›¡Req
 );

454 
	`ä“
Ğ
Ï‹¡Req
 );

455 
	`ä“
Ğ
—¾›¡Fš
 );

456 
	`ä“
Ğ
Ï‹¡Fš
 );

459 
	}
}

	@wcrt/selectcontent.c

1 
	~"kÇp§ck.c
"

7 
	$doAÎoÿtiÚILP
Ğ
ch¬t_t
 *
msc
, 
ov”Ïy_t
 *
ox
, 
ÿ·c™y
 ) {

9 
i
;

10 
FILE
 *
åŒ
;

12 
k
, 
idx
;

13 
âid
, 
bbid
, 
addr
, 
æag
;

14 
Šame
[
MAXLEN
];

16 
sk_t
 *
tx
;

19 *
sksh¬e
 = (*è
	`CALLOC
Ğsksh¬e, 
ox
->
numOwÃrTasks
, (), "taskshare" );

22  
i
 = 0; i < 
ox
->
numOwÃrTasks
; i++ ) {

23 
sk_t
 *
tc
 = 
skLi¡
[
ox
->
owÃrTaskLi¡
[
i
]];

24  
k
 = 0; k < 
tc
->
numMemBlocks
; k++ )

25 
tc
->
memBlockLi¡
[
k
]->
»®size
 =c->memBlockLi¡[k]->
size
;

28 ifĞ
ox
->
numOwÃrTasks
 <= 0 ) {

29 
	`´štf
( "Noask‡ssigned.\n" );

34 
åŒ
 = 
	`İ’fe
( "doalloc.par", "w" );

35 
	`årštf
Ğ
åŒ
, "š¢siz%d\n", 
INSN_SIZE
 );

36 
	`årštf
Ğ
åŒ
, "ãtchsiz%d\n", 
FETCH_SIZE
 );

37 
	`årštf
Ğ
åŒ
, "Ï‹ncy_¥m %d\n", 
¥m_Ï‹ncy
 );

38 
	`årštf
Ğ
åŒ
, "Ï‹ncy_ofà%d\n", 
off_Ï‹ncy
 );

39 
	`årštf
Ğ
åŒ
, "ÿ·c™y %d\n", 
ÿ·c™y
 );

40 
	`fşo£
Ğ
åŒ
 );

43 
åŒ
 = 
	`İ’fe
( "doalloc.tsk", "w" );

44 
	`årštf
Ğ
åŒ
, "%d\n", 
ox
->
numOwÃrTasks
 );

46 ifĞ
ox
->
numOwÃrTasks
 == 1 ) {

47 
sk_t
 *
ti
 = 
skLi¡
[
ox
->
owÃrTaskLi¡
[0]];

48 
	`årštf
Ğ
åŒ
, "% %Lu %Lu 1.0\n", 
ti
->
Šame
,i->
ùimeHi
,i->
³riod
 );

49 
	`fşo£
Ğ
åŒ
 );

52  
i
 = 0; i < 
ox
->
numOwÃrTasks
; i++ ) {

53 
ix
 = 
ox
->
owÃrTaskLi¡
[
i
];

54 
sk_t
 *
ti
 = 
skLi¡
[
ix
];

66 
adju¡
 = 
®locweight
;

67 ifĞ
msc
 !ğ
NULL
 ) {

68 ifĞ
isCr™iÿl
[
ix
] == 1 )

69 
adju¡
 +ğ(
Ï‹¡Fš
[
ix
] - 
—¾›¡Req
[ix]è/ (è
msc
->
wüt
;

70 ifĞ
isCr™iÿl
[
ix
] == 2 )

71 
adju¡
 +ğ
ti
->
ùimeHi
 / (è
msc
->
wüt
;

74 
	`årštf
Ğ
åŒ
, "% %Lu %Lu %lf\n", 
ti
->
Šame
,i->
ùimeHi
,i->
³riod
, 
adju¡
 );

76 
	`fşo£
Ğ
åŒ
 );

79 
	`sy¡em
( "sort doalloc.tsk >mp; mvmp doalloc.tsk" );

83 
	`sy¡em
( "spm doalloc doalloc 1 > ilptrace" );

86 
åŒ
 = 
	`İ’fe
( "doalloc.alloc", "r" );

87 ifĞ
	`fsÿnf
Ğ
åŒ
, "% %d %d %x", 
Šame
, &
âid
, &
bbid
, &
addr
 ) =ğ
EOF
 ) {

89 
	`fşo£
Ğ
åŒ
 );

90 
	`´štf
( "Optimal solution failed -- using induced solution.\n" );

91 
	`sy¡em
( "spmInduce doalloc doalloc 1 > ilptrace\n" );

94 
	`fşo£
Ğ
åŒ
 );

101 
åŒ
 = 
	`İ’fe
( "doalloc.alloc", "r" );

102  
	`fsÿnf
Ğ
åŒ
, "% %d %d %x", 
Šame
, &
âid
, &
bbid
, &
addr
 ) !ğ
EOF
 ) {

107 
k
 = 
ox
->
numOwÃrTasks
 - 1;

108  
k
 > 0 && 
	`¡rcmp
Ğ
skLi¡
[
ox
->
owÃrTaskLi¡
[k]]->
Šame
,name ) != 0 )

109 
k
--;

110 
tx
 = 
skLi¡
[
ox
->
owÃrTaskLi¡
[
k
]];

113 
idx
 = 
tx
->
numMemBlocks
 - 1;

114  
idx
 > 0 && 
tx
->
memBlockLi¡
[idx]->
addr
 !=‡ddr )

115 
idx
--;

116 
tx
->
®loÿ‹d
[
idx
] = 1;

118 
sksh¬e
[
k
] +ğ
tx
->
memBlockLi¡
[
idx
]->
size
;

124 
	`fşo£
Ğ
åŒ
 );

127 
åŒ
 = 
	`İ’fe
( "doalloc.jump", "r" );

128  
	`fsÿnf
Ğ
åŒ
, "% %d %d %x %d", 
Šame
, &
âid
, &
bbid
, &
addr
, &
æag
 ) !ğ
EOF
 ) {

131 
k
 = 
ox
->
numOwÃrTasks
 - 1;

132  
k
 > 0 && 
	`¡rcmp
Ğ
skLi¡
[
ox
->
owÃrTaskLi¡
[k]]->
Šame
,name ) != 0 )

133 
k
--;

135 
tx
 = 
skLi¡
[
ox
->
owÃrTaskLi¡
[
k
]];

136  
idx
 = 0; idx < 
tx
->
numMemBlocks
; idx++ ) {

137 
mem_t
 *
mt
 = 
tx
->
memBlockLi¡
[
idx
];

138 ifĞ
mt
->
âid
 =ğâid && mt->
bbid
 == bbid ) {

139 
mt
->
»®size
 +ğ
INSN_SIZE
;

143 ifĞ
æag
 )

144 
sksh¬e
[
k
] +ğ
INSN_SIZE
;

146 
	`fşo£
Ğ
åŒ
 );

148  
i
 = 0; i < 
ox
->
numOwÃrTasks
; i++ )

149 
	`´štf
Ğ"%s:\t%4d/%4d by‹s\n", 
	`g‘TaskName
(
ox
->
owÃrTaskLi¡
[
i
]), 
sksh¬e
[i], 
ÿ·c™y
 );

151 
	`ä“
Ğ
sksh¬e
 );

156 
	}
}

161 
	$doAÎoÿtiÚKÇp§ck
Ğ
ov”Ïy_t
 *
ox
, 
ÿ·c™y
 ) {

163 
num
;

164 *
gaš
;

165 *
weight
;

166 *
®loc
;

168 
i
, 
k
, 
Ï¡
;

170 *
¡¬tIndex
 = (*è
	`MALLOC
Ğ¡¬tIndex, 
ox
->
numOwÃrTasks
 * (), "startIndex" );

172 
num
 = 0;

173  
i
 = 0; i < 
ox
->
numOwÃrTasks
; i++ ) {

174 
¡¬tIndex
[
i
] = 
num
;

175 
num
 +ğ
skLi¡
[
ox
->
owÃrTaskLi¡
[
i
]]->
numMemBlocks
;

178 
gaš
 = (*è
	`MALLOC
Ğgaš, 
num
 * (), "gain" );

179 
weight
 = (*è
	`MALLOC
Ğweight, 
num
 * (), "weight" );

180 
®loc
 = (*è
	`CALLOC
Ğ®loc, 
num
, (), "alloc" );

182 
Ï¡
 = 0;

183  
i
 = 0; i < 
ox
->
numOwÃrTasks
; i++ ) {

184 
sk_t
 *
tc
 = 
skLi¡
[
ox
->
owÃrTaskLi¡
[
i
]];

185  
k
 = 0; k < 
tc
->
numMemBlocks
; k++ ) {

186 
mem_t
 *
mt
 = 
tc
->
memBlockLi¡
[
k
];

187 
weight
[
Ï¡
+
k
] = 
mt
->
size
;

188 
gaš
[
Ï¡
+
k
] = 
mt
->
äeq
;

190 
Ï¡
 +ğ
tc
->
numMemBlocks
;

193 
	`DP_kÇp§ck
Ğ
ÿ·c™y
, 
num
, 
gaš
, 
weight
, 
®loc
 );

198  
i
 = 0; i < 
num
; i++ ) {

199 ifĞ
®loc
[
i
] ) {

200 
sk_t
 *
tx
;

201 
idx
;

204 
k
 = 
ox
->
numOwÃrTasks
 - 1;

205  
k
 > 0 && 
¡¬tIndex
[k] > 
i
 )

206 
k
--;

208 
tx
 = 
skLi¡
[
ox
->
owÃrTaskLi¡
[
k
]];

209 
idx
 = 
i
 - 
¡¬tIndex
[
k
];

210 
tx
->
®loÿ‹d
[
idx
] = 1;

217 
	`ä“
Ğ
gaš
 );

218 
	`ä“
Ğ
weight
 );

219 
	`ä“
Ğ
®loc
 );

222 
	}
}

225 
	$doAÎoÿtiÚ
Ğ
ch¬t_t
 *
msc
, 
ov”Ïy_t
 *
ox
, 
ÿ·c™y
 ) {

227 
i
, 
k
;

230  
i
 = 0; i < 
ox
->
numOwÃrTasks
; i++ ) {

231 
idx
 = 
ox
->
owÃrTaskLi¡
[
i
];

232  
k
 = 0; k < 
skLi¡
[
idx
]->
numMemBlocks
; k++ )

233 
skLi¡
[
idx
]->
®loÿ‹d
[
k
] = 0;

235 ifĞ
ÿ·c™y
 <= 0 )

238  
	`doAÎoÿtiÚILP
Ğ
msc
, 
ox
, 
ÿ·c™y
 );

239 
	}
}

	@wcrt/slacks.c

1 
	~<as£¹.h
>

2 
	#DEBUGSLACK
 0

	)

4 
ušt
 
g‘_msc_id
(
ch¬t_t
* 
msc
, ušˆ
sk_id
);

6 
	$»£tIÁ”ã»nû
Ğ
ch¬t_t
 *
msc
 ) {

8 
i
, 
j
;

9  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ )

10  
j
 = 0; j < 
msc
->
tİoLi¡L’
; j++ )

11 
š‹rã»
[
msc
->
tİoLi¡
[
i
]][msc->tİoLi¡[
j
]] = 1;

14 
	}
}

17 
	$g’”©eWeiCÚæiù
(
ch¬t_t
 *
msc
)

19 
i
, 
k
, 
Ën
 = 
msc
->
tİoLi¡L’
;

20  
i
 = 0; i < 
Ën
; i++ )

22 
ix
 = 
msc
->
tİoLi¡
[
i
];

23  
k
 = 0; k < 
Ën
; k++ )

25 
kx
 = 
msc
->
tİoLi¡
[
k
];

26 ifĞ(
ix
 =ğ
kx
è|| (
skLi¡
[ ix ]->
³ID
 ==askList[ kx ]->peID) )

28 
š‹rã»
[
ix
][
kx
] = 0;

29 
š‹rã»
[
kx
][
ix
] = 0;

33 
š‹rã»
[
ix
][
kx
] = 1;

34 
š‹rã»
[
kx
][
ix
] = 1;

41 
	}
}

44 
	$wr™eWeiCÚæiù
()

47 
	`´štf
("writing interfere of Wei‚ow...\n");

49 
Çme
[20];

50 
i
, 
k
, 
j
, 
ix
, 
kx
, 
Ën
, 
mscNum
 = 
numCh¬ts
;

51 
FILE
 *
š‹rã»Fe
, *
š‹rã»P©h
;

52 
sk_t
* 
sk
;

53 
ušt
 
nSuccs
;

54 
si
;

56 
	`¥rštf
(
Çme
, "interferePath");

57 
š‹rã»P©h
 = 
	`fİ’
(
Çme
, "w");

58  
j
 = 1; j <ğ
mscNum
; j++)

61 
	`¥rštf
(
Çme
, "š‹rã»/msc%d", 
j
);

63 
	`årštf
(
š‹rã»P©h
, "%s\n", 
Çme
);

66 
Ën
 = 
msg
[
j
-1].
tİoLi¡L’
;

68 
š‹rã»Fe
 = 
	`fİ’
(
Çme
,"w");

69 
	`årštf
(
š‹rã»Fe
, "%d\n", 
msg
[
j
-1].
tİoLi¡L’
);

70 
i
 = 0; i < 
Ën
; i++)

72 
	`årštf
(
š‹rã»Fe
, "%s\n", 
skLi¡
[
msg
[
j
-1].
tİoLi¡
[
i
]]->
Šame
);

77 
sk
 = (
skLi¡
[
msg
[
j
-1].
tİoLi¡
[
i
]]);

78 
nSuccs
 = 
sk
->
numSuccs
;

79 
	`årštf
(
š‹rã»Fe
, "%d ", 
nSuccs
);

80 
si
 = 0; s˜< 
nSuccs
; si++)

82 
	`årštf
(
š‹rã»Fe
, "%d ", 
	`g‘_msc_id
(&
msg
[
j
-1],

83 
sk
->
succLi¡
[
si
]));

85 
	`årštf
(
š‹rã»Fe
, "\n");

89  
i
 = 0; i < 
Ën
; i++ )

91 
ix
 = 
msg
[
j
-1].
tİoLi¡
[
i
];

93  
k
 = 0; k < 
Ën
; k++ )

95 
kx
 = 
msg
[
j
-1].
tİoLi¡
[
k
];

96 
	`årštf
(
š‹rã»Fe
, "%d ", 
š‹rã»
[
ix
][
kx
]);

98 
	`årštf
(
š‹rã»Fe
, "\n");

99 
	`fæush
(
¡dout
);

102 
	`fşo£
(
š‹rã»Fe
);

104 
	`fşo£
(
š‹rã»P©h
);

106 
	}
}

109 
ušt
 
	$g‘_msc_id
(
ch¬t_t
* 
msc
, 
ušt
 
sk_id
)

111 
i
;

113  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ )

115 if(
msc
->
tİoLi¡
[
i
] =ğ
sk_id
)

116  
i
;

121 
	}
}

123 
	$wr™eAÎTime
(
ch¬t_t
* 
msc
, 
sk_t
* 
sk
, 
id
, 
FILE
* 
å
)

125 
i
;

127 
	`as£¹
(
sk
);

128 
	`årštf
(
å
, "TASK ID = %d\n\n", 
id
);

129 
	`årštf
(
å
, "EARLIEST START = %Lu\n", 
—¾›¡Req
[
id
]);

130 
	`årštf
(
å
, "LATEST START = %Lu\n",
Ï‹¡Req
[
id
]);

131 
	`årštf
(
å
, "EARLIEST FINISH = %Lu\n", 
—¾›¡Fš
[
id
]);

132 
	`årštf
(
å
, "LATEST FINISH = %Lu\n", 
Ï‹¡Fš
[
id
]);

133 
	`årštf
(
å
, "Successors\n");

134 
i
 = 0; i < 
sk
->
numSuccs
; i++)

135 
	`årštf
(
å
, "%d\n", 
	`g‘_msc_id
(
msc
, 
sk
->
succLi¡
[
i
]));

136 
	`årštf
(
å
, "\n");

137 
	}
}

140 
	$£tIÁ”ã»nû
Ğ
ch¬t_t
 *
msc
 ) {

145 
i
, 
k
, 
Ën
 = 
msc
->
tİoLi¡L’
;

146 
FILE
* 
timeå
;

151  
i
 = 0; i < 
Ën
; i++ )

153 
ix
 = 
msc
->
tİoLi¡
[
i
];

161 
	`wr™eAÎTime
(
msc
, 
skLi¡
[msc->
tİoLi¡
[
i
]], 
ix
, 
timeå
);

163  
k
 = 0; k < 
Ën
; k++ )

165 
kx
 = 
msc
->
tİoLi¡
[
k
];

166 ifĞ(
ix
 !ğ
kx
è&& 
	`ÿnCÚæiù
(ix,kx))

168 
š‹rã»
[
ix
][
kx
] = 1;

169 
š‹rã»
[
kx
][
ix
] = 1;

176 
š‹rã»
[
ix
][
kx
] = 0;

177 
š‹rã»
[
kx
][
ix
] = 0;

182 
	}
}

184 
	$dumpIÁ”ã»nû
Ğ
ch¬t_t
 *
msc
 ) {

186 
i
, 
k
, 
Ën
 = 
msc
->
tİoLi¡L’
;

190  
i
 = 0; i < 
Ën
; i++ ) {

191 
	`´štTimes
(
msc
->
tİoLi¡
[
i
]);

195  
i
 = 0; i < 
Ën
; i++ ) {

196 
ix
 = 
msc
->
tİoLi¡
[
i
];

197  
k
 = 0; k < 
Ën
; k++ ) {

198 
kx
 = 
msc
->
tİoLi¡
[
k
];

199 
	`´štf
("%d ", 
š‹rã»
[
ix
][
kx
]);

201 
	`´štf
("\n");

203 
	}
}

207 
	$wr™eIÁ”ã»nû
()

209 
Çme
[256];

210 
i
, 
k
, 
j
, 
mscNum
 = 
numCh¬ts
, 
Ën
;

211 
FILE
 *
š‹rã»Fe
, *
š‹rã»P©h
;

212 
ušt
 
nSuccs
;

213 
si
;

214 
sk_t
* 
sk
;

216 
	`´štf
("writing interference‚ow...\n");

217 
	`fæush
 (
¡dout
);

219 
	`¥rštf
(
Çme
, "š‹rã»P©h_%s", 
times_™”©iÚ
);

220 
š‹rã»P©h
 = 
	`fİ’
(
Çme
, "w");

221  
j
 = 1; j <ğ
mscNum
; j++)

223 
	`¥rštf
(
Çme
, "š‹rã»/%s_msc%d", 
times_™”©iÚ
, 
j
);

224 
	`årštf
(
š‹rã»P©h
, "%s\n", 
Çme
);

226 
Ën
 = 
msg
[
j
-1].
tİoLi¡L’
;

228 
š‹rã»Fe
 = 
	`fİ’
(
Çme
,"w");

229 
	`årštf
(
š‹rã»Fe
, "%d \n", 
msg
[
j
-1].
tİoLi¡L’
);

230 
i
 = 0; i < 
Ën
; i++)

232 
	`årštf
(
š‹rã»Fe
, "%s\n", 
skLi¡
[
msg
[
j
-1].
tİoLi¡
[
i
]]->
Šame
);

237 
sk
 = (
skLi¡
[
msg
[
j
-1].
tİoLi¡
[
i
]]);

238 
nSuccs
 = 
sk
->
numSuccs
;

239 
	`årštf
(
š‹rã»Fe
, "%d ", 
nSuccs
);

240 
si
 = 0; s˜< 
nSuccs
; si++)

242 
	`årštf
(
š‹rã»Fe
, "%d ", 
	`g‘_msc_id
(&
msg
[
j
-1],

243 
sk
->
succLi¡
[
si
]));

245 
	`årštf
(
š‹rã»Fe
, "\n");

248  
i
 = 0; i < 
Ën
; i++ ) {

249 
ix
 = (
msg
[
j
-1].
tİoLi¡
)[
i
];

252  
k
 = 0; k < 
Ën
; k++ ) {

253 
kx
 = (
msg
[
j
-1].
tİoLi¡
)[
k
];

254 
	`årštf
(
š‹rã»Fe
, "%d ", 
š‹rã»
[
ix
][
kx
]);

256 
	`årštf
(
š‹rã»Fe
, "\n");

258 
	`fæush
(
¡dout
);

260 
	`fşo£
(
š‹rã»Fe
);

262 
	`fşo£
(
š‹rã»P©h
);

264 
	}
}

271 
	$comesBefÜe
Ğ
´ed
, 
succ
, 
ch¬t_t
 *
msc
 ) {

273 
idp
 = 
	`g‘IndexInLi¡
Ğ
´ed
, 
msc
->
timeTİoLi¡
, msc->
tİoLi¡L’
 );

274 
ids
 = 
	`g‘IndexInLi¡
Ğ
succ
, 
msc
->
timeTİoLi¡
, msc->
tİoLi¡L’
 );

275 Ğ
idp
 > -1 && 
ids
 > -1 && idp < ids );

276 
	}
}

279 
	$Ï‹¡Times_¦ack
Ğ
ch¬t_t
 *
msc
, *
tİoA¼
, 
tİosize
 ) {

281 
i
, 
k
;

282 
chªged
 = 0;

287  
i
 = 0; i < 
tİosize
; i++ ) {

288 
idx
 = 
tİoA¼
[
i
];

289 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

292 
time_t
 
v®
 = 1;

293  
k
 = 0; k < 
tİosize
; k++ ) {

295 
kx
 = 
tİoA¼
[
k
];

296 ifĞ
kx
 =ğ
idx
 || 
skLi¡
[kx]->
³ID
 !ğskLi¡[idx]->³ID || 
š‹rã»
[kx][idx] )

298 ifĞ
	`comesBefÜe
Ğ
kx
, 
idx
, 
msc
 ) && 
v®
 < 
Ï‹¡Fš
[kx] ) {

299 
v®
 = 
Ï‹¡Fš
[
kx
];

306  
k
 = 0; k < 
tx
->
numP»ds
; k++ ) {

307 
idm
 = 
tx
->
´edLi¡
[
k
];

308 ifĞ!
	`šLi¡
Ğ
idm
, 
tİoA¼
, 
tİosize
 ) && 
v®
 < 
Ï‹¡Fš
[idm] ) {

309 
v®
 = 
Ï‹¡Fš
[
idm
];

313 
Ï‹¡Req
[
idx
] = 
v®
;

317  
i
 = 0; i < 
tİosize
; i++ ) {

318 
idx
 = 
tİoA¼
[
i
];

319 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

322 
time_t
 
wüt
 = 
	`fixedPoštC®cHi
Ğ
msc
, 
idx
 );

323 
time_t
 
v®ue
 = 
Ï‹¡Req
[
idx
] + 
wüt
;

324 ifĞ
Ï‹¡Fš
[
idx
] !ğ
v®ue
 ) {

325 
Ï‹¡Fš
[
idx
] = 
v®ue
;

326 
chªged
 = 1;

334  
k
 = 0; k < 
tx
->
numSuccs
; k++ ) {

335 
idk
 = 
tx
->
succLi¡
[
k
];

337 ifĞ
Ï‹¡Req
[
idk
] < 
Ï‹¡Fš
[
idx
] ) {

338 
Ï‹¡Req
[
idk
] = 
Ï‹¡Fš
[
idx
];

339 
chªged
 = 1;

349  
chªged
;

350 
	}
}

353 
	$—¾›¡Times_¦ack
Ğ
ch¬t_t
 *
msc
, *
tİoA¼
, 
tİosize
 ) {

355 
i
, 
k
;

356 
chªged
 = 0;

361  
i
 = 0; i < 
tİosize
; i++ ) {

362 
idx
 = 
tİoA¼
[
i
];

363 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

366 
time_t
 
v®
 = 1;

367  
k
 = 0; k < 
tİosize
; k++ ) {

369 
kx
 = 
tİoA¼
[
k
];

371 ifĞ
kx
 =ğ
idx
 || 
skLi¡
[kx]->
³ID
 !ğskLi¡[idx]->³ID || 
š‹rã»
[kx][idx] )

373 ifĞ
	`comesBefÜe
Ğ
kx
, 
idx
, 
msc
 ) && 
v®
 < 
—¾›¡Fš
[kx] ) {

375 
v®
 = 
Ï‹¡Fš
[
kx
];

382  
k
 = 0; k < 
tx
->
numP»ds
; k++ ) {

383 
idm
 = 
tx
->
´edLi¡
[
k
];

384 ifĞ!
	`šLi¡
Ğ
idm
, 
tİoA¼
, 
tİosize
 ) && 
v®
 < 
—¾›¡Fš
[idm] ) {

386 
v®
 = 
Ï‹¡Fš
[
idm
];

390 
—¾›¡Req
[
idx
] = 
v®
;

394  
i
 = 0; i < 
tİosize
; i++ ) {

395 
idx
 = 
tİoA¼
[
i
];

396 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

399 
time_t
 
wüt
 = 
	`fixedPoštC®cLo
Ğ
msc
, 
idx
 );

400 
time_t
 
v®ue
 = 
—¾›¡Req
[
idx
] + 
wüt
;

401 ifĞ
—¾›¡Fš
[
idx
] !ğ
v®ue
 ) {

402 
—¾›¡Fš
[
idx
] = 
v®ue
;

403 
chªged
 = 1;

412  
k
 = 0; k < 
tx
->
numSuccs
; k++ ) {

413 
idk
 = 
tx
->
succLi¡
[
k
];

415 ifĞ
—¾›¡Req
[
idk
] < 
—¾›¡Fš
[
idx
] ) {

416 
—¾›¡Req
[
idk
] = 
—¾›¡Fš
[
idx
];

417 
chªged
 = 1;

427  
chªged
;

428 
	}
}

431 
	$doTimšg
Ğ
ch¬t_t
 *
msc
, 
¦ack
 ) {

433 
i
, 
k
;

434 
chªged
;

437 
time_t
 *
eReq
 = (time_t*è
	`MALLOC
ĞeReq, 
numTasks
 * (time_t), "eReq" );

438 
time_t
 *
lReq
 = (time_t*è
	`MALLOC
ĞlReq, 
numTasks
 * (time_t), "lReq" );

439 
time_t
 *
eFš
 = (time_t*è
	`MALLOC
ĞeFš, 
numTasks
 * (time_t), "eFin" );

440 
time_t
 *
lFš
 = (time_t*è
	`MALLOC
ĞlFš, 
numTasks
 * (time_t), "lFin" );

442 ifĞ
¦ack
 ) {

445 
Ën
 = 
msc
->
tİoLi¡L’
;

448 
msc
->
timeTİoLi¡
 = (*è
	`MALLOC
Ğmsc->timeTİoLi¡, 
Ën
 * (), "timeTopoList" );

449  
k
 = 0; k < 
Ën
; k++ )

450 
msc
->
timeTİoLi¡
[
k
] = msc->
tİoLi¡
[
Ën
-k-1];

459 
chªged
 = 0;

460  
k
 = 1; k < 
Ën
; k++ ) {

461 
idx
 = 
msc
->
timeTİoLi¡
[
k
];

462 
idp
 = 
msc
->
timeTİoLi¡
[
k
-1];

464 ifĞ
Ï‹¡Req
[
idx
] <†©e¡Req[
idp
] ||

465 
Ï‹¡Req
[
idx
] =ğÏ‹¡Req[
idp
] &&

466 (
—¾›¡Req
[
idx
] <ƒ¬l›¡Req[
idp
] ||

467 (
—¾›¡Req
[
idx
] =ğ—¾›¡Req[
idp
] &&

468 (
Ï‹¡Fš
[
idx
] >†©e¡Fš[
idp
] ||

469 (
Ï‹¡Fš
[
idx
] =ğÏ‹¡Fš[
idp
] && 
—¾›¡Fš
[idx] >ƒarliestFin[idp]))))) {

472 
chªged
 = 1;

473 
msc
->
timeTİoLi¡
[
k
] = 
idp
;

474 
msc
->
timeTİoLi¡
[
k
-1] = 
idx
;

477 }  
chªged
 );

487  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

488 
ix
 = 
msc
->
tİoLi¡
[
i
];

490 
eReq
[
ix
] = 
—¾›¡Req
[ix];

491 
lReq
[
ix
] = 
Ï‹¡Req
 [ix];

492 
eFš
[
ix
] = 
—¾›¡Fš
[ix];

493 
lFš
[
ix
] = 
Ï‹¡Fš
 [ix];

495 
—¾›¡Req
[
ix
] = 1;

496 
Ï‹¡Req
 [
ix
] = 1;

497 
—¾›¡Fš
[
ix
] = 0;

498 
Ï‹¡Fš
 [
ix
] = 0;

501 ifĞ
¦ack
 ) {

502  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

507 
	`—¾›¡Times_¦ack
Ğ
msc
, msc->
timeTİoLi¡
, msc->
tİoLi¡L’
 );

512 
	`Ï‹¡Times_¦ack
Ğ
msc
, msc->
timeTİoLi¡
, msc->
tİoLi¡L’
 );

518  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

519 
ix
 = 
msc
->
tİoLi¡
[
i
];

521 *
tİoA¼
 = 
NULL
;

522 
tİosize
 = 
	`tİoSÜtSubg¿ph
Ğ
ix
, &
tİoA¼
 );

530 
	`—¾›¡Times
Ğ
msc
, 
tİoA¼
, 
tİosize
 );

534 
	`Ï‹¡Times
Ğ
msc
, 
tİoA¼
, 
tİosize
 );

538 
	`ä“
Ğ
tİoA¼
 );

542 
chªged
 = 0;

543  
i
 = 0; !
chªged
 && i < 
msc
->
tİoLi¡L’
; i++ ) {

544 
ix
 = 
msc
->
tİoLi¡
[
i
];

545 ifĞ
eReq
[
ix
] !ğ
—¾›¡Req
[ix] || 
lReq
[ix] !ğ
Ï‹¡Req
[ix] || 
eFš
[ix] !ğ
—¾›¡Fš
[ix] || 
lFš
[ix] !ğ
Ï‹¡Fš
[ix] )

546 
chªged
 = 1;

550  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

551 
ix
 = 
msc
->
tİoLi¡
[
i
];

552  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

553 
kx
 = 
msc
->
tİoLi¡
[
k
];

554 ifĞ
ix
 !ğ
kx
 && (
	`ÿnP»em±
(ix,kx) || canPreempt(kx,ix)) ) {

555 
š‹rã»
[
ix
][
kx
] = 1;

556 
š‹rã»
[
kx
][
ix
] = 1;

560 
š‹rã»
[
ix
][
kx
] = 0;

561 
š‹rã»
[
kx
][
ix
] = 0;

568 
	`ä“
Ğ
eReq
 );

569 
	`ä“
Ğ
lReq
 );

570 
	`ä“
Ğ
eFš
 );

571 
	`ä“
Ğ
lFš
 );

573  
chªged
;

574 
	}
}

577 
	$g‘AÎoÿ‹dSize
Ğ
sk_t
 *
ts
 ) {

579 
i
;

580 
sum
 = 0;

582  
i
 = 0; i < 
ts
->
numMemBlocks
; i++ )

583 ifĞ
ts
->
®loÿ‹d
[
i
] )

584 
sum
 +ğ
ts
->
memBlockLi¡
[
i
]->
size
;

586  
sum
;

587 
	}
}

589 
time_t
 
	$e¡Gaš
Ğ
sk_t
 *
ts
, 
ÿ·c™y
 ) {

591 
i
;

592 
chªged
 = 1;

594 
numUÇÎoc
 = 0;

595 
mem_t
 **
sÜtBlocks
 = 
NULL
;

597 
»maš
 = 
ÿ·c™y
;

598 
time_t
 
gaš
 = 0;

601  
i
 = 0; i < 
ts
->
numMemBlocks
; i++ ) {

602 ifĞ!
ts
->
®loÿ‹d
[
i
] ) {

603 
numUÇÎoc
++;

604 
sÜtBlocks
 = (
mem_t
**è
	`REALLOC
ĞsÜtBlocks, 
numUÇÎoc
 * (mem_t*), "sortBlocks" );

605 
sÜtBlocks
[
numUÇÎoc
-1] = 
ts
->
memBlockLi¡
[
i
];

609  
chªged
 ) {

610 
chªged
 = 0;

611  
i
 = 1; i < 
numUÇÎoc
; i++ ) {

612 ifĞ
sÜtBlocks
[
i
]->
äeq
 > sortBlocks[i-1]->freq ) {

613 
mem_t
 *
tmp
 = 
sÜtBlocks
[
i
-1];

614 
sÜtBlocks
[
i
-1] = sortBlocks[i];

615 
sÜtBlocks
[
i
] = 
tmp
;

616 
chªged
 = 1;

621  
i
 = 0; i < 
numUÇÎoc
 && 
»maš
 > 0; i++ ) {

622 
mem_t
 *
mt
 = 
sÜtBlocks
[
i
];

623 ifĞ
mt
->
size
 <ğ
»maš
 ) {

624 
»maš
 -ğ
mt
->
size
;

625 
gaš
 +ğ
mt
->
äeq
 * (mt->
size
 / 
FETCH_SIZE
è* (
off_Ï‹ncy
 - 
¥m_Ï‹ncy
);

628 
	`ä“
Ğ
sÜtBlocks
 );

630  
gaš
;

631 
	}
}

634 
	$š£¹SÏcks
Ğ
ch¬t_t
 *
msc
 ) {

636 
i
, 
k
, 
n
;

637 
chªged
;

639 
round
 = 0;

640  
round
 < 
MAXCR
 ) {

643 
maxTask
 = -1;

644 
maxVic
 = -1;

646 
time_t
 
mšNewTime
 = 0;

648  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

649 
ix
 = 
msc
->
tİoLi¡
[
i
];

650 
sk_t
 *
ti
 = 
skLi¡
[
ix
];

652 ifĞ
isCr™iÿl
[
ix
] != 1 )

655  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

656 
kx
 = 
msc
->
tİoLi¡
[
k
];

657 
sk_t
 *
tk
 = 
skLi¡
[
kx
];

659 
time_t
 
maxFš
, 
¦ack
, 
®locGaš
;

661 ifĞ
ix
 =ğ
kx
 || !
isCr™iÿl
[kx] || !
š‹rã»
[kx][ix] || !š‹rã»[ix][kx] || !
	`ÿnP»em±
(kx,ix) )

667 
maxFš
 = 
msc
->
wüt
;

668 
¦ack
 = 
Ï‹¡Fš
[
ix
] -†©e¡Fš[
kx
];

670  
n
 = 0;‚ < 
msc
->
tİoLi¡L’
;‚++ ) {

671 
nx
 = 
msc
->
tİoLi¡
[
n
];

673 ifĞ
nx
 =ğ
ix
 ||‚x =ğ
kx
 )

676 ifĞ
	`isP»deûssÜOf
Ğ
kx
, 
nx
 ))

678 
maxFš
 = 
	`tmax
ĞmaxFš, 
Ï‹¡Fš
[
nx
] + 
¦ack
 );

680 ifĞ!
š‹rã»
[
nx
][
kx
] || !interfere[kx][nx] ) {

682 ifĞ
—¾›¡Req
[
nx
] >ğ
Ï‹¡Fš
[
kx
] &&ƒ¬l›¡Req[nx] <†©e¡Fš[kx] + 
¦ack
 )

683 
maxFš
 = 
	`tmax
ĞmaxFš, 
Ï‹¡Fš
[
nx
] + (Ï‹¡Fš[
kx
] + 
¦ack
 - 
—¾›¡Req
[nx]) );

688 
®locGaš
 = 
	`e¡Gaš
Ğ
ti
, 
	`g‘AÎoÿ‹dSize
(
tk
) ) +ƒstGain(k, getAllocatedSize(ti) );

691 
maxFš
 -ğ(
Ï‹¡Fš
[
kx
] - 
—¾›¡Req
[kx]è+ 
®locGaš
;

693 
	`´štf
( "Current WCRT: %Lu\t Projected‡llocGain: %Lu\t Projected WCRT: %Lu\t Gain: %lf\n",

694 
msc
->
wüt
, 
®locGaš
, 
maxFš
, (() msc->wcrt - () maxFin) );

697 ifĞ
maxFš
 <ğ
msc
->
wüt
 && ( 
mšNewTime
 == 0 || maxFin < minNewTime )) {

698 
maxTask
 = 
kx
;

699 
maxVic
 = 
ix
;

701 
mšNewTime
 = 
maxFš
;

705 ifĞ
maxTask
 =ğ-1 || 
maxVic
 == -1 )

709 
	`´štf
Ğ"Elimš©š‹rã»nû % by %s\n", 
	`g‘TaskName
(
maxVic
), g‘TaskName(
maxTask
è); 
	`fæush
Ğ
¡dout
 );

710 
š‹rã»
[
maxTask
][
maxVic
] = 0;

711 
š‹rã»
[
maxVic
][
maxTask
] = 0;

715 
chªged
 = 
	`doTimšg
Ğ
msc
, 1 );

716 }  
chªged
 );

718 
	`´štf
Ğ"%s:\t[%12Lu/%12Lu, %12Lu/%12Lu)\n", 
	`g‘TaskName
(
maxVic
),

719 
—¾›¡Req
[
maxVic
], 
Ï‹¡Req
[maxVic], 
—¾›¡Fš
[maxVic], 
Ï‹¡Fš
[maxVic] );

720 
	`´štf
Ğ"%s:\t[%12Lu/%12Lu, %12Lu/%12Lu)\n\n", 
	`g‘TaskName
(
maxTask
),

721 
—¾›¡Req
[
maxTask
], 
Ï‹¡Req
[maxTask], 
—¾›¡Fš
[maxTask], 
Ï‹¡Fš
[maxTask] );

725 
round
++;

729 
	}
}

	@wcrt/timing.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

4 
	~<m©h.h
>

7 
	#DEBUGTHIS
 0

	)

11 
	$ÿnP»em±
Ğ
su¥eù
, 
viùim
 ) {

14 ifĞ
skLi¡
[
su¥eù
]->
³ID
 !ğskLi¡[
viùim
]->peID )

18 ifĞ
skLi¡
[
su¥eù
]->
´iÜ™y
 >askLi¡[
viùim
]->priority )

24 ifĞ
	`isP»deûssÜOf
Ğ
su¥eù
, 
viùim
 ) || isPredecessorOf( victim, suspect ))

28 ifĞ
—¾›¡Req
[
su¥eù
] > 0 && 
Ï‹¡Fš
[
viùim
] > 0 &&ƒarliestReq[suspect] >=†atestFin[victim] )

30 ifĞ
Ï‹¡Fš
[
su¥eù
] > 0 && 
—¾›¡Req
[
viùim
] > 0 &&†atestFin[suspect] <=ƒarliestReq[victim] )

34 ifĞ
—¾›¡Req
[
su¥eù
] > 0 && 
—¾›¡Fš
[
viùim
] > 0 && 
Ï‹¡Req
[su¥eù] > 0 && 
Ï‹¡Fš
[victim] > 0

35 && 
—¾›¡Req
[
su¥eù
] >ğ
—¾›¡Fš
[
viùim
] && 
Ï‹¡Req
[su¥eù] >ğ
Ï‹¡Fš
[victim] )

37 ifĞ
—¾›¡Fš
[
su¥eù
] > 0 && 
—¾›¡Req
[
viùim
] > 0 && 
Ï‹¡Fš
[su¥eù] > 0 && 
Ï‹¡Req
[victim] > 0

38 && 
—¾›¡Fš
[
su¥eù
] <ğ
—¾›¡Req
[
viùim
] && 
Ï‹¡Fš
[su¥eù] <ğ
Ï‹¡Req
[victim] )

42 
	}
}

46 
	$ÿnCÚæiù
Ğ
su¥eù
, 
viùim
 ) {

59 if(
skLi¡
[
su¥eù
]->
³ID
 =ğskLi¡[
viùim
]->peID)  0;

60 ifĞ
	`isP»deûssÜOf
Ğ
su¥eù
, 
viùim
 ))  0;

61 ifĞ
	`isP»deûssÜOf
Ğ
viùim
, 
su¥eù
))  0;

64 ifĞ
—¾›¡Req
[
su¥eù
] > 0 && 
Ï‹¡Fš
[
viùim
] > 0 &&ƒarliestReq[suspect] >=†atestFin[victim] )

67 ifĞ
—¾›¡Req
[
su¥eù
] > 0 && 
Ï‹¡Fš
[
viùim
] > 0 &&ƒarliestReq[victim] >=†atestFin[suspect] )

75 ifĞ(
Ï‹¡Fš
[
su¥eù
] > 0 &&†©e¡Fš[
viùim
] > 0 && 
—¾›¡Req
[victim] > 0) && (latestFin[suspect] >ƒarliestReq[victim]) && (latestFin[suspect] <=†atestFin[victim]))

78 ifĞ(
Ï‹¡Fš
[
su¥eù
] > 0 &&†©e¡Fš[
viùim
] > 0 && 
—¾›¡Req
[victim] > 0) && (latestFin[victim] >ƒarliestReq[suspect]) && (latestFin[victim] <=†atestFin[suspect]))

82 
	}
}

85 
	$fšdCr™iÿlP©h
Ğ
ch¬t_t
 *
msc
 ) {

87 
i
, 
k
, 
cu¼
;

88 
numCr™iÿl
;

90 
maxTask
 = -1;

91 
time_t
 
maxFš
 = 0;

94  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ )

95 
isCr™iÿl
[ 
msc
->
tİoLi¡
[
i
] ] = 0;

98  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

99 
ix
 = 
msc
->
tİoLi¡
[
i
];

100 ifĞ
maxFš
 < 
Ï‹¡Fš
[
ix
] ) {

101 
maxTask
 = 
ix
;

102 
maxFš
 = 
Ï‹¡Fš
[
ix
];

105 ifĞ
maxTask
 > -1 )

106 
isCr™iÿl
[
maxTask
] = 1;

109 
cu¼
 = 
maxTask
;

110  
cu¼
 > -1 ) {

111 
maxTask
 = -1;

112 
maxFš
 = 0;

113  
i
 = 0; i < 
skLi¡
[
cu¼
]->
numP»ds
; i++ ) {

114 
idk
 = 
skLi¡
[
cu¼
]->
´edLi¡
[
i
];

115 ifĞ
maxFš
 < 
Ï‹¡Fš
[
idk
] ) {

116 
maxTask
 = 
idk
;

117 
maxFš
 = 
Ï‹¡Fš
[
idk
];

120 ifĞ
maxTask
 > -1 )

121 
isCr™iÿl
[
maxTask
] = 1;

122 
cu¼
 = 
maxTask
;

126  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

127 
ix
 = 
msc
->
tİoLi¡
[
i
];

128 ifĞ!
isCr™iÿl
[
ix
] )

130  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

131 
kx
 = 
msc
->
tİoLi¡
[
k
];

132 ifĞ!
isCr™iÿl
[
kx
] && 
	`ÿnP»em±
(kx,
ix
) )

133 
isCr™iÿl
[
kx
] = 2;

137 
numCr™iÿl
 = 0;

139  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

140 
ix
 = 
msc
->
tİoLi¡
[
i
];

141 ifĞ
isCr™iÿl
[
ix
] > 0 ) {

142 
numCr™iÿl
++;

147 
®locweight
 = 
numCr™iÿl
 / (è
msc
->
tİoLi¡L’
;

151 
	}
}

154 
time_t
 
	$gxC®cHi
Ğ
ch¬t_t
 *
msc
, 
idx
, 
time_t
 
x
 ) {

156 
k
;

157 
time_t
 
š‹¼u±
 = 0;

162  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

163 
kx
 = 
msc
->
tİoLi¡
[
k
];

164 
sk_t
 *
tc
 = 
skLi¡
[
kx
];

165 ifĞ
kx
 !ğ
idx
 && 
	`ÿnP»em±
( kx, idx )) {

168 
š‹¼u±
 +ğ
tc
->
ùimeHi
;

174  (
skLi¡
[
idx
]->
ùimeHi
 + 
š‹¼u±
);

175 
	}
}

178 
time_t
 
	$gxC®cLo
Ğ
ch¬t_t
 *
msc
, 
idx
, 
time_t
 
x
 ) {

180 
k
;

181 
time_t
 
š‹¼u±
 = 0;

186  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

187 
kx
 = 
msc
->
tİoLi¡
[
k
];

188 
sk_t
 *
tc
 = 
skLi¡
[
kx
];

189 ifĞ
kx
 !ğ
idx
 && 
	`ÿnP»em±
( kx, idx )) {

192 
š‹¼u±
 +ğ
tc
->
ùimeLo
;

198  (
skLi¡
[
idx
]->
ùimeLo
 + 
š‹¼u±
);

199 
	}
}

202 
time_t
 
	$fixedPoštC®cHi
Ğ
ch¬t_t
 *
msc
, 
idx
 ) {

204 
k
;

205 
time_t
 
x
, 
gx
;

206 
ut
 = 0;

208  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

209 
kx
 = 
msc
->
tİoLi¡
[
k
];

210 
sk_t
 *
tc
 = 
skLi¡
[
kx
];

211 ifĞ
kx
 !ğ
idx
 && 
	`ÿnP»em±
( kx, idx )) {

212 
ut
 +ğ(
tc
->
ùimeHi
 / (ètc->
³riod
);

216 ifĞ
ut
 >= 1 )

217 
	`´štf
Ğ"\nScheduË i šãasibË.\n\n" ), 
	`ex™
(1);

219 
x
 = (
time_t
è
	`û
Ğ
skLi¡
[
idx
]->
ùimeHi
 / (1 - 
ut
));

221 
gx
 = 
	`gxC®cHi
Ğ
msc
, 
idx
, 
x
 );

223  
x
 < 
gx
 ) {

224 
x
 = 
gx
;

225 
gx
 = 
	`gxC®cHi
Ğ
msc
, 
idx
, 
x
 );

227  
x
;

228 
	}
}

231 
time_t
 
	$fixedPoštC®cLo
Ğ
ch¬t_t
 *
msc
, 
idx
 ) {

233 
k
;

234 
time_t
 
x
, 
gx
;

235 
ut
 = 0;

237  
k
 = 0; k < 
msc
->
tİoLi¡L’
; k++ ) {

238 
kx
 = 
msc
->
tİoLi¡
[
k
];

239 
sk_t
 *
tc
 = 
skLi¡
[
kx
];

240 ifĞ
kx
 !ğ
idx
 && 
	`ÿnP»em±
( kx, idx )) {

241 
ut
 +ğ(
tc
->
ùimeLo
 / (ètc->
³riod
);

245 ifĞ
ut
 >= 1 )

246 
	`´štf
Ğ"\nScheduË i šãasibË.\n\n" ), 
	`ex™
(1);

248 
x
 = (
time_t
è
	`æoÜ
Ğ
skLi¡
[
idx
]->
ùimeLo
 / (1 - 
ut
));

250 
gx
 = 
	`gxC®cLo
Ğ
msc
, 
idx
, 
x
 );

252  
x
 < 
gx
 ) {

253 
x
 = 
gx
;

254 
gx
 = 
	`gxC®cLo
Ğ
msc
, 
idx
, 
x
 );

256  
x
;

257 
	}
}

260 
	$Ï‹¡Times
Ğ
ch¬t_t
 *
msc
, *
tİoA¼
, 
tİosize
 ) {

262 
i
, 
j
, 
k
, 
idi
, 
idj
, 
æag
;

263 
chªged
 = 0;

268  
i
 = 0; i < 
tİosize
; i++ ) {

269 
idx
 = 
tİoA¼
[
i
];

270 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

274 
time_t
 
v®
 = 1;

275  
k
 = 0; k < 
tx
->
numP»ds
; k++ ) {

276 
idm
 = 
tx
->
´edLi¡
[
k
];

280 ifĞ
v®
 < 
Ï‹¡Fš
[
idm
] ) {

281 
v®
 = 
Ï‹¡Fš
[
idm
];

307 
Ï‹¡Req
[
idx
] = 
v®
;

315 
j
 = 0; j < 
tİosize
; j++)

317 
idj
 = 
tİoA¼
[
j
];

318 if(
i
 =ğ
j
) ;

319 if(
³”s
[
idx
][
idj
] == 1)

321 
Ï‹¡Req
[
idx
] =†©e¡Req[idx] + 
skLi¡
[
idj
]->
ùimeHi
;

328  
i
 = 
tİosize
 - 1; i >= 0; i-- ) {

329 
idx
 = 
tİoA¼
[
i
];

330 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

333 
time_t
 
wüt
 = 
skLi¡
[
idx
]->
ùimeHi
;

334 
time_t
 
v®ue
 = 
Ï‹¡Req
[
idx
] + 
wüt
;

335 ifĞ
Ï‹¡Fš
[
idx
] !ğ
v®ue
 ) {

336 
Ï‹¡Fš
[
idx
] = 
v®ue
;

337 
chªged
 = 1;

361  
chªged
;

362 
	}
}

365 
	$—¾›¡Times
Ğ
ch¬t_t
 *
msc
, *
tİoA¼
, 
tİosize
 ) {

367 
i
, 
k
;

368 
chªged
 = 0;

373  
i
 = 0; i < 
tİosize
; i++ ) {

374 
idx
 = 
tİoA¼
[
i
];

375 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

379 
time_t
 
v®
 = 1;

380  
k
 = 0; k < 
tx
->
numP»ds
; k++ ) {

381 
idm
 = 
tx
->
´edLi¡
[
k
];

385 ifĞ
v®
 < 
—¾›¡Fš
[
idm
] ) {

386 
v®
 = 
—¾›¡Fš
[
idm
];

392 
—¾›¡Req
[
idx
] = 
v®
;

397 
time_t
 
wüt
 = 
skLi¡
[
idx
]->
ùimeLo
;

398 
time_t
 
v®ue
 = 
—¾›¡Req
[
idx
] + 
wüt
;

399 ifĞ
—¾›¡Fš
[
idx
] < 
v®ue
 )

401 
—¾›¡Fš
[
idx
] = 
v®ue
;

402 
chªged
 = 1;

424  
chªged
;

425 
	}
}

432 
time_t
 
	$compu‹WCRT
Ğ
ch¬t_t
 *
msc
 ) {

434 
i
;

436 
isS‘
 = 0;

437 
time_t
 
mšS¹
 = 1;

438 
time_t
 
maxFš
 = 0;

440 
	`´štf
( "\n" );

441  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

442 
ix
 = 
msc
->
tİoLi¡
[
i
];

445 
	`´štf
Ğ"%s:\t[%8Lu/%8Lu, %8Lu/%8Lu)\n", 
	`g‘TaskName
(
ix
), 
—¾›¡Req
[ix], 
Ï‹¡Req
[ix], 
—¾›¡Fš
[ix], 
Ï‹¡Fš
[ix] );

448 ifĞ!
isS‘
 || 
mšS¹
 > 
—¾›¡Req
[
ix
] ) {

449 
mšS¹
 = 
—¾›¡Req
[
ix
];

450 
isS‘
 = 1;

452 ifĞ
maxFš
 < 
Ï‹¡Fš
[
ix
] )

453 
maxFš
 = 
Ï‹¡Fš
[
ix
];

455 
	`´štf
Ğ"ExecutiÚ„uÁime: [%Lu,%Lu): %Lu\n\n", 
mšS¹
, 
maxFš
, (maxFin - minStart) );

457  (
maxFš
 - 
mšS¹
);

458 
	}
}

460 
	$ov”Ïp
(
i
, 
j
)

462 if(
—¾›¡Req
[
i
] >ğ—¾›¡Req[
j
] &&ƒ¬l›¡Req[i] < 
Ï‹¡Req
[j])

464 if(
Ï‹¡Req
[
i
] > 
—¾›¡Req
[
j
] &&†atestReq[i] <=†atestReq[j])

467 
	}
}

470 
	$isP»d
(
ch¬t_t
 *
msc
, 
id
, 
´ed
)

472 
i
 = 0;

473 if(
skLi¡
[
id
]->
numP»ds
 == 0)

475 ; 
i
 < 
skLi¡
[
id
]->
numP»ds
; i++)

477 if(
skLi¡
[
id
]->
´edLi¡
[
i
] =ğ
´ed
)

479 if(
	`isP»d
(
msc
, 
skLi¡
[
id
]->
´edLi¡
[
i
], 
´ed
))

483 
	}
}

485 
	$timšgE¡im©eMSC
Ğ
ch¬t_t
 *
msc
 )

487 
i
, 
j
, 
Ën
, 
¡•
, 
idi
, 
idj
;

489 
time_t
 
ŞdWCRT
, 
ÃwWCRT
;

491 
¡•
 = 0;

492 
ŞdWCRT
 = 0;

493 
ÃwWCRT
 = 0;

494 
Ën
 = 
msc
->
tİoLi¡L’
;

498  
i
 = 0; i < 
msc
->
tİoLi¡L’
; i++ ) {

499 
id
 = 
msc
->
tİoLi¡
[
i
];

500 
—¾›¡Req
[
id
] = 1;

501 
Ï‹¡Req
 [
id
] = 1;

502 
Ï‹¡Req_cİy
[
id
] = 1;

503 
—¾›¡Fš
[
id
] = 0;

504 
Ï‹¡Fš
 [
id
] = 0;

507 
	`—¾›¡Times
Ğ
msc
, msc->
tİoLi¡
, 
Ën
 );

508 
	`Ï‹¡Times
Ğ
msc
, msc->
tİoLi¡
, 
Ën
);

534 
	`Ï‹¡Times
Ğ
msc
, msc->
tİoLi¡
, 
Ën
);

536 
i
 = 0; i < 
Ën
; i++)

538 
idi
 = 
msc
->
tİoLi¡
[
i
];

540 
j
 = 0; j < 
Ën
; j++)

542 
idj
 = 
msc
->
tİoLi¡
[
j
];

544 if(
i
 =ğ
j
 ||
skLi¡
[
idi
]->
³ID
 !ğskLi¡[
idj
]->peID)

547 if(!
	`isP»d
(
msc
, 
idj
, 
idi
 ) &&

548 !
	`isP»d
(
msc
, 
idi
, 
idj
 ) &&
	`ov”Ïp
(idi, idj))

550 
³”s
[
idi
][
idj
] = 1;

551 
³”s
[
idj
][
idi
] = 1;

558 
	`´štf
Ğ"\nAá”‡Çlysi round %d\n", 
¡•
 );

559 
ÃwWCRT
 = 
	`compu‹WCRT
Ğ
msc
 );

561 ifĞ
ÃwWCRT
 =ğ
ŞdWCRT
 )

566 
ŞdWCRT
 = 
ÃwWCRT
;

567 
¡•
++;

569 }  
¡•
 < 
MAXSTEP
 );

571 
msc
->
wüt
 = 
ÃwWCRT
;

574 
	}
}

	@wcrt/timingMSG.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<m©h.h
>

9 
	$cİyTask
Ğ
sk_t
 *
d¡
,ask_ˆ*
¤c
 ) {

11 
i
;

13 
	`¡rıy
Ğ
d¡
->
Šame
, 
¤c
->tname );

14 
d¡
->
aùÜID
 = 
¤c
->actorID;

15 
d¡
->
³ID
 = 
¤c
->peID;

16 
d¡
->
´iÜ™y
 = 
¤c
->priority;

17 
d¡
->
³riod
 = 
¤c
->period;

18 
d¡
->
ùimeLo
 = 
¤c
->ctimeLo;

19 
d¡
->
ùimeHi
 = 
¤c
->ctimeHi;

21 
d¡
->
numP»ds
 = 
¤c
->numPreds;

22 
d¡
->
´edLi¡
 = (*è
	`MALLOC
Ğd¡->´edLi¡, d¡->
numP»ds
 * (), "dst->predList" );

23  
i
 = 0; i < 
d¡
->
numP»ds
; i++ )

24 
d¡
->
´edLi¡
[
i
] = 
¤c
->predList[i];

26 
d¡
->
numSuccs
 = 
¤c
->numSuccs;

27 
d¡
->
succLi¡
 = (*è
	`MALLOC
Ğd¡->succLi¡, d¡->
numSuccs
 * (), "dst->succList" );

28  
i
 = 0; i < 
d¡
->
numSuccs
; i++ )

29 
d¡
->
succLi¡
[
i
] = 
¤c
->succList[i];

31 
d¡
->
numMemBlocks
 = 
¤c
->numMemBlocks;

32 
d¡
->
memBlockLi¡
 = (
mem_t
**è
	`MALLOC
Ğd¡->memBlockLi¡, d¡->
numMemBlocks
 * (mem_t*), "dst->memBlockList" );

33  
i
 = 0; i < 
d¡
->
numMemBlocks
; i++ )

34 
d¡
->
memBlockLi¡
[
i
] = 
¤c
->memBlockList[i];

36 
d¡
->
®loÿ‹d
 = (*è
	`CALLOC
Ğd¡->®loÿ‹d, d¡->
numMemBlocks
, (), "dst->allocated" );

39 
	}
}

42 
	$m­D•’d’cy
Ğ
sk_t
 *
tc
, *
m­
 ) {

44 
i
;

46  
i
 = 0; i < 
tc
->
numP»ds
; i++ )

47 
tc
->
´edLi¡
[
i
] = 
m­
[tc->predList[i]];

49  
i
 = 0; i < 
tc
->
numSuccs
; i++ )

50 
tc
->
succLi¡
[
i
] = 
m­
[tc->succList[i]];

53 
	}
}

63 
	$addCh¬tTasks
Ğ
ch¬tid
, 
ch¬t_t
 *
ùx
 ) {

65 
i
, 
k
;

67 *
m­
 = 
NULL
;

69 
ch¬t_t
 *
cid
 = &(
msg
[
ch¬tid
]);

70 
toDup
 = 
	`šLi¡
Ğ
cid
->
tİoLi¡
[0], 
ùx
->tİoLi¡, ctx->
tİoLi¡L’
 );

73 
ÃwËn
 = 
ùx
->
tİoLi¡L’
 + 
cid
->topoListLen;

74 
ùx
->
tİoLi¡
 = (*è
	`REALLOC
Ğùx->tİoLi¡, 
ÃwËn
 * (), "ctx->topoList" );

76 ifĞ
toDup
 ) {

79 
ÃwS¹
 = 
numTasks
;

81 
m­
 = (*è
	`MALLOC
Ğm­, 
numTasks
 * (), "map" );

82  
i
 = 0; i < 
numTasks
; i++ )

83 
m­
[
i
] = i;

85  
i
 = 0; i < 
cid
->
tİoLi¡L’
; i++ ) {

86 
idx
 = 
cid
->
tİoLi¡
[
i
];

89 
sk_t
 *
tc
 = (sk_t*è
	`MALLOC
(c, (task_t), "tc" );

90 
	`cİyTask
Ğ
tc
, 
skLi¡
[
idx
] );

93 
m­
[
idx
] = 
numTasks
;

98 
numTasks
++;

99 
skLi¡
 = (
sk_t
**è
	`REALLOC
ĞskLi¡, 
numTasks
 * (task_t*), "taskList" );

100 
skLi¡
[
numTasks
-1] = 
tc
;

106  
i
 = 
ÃwS¹
; i < 
numTasks
; i++ )

107 
	`m­D•’d’cy
Ğ
skLi¡
[
i
], 
m­
 );

112  
i
 = 0; i < 
cid
->
tİoLi¡L’
; i++ )

113 
ùx
->
tİoLi¡
[ùx->
tİoLi¡L’
 + 
i
] = 
m­
[
cid
->topoList[i]];

114 
ùx
->
tİoLi¡L’
 = 
ÃwËn
;

117  
k
 = 0; k < 
numPEs
; k++ ) {

118 
sched_t
 *
sc
 = 
ùx
->
PELi¡
[
k
];

119 
sched_t
 *
¤
 = 
cid
->
PELi¡
[
k
];

121 
Ãwassg
 = 
sc
->
numAssigÃd
 + 
¤
->numAssigned;

122 ifĞ
Ãwassg
 <= 0 )

125 
sc
->
assigÃdLi¡
 = (*è
	`REALLOC
Ğsc->assigÃdLi¡, 
Ãwassg
 * (), "sc->assignedList" );

126  
i
 = 0; i < 
¤
->
numAssigÃd
; i++ ) {

127 
sc
->
assigÃdLi¡
[sc->
numAssigÃd
 + 
i
] = 
m­
[
¤
->assignedList[i]];

129 
sc
->
numAssigÃd
 = 
Ãwassg
;

131 
	`ä“
Ğ
m­
 );

133  
ÃwËn
;

137  
i
 = 0; i < 
cid
->
tİoLi¡L’
; i++ )

138 
ùx
->
tİoLi¡
[ùx->
tİoLi¡L’
 + 
i
] = 
cid
->topoList[i];

139 
ùx
->
tİoLi¡L’
 = 
ÃwËn
;

141  
k
 = 0; k < 
numPEs
; k++ ) {

142 
sched_t
 *
sc
 = 
ùx
->
PELi¡
[
k
];

143 
sched_t
 *
¤
 = 
cid
->
PELi¡
[
k
];

145 
Ãwassg
 = 
sc
->
numAssigÃd
 + 
¤
->numAssigned;

146 ifĞ
Ãwassg
 <= 0 )

149 
sc
->
assigÃdLi¡
 = (*è
	`REALLOC
Ğsc->assigÃdLi¡, 
Ãwassg
 * (), "sc->assignedList" );

150  
i
 = 0; i < 
¤
->
numAssigÃd
; i++ ) {

151 
sc
->
assigÃdLi¡
[sc->
numAssigÃd
 + 
i
] = 
¤
->assignedList[i];

153 
sc
->
numAssigÃd
 = 
Ãwassg
;

155  
ÃwËn
;

156 
	}
}

159 
	$cİyCh¬t
Ğ
ch¬t_t
 *
Ãw
, ch¬t_ˆ*
¤c
, 
Ï¡node
, 
Ãxtsucc
 ) {

161 
i
;

162 
¡İnode
 = 
msg
[
Ï¡node
].
succLi¡
[
Ãxtsucc
-1];

163 
¡İsk
 = 
msg
[
¡İnode
].
tİoLi¡
[0];

165  
i
 = 0; i < 
¤c
->
tİoLi¡L’
; i++ ) {

166 ifĞ
¤c
->
tİoLi¡
[
i
] =ğ
¡İsk
 )

168 
	`’queue
Ğ
¤c
->
tİoLi¡
[
i
], &(
Ãw
->tİoLi¡), &Òew->
tİoLi¡L’
) );

170  
Ãw
->
tİoLi¡L’
;

171 
	}
}

178 
	$pİNode
Ğ*
node
, *
Ãxt
, **
bpSck
, **
ÃxtSucc
, *
Ën
 ) {

180 *
node
 = (*
bpSck
)[(*
Ën
)-1];

181 *
Ãxt
 = (*
ÃxtSucc
)[(*
Ën
)-1];

183 (*
ÃxtSucc
)[(*
Ën
)-1]++;

184 ifĞ(*
ÃxtSucc
)[(*
Ën
)-1] >ğ
msg
[(*Ën)-1].
numSuccs
 )

185 (*
Ën
)--;

188 
	}
}

191 
	$couÁEdge
Ğ
·th_t
 *
px
, 
¤c
, 
d¡
 ) {

193 
px
->
edgeBounds
[
¤c
][
d¡
]--;

194  
px
->
edgeBounds
[
¤c
][
d¡
];

195 
	}
}

203 
	$addCÚÿtD•’d’cy
Ğ
ch¬t_t
 *
cx
, **
´edRecÜd
, **
succRecÜd
, *
»cÜdL’
 ) {

205 
i
, 
k
;

207  
i
 = 0; i < 
cx
->
tİoLi¡L’
 - 1; i++ ) {

208 
ix
 = 
cx
->
tİoLi¡
[
i
];

209 
sk_t
 *
ti
 = 
skLi¡
[
ix
];

210 
found
 = 0;

212  
k
 = 
i
+1; !
found
 && k < 
cx
->
tİoLi¡L’
; k++ ) {

213 
kx
 = 
cx
->
tİoLi¡
[
k
];

214 
sk_t
 *
tk
 = 
skLi¡
[
kx
];

216 ifĞ
ti
->
aùÜID
 =ğ
tk
->actorID ) {

217 
found
 = 1;

218 
	`’queueUnique
Ğ
ix
, &(
tk
->
´edLi¡
), &Ñk->
numP»ds
) );

219 
	`’queueUnique
Ğ
kx
, &(
ti
->
succLi¡
), &Ñi->
numSuccs
) );

220 
	`’queuePaœ
Ğ
ix
, 
´edRecÜd
, 
kx
, 
succRecÜd
, 
»cÜdL’
 );

227 
	}
}

234 
	$»cov”CÚÿtD•’d’cy
Ğ*
´edRecÜd
, *
succRecÜd
, 
»cÜdL’
 ) {

236 
i
;

237 
sk_t
 *
tx
;

239  
i
 = 0; i < 
»cÜdL’
; i++ ) {

240 
´ed
 = 
´edRecÜd
[
i
];

241 
succ
 = 
succRecÜd
[
i
];

244 
tx
 = 
skLi¡
[
´ed
];

245 ifĞ
tx
->
succLi¡
[tx->
numSuccs
-1] =ğ
succ
 ) {

246 
tx
->
succLi¡
[tx->
numSuccs
-1] = -1;

247 
tx
->
numSuccs
--;

252 
tx
 = 
skLi¡
[
succ
];

253 ifĞ
tx
->
´edLi¡
[tx->
numP»ds
-1] =ğ
´ed
 ) {

254 
tx
->
´edLi¡
[tx->
numP»ds
-1] = -1;

255 
tx
->
numP»ds
--;

261 
	}
}

264 
	$š™P©h
Ğ
·th_t
 *
px
 ) {

266 
i
, 
k
;

268 
px
->
msc
 = (
ch¬t_t
*è
	`MALLOC
(…x->msc, (chart_t), "chart_t" );

269 
	`š™Ch¬t
Ğ
px
->
msc
 );

271 
px
->
edgeBounds
 = (**è
	`MALLOC
Ğpx->edgeBounds, 
numCh¬ts
 * (*), "px->edgeBounds" );

272  
i
 = 0; i < 
numCh¬ts
; i++ ) {

273 
px
->
edgeBounds
[
i
] = (*è
	`MALLOC
Ğpx->edgeBounds[i], 
numCh¬ts
 * (), "px->edgeBounds[i]" );

274  
k
 = 0; k < 
numCh¬ts
; k++ )

275 
px
->
edgeBounds
[
i
][
k
] = 
MAX_UNFOLD
;

277  
i
 = 0; i < 
numEdgeBounds
; i++ ) {

278 
edge_t
 *
eb
 = &(
edgeBounds
[
i
]);

279 
px
->
edgeBounds
[
eb
->
¤c
][eb->
d¡
] =ƒb->
bound
;

282 
	}
}

285 
	$cİyP©h
Ğ
·th_t
 *
Ãw
,…©h_ˆ*
¤c
, 
Ï¡node
, 
Ãxtsucc
 ) {

287 
i
;

288 
cu¼
, 
´ev
;

290 
¡İnode
 = 
msg
[
Ï¡node
].
succLi¡
[
Ãxtsucc
-1];

291 
¡İsk
 = 
msg
[
¡İnode
].
tİoLi¡
[0];

293 
´ev
 = -1;

294  
i
 = 0; i < 
¤c
->
msc
->
tİoLi¡L’
; i++ ) {

295 
cu¼
 = 
¤c
->
msc
->
tİoLi¡
[
i
];

296 ifĞ
cu¼
 =ğ
¡İsk
 )

298 
	`’queue
Ğ
cu¼
, &(
Ãw
->
msc
->
tİoLi¡
), &Òew->msc->
tİoLi¡L’
) );

299 ifĞ
´ev
 > -1 )

300 
	`couÁEdge
Ğ
Ãw
, 
´ev
, 
cu¼
 );

301 
´ev
 = 
cu¼
;

303  
Ãw
->
msc
->
tİoLi¡L’
;

304 
	}
}

307 
	$g‘NextV®idSuccId
Ğ
·th_t
 *
px
, 
ch¬tid
, 
äom
 ) {

309 
i
;

311  
i
 = 
äom
; i < 
msg
[
ch¬tid
].
numSuccs
; i++ ) {

312 
succ
 = 
msg
[
ch¬tid
].
succLi¡
[
i
];

313 ifĞ
px
->
edgeBounds
[
ch¬tid
][
succ
] > 0 )

314  
i
;

317 
	}
}

320 
	$timšgE¡im©e_synch_acyşic
() {

322 
i
, 
k
;

324 
time_t
 *
cummu
 = (time_t*è
	`CALLOC
Ğcummu, 
numCh¬ts
, (time_t), "cummulated WCRT" );

325 *
w·th
 = (*è
	`CALLOC
Ğw·th, 
numCh¬ts
, (), "WCRT…ath" );

327 ifĞ
®locm‘hod
 =ğ
NONE
 ) {

328  
i
 = 0; i < 
numCh¬ts
; i++ ) {

329 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

331 
	`timšgE¡im©eMSC
Ğ&(
msg
[
i
]) );

334 ifĞ
®locm‘hod
 =ğ
SLACK_CRITICAL
 ) {

335  
i
 = 0; i < 
numCh¬ts
; i++ ) {

336 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

337 
	`»£tAÎoÿtiÚ
Ğ&(
msg
[
i
]) );

338 
	`timšgAÎocMSC_¦ackCr™iÿl
Ğ&(
msg
[
i
]) );

342  
i
 = 0; i < 
numCh¬ts
; i++ ) {

343 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

344 
	`»£tAÎoÿtiÚ
Ğ&(
msg
[
i
]) );

345 
	`timšgAÎocMSC
Ğ&(
msg
[
i
]) );

349  
i
 = 0; i < 
numCh¬ts
; i++ )

350 
	`´štf
Ğ"WCRT[%d]: %Lu\n", 
i
, 
msg
[i].
wüt
 );

351 
	`´štf
( "\n" );

354  
i
 = 
numCh¬ts
-1; i >= 0; i-- ) {

355 
id
 = 
tİoMSG
[
i
];

357 
time_t
 
max
 = 0;

358 
maxID
 = -1;

361  
k
 = 0; k < 
msg
[
id
].
numSuccs
; k++ ) {

362 
sid
 = 
msg
[
id
].
succLi¡
[
k
];

363 ifĞ
cummu
[
sid
] > 
max
 ) {

364 
max
 = 
cummu
[
sid
];

365 
maxID
 = 
sid
;

368 
cummu
[
id
] = 
max
 + 
msg
[id].
wüt
;

369 
w·th
[
id
] = 
maxID
;

371 
	`´štf
Ğ"TÙ® WCRT: %Lu\n", 
cummu
[
tİoMSG
[0]] );

374 
i
 = 
tİoMSG
[0];

375 
	`´štf
( "Longest…ath:" );

376  
i
 != -1 ) {

377 
	`´štf
Ğ" %d", 
i
 );

378 
i
 = 
w·th
[i];

380 
	`´štf
( "\n" );

382 
	`ä“
Ğ
cummu
 );

383 
	`ä“
Ğ
w·th
 );

386 
	}
}

393 
	$timšgE¡im©e_synch
() {

395 
i
, 
k
;

396 
FILE
 *
pf
;

398 
sŞn
;

400 **
šcomšg
;

401 *
šcomšgL’
;

403 ifĞ
®locm‘hod
 =ğ
NONE
 ) {

404  
i
 = 0; i < 
numCh¬ts
; i++ ) {

405 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

407 
	`timšgE¡im©eMSC
Ğ&(
msg
[
i
]) );

410 ifĞ
®locm‘hod
 =ğ
SLACK_CRITICAL
 ) {

411  
i
 = 0; i < 
numCh¬ts
; i++ ) {

412 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

413 
	`»£tAÎoÿtiÚ
Ğ&(
msg
[
i
]) );

414 
	`timšgAÎocMSC_¦ackCr™iÿl
Ğ&(
msg
[
i
]) );

418  
i
 = 0; i < 
numCh¬ts
; i++ ) {

419 
	`»£tIÁ”ã»nû
Ğ&(
msg
[
i
]) );

420 
	`»£tAÎoÿtiÚ
Ğ&(
msg
[
i
]) );

421 
	`timšgAÎocMSC
Ğ&(
msg
[
i
]) );

425  
i
 = 0; i < 
numCh¬ts
; i++ )

426 
	`´štf
Ğ"WCRT[%d]: %Lu\n", 
i
, 
msg
[i].
wüt
 );

427 
	`´štf
( "\n" );

429 
pf
 = 
	`İ’fe
( "wcrtsyn.ilp", "w" );

435 
	`årštf
Ğ
pf
, "maximize\n" );

436  
i
 = 0; i < 
numCh¬ts
; i++ ) {

437 
	`årštf
Ğ
pf
, "%Lu Node%d", 
msg
[
i
].
wüt
, i );

438 ifĞ
i
 < 
numCh¬ts
 - 1 )

439 
	`årštf
Ğ
pf
, " + " );

443 
	`årštf
Ğ
pf
, "\nsubjecto\n" );

446 
	`årštf
Ğ
pf
, "Ya_%d = 1\n", 
¡¬tNode
 );

447 
	`årštf
Ğ
pf
, "Y%d_z = 1\n", 
’dNode
 );

450  
i
 = 0; i < 
numEdgeBounds
; i++ )

451 
	`årštf
Ğ
pf
, "Y%d_%d <ğ%d\n", 
edgeBounds
[
i
].
¤c
,ƒdgeBounds[i].
d¡
,ƒdgeBounds[i].
bound
 );

454  
i
 = 0; i < 
numCh¬ts
; i++ ) {

455 
ch¬t_t
 *
cx
 = &(
msg
[
i
]);

456 
	`årštf
Ğ
pf
, "Node%d", 
i
 );

457  
k
 = 0; k < 
cx
->
numSuccs
; k++ )

458 
	`årštf
Ğ
pf
, " - Y%d_%d", 
i
, 
cx
->
succLi¡
[
k
] );

460 ifĞ
i
 =ğ
’dNode
 )

461 
	`årštf
Ğ
pf
, " - Y%d_z", 
i
 );

462 
	`årštf
Ğ
pf
, " = 0\n" );

466 
šcomšg
 = (**è
	`MALLOC
Ğšcomšg, 
numCh¬ts
 * (*), "incoming" );

467 
šcomšgL’
 = (*è
	`CALLOC
ĞšcomšgL’, 
numCh¬ts
, (), "incomingLen" );

468  
i
 = 0; i < 
numCh¬ts
; i++ )

469 
šcomšg
[
i
] = 
NULL
;

471  
i
 = 0; i < 
numCh¬ts
; i++ ) {

472 
ch¬t_t
 *
cx
 = &(
msg
[
i
]);

473  
k
 = 0; k < 
cx
->
numSuccs
; k++ ) {

474 
sx
 = 
cx
->
succLi¡
[
k
];

475 
	`’queue
Ğ
i
, &(
šcomšg
[
sx
]), &(
šcomšgL’
[sx]) );

480  
i
 = 0; i < 
numCh¬ts
; i++ ) {

481 
	`årštf
Ğ
pf
, "Node%d", 
i
 );

482  
k
 = 0; k < 
šcomšgL’
[
i
]; k++ )

483 
	`årštf
Ğ
pf
, " - Y%d_%d", 
šcomšg
[
i
][
k
], i );

484 ifĞ
i
 =ğ
¡¬tNode
 )

485 
	`årštf
Ğ
pf
, " - Ya_%d", 
i
 );

486 
	`årštf
Ğ
pf
, " = 0\n" );

489 
	`årštf
Ğ
pf
, "end\n" );

503  
i
 = 0; i < 
numCh¬ts
; i++ )

504 
	`ä“
Ğ
šcomšg
[
i
] );

505 
	`ä“
Ğ
šcomšg
 );

506 
	`ä“
Ğ
šcomšgL’
 );

515 
	`fşo£
Ğ
pf
 );

519 
	`sy¡em
( "./solve wcrtsyn.ilp > wcrtsyn.sol" );

522 
	`sy¡em
( "grep objective wcrtsyn.sol |‡wk '{print $NF}' > wcrtsyn.val" );

524 
pf
 = 
	`İ’fe
( "wcrtsyn.val", "r" );

525 
	`fsÿnf
Ğ
pf
, "%Ë", &
sŞn
 );

526 
	`fşo£
Ğ
pf
 );

531 
	`´štf
Ğ"\nTÙ® WCRT: %Lu\n\n", (
time_t
è
sŞn
 );

534 
FILE
 *
f
;

535 
·th
[
MAXLEN
];

536 
	`¥rštf
(
·th
, "š‹rã»/%s.WCRT", 
times_™”©iÚ
);

537 
f
 = 
	`fİ’
(
·th
, "w");

538 
	`årštf
(
f
, "%Lu", (
time_t
è
sŞn
);

541 
	}
}

544 
	$timšgE¡im©e_asynch_acyşic
() {

547 
idx
;

548 
time_t
 
max
;

549 
ch¬t_t
 *
cx
, *
maxcx
, *
´evcx
;

551 
back±
;

552 
Ãxtsc
;

555 
backŒackËn
 = 0;

556 *
backŒack
 = 
NULL
;

557 *
Ãxtsucc
 = 
NULL
;

560 
»cÜdL’
;

561 *
´edRecÜd
;

562 *
succRecÜd
;

565 
numP©hs
 = 0;

568 
cx
 = (
ch¬t_t
*è
	`MALLOC
( cx, (chart_t), "chart_t" );

569 
	`š™Ch¬t
Ğ
cx
 );

573 
idx
 = 
¡¬tNode
;

575 
max
 = 0;

576 
maxcx
 = 
NULL
;

577 
´evcx
 = 
NULL
;

581 
	`addCh¬tTasks
Ğ
idx
, 
cx
 );

583 ifĞ
msg
[
idx
].
numSuccs
 <= 0 ) {

586 
numP©hs
++;

591 
»cÜdL’
 = 0;

592 
´edRecÜd
 = 
NULL
;

593 
succRecÜd
 = 
NULL
;

594 
	`addCÚÿtD•’d’cy
Ğ
cx
, &
´edRecÜd
, &
succRecÜd
, &
»cÜdL’
 );

598 
	`»£tIÁ”ã»nû
Ğ
cx
 );

600 ifĞ
®locm‘hod
 =ğ
NONE
 )

601 
	`timšgE¡im©eMSC
Ğ
cx
 );

603 
	`»£tAÎoÿtiÚ
Ğ
cx
 );

604 ifĞ
®locm‘hod
 =ğ
SLACK_CRITICAL
 )

605 
	`timšgAÎocMSC_¦ackCr™iÿl
Ğ
cx
 );

607 
	`timšgAÎocMSC
Ğ
cx
 );

611 
	`»cov”CÚÿtD•’d’cy
Ğ
´edRecÜd
, 
succRecÜd
, 
»cÜdL’
 );

612 
	`ä“
Ğ
´edRecÜd
 );

613 
	`ä“
Ğ
succRecÜd
 );

615 ifĞ
backŒackËn
 <= 0 )

618 
´evcx
 = 
cx
;

621 
cx
 = (
ch¬t_t
*è
	`MALLOC
( cx, (chart_t), "chart_t" );

622 
	`š™Ch¬t
Ğ
cx
 );

625 
	`pİNode
Ğ&
back±
, &
Ãxtsc
, &
backŒack
, &
Ãxtsucc
, &
backŒackËn
 );

629 
	`cİyCh¬t
Ğ
cx
, 
´evcx
, 
back±
, 
Ãxtsc
 );

632 
idx
 = 
msg
[
back±
].
succLi¡
[
Ãxtsc
];

634 
	`´štf
Ğ"WCRT[%d]: %Lu\n", 
numP©hs
-1, 
´evcx
->
wüt
 );

635 ifĞ
´evcx
->
wüt
 > 
max
 ) {

636 
max
 = 
´evcx
->
wüt
;

637 
maxcx
 = 
´evcx
;

640 
	`ä“Ch¬t
Ğ
´evcx
 );

646 ifĞ
msg
[
idx
].
numSuccs
 > 1 )

647 
	`’queuePaœ
Ğ
idx
, &
backŒack
, 1, &
Ãxtsucc
, &
backŒackËn
 );

650 
idx
 = 
msg
[idx].
succLi¡
[0];

664 
	`´štf
Ğ"\n\nGlob® WCRT: %Lu\n\n", 
max
 );

666 
	`´štTaskLi¡
Ğ
maxcx
 );

668 
	`ä“
Ğ
backŒack
 );

669 
	`ä“
Ğ
Ãxtsucc
 );

671 
	`ä“Ch¬t
Ğ
maxcx
 );

672 
	`ä“
Ğ
maxcx
 );

681 
	}
}

687 
	$timšgE¡im©e_asynch_
() {

689 
idx
, 
´ev
;

690 
time_t
 
max
;

692 
·th_t
 *
px
, *
maxpx
, *
´evpx
;

693 
ch¬t_t
 *
cx
;

695 
back±
;

696 
Ãxtsc
;

697 
ÃxŠextsc
;

700 
backŒackËn
 = 0;

701 *
backŒack
 = 
NULL
;

702 *
Ãxtsucc
 = 
NULL
;

705 
»cÜdL’
;

706 *
´edRecÜd
;

707 *
succRecÜd
;

710 
numP©hs
 = 0;

712 
FILE
 *
·thf
 = 
	`İ’fe
( "wcrtasyn.paths", "w" );

713 
	`årštf
Ğ
·thf
, "P©h %d\n", 
numP©hs
 );

714 
	`´štf
Ğ"P©h %d\n", 
numP©hs
 ); 
	`fæush
Ğ
¡dout
 );

716 
px
 = (
·th_t
*è
	`MALLOC
(…x, (path_t), "path_t" );

717 
	`š™P©h
Ğ
px
 );

720 
idx
 = 
¡¬tNode
;

723 
cx
 = &(
msg
[
’dNode
]);

724 
	`’queue
Ğ
numCh¬ts
, &(
cx
->
succLi¡
), &(cx->
numSuccs
) );

726 
max
 = 0;

727 
maxpx
 = 
NULL
;

728 
´evpx
 = 
NULL
;

732 
ch¬t_t
 *
cx
 = 
px
->
msc
;

734 
	`årštf
Ğ
·thf
, " %d", 
idx
 );

735 
	`´štf
Ğ" %d", 
idx
 ); 
	`fæush
Ğ
¡dout
 );

737 ifĞ
idx
 < 
numCh¬ts
 )

738 
	`addCh¬tTasks
Ğ
idx
, 
cx
 );

743 
numP©hs
++;

744 
	`årštf
Ğ
·thf
, "\n\n" );

745 
	`´štf
Ğ"\n\n" ); 
	`fæush
Ğ
¡dout
 );

748 
»cÜdL’
 = 0;

749 
´edRecÜd
 = 
NULL
;

750 
succRecÜd
 = 
NULL
;

751 
	`addCÚÿtD•’d’cy
Ğ
cx
, &
´edRecÜd
, &
succRecÜd
, &
»cÜdL’
 );

755 
	`»£tIÁ”ã»nû
Ğ
cx
 );

757 ifĞ
®locm‘hod
 =ğ
NONE
 )

758 
	`timšgE¡im©eMSC
Ğ
cx
 );

760 
	`»£tAÎoÿtiÚ
Ğ
cx
 );

761 ifĞ
®locm‘hod
 =ğ
SLACK_CRITICAL
 )

762 
	`timšgAÎocMSC_¦ackCr™iÿl
Ğ
cx
 );

764 
	`timšgAÎocMSC
Ğ
cx
 );

768 
	`»cov”CÚÿtD•’d’cy
Ğ
´edRecÜd
, 
succRecÜd
, 
»cÜdL’
 );

769 
	`ä“
Ğ
´edRecÜd
 );

770 
	`ä“
Ğ
succRecÜd
 );

772 ifĞ
backŒackËn
 <= 0 )

777 
	`pİNode
Ğ&
back±
, &
Ãxtsc
, &
backŒack
, &
Ãxtsucc
, &
backŒackËn
 );

778 
Ãxtsc
 = 
	`g‘NextV®idSuccId
Ğ
px
, 
back±
,‚extsc );

779 }  
Ãxtsc
 == -1 );

782 
idx
 = 
msg
[
back±
].
succLi¡
[
Ãxtsc
];

783 ifĞ
idx
 < 
numCh¬ts
 )

784 
	`couÁEdge
Ğ
px
, 
back±
, 
idx
 );

787 
´evpx
 = 
px
;

788 
px
 = (
·th_t
*è
	`MALLOC
(…x, (path_t), "path_t" );

789 
	`š™P©h
Ğ
px
 );

792 
	`cİyP©h
Ğ
px
, 
´evpx
, 
back±
, 
Ãxtsc
 );

794 
	`´štf
Ğ"WCRT[%d]: %Lu\n", 
numP©hs
-1, 
´evpx
->
msc
->
wüt
 );

795 ifĞ
´evpx
->
msc
->
wüt
 > 
max
 ) {

796 
max
 = 
´evpx
->
msc
->
wüt
;

797 
maxpx
 = 
´evpx
;

800 
	`ä“P©h
Ğ
´evpx
 );

802 
	`årštf
Ğ
·thf
, "P©h %d\n", 
numP©hs
 );

803 
	`´štf
Ğ"P©h %d\n", 
numP©hs
 ); 
	`fæush
Ğ
¡dout
 );

809 
Ãxtsc
 = 
	`g‘NextV®idSuccId
Ğ
px
, 
idx
, 0 );

810 ifĞ
Ãxtsc
 == -1 ) {

813 
	`årštf
Ğ
·thf
, " X\n\n" );

814 
	`´štf
Ğ" X\n\n" ); 
	`fæush
Ğ
¡dout
 );

816 ifĞ
backŒackËn
 <= 0 )

821 
	`pİNode
Ğ&
back±
, &
Ãxtsc
, &
backŒack
, &
Ãxtsucc
, &
backŒackËn
 );

822 
Ãxtsc
 = 
	`g‘NextV®idSuccId
Ğ
px
, 
back±
,‚extsc );

823 }  
Ãxtsc
 == -1 );

826 
idx
 = 
msg
[
back±
].
succLi¡
[
Ãxtsc
];

827 ifĞ
idx
 < 
numCh¬ts
 )

828 
	`couÁEdge
Ğ
px
, 
back±
, 
idx
 );

831 
´evpx
 = 
px
;

832 
px
 = (
·th_t
*è
	`MALLOC
(…x, (path_t), "path_t" );

833 
	`š™P©h
Ğ
px
 );

836 
	`cİyP©h
Ğ
px
, 
´evpx
, 
back±
, 
Ãxtsc
 );

838 
	`årštf
Ğ
·thf
, "P©h %d\n", 
numP©hs
 );

839 
	`´štf
Ğ"P©h %d\n", 
numP©hs
 ); 
	`fæush
Ğ
¡dout
 );

845 
ÃxŠextsc
 = 
	`g‘NextV®idSuccId
Ğ
px
, 
idx
, 
Ãxtsc
 + 1 );

846 ifĞ
Ãxtsc
 > -1 )

847 
	`’queuePaœ
Ğ
idx
, &
backŒack
, 
ÃxŠextsc
, &
Ãxtsucc
, &
backŒackËn
 );

850 
´ev
 = 
idx
;

851 
idx
 = 
msg
[
´ev
].
succLi¡
[
Ãxtsc
];

852 ifĞ
idx
 < 
numCh¬ts
 )

853 
	`couÁEdge
Ğ
px
, 
´ev
, 
idx
 );

855 
	`fşo£
Ğ
·thf
 );

857 
	`´štf
Ğ"\n\nGlob® WCRT: %Lu\n\n", 
max
 );

858 
	`´štTaskLi¡
Ğ
maxpx
->
msc
 );

860 
	`ä“
Ğ
backŒack
 );

861 
	`ä“
Ğ
Ãxtsucc
 );

863 
	`ä“P©h
Ğ
maxpx
 );

864 
	`ä“
Ğ
maxpx
 );

867 
	}
}

875 
	$timšgE¡im©e_asynch
() {

877 
FILE
 *
·thf
;

878 
tok’
[24];

880 
i
, 
idx
;

881 
id
, 
Ën
;

882 
ÜgNumTasks
;

884 
maxid
;

885 
time_t
 
max
;

886 
ch¬t_t
 *
cx
, *
maxcx
;

889 
»cÜdL’
;

890 *
´edRecÜd
;

891 *
succRecÜd
;

894 
·thf
 = 
	`İ’ãxt
Ğ
dgÇme
, "paths", "r" );

895  
	`fsÿnf
Ğ
·thf
, "% %d %d", 
tok’
, &
id
, &
Ën
 ) !ğ
EOF
 ) {

898 
cx
 = (
ch¬t_t
*è
	`MALLOC
( cx, (chart_t), "chart_t" );

899 
	`š™Ch¬t
Ğ
cx
 );

902 
ÜgNumTasks
 = 
numTasks
;

905 
	`´štf
Ğ"\nP©h %d:", 
id
 );

906  
i
 = 0; i < 
Ën
; i++ ) {

907 
	`fsÿnf
Ğ
·thf
, "%d", &
idx
 );

908 
	`´štf
Ğ" %d", 
idx
 );

909 
	`addCh¬tTasks
Ğ
idx
, 
cx
 );

914 
	`´štf
( "\n\n" );

917 ifĞ
numTasks
 > 
ÜgNumTasks
 ) {

919 
—¾›¡Req
 = (
time_t
*è
	`REALLOC
Ğ—¾›¡Req, 
numTasks
 * (time_t), "earliestReq" );

920 
Ï‹¡Req
 = (
time_t
*è
	`REALLOC
ĞÏ‹¡Req, 
numTasks
 * (time_t), "latestReq" );

921 
—¾›¡Fš
 = (
time_t
*è
	`REALLOC
Ğ—¾›¡Fš, 
numTasks
 * (time_t), "earliestFin" );

922 
Ï‹¡Fš
 = (
time_t
*è
	`REALLOC
ĞÏ‹¡Fš, 
numTasks
 * (time_t), "latestFin" );

924 
š‹rã»
 = (**è
	`REALLOC
Ğš‹rã», 
numTasks
 * (*), "interfere" );

925  
i
 = 0; i < 
numTasks
; i++ ) {

926 
š‹rã»
[
i
] = (*è
	`CALLOC
Ğš‹rã»[i], 
numTasks
, (), "interfere[i]" );

931 
»cÜdL’
 = 0;

932 
´edRecÜd
 = 
NULL
;

933 
succRecÜd
 = 
NULL
;

934 
	`addCÚÿtD•’d’cy
Ğ
cx
, &
´edRecÜd
, &
succRecÜd
, &
»cÜdL’
 );

938 
	`»£tIÁ”ã»nû
Ğ
cx
 );

940 ifĞ
®locm‘hod
 =ğ
NONE
 )

941 
	`timšgE¡im©eMSC
Ğ
cx
 );

943 
	`»£tAÎoÿtiÚ
Ğ
cx
 );

944 ifĞ
®locm‘hod
 =ğ
SLACK_CRITICAL
 )

945 
	`timšgAÎocMSC_¦ackCr™iÿl
Ğ
cx
 );

947 
	`timšgAÎocMSC
Ğ
cx
 );

951 
	`»cov”CÚÿtD•’d’cy
Ğ
´edRecÜd
, 
succRecÜd
, 
»cÜdL’
 );

952 
	`ä“
Ğ
´edRecÜd
 );

953 
	`ä“
Ğ
succRecÜd
 );

956 ifĞ
numTasks
 > 
ÜgNumTasks
 ) {

957  
i
 = 
ÜgNumTasks
; i < 
numTasks
; i++ ) {

958 
	`ä“Task
Ğ
skLi¡
[
i
] );

959 
	`ä“
Ğ
skLi¡
[
i
] );

960 
	`ä“
Ğ
š‹rã»
[
i
] );

962 
numTasks
 = 
ÜgNumTasks
;

965 
	`´štf
Ğ"WCRT[%d]: %Lu\n", 
id
, 
cx
->
wüt
 );

966 ifĞ
cx
->
wüt
 > 
max
 ) {

967 
max
 = 
cx
->
wüt
;

968 
maxid
 = 
id
;

969 
maxcx
 = 
cx
;

972 
	`ä“Ch¬t
Ğ
cx
 );

973 
	`ä“
Ğ
cx
 );

976 
	`fşo£
Ğ
·thf
 );

978 
	`´štf
Ğ"\n\nGlob® WCRT: %Lu\n\n", 
max
 );

979 
	`´štf
Ğ"WCRT P©h %d\n", 
maxid
 );

982 
	`ä“Ch¬t
Ğ
maxcx
 );

983 
	`ä“
Ğ
maxcx
 );

986 
	}
}

989 
	$timšgE¡im©e
() {

991 ifĞ
cÚÿt
 =ğ
ASYNCH
 )

992  
	`timšgE¡im©e_asynch
();

994  
	`timšgE¡im©e_synch
();

995 
	}
}

	@wcrt/topo.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

9 
	$cŞËùS¹Tasks
Ğ*
skIDLi¡
, 
numCh¬tTasks
, **
¡¬tTaskLi¡
 ) {

11 
k
, 
couÁ
;

13 
couÁ
 = 0;

14  
k
 = 0; k < 
numCh¬tTasks
; k++ ) {

15 
idx
 = 
skIDLi¡
[
k
];

16 ifĞ
skLi¡
[
idx
]->
numP»ds
 == 0 )

17 
	`’queue
Ğ
idx
, 
¡¬tTaskLi¡
, &
couÁ
 );

19  
couÁ
;

20 
	}
}

92 
	$tİoSÜt
Ğ*
skIDLi¡
, 
numCh¬tTasks
, **
tİoA¼
 ) {

94 
k
;

95 
tİosize
;

97 *
wÜkli¡
;

98 
wÜkli¡Ën
;

100 *
šdeg»e
 = (*è
	`MALLOC
Ğšdeg»e, 
numTasks
 * (), "indegree" );

101  
k
 = 0; k < 
numTasks
; k++ )

102 
šdeg»e
[
k
] = 
skLi¡
[k]->
numP»ds
;

105 
wÜkli¡
 = 
NULL
;

106 
wÜkli¡Ën
 = 
	`cŞËùS¹Tasks
Ğ
skIDLi¡
, 
numCh¬tTasks
, &
wÜkli¡
 );

117 
tİosize
 = 0;

120  
wÜkli¡Ën
 > 0 ) {

122 
idx
 = 
	`dequeue
Ğ&
wÜkli¡
, &
wÜkli¡Ën
 );

123 
sk_t
 *
tx
 = 
skLi¡
[
idx
];

126 
	`’queue
Ğ
idx
, 
tİoA¼
, &
tİosize
 );

129  
k
 = 0; k < 
tx
->
numSuccs
; k++ ) {

130 
idk
 = 
tx
->
succLi¡
[
k
];

133 
šdeg»e
[
idk
]--;

136 ifĞ
šdeg»e
[
idk
] == 0 )

137 
	`’queue
Ğ
idk
, &
wÜkli¡
, &
wÜkli¡Ën
 );

140 
	`ä“
Ğ
šdeg»e
 );

141 
	`ä“
Ğ
wÜkli¡
 );

143  
tİosize
;

144 
	}
}

150 
	$tİoTask
() {

152 
i
, 
k
;

154  
i
 = 0; i < 
numCh¬ts
; i++ ) {

155 *
tİoA¼
 = 
NULL
;

156 
tİosize
 = 
	`tİoSÜt
Ğ
msg
[
i
].
tİoLi¡
, msg[i].
tİoLi¡L’
, &
tİoA¼
 );

157 ifĞ
tİosize
 !ğ
msg
[
i
].
tİoLi¡L’
 )

158 
	`´štf
Ğ"WARNING: D‘eùed %d isŞ©edask š ch¬ˆ%d\n", (
tİosize
 - 
msg
[
i
].
tİoLi¡L’
), i );

161  
k
 = 0; k < 
tİosize
; k++ )

162 
msg
[
i
].
tİoLi¡
[
k
] = 
tİoA¼
[k];

163 
	`ä“
Ğ
tİoA¼
 );

166 
	}
}

172 
	$tİoG¿ph
() {

174 
i
, 
k
;

175 
tİosize
;

177 *
wÜkli¡
;

178 
wÜkli¡Ën
;

180 *
šdeg»e
 = (*è
	`CALLOC
Ğšdeg»e, 
numCh¬ts
, (), "indegree" );

181  
k
 = 0; k < 
numCh¬ts
; k++ ) {

182  
i
 = 0; i < 
msg
[
k
].
numSuccs
; i++ ) {

184 ifĞ
msg
[
k
].
succLi¡
[
i
] > k )

185 
šdeg»e
[
msg
[
k
].
succLi¡
[
i
]]++;

189 
wÜkli¡
 = 
NULL
;

190 
wÜkli¡Ën
 = 0;

192 
	`’queue
Ğ
¡¬tNode
, &
wÜkli¡
, &
wÜkli¡Ën
 );

195 
tİosize
 = 0;

196 
tİoMSG
 = 
NULL
;

199  
wÜkli¡Ën
 > 0 ) {

201 
idx
 = 
	`dequeue
Ğ&
wÜkli¡
, &
wÜkli¡Ën
 );

202 
ch¬t_t
 *
tx
 = &(
msg
[
idx
]);

205 
	`’queue
Ğ
idx
, &
tİoMSG
, &
tİosize
 );

208  
k
 = 0; k < 
tx
->
numSuccs
; k++ ) {

209 
idk
 = 
tx
->
succLi¡
[
k
];

212 ifĞ
idk
 < 
idx
 )

216 
šdeg»e
[
idk
]--;

219 ifĞ
šdeg»e
[
idk
] == 0 )

220 
	`’queue
Ğ
idk
, &
wÜkli¡
, &
wÜkli¡Ën
 );

223 
	`ä“
Ğ
šdeg»e
 );

224 
	`ä“
Ğ
wÜkli¡
 );

226  
tİosize
;

227 
	}
}

234 
	$tİoSÜtSubg¿ph
Ğ
¡¬tid
, **
tİoA¼
 ) {

236 
i
, 
idx
;

237 
fš
;

239 *
m¬kfš
 = (*è
	`CALLOC
Ğm¬kfš, 
numTasks
, (), "markfin" );

242 *
comeäom
 = 
NULL
;

245 
comeäomsize
 = 0;

246 
tİosize
 = 0;

248 
idx
 = 
¡¬tid
;

251 
sk_t
 *
tc
 = 
skLi¡
[
idx
];

255 
fš
 = 1;

256  
i
 = 0; 
fš
 && i < 
tc
->
numSuccs
; i++ )

257 ifĞ
m¬kfš
[
tc
->
succLi¡
[
i
]] != 2 )

258 
fš
 = 0;

260 ifĞ!
tc
->
numSuccs
 || 
fš
 ) {

261 
m¬kfš
[
idx
] = 2;

263 
	`’queue
Ğ
idx
, 
tİoA¼
, &
tİosize
 );

267 ifĞ!
comeäomsize
 )

270 
idx
 = 
comeäom
[ --
comeäomsize
 ];

274 
m¬kfš
[
idx
] = 1;

275 
	`’queue
Ğ
idx
, &
comeäom
, &
comeäomsize
 );

278 
fš
 = 1;

279  
i
 = 0; 
fš
 && i < 
tc
->
numSuccs
; i++ ) {

280 
sx
 = 
tc
->
succLi¡
[
i
];

281 ifĞ
m¬kfš
[
sx
] != 2 ) {

282 
idx
 = 
sx
;

283 
fš
 = 0;

287 ifĞ
fš
 )

288 
	`´štf
Ğ"Unvis™edask‚Ù d‘eùed.\n" ), 
	`ex™
(1);

292 
	`ä“
Ğ
comeäom
 );

293 
	`ä“
Ğ
m¬kfš
 );

295  
tİosize
;

296 
	}
}

	@wcrt/util.c

4 
	$šLi¡
Ğ
–em’t
, *
¬r
, 
Ën
 ) {

6 
i
;

7  
i
 = 0; i < 
Ën
; i++ )

8 ifĞ
¬r
[
i
] =ğ
–em’t
 )

11 
	}
}

17 
	$g‘IndexInLi¡
Ğ
–em’t
, *
¬r
, 
Ën
 ) {

19 
i
;

20  
i
 = 0; i < 
Ën
; i++ )

21 ifĞ
¬r
[
i
] =ğ
–em’t
 )

22  
i
;

24 
	}
}

30 
	$’queue
Ğ
–em’t
, **
¬r
, *
Ën
 ) {

32 (*
Ën
)++;

33 *
¬r
 = (*è
	`REALLOC
Ğ*¬r, (*
Ën
) * (), "arr" );

34 (*
¬r
)[(*
Ën
)-1] = 
–em’t
;

36  *
Ën
;

37 
	}
}

43 
	$’queueUnique
Ğ
–em’t
, **
¬r
, *
Ën
 ) {

45 ifĞ*
¬r
 !ğ
NULL
 && 
	`šLi¡
Ğ
–em’t
, *¬r, *
Ën
 ) )

46  *
Ën
;

48 (*
Ën
)++;

49 *
¬r
 = (*è
	`REALLOC
Ğ*¬r, (*
Ën
) * (), "arr" );

50 (*
¬r
)[(*
Ën
)-1] = 
–em’t
;

52  *
Ën
;

53 
	}
}

59 
	$’queuePaœ
Ğ
–em’t1
, **
¬r1
, 
–em’t2
, **
¬r2
, *
Ën
 ) {

61 (*
Ën
)++;

63 *
¬r1
 = (*è
	`REALLOC
Ğ*¬r1, (*
Ën
) * (), "arr1" );

64 (*
¬r1
)[(*
Ën
)-1] = 
–em’t1
;

66 *
¬r2
 = (*è
	`REALLOC
Ğ*¬r2, (*
Ën
) * (), "arr2" );

67 (*
¬r2
)[(*
Ën
)-1] = 
–em’t2
;

69  *
Ën
;

70 
	}
}

77 
	$dequeue
Ğ**
¬r
, *
Ën
 ) {

79 
i
;

80 
–em’t
 = (*
¬r
[0]);

81  
i
 = 0; i < (*
Ën
)-1; i++ )

82 (*
¬r
)[
i
] = (*arr)[i+1];

83 (*
Ën
)--;

85  
–em’t
;

86 
	}
}

93 
	$mymod
Ğ
a
, 
b
 ) {

95 
c
;

97 ifĞ
a
 >= 0 )

98  
a
 % 
b
;

100 
c
 = 
a
;

101  
c
 < 0 )

102 
c
 +ğ
b
;

104  
c
;

105 
	}
}

108 
	$imš
Ğ
a
, 
b
 ) {

110 ifĞ
a
 <ğ
b
 )

111  
a
;

112  
b
;

113 
	}
}

115 
time_t
 
	$tmax
Ğ
time_t
 
a
,ime_ˆ
b
 ) {

117 ifĞ
a
 >ğ
b
 )

118  
a
;

119  
b
;

120 
	}
}

	@busSchedule.c

1 
	~<¡dio.h
>

2 
	~<¡dlib.h
>

3 
	~<as£¹.h
>

6 
	$´”r
(* 
msg
)

8 
	`årštf
(
¡dout
, "%s\n", 
msg
);

9 
	`fæush
(
¡dout
);

10 
	`ex™
(-1);

11 
	}
}

14 #ifdeà
_DEBUG


15 
	$´št_cÜe_¥ecific_d©a
(
cÜe_sched_p
* 
h—d_cÜe
, 
ncÜe
, 
FILE
* 
å
)

17 
i
;

19 
i
 = 0; i < 
ncÜe
; i++)

21 
	`årštf
(
å
, "ScheduË fÜ cÜ%d ======> \n", 
i
);

22 
	`årštf
(
å
, "********************************************\n");

23 
	`årštf
(
å
, "CÜ¦Ù s¹imğ%Lu\n", 
h—d_cÜe
[
i
]->
¡¬t_time
);

24 
	`årštf
(
å
, "CÜ¦Ù iÁ”v® = %u\n", 
h—d_cÜe
[
i
]->
š‹rv®
);

25 
	`årštf
(
å
, "CÜ¦Ù†’gth = %u\n", 
h—d_cÜe
[
i
]->
¦Ù_Ën
);

26 
	`årštf
(
å
, "********************************************\n");

28 
	}
}

30 
	$´št_TDMA_sched
()

32 
FILE
* 
å
 = 
¡dout
;

33 
i
;

34 
£gm’t_p
 
£g
;

37 
	`as£¹
(
glob®_sched_d©a
);

38 
	`årštf
(
å
, "\n****************TDMA BUS SCHEDULE INFO********************\n\n");

39 
	`årštf
(
å
, "ScheduËy³ = %u\n", 
glob®_sched_d©a
->
ty³
);

40 
	`årštf
(
å
, "Numb” oà£gm’t ğ%u\n\n", 
glob®_sched_d©a
->
n_£gm’ts
);

41 
	`årštf
(
å
, "Numb” oàcÜe ğ%u\n\n", 
glob®_sched_d©a
->
n_cÜes
);

44 
i
 = 0; i < 
glob®_sched_d©a
->
n_£gm’ts
; i++)

46 
£g
 = 
glob®_sched_d©a
->
£g_li¡
[
i
];

47 
	`årštf
(
å
, "Segm’ˆid = %d ====> \n", 
i
);

48 
	`årštf
(
å
, "************************************************\n");

49 if(
glob®_sched_d©a
->
n_£gm’ts
 > 1)

51 
	`årštf
(
å
, "Segm’ˆ¡¬ˆtimğ%Lu\n", 
£g
->
£g_¡¬t
);

52 
	`årštf
(
å
, "Segm’ˆ’dimğ%Lu\n", 
£g
->
£g_’d
);

55 
	`´št_cÜe_¥ecific_d©a
(
£g
->
³r_cÜe_sched
, 
glob®_sched_d©a
->
n_cÜes
, 
å
);

57 
	`årštf
(
å
, "\n****************END TDMA BUS SCHEDULE INFO********************\n\n");

58 
	`årštf
(
å
, "\n");

59 
	}
}

63 
£gm’t_p
 
	$fšd_£gm’t
(
£gm’t_p
* 
h—d_£g
, 
n£gs
, 
uÎ
 
¡¬t_time
)

66  
NULL
;

67 
	}
}

70 
sched_p
 
	$g‘ScheduË
()

72  
glob®_sched_d©a
;

73 
	}
}

76 
	$£t_cÜe_¥ecific_d©a
(
cÜe_sched_p
* 
h—d_cÜe
, 
ncÜe
, 
FILE
* 
å
)

78 
i
;

79 
d–im™”
;

81 
	`as£¹
(
h—d_cÜe
);

83 
i
 = 0; i < 
ncÜe
; i++)

85 
h—d_cÜe
[
i
] = (
cÜe_sched_p
)
	`m®loc
((
cÜe_sched_s
));

86 if(!
h—d_cÜe
[
i
])

87 
	`´”r
("Error: Out of memory");

88 
	`mem£t
(
h—d_cÜe
[
i
], 0, (
cÜe_sched_s
));

89 
	`fsÿnf
(
å
, "%Lu", &(
h—d_cÜe
[
i
]->
¡¬t_time
));

90 
	`fsÿnf
(
å
, "%u", &(
h—d_cÜe
[
i
]->
š‹rv®
));

91 
	`fsÿnf
(
å
, "%u", &(
h—d_cÜe
[
i
]->
¦Ù_Ën
));

92 
	`fsÿnf
(
å
, "%u", &
d–im™”
);

93 if(
d–im™”
 > 0)

94 
	`´”r
("Error: TDMA bus schedule file is in wrong format");

96 
	}
}

98 
	$£tScheduË
(* 
sched_fe
)

100 
FILE
* 
å
;

101 
ušt
 
g‘d©a
;

102 
ušt
 
ncÜe
;

103 
ušt
 
n_£gs
, 
cur_£g
 = 0;

104 
£gm’t_p
 
£g
;

106 
å
 = 
	`fİ’
(
sched_fe
, "r");

107 if(!
å
)

109 
	`årštf
(
¡dout
, "Internal file opening failed\n");

110 
	`ex™
(-1);

125 
glob®_sched_d©a
 = (
sched_p
)
	`m®loc
((
sched_s
));

126 if(!
glob®_sched_d©a
)

127 
	`´”r
("Error: Out of memory");

128 
	`mem£t
(
glob®_sched_d©a
, 0, (
sched_s
));

131 
	`fsÿnf
(
å
, "%u", &
g‘d©a
);

132 
glob®_sched_d©a
->
ty³
 = 
g‘d©a
;

137 if(
g‘d©a
 == 0)

139 
n_£gs
 = 1;

140 
glob®_sched_d©a
->
n_£gm’ts
 = 1;

144 
	`fsÿnf
(
å
, "%u", &
n_£gs
);

145 
glob®_sched_d©a
->
n_£gm’ts
 = 
n_£gs
;

148 
glob®_sched_d©a
->
£g_li¡
 = (
£gm’t_p
 *)
	`m®loc
(
n_£gs
 * (segment_p));

149 if(!(
glob®_sched_d©a
->
£g_li¡
))

150 
	`´”r
("Error: Out of memory");

151 
	`mem£t
(
glob®_sched_d©a
->
£g_li¡
, 0, 
n_£gs
 * (
£gm’t_p
));

154 
	`fsÿnf
(
å
, "%u", &
ncÜe
);

155 
glob®_sched_d©a
->
n_cÜes
 = 
ncÜe
;

162 
£g
 = (
£gm’t_p
)
	`m®loc
((
£gm’t_s
));

163 if(!
£g
)

164 
	`´”r
("Error: Out of memory");

165 
	`mem£t
(
£g
, 0, (
£gm’t_s
));

166 
glob®_sched_d©a
->
£g_li¡
[
cur_£g
++] = 
£g
;

167 if(
n_£gs
 > 1)

170 
	`fsÿnf
(
å
, "%Lu", &(
£g
->
£g_¡¬t
));

171 
	`fsÿnf
(
å
, "%Lu", &(
£g
->
£g_’d
));

174 
£g
->
³r_cÜe_sched
 = (
cÜe_sched_p
 *)
	`m®loc
(
ncÜe
 * (core_sched_p));

175 if(!(
£g
->
³r_cÜe_sched
))

176 
	`´”r
("Error: Out of memory");

177 
	`mem£t
(
£g
->
³r_cÜe_sched
, 0, 
ncÜe
 * (
cÜe_sched_p
));

178 
	`£t_cÜe_¥ecific_d©a
(
£g
->
³r_cÜe_sched
, 
ncÜe
, 
å
);

181 if(
cur_£g
 =ğ
n_£gs
)

185 
	`fşo£
(
å
);

187 #ifdeà
_DEBUG


188 
	`´št_TDMA_sched
();

190 
	}
}

	@
1
.
0
51
667
DAG_WCET.c
analysis.c
analysis.h
analysisCache.c
analysisCacheL2.c
analysisDAG.c
analysisDAG_BCET.c
analysisDAG_WCET.c
analysisEnum.c
analysisILP.c
block.c
cycle_time.c
cycle_time.h
dump.c
findConflicts.c
handler.c
header.h
infeasible.c
infeasible.h
loopdetect.c
main.c
parse.c
parseCFG.c
path.c
pathDAG.c
pathTest.c
slacks.c
timing.c
timingMSG.c
topo.c
updateCacheL2.c
wcrt/alloc.c
wcrt/analysis.c
wcrt/cluster.c
wcrt/cycle_time.c
wcrt/cycle_time.h
wcrt/dp.c
wcrt/dump.c
wcrt/graphcoloring.c
wcrt/handler.c
wcrt/header.h
wcrt/knapsack.c
wcrt/main.c
wcrt/parse.c
wcrt/selectcontent.c
wcrt/slacks.c
wcrt/timing.c
wcrt/timingMSG.c
wcrt/topo.c
wcrt/util.c
busSchedule.c
